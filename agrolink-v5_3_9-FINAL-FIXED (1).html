<!DOCTYPE html>
<html lang="tr" x-data="agroApp()" :class="darkMode ? 'dark-theme' : ''">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AgroLink | Dijital TarÄ±m TopluluÄŸu</title>
    <meta name="description" content="AgroLink - Ã‡iftÃ§iler iÃ§in dijital tarÄ±m topluluÄŸu. Bilgi paylaÅŸ, Ã¼rÃ¼n sat, baÄŸlantÄ± kur.">
    
    <!-- ========== ASKERÄ° DÃœZEY GÃœVENLÄ°K BAÅžLANGIÃ‡ ========== -->
    <!-- Content Security Policy -->
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'self' https: wss:;
        script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.tailwindcss.com https://unpkg.com https://cdnjs.cloudflare.com https://cdn.socket.io;
        style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://fonts.googleapis.com;
        font-src 'self' https://cdnjs.cloudflare.com https://fonts.gstatic.com;
        img-src 'self' data: blob: https:;
        connect-src 'self' https: wss: ws:;
        frame-ancestors 'self' *;
        base-uri 'self';
        form-action 'self';
        upgrade-insecure-requests;
    ">
    <!-- XSS Protection -->
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <!-- No Sniffing -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <!-- Frame Options -->
    <meta http-equiv="X-Frame-Options" content="SAMEORIGIN">
    <!-- Referrer Policy -->
    <meta name="referrer" content="strict-origin-when-cross-origin">
    <!-- Permissions Policy -->
    <meta http-equiv="Permissions-Policy" content="accelerometer=(), camera=(self), geolocation=(self), gyroscope=(), magnetometer=(), microphone=(self), payment=(), usb=()">
    <!-- ========== ASKERÄ° DÃœZEY GÃœVENLÄ°K BÄ°TÄ°Åž ========== -->
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.6.2/axios.min.js"></script>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap');

        :root {
            --agro-green: #00b894;
            --bg-main: #f8fafc;
            --bg-card: #ffffff;
            --text-main: #1e293b;
            --text-sec: #64748b;
            --border: #e2e8f0;
            --input-bg: #f1f5f9;
        }

        .dark-theme {
            --bg-main: #0f172a;
            --bg-card: #1e293b;
            --text-main: #f1f5f9;
            --text-sec: #94a3b8;
            --border: #334155;
            --input-bg: #0f172a;
        }

        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: var(--bg-main); color: var(--text-main); transition: 0.3s; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; }
        
        /* ========== GELÄ°ÅžMÄ°Åž YÃœKLEME EKRANI ========== */
        .page-loading-overlay {
            position: fixed;
            inset: 0;
            z-index: 99999;
            background: linear-gradient(135deg, #0f172a 0%, #1e3a5f 50%, #0f172a 100%);
            background-size: 400% 400%;
            animation: gradientShift 8s ease infinite;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 30px;
        }
        .page-loading-overlay.hidden {
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.5s ease-out, visibility 0.5s ease-out;
        }
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .loading-logo {
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, #00b894 0%, #00cec9 50%, #0984e3 100%);
            border-radius: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: logoPulse 2s ease-in-out infinite, logoFloat 3s ease-in-out infinite;
            box-shadow: 0 20px 60px rgba(0, 184, 148, 0.4);
        }
        .loading-logo i {
            font-size: 48px;
            color: white;
            animation: leafSway 2s ease-in-out infinite;
        }
        @keyframes logoPulse {
            0%, 100% { transform: scale(1); box-shadow: 0 20px 60px rgba(0, 184, 148, 0.4); }
            50% { transform: scale(1.05); box-shadow: 0 25px 80px rgba(0, 184, 148, 0.6); }
        }
        @keyframes logoFloat {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-10px) scale(1.05); }
        }
        @keyframes leafSway {
            0%, 100% { transform: rotate(-5deg); }
            50% { transform: rotate(5deg); }
        }
        
        .loading-text {
            text-align: center;
        }
        .loading-text h2 {
            font-size: 28px;
            font-weight: 800;
            background: linear-gradient(90deg, #00b894, #00cec9, #0984e3, #00b894);
            background-size: 300% 100%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: textGradient 3s linear infinite;
        }
        .loading-text p {
            color: rgba(255,255,255,0.7);
            font-size: 14px;
            margin-top: 8px;
            animation: textFade 2s ease-in-out infinite;
        }
        @keyframes textGradient {
            0% { background-position: 0% 50%; }
            100% { background-position: 100% 50%; }
        }
        @keyframes textFade {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }
        
        .loading-dots {
            display: flex;
            gap: 8px;
            margin-top: 10px;
            justify-content: center;
        }
        .loading-dots span {
            width: 10px;
            height: 10px;
            background: #00b894;
            border-radius: 50%;
            animation: dotBounce 1.4s ease-in-out infinite;
        }
        .loading-dots span:nth-child(1) { animation-delay: 0s; }
        .loading-dots span:nth-child(2) { animation-delay: 0.2s; }
        .loading-dots span:nth-child(3) { animation-delay: 0.4s; }
        @keyframes dotBounce {
            0%, 80%, 100% { transform: scale(0.6); opacity: 0.5; }
            40% { transform: scale(1); opacity: 1; }
        }
        
        .loading-progress {
            width: 200px;
            height: 4px;
            background: rgba(255,255,255,0.1);
            border-radius: 2px;
            overflow: hidden;
            margin-top: 20px;
        }
        .loading-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #00b894, #00cec9);
            border-radius: 2px;
            animation: progressAnim 2s ease-in-out infinite;
        }
        @keyframes progressAnim {
            0% { width: 0%; transform: translateX(0); }
            50% { width: 70%; }
            100% { width: 100%; transform: translateX(0); }
        }
        
        /* Particles */
        .loading-particles {
            position: absolute;
            width: 100%;
            height: 100%;
            overflow: hidden;
            pointer-events: none;
        }
        .loading-particle {
            position: absolute;
            width: 6px;
            height: 6px;
            background: rgba(0, 184, 148, 0.5);
            border-radius: 50%;
            animation: particleFloat 4s ease-in-out infinite;
        }
        .loading-particle:nth-child(1) { left: 10%; top: 20%; animation-delay: 0s; }
        .loading-particle:nth-child(2) { left: 20%; top: 80%; animation-delay: 0.5s; }
        .loading-particle:nth-child(3) { left: 80%; top: 15%; animation-delay: 1s; }
        .loading-particle:nth-child(4) { left: 70%; top: 70%; animation-delay: 1.5s; }
        .loading-particle:nth-child(5) { left: 50%; top: 50%; animation-delay: 2s; }
        .loading-particle:nth-child(6) { left: 30%; top: 60%; animation-delay: 2.5s; }
        @keyframes particleFloat {
            0%, 100% { transform: translateY(0) scale(1); opacity: 0.5; }
            50% { transform: translateY(-30px) scale(1.2); opacity: 1; }
        }
        
        .page-loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(0, 184, 148, 0.2);
            border-top-color: #00b894;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .glass { background: var(--bg-card); backdrop-filter: blur(10px); border-bottom: 1px solid var(--border); }
        .agro-card { 
            background: var(--bg-card); 
            border: 1px solid var(--border); 
            border-radius: 24px;
            transition: all 0.3s ease;
        }
        .post-card-modern {
            background: var(--bg-card);
            border-radius: 28px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid var(--border);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
            position: relative;
        }
        .post-card-modern::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #00b894, #00cec9, #0984e3);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .post-card-modern:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px rgba(0, 184, 148, 0.15);
        }
        .post-card-modern:hover::before {
            opacity: 1;
        }
        [x-cloak] { display: none !important; }
        
        /* ========== KEÅžFET SAYFASI ========== */
        .explore-grid {
            columns: 2;
            column-gap: 8px;
        }
        .explore-card {
            break-inside: avoid;
            margin-bottom: 8px;
            border-radius: 16px;
            overflow: hidden;
            position: relative;
            background: var(--bg-card);
            border: 1px solid var(--border);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .explore-card:active {
            transform: scale(0.97);
        }
        .explore-card img, .explore-card video {
            width: 100%;
            display: block;
            object-fit: cover;
        }
        .explore-card-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.85) 0%, rgba(0,0,0,0.4) 50%, transparent 100%);
            padding: 40px 12px 12px;
            color: white;
        }
        .explore-card-stats {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 12px;
            font-weight: 700;
        }
        .explore-card-stats i {
            margin-right: 3px;
        }
        .explore-trending-badge {
            position: absolute;
            top: 10px;
            left: 10px;
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 10px;
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: 4px;
            box-shadow: 0 4px 12px rgba(238,90,36,0.4);
            z-index: 5;
        }
        .explore-category-chip {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
            flex-shrink: 0;
            background: var(--input-bg);
            color: var(--text-main);
            border: 1px solid var(--border);
        }
        .explore-category-chip.active {
            background: linear-gradient(135deg, #00b894, #00cec9);
            color: white;
            border-color: transparent;
            box-shadow: 0 4px 16px rgba(0,184,148,0.35);
        }
        .explore-category-chip:hover:not(.active) {
            background: var(--border);
        }
        .explore-text-card {
            padding: 16px;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        .explore-text-card.gradient-1 { background: linear-gradient(135deg, #00b894, #00cec9); color: white; }
        .explore-text-card.gradient-2 { background: linear-gradient(135deg, #6c5ce7, #a29bfe); color: white; }
        .explore-text-card.gradient-3 { background: linear-gradient(135deg, #fd79a8, #e17055); color: white; }
        .explore-text-card.gradient-4 { background: linear-gradient(135deg, #0984e3, #74b9ff); color: white; }
        
        /* ========== GELÄ°ÅžMÄ°Åž DM TASARIMI ========== */
        .dm-conversation-item {
            display: flex;
            align-items: center;
            gap: 14px;
            padding: 14px 16px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            background: var(--bg-card);
            border: 1px solid transparent;
        }
        .dm-conversation-item:hover {
            background: var(--input-bg);
            border-color: var(--border);
        }
        .dm-conversation-item:active {
            transform: scale(0.98);
        }
        .dm-avatar-wrapper {
            position: relative;
            flex-shrink: 0;
        }
        .dm-avatar {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--border);
        }
        .dm-online-dot {
            position: absolute;
            bottom: 2px;
            right: 2px;
            width: 14px;
            height: 14px;
            background: #00b894;
            border-radius: 50%;
            border: 3px solid var(--bg-card);
        }
        .dm-content {
            flex: 1;
            min-width: 0;
        }
        .dm-name-row {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 3px;
        }
        .dm-name {
            font-weight: 700;
            font-size: 15px;
            color: var(--text-main);
        }
        .dm-time {
            font-size: 11px;
            color: var(--text-sec);
            margin-left: auto;
            flex-shrink: 0;
        }
        .dm-last-message {
            font-size: 13px;
            color: var(--text-sec);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 200px;
        }
        .dm-last-message.unread {
            color: var(--text-main);
            font-weight: 600;
        }
        .dm-unread-badge {
            min-width: 22px;
            height: 22px;
            background: linear-gradient(135deg, #00b894, #00cec9);
            color: white;
            font-size: 11px;
            font-weight: 800;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 6px;
            flex-shrink: 0;
            box-shadow: 0 2px 8px rgba(0,184,148,0.4);
        }
        .dm-meta {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 6px;
            flex-shrink: 0;
        }
        .dm-delete-btn {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            width: 32px;
            height: 32px;
            background: rgba(239,68,68,0.1);
            color: #ef4444;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: all 0.2s;
        }
        .dm-conversation-item:hover .dm-delete-btn {
            opacity: 1;
        }
        .dm-delete-btn:hover {
            background: rgba(239,68,68,0.2);
        }
        
        /* Chat Header GeliÅŸmiÅŸ */
        .chat-header-pro {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            background: var(--bg-card);
            border-bottom: 1px solid var(--border);
            backdrop-filter: blur(20px);
        }
        .chat-header-info {
            flex: 1;
            min-width: 0;
        }
        .chat-header-name {
            font-weight: 800;
            font-size: 16px;
            color: var(--text-main);
        }
        .chat-header-status {
            font-size: 12px;
            color: #00b894;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        .chat-header-status::before {
            content: '';
            width: 6px;
            height: 6px;
            background: #00b894;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        .chat-action-btn {
            width: 38px;
            height: 38px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            font-size: 16px;
        }
        .chat-action-btn.video-btn {
            background: linear-gradient(135deg, #00b894, #00cec9);
            color: white;
            box-shadow: 0 4px 12px rgba(0,184,148,0.3);
        }
        .chat-action-btn.audio-btn {
            background: var(--input-bg);
            color: var(--text-main);
        }
        .chat-action-btn:active {
            transform: scale(0.9);
        }
        
        /* Chat Input GeliÅŸmiÅŸ */
        .chat-input-pro {
            padding: 12px 16px;
            background: var(--bg-card);
            border-top: 1px solid var(--border);
        }
        .chat-input-row {
            display: flex;
            align-items: center;
            gap: 8px;
            background: var(--input-bg);
            border-radius: 28px;
            padding: 4px 4px 4px 16px;
            border: 1px solid var(--border);
            transition: border-color 0.2s;
        }
        .chat-input-row:focus-within {
            border-color: var(--agro-green);
            box-shadow: 0 0 0 3px rgba(0,184,148,0.1);
        }
        .chat-input-field {
            flex: 1;
            border: none;
            background: transparent;
            outline: none;
            font-size: 14px;
            color: var(--text-main);
            padding: 8px 0;
        }
        .chat-input-field::placeholder {
            color: var(--text-sec);
        }
        .chat-send-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #00b894, #00cec9);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            flex-shrink: 0;
            box-shadow: 0 4px 12px rgba(0,184,148,0.3);
        }
        .chat-send-btn:active {
            transform: scale(0.9);
        }
        .chat-send-btn:disabled {
            opacity: 0.5;
            box-shadow: none;
        }
        .chat-attach-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-sec);
            transition: all 0.2s;
            flex-shrink: 0;
        }
        .chat-attach-btn:hover {
            color: var(--agro-green);
            background: rgba(0,184,148,0.1);
        }
        
        /* Resim ve medya indirmeyi engelle */
        img, video { 
            pointer-events: auto;
            -webkit-user-drag: none;
            -khtml-user-drag: none;
            -moz-user-drag: none;
            -o-user-drag: none;
            user-drag: none;
        }
        
        /* SaÄŸ tÄ±k menÃ¼sÃ¼nÃ¼ engelle */
        .no-context-menu {
            -webkit-touch-callout: none;
        }
        
        .btn-agro { background: var(--agro-green); color: white; border-radius: 16px; font-weight: 700; transition: 0.2s; }
        .btn-agro:active { transform: scale(0.95); }
        
        .nav-icon { 
            color: var(--text-sec); 
            font-size: 1.25rem; 
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
            position: relative;
            padding: 8px 16px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
        }
        .nav-icon:hover { 
            color: var(--agro-green); 
            background: rgba(16, 185, 129, 0.08);
        }
        .nav-icon.active { 
            color: var(--agro-green); 
            background: rgba(16, 185, 129, 0.12);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.2);
        }
        .nav-icon.active::after {
            content: '';
            position: absolute;
            bottom: 2px;
            left: 50%;
            transform: translateX(-50%);
            width: 6px;
            height: 6px;
            background: var(--agro-green);
            border-radius: 50%;
        }

        .poll-bar-bg { background: var(--input-bg); border-radius: 12px; height: 40px; position: relative; overflow: hidden; border: 1px solid var(--border); cursor: pointer; }
        .poll-bar-fill { background: var(--agro-green); opacity: 0.3; height: 100%; transition: 1s ease-out; position: absolute; left: 0; top: 0; }
        
        .story-ring { background: linear-gradient(45deg, #00b894, #00cec9, #0984e3); padding: 3px; border-radius: 50%; }
        .story-ring.watched { background: var(--border); }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        .animate-fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .animate-slide-up { animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(100px); } to { opacity: 1; transform: translateY(0); } }
        
        /* FEED POST ANÄ°MASYONLARI - YENÄ° */
        .post-card-animate {
            animation: postSlideIn 0.5s cubic-bezier(0.22, 1, 0.36, 1) forwards;
            opacity: 0;
        }
        @keyframes postSlideIn {
            from { 
                opacity: 0; 
                transform: translateY(30px) scale(0.98); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0) scale(1); 
            }
        }
        /* Staggered animasyon iÃ§in delay sÄ±nÄ±flarÄ± */
        .post-card-animate:nth-child(1) { animation-delay: 0ms; }
        .post-card-animate:nth-child(2) { animation-delay: 50ms; }
        .post-card-animate:nth-child(3) { animation-delay: 100ms; }
        .post-card-animate:nth-child(4) { animation-delay: 150ms; }
        .post-card-animate:nth-child(5) { animation-delay: 200ms; }
        .post-card-animate:nth-child(n+6) { animation-delay: 250ms; }
        
        .hashtag { color: var(--agro-green); font-weight: 600; cursor: pointer; }
        .hashtag:hover { text-decoration: underline; }
        .mention { color: #0984e3; font-weight: 600; cursor: pointer; }
        .mention:hover { text-decoration: underline; }
        
        .toast { position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%); background: #1e293b; color: white; padding: 12px 24px; border-radius: 12px; z-index: 9999; animation: fadeIn 0.3s; }
        
        /* ========== TIKTOK TARZI KAYDIRMA ========== */
        .tiktok-scroll-container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: black;
            z-index: 200;
            overflow: hidden;
        }
        
        .tiktok-scroll-wrapper {
            height: 100vh;
            overflow-y: scroll;
            scroll-snap-type: y mandatory;
            scroll-behavior: smooth;
        }
        
        .tiktok-post {
            height: 100vh;
            scroll-snap-align: start;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            background: black;
        }
        
        .tiktok-post img, .tiktok-post video {
            max-height: 100vh;
            max-width: 100%;
            object-fit: contain;
        }
        
        /* ========== INSTAGRAM TARZI KALP ATMA ANIMasyonu ========== */
        .heart-animation {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 100px;
            color: #ff3040;
            opacity: 0;
            pointer-events: none;
            z-index: 100;
        }
        
        .heart-animation.animate {
            animation: heartPop 0.8s ease-out;
        }
        
        @keyframes heartPop {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0); }
            15% { opacity: 1; transform: translate(-50%, -50%) scale(1.2); }
            30% { transform: translate(-50%, -50%) scale(0.95); }
            45% { transform: translate(-50%, -50%) scale(1.1); }
            80% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(0); }
        }
        
        /* ========== SAÄž TARAF EYLEM BUTONLARI (TikTok/Instagram tarzÄ±) ========== */
        .side-actions {
            position: absolute;
            right: 16px;
            bottom: 120px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            z-index: 50;
        }
        
        .side-action-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            color: white;
            background: rgba(0,0,0,0.3);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            justify-content: center;
            backdrop-filter: blur(4px);
        }
        
        .side-action-btn i {
            font-size: 24px;
        }
        
        .side-action-btn span {
            font-size: 12px;
            font-weight: 700;
        }
        
        /* ========== SES KAYIT BUTONU ========== */
        .voice-record-btn {
            position: relative;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--agro-green);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            transition: all 0.2s;
        }
        
        .voice-record-btn.recording {
            background: #ff3040;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .voice-wave {
            display: flex;
            align-items: center;
            gap: 2px;
            height: 20px;
        }
        
        .voice-wave span {
            width: 3px;
            background: var(--agro-green);
            border-radius: 2px;
            animation: wave 0.5s ease-in-out infinite;
        }
        
        .voice-wave span:nth-child(1) { animation-delay: 0s; height: 8px; }
        .voice-wave span:nth-child(2) { animation-delay: 0.1s; height: 16px; }
        .voice-wave span:nth-child(3) { animation-delay: 0.2s; height: 12px; }
        .voice-wave span:nth-child(4) { animation-delay: 0.3s; height: 20px; }
        .voice-wave span:nth-child(5) { animation-delay: 0.4s; height: 10px; }
        
        @keyframes wave {
            0%, 100% { transform: scaleY(1); }
            50% { transform: scaleY(1.5); }
        }
        
        /* ========== HÄ°KAYE GÃ–RÃœNTÃœLEYENLER ========== */
        .story-viewers-btn {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(0,0,0,0.6);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            backdrop-filter: blur(4px);
        }
        
        /* Profil sayfasÄ± stilleri - Twitter/X benzeri */
        .profile-header {
            position: relative;
        }
        
        .profile-cover-container {
            width: calc(100% - 2rem);
            margin: 0 1rem;
            height: 180px;
            border-radius: 1.5rem;
            overflow: hidden;
            background: linear-gradient(135deg, #00b894 0%, #00cec9 50%, #0984e3 100%);
        }
        
        .profile-cover-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .profile-avatar-container {
            position: absolute;
            bottom: -56px;
            left: 2rem;
        }
        
        .profile-avatar-ring {
            width: 112px;
            height: 112px;
            border-radius: 50%;
            border: 4px solid var(--bg-main);
            overflow: hidden;
            background: var(--bg-card);
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }
        
        .profile-avatar-ring img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .profile-edit-btn {
            position: absolute;
            bottom: -40px;
            right: 1.5rem;
        }
        
        .online-status {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            color: #00b894;
            font-size: 14px;
            font-weight: 500;
        }
        
        .online-status::before {
            content: '';
            width: 8px;
            height: 8px;
            background: #00b894;
            border-radius: 50%;
        }
        
        .profile-tabs {
            display: flex;
            border-bottom: 1px solid var(--border);
        }
        
        .profile-tab {
            flex: 1;
            padding: 1rem 0;
            text-align: center;
            font-weight: 600;
            font-size: 0.875rem;
            color: var(--text-sec);
            position: relative;
            transition: 0.2s;
            cursor: pointer;
        }
        
        .profile-tab:hover {
            background: var(--input-bg);
        }
        
        .profile-tab.active {
            color: var(--text-main);
        }
        
        .profile-tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 4px;
            background: #00b894;
            border-radius: 4px 4px 0 0;
        }
        
        .stat-inline {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            cursor: pointer;
        }
        
        .stat-inline:hover {
            text-decoration: underline;
        }
        
        .stat-inline strong {
            font-weight: 700;
        }
        
        .stat-inline span {
            color: var(--text-sec);
        }
        
        /* Video poster */
        .video-poster {
            position: relative;
            cursor: pointer;
        }
        .video-poster::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(to bottom, transparent 50%, rgba(0,0,0,0.5));
            border-radius: 1.2rem;
            pointer-events: none;
        }
        .video-play-btn {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 60px;
            height: 60px;
            background: rgba(255,255,255,0.9);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }
        .video-play-btn i {
            color: var(--agro-green);
            font-size: 24px;
            margin-left: 4px;
        }
        
        /* Bildirim avatar */
        .notif-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--agro-green);
        }
        
        /* Post aÃ§Ä±klama truncate */
        .content-truncated {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        /* CanlÄ± sohbet mesaj balonu */
        .chat-bubble-sent {
            background: var(--agro-green);
            color: white;
            border-radius: 20px 20px 4px 20px;
        }
        .chat-bubble-received {
            background: var(--input-bg);
            color: var(--text-main);
            border-radius: 20px 20px 20px 4px;
        }
        
        /* Ayarlar menÃ¼sÃ¼ */
        .settings-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px;
            border-radius: 16px;
            cursor: pointer;
            transition: 0.2s;
        }
        .settings-item:hover {
            background: var(--input-bg);
        }
        .settings-item.danger {
            color: #ef4444;
        }
        .settings-item.danger:hover {
            background: #fef2f2;
        }
        
        /* Instagram Verified Badge - Orijinal TasarÄ±m */
        .verified-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 18px;
            height: 18px;
            min-width: 18px;
            min-height: 18px;
            flex-shrink: 0;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .verified-badge:hover {
            transform: scale(1.1);
        }
        .verified-badge svg {
            width: 100%;
            height: 100%;
        }
        .verified-badge-sm {
            width: 14px;
            height: 14px;
            min-width: 14px;
            min-height: 14px;
        }
        .verified-badge-lg {
            width: 22px;
            height: 22px;
            min-width: 22px;
            min-height: 22px;
        }
        
        /* ========== Ã‡Ä°FTÃ‡Ä° YÃœKSEK ETKÄ°LEÅžÄ°M ROZETÄ° ========== */
        .farmer-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 50%, #b45309 100%);
            border-radius: 50%;
            width: 18px;
            height: 18px;
            min-width: 18px;
            min-height: 18px;
            flex-shrink: 0;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 2px 8px rgba(245, 158, 11, 0.4);
            position: relative;
            overflow: hidden;
        }
        .farmer-badge::before {
            content: 'ðŸŒ¾';
            font-size: 10px;
        }
        .farmer-badge:hover {
            transform: scale(1.15);
            box-shadow: 0 4px 16px rgba(245, 158, 11, 0.6);
        }
        .farmer-badge.farmer-badge-sm {
            width: 14px;
            height: 14px;
            min-width: 14px;
            min-height: 14px;
        }
        .farmer-badge.farmer-badge-sm::before {
            font-size: 8px;
        }
        .farmer-badge.farmer-badge-lg {
            width: 24px;
            height: 24px;
            min-width: 24px;
            min-height: 24px;
        }
        .farmer-badge.farmer-badge-lg::before {
            font-size: 14px;
        
        /* Verified Badge Tooltip */
        .verified-tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 12px 16px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            z-index: 100;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: 0.2s;
            margin-bottom: 8px;
        }
        .verified-tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 6px solid transparent;
            border-top-color: var(--bg-card);
        }
        .verified-badge-wrapper:hover .verified-tooltip {
            opacity: 1;
            visibility: visible;
        }
        .verified-badge-wrapper {
            position: relative;
            display: inline-flex;
        }
        
        /* Message read receipts */
        .message-status {
            display: inline-flex;
            align-items: center;
            gap: 2px;
            margin-left: 4px;
        }
        .message-status .check {
            color: rgba(255,255,255,0.5);
            font-size: 10px;
        }
        .message-status .check.read {
            color: #34d399;
        }
        .message-status-received {
            color: var(--text-sec);
        }
        .message-status-received .check.read {
            color: #00b894;
        }
        
        /* ========== GÄ°RÄ°Åž YAPMADAN Ä°Ã‡ERÄ°K GÄ°ZLEME ========== */
        /* JavaScript yÃ¼klenene kadar ana iÃ§eriÄŸi gizle */
        [x-cloak] { display: none !important; }
        
        /* GiriÅŸ yapÄ±lmadan ana uygulama iÃ§eriÄŸi gÃ¶rÃ¼ntÃ¼lenemez */
        .main-app-content {
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out;
        }
        
        .main-app-content.authenticated {
            opacity: 1;
            visibility: visible;
        }
        
        /* Auth ekranÄ± her zaman en Ã¼stte */
        .auth-overlay {
            position: fixed;
            inset: 0;
            z-index: 9999;
            background: #0f172a;
        }
        
        /* ========== ORTAK TAKÄ°PÃ‡Ä° BÃ–LÃœMÃœ ========== */
        .mutual-followers {
            display: flex !important;
            align-items: center;
            gap: 8px;
            padding: 12px 16px;
            background: var(--input-bg);
            border-radius: 16px;
            margin-top: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid var(--border);
        }
        .mutual-followers:hover {
            background: var(--border);
            transform: translateX(4px);
        }
        .mutual-followers-avatars {
            display: flex;
            flex-shrink: 0;
        }
        .mutual-followers-avatars > div,
        .mutual-followers-avatars img {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            border: 2px solid var(--bg-card);
            margin-left: -8px;
            object-fit: cover;
            flex-shrink: 0;
        }
        .mutual-followers-avatars > div:first-child,
        .mutual-followers-avatars img:first-child {
            margin-left: 0;
        }
        
        /* ========== PINCH TO ZOOM ========== */
        .pinch-zoom-container {
            position: fixed;
            inset: 0;
            z-index: 300;
            background: rgba(0,0,0,0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            touch-action: none;
        }
        .pinch-zoom-container img {
            max-width: 100%;
            max-height: 100%;
            transition: transform 0.1s ease-out;
        }
        .pinch-zoom-controls {
            position: absolute;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 16px;
            z-index: 10;
        }
        .pinch-zoom-controls button {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            color: white;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(4px);
            transition: 0.2s;
        }
        .pinch-zoom-controls button:hover {
            background: rgba(255,255,255,0.3);
        }
        
        /* ========== ONBOARDING / REHBER SÄ°STEMÄ° ========== */
        .onboarding-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 99990;
            transition: opacity 0.3s;
        }
        .onboarding-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .onboarding-highlight {
            position: absolute;
            border-radius: 16px;
            box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.75);
            z-index: 99991;
            pointer-events: none;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .onboarding-tooltip {
            position: absolute;
            background: white;
            border-radius: 20px;
            padding: 20px;
            max-width: 300px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            z-index: 99992;
            animation: tooltipBounce 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        @keyframes tooltipBounce {
            0% { opacity: 0; transform: scale(0.8) translateY(20px); }
            100% { opacity: 1; transform: scale(1) translateY(0); }
        }
        
        .onboarding-tooltip::before {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            background: white;
            transform: rotate(45deg);
        }
        .onboarding-tooltip.arrow-top::before {
            top: -8px;
            left: 50%;
            margin-left: -8px;
        }
        .onboarding-tooltip.arrow-bottom::before {
            bottom: -8px;
            left: 50%;
            margin-left: -8px;
        }
        .onboarding-tooltip.arrow-left::before {
            left: -8px;
            top: 50%;
            margin-top: -8px;
        }
        .onboarding-tooltip.arrow-right::before {
            right: -8px;
            top: 50%;
            margin-top: -8px;
        }
        
        .onboarding-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #00b894 0%, #00cec9 100%);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 12px;
        }
        .onboarding-icon i {
            font-size: 24px;
            color: white;
        }
        
        .onboarding-title {
            font-size: 18px;
            font-weight: 800;
            color: #1e293b;
            margin-bottom: 8px;
        }
        
        .onboarding-text {
            font-size: 14px;
            color: #64748b;
            line-height: 1.6;
            margin-bottom: 16px;
        }
        
        .onboarding-progress {
            display: flex;
            gap: 6px;
            margin-bottom: 16px;
        }
        .onboarding-progress-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #e2e8f0;
            transition: 0.3s;
        }
        .onboarding-progress-dot.active {
            background: #00b894;
            width: 24px;
            border-radius: 4px;
        }
        .onboarding-progress-dot.done {
            background: #00b894;
        }
        
        .onboarding-buttons {
            display: flex;
            gap: 10px;
        }
        .onboarding-btn {
            flex: 1;
            padding: 12px 16px;
            border-radius: 12px;
            font-weight: 700;
            font-size: 14px;
            cursor: pointer;
            transition: 0.2s;
        }
        .onboarding-btn-skip {
            background: #f1f5f9;
            color: #64748b;
        }
        .onboarding-btn-skip:hover {
            background: #e2e8f0;
        }
        .onboarding-btn-next {
            background: linear-gradient(135deg, #00b894 0%, #00cec9 100%);
            color: white;
        }
        .onboarding-btn-next:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 184, 148, 0.4);
        }
        
        .onboarding-step-counter {
            font-size: 12px;
            color: #94a3b8;
            text-align: center;
            margin-top: 12px;
        }
    </style>
</head>
<body @scroll.window="handleScroll" @contextmenu.prevent oncontextmenu="return false;" ondragstart="return false;">
    
    <!-- ========== GELÄ°ÅžMÄ°Åž YÃœKLEME EKRANI ========== -->
    <div id="pageLoadingOverlay" class="page-loading-overlay">
        <!-- ParÃ§acÄ±klar -->
        <div class="loading-particles">
            <div class="loading-particle"></div>
            <div class="loading-particle"></div>
            <div class="loading-particle"></div>
            <div class="loading-particle"></div>
            <div class="loading-particle"></div>
            <div class="loading-particle"></div>
        </div>
        
        <!-- Logo -->
        <div class="loading-logo">
            <i class="fas fa-leaf"></i>
        </div>
        
        <!-- Metin -->
        <div class="loading-text">
            <h2>AgroLink</h2>
            <p>Dijital TarÄ±m TopluluÄŸu</p>
            <div class="loading-dots">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        
        <!-- Ä°lerleme Ã§ubuÄŸu -->
        <div class="loading-progress">
            <div class="loading-progress-bar"></div>
        </div>
    </div>

    <!-- FALLBACK: Alpine.js yÃ¼klenemezse bile splash ekranÄ±nÄ± kapat -->
    <script>
    (function() {
        // 3 saniye sonra splash ekranÄ±nÄ± zorla kapat
        setTimeout(function() {
            var overlay = document.getElementById('pageLoadingOverlay');
            if (overlay && !overlay.classList.contains('hidden')) {
                console.warn('[AgroLink] Fallback: Splash ekranÄ± zorla kapatÄ±lÄ±yor...');
                overlay.classList.add('hidden');
                setTimeout(function() { overlay.remove(); }, 500);
            }
        }, 3000);
    })();
    </script>

    <!-- ========== ASKERÄ° DÃœZEY GÃœVENLÄ°K SÄ°STEMÄ° ========== -->
    <script>
    (function() {
        'use strict';
        
        // ========== 1. GLOBAL GÃœVENLÄ°K AYARLARI ==========
        const SECURITY_CONFIG = {
            enableAntiDebug: true,
            enableAntiTamper: true,
            enableXSSProtection: true,
            enableDOMProtection: true,
            enableConsoleProtection: true,
            maxErrorsBeforeLock: 500,
            sessionTimeout: 3600000, // 1 saat
            errorResetInterval: 60000 // 1 dakikada hata sayacÄ±nÄ± sÄ±fÄ±rla
        };
        
        let errorCount = 0;
        let isLocked = false;

        // Hata sayacÄ±nÄ± periyodik olarak sÄ±fÄ±rla (normal hatalar birikmesini Ã¶nler)
        setInterval(function() {
            if (errorCount > 0 && !isLocked) {
                errorCount = Math.max(0, errorCount - 50);
            }
        }, SECURITY_CONFIG.errorResetInterval);
        
        // ========== 2. XSS KORUMA - INPUT SANÄ°TÄ°ZASYONU ==========
        const XSSProtection = {
            // HTML karakterlerini escape et
            escapeHTML: function(str) {
                if (typeof str !== 'string') return str;
                const div = document.createElement('div');
                div.textContent = str;
                return div.innerHTML;
            },
            
            // Tehlikeli karakterleri temizle
            sanitize: function(input) {
                if (typeof input !== 'string') return input;
                return input
                    .replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi, '')
                    .replace(/javascript:/gi, '')
                    .replace(/on\w+\s*=/gi, '')
                    .replace(/<iframe/gi, '&lt;iframe')
                    .replace(/<object/gi, '&lt;object')
                    .replace(/<embed/gi, '&lt;embed')
                    .replace(/<form/gi, '&lt;form')
                    .replace(/expression\s*\(/gi, '')
                    .replace(/url\s*\(/gi, 'url (')
                    .replace(/<link/gi, '&lt;link')
                    .replace(/<meta/gi, '&lt;meta')
                    .replace(/<base/gi, '&lt;base');
            },
            
            // URL doÄŸrulama - data: ve blob: protokolleri XSS riski taÅŸÄ±dÄ±ÄŸÄ± iÃ§in kaldÄ±rÄ±ldÄ±
            isValidURL: function(url) {
                try {
                    const parsed = new URL(url, window.location.origin);
                    return ['http:', 'https:'].includes(parsed.protocol);
                } catch {
                    return false;
                }
            }
        };
        
        // Global XSS korumasÄ±nÄ± uygula
        window.sanitizeInput = XSSProtection.sanitize;
        window.escapeHTML = XSSProtection.escapeHTML;
        
        // ========== 3. DOM KORUMA ==========
        const DOMProtection = {
            observer: null,
            
            init: function() {
                if (!SECURITY_CONFIG.enableDOMProtection) return;
                
                // MutationObserver ile DOM deÄŸiÅŸikliklerini izle
                this.observer = new MutationObserver(function(mutations) {
                    mutations.forEach(function(mutation) {
                        if (mutation.type === 'childList') {
                            mutation.addedNodes.forEach(function(node) {
                                if (node.nodeType === 1) {
                                    // Script injection kontrolÃ¼
                                    if (node.tagName === 'SCRIPT' && !node.hasAttribute('data-trusted')) {
                                        node.remove();
                                        console.warn('[GÃœVENLÄ°K] Yetkisiz script engellendi');
                                    }
                                    // Inline event handler kontrolÃ¼
                                    DOMProtection.removeInlineHandlers(node);
                                }
                            });
                        }
                    });
                });
                
                this.observer.observe(document.documentElement, {
                    childList: true,
                    subtree: true
                });
            },
            
            removeInlineHandlers: function(element) {
                const dangerousAttrs = ['onclick', 'onerror', 'onload', 'onmouseover', 'onfocus', 'onblur'];
                dangerousAttrs.forEach(function(attr) {
                    if (element.hasAttribute && element.hasAttribute(attr) && !element.hasAttribute('data-trusted')) {
                        // Alpine.js ve gÃ¼venilir handler'larÄ± koru
                        const attrValue = element.getAttribute(attr);
                        if (attrValue && (attrValue.includes('eval(') || attrValue.includes('Function('))) {
                            element.removeAttribute(attr);
                        }
                    }
                });
            }
        };
        
        // ========== 4. ANTI-DEBUGGING KORUMA ==========
        const AntiDebug = {
            isDebuggerOpen: false,
            
            init: function() {
                if (!SECURITY_CONFIG.enableAntiDebug) return;
                
                // DevTools aÃ§Ä±k mÄ± kontrolÃ¼
                const threshold = 160;
                
                const checkDevTools = function() {
                    const widthThreshold = window.outerWidth - window.innerWidth > threshold;
                    const heightThreshold = window.outerHeight - window.innerHeight > threshold;
                    
                    if (widthThreshold || heightThreshold) {
                        AntiDebug.isDebuggerOpen = true;
                    }
                };
                
                setInterval(checkDevTools, 1000);
                
                // Debugger statement tuzaÄŸÄ± (pasif - sadece yavaÅŸlatÄ±r)
                // setInterval(function() { debugger; }, 100); // Devre dÄ±ÅŸÄ± - kullanÄ±cÄ± deneyimini etkiler
            }
        };
        
        // ========== 5. CONSOLE KORUMA ==========
        const ConsoleProtection = {
            init: function() {
                if (!SECURITY_CONFIG.enableConsoleProtection) return;
                
                // Console metodlarÄ±nÄ± override et (sadece production'da)
                const noop = function() {};
                const methods = ['log', 'debug', 'info', 'warn', 'error', 'table', 'trace'];
                
                // GeliÅŸtirme modunda console'u koru, production'da sÄ±nÄ±rla
                if (window.location.hostname !== 'localhost' && window.location.hostname !== '127.0.0.1') {
                    // Console'u tamamen devre dÄ±ÅŸÄ± bÄ±rakma - sadece uyarÄ± gÃ¶ster
                    const originalLog = console.log;
                    console.log = function() {
                        originalLog.apply(console, ['[GÃœVENLÄ°K] Console kullanÄ±mÄ± kaydediliyor...']);
                        originalLog.apply(console, arguments);
                    };
                }
            }
        };
        
        // ========== 6. ANTI-TAMPERING ==========
        const AntiTamper = {
            originalFunctions: new Map(),
            
            init: function() {
                if (!SECURITY_CONFIG.enableAntiTamper) return;
                
                // Kritik fonksiyonlarÄ± koru
                this.protect('fetch', window);
                this.protect('XMLHttpRequest', window);
                this.protect('WebSocket', window);
                
                // localStorage ve sessionStorage'Ä± koru
                this.protectStorage();
            },
            
            protect: function(fnName, obj) {
                const original = obj[fnName];
                if (original) {
                    this.originalFunctions.set(fnName, original);
                    Object.defineProperty(obj, fnName, {
                        configurable: false,
                        writable: false,
                        value: original
                    });
                }
            },
            
            protectStorage: function() {
                // Storage verilerini ÅŸifrele
                const originalSetItem = localStorage.setItem.bind(localStorage);
                const originalGetItem = localStorage.getItem.bind(localStorage);
                
                localStorage.setItem = function(key, value) {
                    // Hassas verileri iÅŸaretle
                    if (key.startsWith('_secure_')) {
                        value = btoa(encodeURIComponent(value));
                    }
                    return originalSetItem(key, value);
                };
                
                localStorage.getItem = function(key) {
                    let value = originalGetItem(key);
                    if (key.startsWith('_secure_') && value) {
                        try {
                            value = decodeURIComponent(atob(value));
                        } catch (e) {
                            value = null;
                        }
                    }
                    return value;
                };
            }
        };
        
        // ========== 7. HATA Ä°ZLEME VE KORUMA ==========
        const ErrorProtection = {
            init: function() {
                window.onerror = function(msg, url, lineNo, columnNo, error) {
                    // AÄŸ, socket ve baÄŸlantÄ± hatalarÄ±nÄ± gÃ¼venlik sayacÄ±ndan hariÃ§ tut
                    var msgStr = String(msg || '').toLowerCase();
                    var isNetworkError = msgStr.indexOf('network') !== -1 || 
                                         msgStr.indexOf('socket') !== -1 || 
                                         msgStr.indexOf('fetch') !== -1 || 
                                         msgStr.indexOf('xhr') !== -1 || 
                                         msgStr.indexOf('timeout') !== -1 ||
                                         msgStr.indexOf('cors') !== -1 ||
                                         msgStr.indexOf('failed to fetch') !== -1 ||
                                         msgStr.indexOf('websocket') !== -1 ||
                                         msgStr.indexOf('net::') !== -1 ||
                                         msgStr.indexOf('connection') !== -1;
                    
                    if (!isNetworkError) {
                        errorCount++;
                    }
                    
                    // Ã‡ok fazla hata = potansiyel saldÄ±rÄ±
                    if (errorCount > SECURITY_CONFIG.maxErrorsBeforeLock) {
                        isLocked = true;
                        SecurityLockout.lockSession('Ã‡ok fazla hata tespit edildi');
                        return true;
                    }
                    
                    // HatayÄ± logla ama yayÄ±lmasÄ±nÄ± ENGELLEME (debug iÃ§in gerekli)
                    console.warn('[GÃœVENLÄ°K] Hata yakalandÄ±:', msg);
                    return false; // HatanÄ±n normal ÅŸekilde raporlanmasÄ±na izin ver
                };
                
                // Promise rejection'larÄ± yakala - ama engelleme
                window.onunhandledrejection = function(event) {
                    // AÄŸ/baÄŸlantÄ± promise hatalarÄ±nÄ± sayma
                    var reason = String(event.reason || '').toLowerCase();
                    var isNetworkRejection = reason.indexOf('network') !== -1 || 
                                             reason.indexOf('fetch') !== -1 || 
                                             reason.indexOf('timeout') !== -1 ||
                                             reason.indexOf('socket') !== -1 ||
                                             reason.indexOf('abort') !== -1 ||
                                             reason.indexOf('connection') !== -1;
                    
                    if (!isNetworkRejection) {
                        errorCount++;
                    }
                    console.warn('[GÃœVENLÄ°K] Promise hatasÄ± yakalandÄ±:', event.reason);
                };
            }
        };
        
        // ========== 7.5. GÃœVENLÄ°K LOCKOUT SÄ°STEMÄ° ==========
        const SecurityLockout = {
            lockSession: function(reason) {
                    reason = reason || 'GÃ¼venlik ihlali tespit edildi';
                // XSS korumasÄ±: reason'Ä± escape et
                var safeReason = document.createElement('div');
                safeReason.textContent = reason;
                var escapedReason = safeReason.innerHTML;
                document.body.innerHTML = `
                    <div style="display:flex;align-items:center;justify-content:center;height:100vh;background:#0f172a;color:white;font-family:'Plus Jakarta Sans',sans-serif;">
                        <div style="text-align:center;max-width:400px;padding:40px;">
                            <div style="width:80px;height:80px;margin:0 auto 24px;background:rgba(239,68,68,0.1);border-radius:50%;display:flex;align-items:center;justify-content:center;">
                                <svg width="40" height="40" fill="none" stroke="#ef4444" stroke-width="2" viewBox="0 0 24 24">
                                    <path d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                                </svg>
                            </div>
                            <h1 style="font-size:24px;font-weight:700;margin-bottom:12px;">GÃ¼venlik UyarÄ±sÄ±</h1>
                            <p style="color:#94a3b8;margin-bottom:24px;">Oturumunuz gÃ¼venlik nedeniyle sonlandÄ±rÄ±ldÄ±.</p>
                            <p style="color:#64748b;font-size:14px;margin-bottom:24px;">${escapedReason}</p>
                            <button id="security-retry-btn" style="padding:14px 40px;background:#00b894;color:white;border:none;border-radius:12px;cursor:pointer;font-weight:600;font-size:16px;transition:transform 0.2s,opacity 0.2s;">
                                Yeniden Deneyelim
                            </button>
                        </div>
                    </div>
                `;
                
                // Yeniden Deneyelim butonuna tÄ±klandÄ±ÄŸÄ±nda
                setTimeout(function() {
                    var retryBtn = document.getElementById('security-retry-btn');
                    if (retryBtn) {
                        retryBtn.addEventListener('click', function() {
                            SecurityLockout.fullCleanupAndRedirect();
                        });
                    }
                }, 100);
            },
            
            fullCleanupAndRedirect: function() {
                try {
                    // 0. Sunucudaki TÃœM oturumlarÄ± sonlandÄ±r
                    var token = null;
                    try {
                        // SecureStorage'dan token al
                        var rawToken = localStorage.getItem('_secure_token');
                        if (rawToken) {
                            try { token = decodeURIComponent(atob(rawToken)); } catch(e) { token = rawToken; }
                        }
                        // Eski format
                        if (!token) {
                            token = localStorage.getItem('agrolink_token');
                        }
                    } catch(e) {}

                    var logoutPromise;
                    if (token) {
                        logoutPromise = fetch('/api/auth/logout-all', {
                            method: 'POST',
                            headers: {
                                'Authorization': 'Bearer ' + token,
                                'Content-Type': 'application/json'
                            }
                        }).catch(function() {});
                    } else {
                        logoutPromise = Promise.resolve();
                    }

                    // Sunucu Ã§aÄŸrÄ±sÄ±ndan sonra (veya hata olsa bile) temizle ve yÃ¶nlendir
                    logoutPromise.then(function() {
                        SecurityLockout._doFullCleanup();
                    }).catch(function() {
                        SecurityLockout._doFullCleanup();
                    });
                } catch(e) {
                    // Hata olursa yine de temizle ve yÃ¶nlendir
                    SecurityLockout._doFullCleanup();
                }
            },

            _doFullCleanup: function() {
                try {
                    // 1. localStorage'Ä± tamamen temizle
                    localStorage.clear();
                    
                    // 2. sessionStorage'Ä± temizle
                    sessionStorage.clear();
                    
                    // 3. TÃ¼m Ã§erezleri sil
                    document.cookie.split(";").forEach(function(c) {
                        document.cookie = c.replace(/^ +/, "").replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/");
                    });
                    
                    // 4. Service Worker cache temizle
                    if ('caches' in window) {
                        caches.keys().then(function(names) {
                            names.forEach(function(name) {
                                caches.delete(name);
                            });
                        });
                    }
                    
                    // 5. IndexedDB temizle (eÄŸer varsa)
                    if (window.indexedDB) {
                        try {
                            indexedDB.databases().then(function(dbs) {
                                dbs.forEach(function(db) {
                                    indexedDB.deleteDatabase(db.name);
                                });
                            });
                        } catch(e) {}
                    }
                    
                    // 6. SayfayÄ± login ekranÄ±na yÃ¶nlendir (cache'siz)
                    window.location.href = window.location.origin + window.location.pathname + '?_=' + Date.now();
                } catch(e) {
                    window.location.reload(true);
                }
            }
        };
        
        // Global eriÅŸim
        window.SecurityLockout = SecurityLockout;
        
        // ========== 7.6. HTTPS ZORUNLULUÄžU ==========
        const HTTPSEnforcement = {
            init: function() {
                // Sadece gerÃ§ek ortamda kontrol et (localhost hariÃ§)
                if (window.location.hostname !== 'localhost' && 
                    window.location.hostname !== '127.0.0.1' && 
                    !window.location.hostname.includes('.lovable.app')) {
                    
                    // HTTP ise HTTPS'e yÃ¶nlendir
                    if (window.location.protocol === 'http:') {
                        window.location.href = window.location.href.replace('http:', 'https:');
                        return;
                    }
                }
                
                // HTTP baÄŸlantÄ±larÄ± engelle
                this.blockHTTPRequests();
            },
            
            blockHTTPRequests: function() {
                // Fetch'i sarmalayarak HTTP isteklerini engelle
                var originalFetch = window.fetch;
                window.fetch = function(url, options) {
                    if (typeof url === 'string' && url.startsWith('http://') && 
                        !url.includes('localhost') && !url.includes('127.0.0.1')) {
                        console.warn('[GÃœVENLÄ°K] HTTP isteÄŸi engellendi:', url);
                        return Promise.reject(new Error('HTTP istekleri gÃ¼venlik nedeniyle engellendi. Sadece HTTPS kullanÄ±n.'));
                    }
                    return originalFetch.apply(this, arguments);
                };
                
                // XMLHttpRequest'i sarmalayarak HTTP isteklerini engelle
                var OriginalXHR = window.XMLHttpRequest;
                window.XMLHttpRequest = function() {
                    var xhr = new OriginalXHR();
                    var originalOpen = xhr.open.bind(xhr);
                    xhr.open = function(method, url) {
                        if (typeof url === 'string' && url.startsWith('http://') && 
                            !url.includes('localhost') && !url.includes('127.0.0.1')) {
                            console.warn('[GÃœVENLÄ°K] HTTP XHR isteÄŸi engellendi:', url);
                            throw new Error('HTTP istekleri gÃ¼venlik nedeniyle engellendi. Sadece HTTPS kullanÄ±n.');
                        }
                        return originalOpen.apply(xhr, arguments);
                    };
                    return xhr;
                };
            }
        };
        
        // ========== 8. SAÄž TIK VE KLAVYE KORUMA ==========
        const InputProtection = {
            init: function() {
                // SaÄŸ tÄ±k menÃ¼sÃ¼nÃ¼ engelle
                document.addEventListener('contextmenu', function(e) {
                    e.preventDefault();
                    return false;
                }, true);
                
                // Resim sÃ¼rÃ¼klemeyi engelle
                document.addEventListener('dragstart', function(e) {
                    if (e.target.tagName === 'IMG' || e.target.tagName === 'VIDEO') {
                        e.preventDefault();
                        return false;
                    }
                }, true);
                
                // Tehlikeli klavye kÄ±sayollarÄ±nÄ± engelle
                document.addEventListener('keydown', function(e) {
                    // F12 - DevTools
                    if (e.key === 'F12') {
                        e.preventDefault();
                        return false;
                    }
                    // Ctrl+U - Kaynak kodu
                    if (e.ctrlKey && e.key === 'u') {
                        e.preventDefault();
                        return false;
                    }
                    // Ctrl+S - Kaydet
                    if (e.ctrlKey && e.key === 's') {
                        e.preventDefault();
                        return false;
                    }
                    // Ctrl+Shift+I - DevTools
                    if (e.ctrlKey && e.shiftKey && e.key === 'I') {
                        e.preventDefault();
                        return false;
                    }
                    // Ctrl+Shift+J - Console
                    if (e.ctrlKey && e.shiftKey && e.key === 'J') {
                        e.preventDefault();
                        return false;
                    }
                    // Ctrl+Shift+C - Element seÃ§
                    if (e.ctrlKey && e.shiftKey && e.key === 'C') {
                        e.preventDefault();
                        return false;
                    }
                    // Ctrl+P - Print
                    if (e.ctrlKey && e.key === 'p') {
                        e.preventDefault();
                        return false;
                    }
                }, true);
                
                // Print engelle
                window.addEventListener('beforeprint', function(e) {
                    e.preventDefault();
                }, true);
                
                // SeÃ§imi engelle (metin kopyalamayÄ± zorlaÅŸtÄ±r)
                document.addEventListener('selectstart', function(e) {
                    if (e.target.tagName !== 'INPUT' && e.target.tagName !== 'TEXTAREA') {
                        // Sadece input/textarea dÄ±ÅŸÄ±nda engelle
                        // Bu satÄ±rÄ± yorum yaparak kullanÄ±cÄ± deneyimini bozmuyoruz
                        // e.preventDefault();
                    }
                }, true);
                
                // KopyalamayÄ± sÄ±nÄ±rla (resimlerde)
                document.addEventListener('copy', function(e) {
                    if (document.activeElement.tagName !== 'INPUT' && document.activeElement.tagName !== 'TEXTAREA') {
                        // Sadece uyarÄ± ver, engellemiyoruz
                        console.log('[GÃœVENLÄ°K] Kopyalama kaydedildi');
                    }
                });
            }
        };
        
        // ========== 9. CLICKJACKING KORUMA ==========
        const ClickjackingProtection = {
            init: function() {
                // Frame iÃ§inde yÃ¼klenmesini engelle
                if (window.self !== window.top) {
                    try {
                        window.top.location = window.self.location;
                    } catch (e) {
                        // Cross-origin frame - sayfayÄ± gizle
                        document.body.style.display = 'none';
                        alert('Bu sayfa bir iframe iÃ§inde gÃ¶rÃ¼ntÃ¼lenemez.');
                    }
                }
            }
        };
        
        // ========== 10. AXIOS GÃœVENLÄ°K Ä°NTERCEPTOR ==========
        const AxiosSecurity = {
            init: function() {
                if (typeof axios === 'undefined') return;
                
                // Request interceptor
                axios.interceptors.request.use(function(config) {
                    // XSS korumasÄ± - gÃ¶nderilen verileri sanitize et
                    if (config.data && typeof config.data === 'object') {
                        config.data = AxiosSecurity.sanitizeObject(config.data);
                    }
                    
                    // CSRF token ekle
                    const csrfToken = document.querySelector('meta[name="csrf-token"]');
                    if (csrfToken) {
                        config.headers['X-CSRF-Token'] = csrfToken.content;
                    }
                    
                    // Request ID ekle (izleme iÃ§in)
                    config.headers['X-Request-ID'] = AxiosSecurity.generateUUID();
                    
                    return config;
                }, function(error) {
                    return Promise.reject(error);
                });
                
                // Response interceptor
                axios.interceptors.response.use(function(response) {
                    return response;
                }, function(error) {
                    // 401/403 - Oturum sonlandÄ±rÄ±ldÄ±
                    if (error.response && (error.response.status === 401 || error.response.status === 403)) {
                        console.warn('[GÃœVENLÄ°K] Yetkisiz eriÅŸim tespit edildi');
                    }
                    return Promise.reject(error);
                });
            },
            
            sanitizeObject: function(obj) {
                if (typeof obj !== 'object' || obj === null) return obj;
                
                const sanitized = Array.isArray(obj) ? [] : {};
                for (const key in obj) {
                    if (obj.hasOwnProperty(key)) {
                        const value = obj[key];
                        if (typeof value === 'string') {
                            sanitized[key] = XSSProtection.sanitize(value);
                        } else if (typeof value === 'object') {
                            sanitized[key] = AxiosSecurity.sanitizeObject(value);
                        } else {
                            sanitized[key] = value;
                        }
                    }
                }
                return sanitized;
            },
            
            generateUUID: function() {
                return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                    const r = Math.random() * 16 | 0;
                    const v = c === 'x' ? r : (r & 0x3 | 0x8);
                    return v.toString(16);
                });
            }
        };
        
        // ========== 11. SESSION GÃœVENLÄ°ÄžÄ° ==========
        const SessionSecurity = {
            sessionStart: Date.now(),
            
            init: function() {
                // Session timeout kontrolÃ¼
                setInterval(function() {
                    if (Date.now() - SessionSecurity.sessionStart > SECURITY_CONFIG.sessionTimeout) {
                        // Session sÃ¼resi doldu
                        localStorage.removeItem('agrolink_user');
                        sessionStorage.clear();
                        console.warn('[GÃœVENLÄ°K] Oturum sÃ¼resi doldu');
                    }
                }, 60000);
                
                // Tab visibility - arka planda bÄ±rakÄ±lÄ±nca kontrol
                document.addEventListener('visibilitychange', function() {
                    if (document.visibilityState === 'visible') {
                        // Tab aktif olduÄŸunda session kontrolÃ¼
                        SessionSecurity.validateSession();
                    }
                });
            },
            
            validateSession: function() {
                // Session'Ä±n hala geÃ§erli olup olmadÄ±ÄŸÄ±nÄ± kontrol et
                const user = localStorage.getItem('agrolink_user');
                if (!user) return;
                
                try {
                    JSON.parse(user);
                } catch (e) {
                    // Bozuk session - temizle
                    localStorage.removeItem('agrolink_user');
                    console.warn('[GÃœVENLÄ°K] Bozuk oturum tespit edildi ve temizlendi');
                }
            }
        };
        
        // ========== 12. SAFE NULL/UNDEFINED KORUMA ==========
        const SafeAccess = {
            init: function() {
                // Global safe access fonksiyonu
                window.safeGet = function(obj, path, defaultValue) {
                    if (obj === null || obj === undefined) return defaultValue;
                    const keys = path.split('.');
                    let result = obj;
                    for (const key of keys) {
                        if (result === null || result === undefined) return defaultValue;
                        result = result[key];
                    }
                    return result !== undefined ? result : defaultValue;
                };
                
                // Safe JSON parse
                window.safeJSONParse = function(str, defaultValue) {
                    if (!str) return defaultValue;
                    try {
                        return JSON.parse(str);
                    } catch (e) {
                        console.warn('[GÃœVENLÄ°K] JSON parse hatasÄ±');
                        return defaultValue;
                    }
                };
                
                // Safe function call
                window.safeCall = function(fn, context, args, defaultValue) {
                    if (typeof fn !== 'function') return defaultValue;
                    try {
                        return fn.apply(context, args);
                    } catch (e) {
                        console.warn('[GÃœVENLÄ°K] Fonksiyon Ã§aÄŸrÄ±sÄ± hatasÄ±:', e.message);
                        return defaultValue;
                    }
                };
            }
        };
        
        // ========== 13. FORM GÃœVENLÄ°ÄžÄ° ==========
        const FormSecurity = {
            init: function() {
                // TÃ¼m formlarÄ± izle
                document.addEventListener('submit', function(e) {
                    const form = e.target;
                    if (form.tagName !== 'FORM') return;
                    
                    // Form verilerini sanitize et
                    const inputs = form.querySelectorAll('input, textarea');
                    inputs.forEach(function(input) {
                        if (input.type !== 'password' && input.type !== 'file') {
                            input.value = XSSProtection.sanitize(input.value);
                        }
                    });
                }, true);
                
                // Autocomplete'i hassas alanlarda kapat
                document.querySelectorAll('input[type="password"]').forEach(function(input) {
                    input.setAttribute('autocomplete', 'new-password');
                });
            }
        };
        
        // ========== 14. NETWORK GÃœVENLÄ°ÄžÄ° ==========
        const NetworkSecurity = {
            trustedOrigins: [
                window.location.origin,
                'https://cdn.tailwindcss.com',
                'https://unpkg.com',
                'https://cdnjs.cloudflare.com',
                'https://cdn.socket.io',
                'https://fonts.googleapis.com',
                'https://fonts.gstatic.com',
                'https://ui-avatars.com'
            ],
            
            init: function() {
                // Fetch'i wrap et ve kontrol ekle
                const originalFetch = window.fetch;
                window.fetch = function(url, options) {
                    // URL kontrolÃ¼
                    try {
                        const parsedURL = new URL(url, window.location.origin);
                        
                        // Mixed content kontrolÃ¼
                        if (window.location.protocol === 'https:' && parsedURL.protocol === 'http:') {
                            console.warn('[GÃœVENLÄ°K] Mixed content engellendi:', url);
                            return Promise.reject(new Error('Mixed content blocked'));
                        }
                    } catch (e) {
                        // URL parse hatasÄ± - izin ver (relative URL olabilir)
                    }
                    
                    return originalFetch.apply(window, arguments);
                };
            }
        };
        
        // ========== 15. INTEGRITY CHECK ==========
        const IntegrityCheck = {
            checksums: new Map(),
            
            init: function() {
                // Kritik elementlerin hash'ini al
                const criticalElements = document.querySelectorAll('[data-integrity]');
                criticalElements.forEach(function(el) {
                    IntegrityCheck.checksums.set(el.id, IntegrityCheck.hash(el.innerHTML));
                });
                
                // Periyodik kontrol
                setInterval(function() {
                    IntegrityCheck.verify();
                }, 30000);
            },
            
            hash: function(str) {
                let hash = 0;
                for (let i = 0; i < str.length; i++) {
                    const char = str.charCodeAt(i);
                    hash = ((hash << 5) - hash) + char;
                    hash = hash & hash;
                }
                return hash.toString(16);
            },
            
            verify: function() {
                this.checksums.forEach(function(originalHash, elementId) {
                    const element = document.getElementById(elementId);
                    if (element) {
                        const currentHash = IntegrityCheck.hash(element.innerHTML);
                        if (currentHash !== originalHash) {
                            console.warn('[GÃœVENLÄ°K] DeÄŸiÅŸiklik tespit edildi:', elementId);
                        }
                    }
                });
            }
        };
        
        // ========== TÃœM GÃœVENLÄ°K SÄ°STEMLERÄ°NÄ° BAÅžLAT ==========
        function initializeSecurity() {
            try {
                // HTTPS zorunluluÄŸunu en baÅŸta kontrol et
                HTTPSEnforcement.init();
                
                ErrorProtection.init();
                SafeAccess.init();
                InputProtection.init();
                ClickjackingProtection.init();
                DOMProtection.init();
                // AntiDebug.init(); // KullanÄ±cÄ± deneyimini etkileyebilir, isteÄŸe baÄŸlÄ±
                // ConsoleProtection.init(); // GeliÅŸtirme iÃ§in kapalÄ±
                AntiTamper.init();
                SessionSecurity.init();
                FormSecurity.init();
                NetworkSecurity.init();
                IntegrityCheck.init();
                
                // Axios yÃ¼klendikten sonra
                if (typeof axios !== 'undefined') {
                    AxiosSecurity.init();
                } else {
                    window.addEventListener('load', function() {
                        if (typeof axios !== 'undefined') {
                            AxiosSecurity.init();
                        }
                    });
                }
                
                console.log('%c[AgroLink GÃ¼venlik] Askeri dÃ¼zey koruma aktif', 'color: #00b894; font-weight: bold; font-size: 14px;');
            } catch (e) {
                console.error('[GÃœVENLÄ°K] BaÅŸlatma hatasÄ±:', e);
            }
        }
        
        // DOM hazÄ±r olduÄŸunda baÅŸlat
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeSecurity);
        } else {
            initializeSecurity();
        }
        
        // ========== GLOBAL ERÄ°ÅžÄ°M Ä°Ã‡Ä°N EXPORT ==========
        window.AgroSecurity = {
            sanitize: XSSProtection.sanitize,
            escapeHTML: XSSProtection.escapeHTML,
            isValidURL: XSSProtection.isValidURL,
            safeGet: window.safeGet,
            safeJSONParse: window.safeJSONParse,
            safeCall: window.safeCall
        };
        
        // ========== CONSOLE KORUMA - SecureStorage EriÅŸimini Engelle ==========
        // Freeze ile deÄŸiÅŸtirilemez yap
        Object.freeze(window.AgroSecurity);
        
        // Console'dan localStorage eriÅŸimini izle
        if (window.location.hostname !== 'localhost' && window.location.hostname !== '127.0.0.1') {
            const originalGetItem = localStorage.getItem.bind(localStorage);
            const originalSetItem = localStorage.setItem.bind(localStorage);
            
            // Sadece gÃ¼venli prefix'li verilere izin ver, ham verileri temizle
            setTimeout(function() {
                // Eski ham verileri temizle
                const keysToRemove = ['token', 'user', 'agrolink_user'];
                keysToRemove.forEach(key => {
                    if (localStorage.getItem(key)) {
                        console.warn('[GÃœVENLÄ°K] GÃ¼vensiz veri tespit edildi ve temizlendi:', key);
                        localStorage.removeItem(key);
                    }
                });
            }, 2000);
        }
        
    })();
    </script>

    <!-- TOAST BÄ°LDÄ°RÄ°MÄ° -->
    <div x-show="toast.show" x-transition class="toast" x-text="toast.message"></div>

    <!-- ========== 2FA DOÄžRULAMA MODAL ========== -->
    <template x-if="show2FAModal">
        <div class="fixed inset-0 z-[99999] bg-black/80 backdrop-blur-sm flex items-center justify-center p-4">
            <div class="w-full max-w-md bg-white rounded-[2.5rem] p-8 shadow-2xl animate-slide-up">
                <div class="text-center mb-8">
                    <div class="w-20 h-20 bg-gradient-to-br from-emerald-500 to-teal-600 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg">
                        <i class="fas fa-shield-alt text-white text-3xl"></i>
                    </div>
                    <h2 class="text-2xl font-black text-slate-900">Ä°ki AdÄ±mlÄ± DoÄŸrulama</h2>
                    <p class="text-slate-500 mt-2">GÃ¼venliÄŸiniz iÃ§in e-posta adresinize 6 haneli bir kod gÃ¶nderdik.</p>
                    <p class="text-emerald-600 font-bold mt-1" x-text="twoFAData.email"></p>
                </div>

                <!-- 2FA Kod GiriÅŸi -->
                <form @submit.prevent="verify2FA" class="space-y-6">
                    <!-- 6 Haneli Kod Input -->
                    <div class="flex justify-center gap-2">
                        <template x-for="(digit, index) in twoFAInput" :key="index">
                            <input 
                                type="text" 
                                maxlength="1"
                                x-model="twoFAInput[index]"
                                @input="handle2FAInput(index, $event)"
                                @keydown="handle2FABackspace(index, $event)"
                                :ref="'2fa-'+index"
                                class="w-12 h-14 text-center text-2xl font-bold bg-slate-100 rounded-xl border-2 border-transparent focus:border-emerald-500 focus:bg-white outline-none transition"
                                inputmode="numeric"
                                pattern="[0-9]"
                                required
                            >
                        </template>
                    </div>

                    <!-- Kalan SÃ¼re -->
                    <div class="text-center">
                        <p class="text-sm text-slate-500">
                            Kodun geÃ§erlilik sÃ¼resi: 
                            <span class="font-bold text-emerald-600" x-text="format2FATimer()"></span>
                        </p>
                    </div>

                    <!-- Hata MesajÄ± -->
                    <div x-show="twoFAError" class="bg-red-50 border border-red-200 rounded-xl p-3 text-center">
                        <p class="text-red-600 text-sm font-medium" x-text="twoFAError"></p>
                    </div>

                    <button type="submit" class="w-full py-4 btn-agro bg-emerald-500 shadow-lg shadow-emerald-200 hover:bg-emerald-600" :disabled="loading || !is2FAComplete()">
                        <span x-show="!loading">DoÄŸrula ve GiriÅŸ Yap</span>
                        <i x-show="loading" class="fas fa-spinner fa-spin"></i>
                    </button>
                </form>

                <!-- Alt SeÃ§enekler -->
                <div class="mt-6 text-center space-y-3">
                    <button @click="resend2FACode" :disabled="twoFAResendTimer > 0 || loading" class="text-sm font-bold transition" :class="twoFAResendTimer > 0 ? 'text-slate-400' : 'text-emerald-600 hover:text-emerald-700'">
                        <span x-show="twoFAResendTimer === 0">Kodu Tekrar GÃ¶nder</span>
                        <span x-show="twoFAResendTimer > 0" x-text="twoFAResendTimer + ' saniye sonra tekrar gÃ¶nder'"></span>
                    </button>
                    <button @click="cancel2FA" class="text-sm text-slate-500 font-medium block w-full hover:text-slate-700">
                        Ä°ptal Et
                    </button>
                </div>
            </div>
        </div>
    </template>

    <!-- ========== E-POSTA DOÄžRULAMA MODAL ========== -->
    <template x-if="showEmailVerifyModal">
        <div class="fixed inset-0 z-[99999] bg-black/80 backdrop-blur-sm flex items-center justify-center p-4">
            <div class="w-full max-w-md bg-white rounded-[2.5rem] p-8 shadow-2xl animate-slide-up">
                <div class="text-center mb-8">
                    <div class="w-20 h-20 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg">
                        <i class="fas fa-envelope-open-text text-white text-3xl"></i>
                    </div>
                    <h2 class="text-2xl font-black text-slate-900">E-Posta DoÄŸrulama</h2>
                    <p class="text-slate-500 mt-2">KaydÄ±nÄ±zÄ± tamamlamak iÃ§in e-posta adresinize gÃ¶nderilen 6 haneli kodu girin.</p>
                    <p class="text-blue-600 font-bold mt-1" x-text="emailVerifyData.email"></p>
                </div>

                <!-- DoÄŸrulama Kod GiriÅŸi -->
                <form @submit.prevent="verifyEmailCode" class="space-y-6">
                    <!-- 6 Haneli Kod Input -->
                    <div class="flex justify-center gap-2">
                        <template x-for="(digit, index) in emailVerifyInput" :key="index">
                            <input 
                                type="text" 
                                maxlength="1"
                                x-model="emailVerifyInput[index]"
                                @input="handleEmailVerifyInput(index, $event)"
                                @keydown="handleEmailVerifyBackspace(index, $event)"
                                :ref="'email-verify-'+index"
                                class="w-12 h-14 text-center text-2xl font-bold bg-slate-100 rounded-xl border-2 border-transparent focus:border-blue-500 focus:bg-white outline-none transition"
                                inputmode="numeric"
                                pattern="[0-9]"
                                required
                            >
                        </template>
                    </div>

                    <!-- Kalan SÃ¼re -->
                    <div class="text-center">
                        <p class="text-sm text-slate-500">
                            Kodun geÃ§erlilik sÃ¼resi: 
                            <span class="font-bold text-blue-600" x-text="formatEmailVerifyTimer()"></span>
                        </p>
                    </div>

                    <!-- Hata MesajÄ± -->
                    <div x-show="emailVerifyError" class="bg-red-50 border border-red-200 rounded-xl p-3 text-center">
                        <p class="text-red-600 text-sm font-medium" x-text="emailVerifyError"></p>
                    </div>

                    <button type="submit" class="w-full py-4 btn-agro bg-blue-500 shadow-lg shadow-blue-200 hover:bg-blue-600" :disabled="loading || !isEmailVerifyComplete()">
                        <span x-show="!loading">DoÄŸrula ve KaydÄ± Tamamla</span>
                        <i x-show="loading" class="fas fa-spinner fa-spin"></i>
                    </button>
                </form>

                <!-- Alt SeÃ§enekler -->
                <div class="mt-6 text-center space-y-3">
                    <button @click="resendEmailCode" :disabled="emailResendTimer > 0 || loading" class="text-sm font-bold transition" :class="emailResendTimer > 0 ? 'text-slate-400' : 'text-blue-600 hover:text-blue-700'">
                        <span x-show="emailResendTimer === 0">Kodu Tekrar GÃ¶nder</span>
                        <span x-show="emailResendTimer > 0" x-text="emailResendTimer + ' saniye sonra tekrar gÃ¶nder'"></span>
                    </button>
                    <button @click="cancelEmailVerify" class="text-sm text-slate-500 font-medium block w-full hover:text-slate-700">
                        Ä°ptal Et
                    </button>
                </div>
            </div>
        </div>
    </template>

    <!-- 1. AUTH EKRANI - GiriÅŸ yapÄ±lmadan hiÃ§bir iÃ§erik gÃ¶rÃ¼ntÃ¼lenemez -->
    <template x-if="!isLoggedIn && !show2FAModal && !showEmailVerifyModal">
        <div class="auth-overlay flex items-center justify-center p-4">
            <div class="w-full max-w-md bg-white text-slate-900 rounded-[2.5rem] p-8 shadow-2xl overflow-y-auto max-h-screen no-scrollbar">
                <div class="text-center mb-8">
                    <div class="w-16 h-16 bg-emerald-500 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg shadow-emerald-200">
                        <i class="fas fa-leaf text-white text-2xl"></i>
                    </div>
                    <h1 class="text-3xl font-black text-emerald-500">AgroLink</h1>
                    <p class="text-slate-500 font-bold" x-text="authMode === 'login' ? 'Tekrar HoÅŸ Geldin!' : (authMode === 'register' ? 'Yeni Hesap OluÅŸtur' : 'Åžifre SÄ±fÄ±rla')"></p>
                </div>

                <!-- GiriÅŸ/KayÄ±t Formu -->
                <template x-if="authMode !== 'forgot'">
                    <form @submit.prevent="authAction" class="space-y-4">
                        <template x-if="authMode === 'register'">
                            <div class="space-y-4">
                                <!-- Profil FotoÄŸrafÄ± YÃ¼kleme -->
                                <div class="flex flex-col items-center gap-2">
                                    <label class="relative cursor-pointer group">
                                        <div class="w-20 h-20 rounded-2xl bg-slate-100 flex items-center justify-center border-2 border-dashed border-slate-300 overflow-hidden">
                                            <template x-if="!authForm.avatarPreview">
                                                <i class="fas fa-camera text-slate-400 text-xl"></i>
                                            </template>
                                            <template x-if="authForm.avatarPreview">
                                                <img :src="authForm.avatarPreview" class="w-full h-full object-cover">
                                            </template>
                                        </div>
                                        <input type="file" class="hidden" @change="previewAvatar" accept="image/*">
                                    </label>
                                    <span class="text-[10px] font-bold text-slate-400 uppercase">Profil FotoÄŸrafÄ± SeÃ§</span>
                                </div>
                                <input type="text" x-model="authForm.name" placeholder="Ad Soyad" class="w-full bg-slate-100 p-4 rounded-2xl border-none focus:ring-2 focus:ring-emerald-500 outline-none" required>
                                <input type="text" x-model="authForm.username" placeholder="KullanÄ±cÄ± AdÄ±" class="w-full bg-slate-100 p-4 rounded-2xl border-none focus:ring-2 focus:ring-emerald-500 outline-none" required>
                                
                                <!-- KullanÄ±cÄ± Tipi SeÃ§imi -->
                                <div class="space-y-2">
                                    <label class="text-xs font-bold text-slate-500">Hesap Tipiniz</label>
                                    <select x-model="authForm.userType" class="w-full bg-slate-100 p-4 rounded-2xl border-none focus:ring-2 focus:ring-emerald-500 outline-none" required>
                                        <option value="">Hesap tipi seÃ§in</option>
                                        <option value="tarim_ogretmeni">ðŸŒ¾ TarÄ±m Ã–ÄŸretmeni</option>
                                        <option value="tarim_ogrencisi">ðŸŽ“ TarÄ±m Ã–ÄŸrencisi</option>
                                        <option value="ogretmen">ðŸ“š Ã–ÄŸretmen</option>
                                        <option value="ziraat_muhendisi">ðŸ”¬ Ziraat MÃ¼hendisi</option>
                                        <option value="normal_kullanici">ðŸ‘¤ Normal KullanÄ±cÄ±</option>
                                        <option value="ciftci_hayvancilik">ðŸ„ Ã‡iftÃ§i & HayvancÄ±lÄ±k</option>
                                    </select>
                                </div>
                            </div>
                        </template>

                        <input type="email" x-model="authForm.email" placeholder="E-Posta (@gmail.com)" class="w-full bg-slate-100 p-4 rounded-2xl border-none focus:ring-2 focus:ring-emerald-500 outline-none" required>
                        <input type="password" x-model="authForm.password" placeholder="Åžifre" class="w-full bg-slate-100 p-4 rounded-2xl border-none focus:ring-2 focus:ring-emerald-500 outline-none" required>

                        <!-- CAPTCHA -->
                        <div class="bg-slate-50 p-4 rounded-2xl border border-slate-200">
                            <label class="text-xs font-bold text-slate-500">GÃ¼venlik Sorusu: <span x-text="captcha.q"></span> = ?</label>
                            <input type="number" x-model="captcha.userAns" class="w-full bg-white mt-2 p-2 rounded-lg border border-slate-200 outline-none focus:ring-2 focus:ring-emerald-500" required>
                        </div>

                        <!-- KVKK -->
                        <template x-if="authMode === 'register'">
                            <label class="flex items-start gap-2 p-2">
                                <input type="checkbox" class="mt-1 accent-emerald-500" required>
                                <span class="text-[10px] text-slate-500 leading-tight">
                                    <a href="https://salih-ozt.github.io/Agrolink-kullan-c-s-zle-mesi-ekran-/" target="_blank" class="text-emerald-600 font-bold underline">KullanÄ±cÄ± SÃ¶zleÅŸmesini ve KVKK</a> metnini okudum, kabul ediyorum.
                                </span>
                            </label>
                        </template>

                        <button type="submit" class="w-full py-4 btn-agro bg-emerald-500 shadow-lg shadow-emerald-200 hover:bg-emerald-600" :disabled="loading">
                            <span x-show="!loading" x-text="authMode === 'login' ? 'GiriÅŸ Yap' : 'KayÄ±t Ol'"></span>
                            <i x-show="loading" class="fas fa-spinner fa-spin"></i>
                        </button>
                    </form>
                </template>

                <!-- Åžifremi Unuttum Formu -->
                <template x-if="authMode === 'forgot'">
                    <form @submit.prevent="forgotPassword" class="space-y-4">
                        <p class="text-sm text-slate-600 text-center">E-posta ve kullanÄ±cÄ± adÄ±nÄ±zÄ± girin, size ÅŸifre sÄ±fÄ±rlama baÄŸlantÄ±sÄ± gÃ¶nderelim.</p>
                        <input type="text" x-model="authForm.username" placeholder="KullanÄ±cÄ± AdÄ±nÄ±z" class="w-full bg-slate-100 p-4 rounded-2xl border-none focus:ring-2 focus:ring-emerald-500 outline-none" required>
                        <input type="email" x-model="authForm.email" placeholder="E-Posta Adresiniz" class="w-full bg-slate-100 p-4 rounded-2xl border-none focus:ring-2 focus:ring-emerald-500 outline-none" required>
                        <button type="submit" class="w-full py-4 btn-agro bg-emerald-500 shadow-lg shadow-emerald-200 hover:bg-emerald-600" :disabled="loading">
                            <span x-show="!loading">Åžifre SÄ±fÄ±rlama Linki GÃ¶nder</span>
                            <i x-show="loading" class="fas fa-spinner fa-spin"></i>
                        </button>
                    </form>
                </template>

                <div class="mt-6 text-center space-y-2">
                    <button @click="authMode = (authMode === 'login' ? 'register' : 'login')" class="text-sm font-bold text-slate-600 block w-full">
                        <span x-text="authMode === 'login' ? 'HesabÄ±n yok mu? Hemen KatÄ±l' : (authMode === 'forgot' ? 'GiriÅŸ Yap' : 'Zaten Ã¼ye misin? GiriÅŸ Yap')"></span>
                    </button>
                    <template x-if="authMode === 'login'">
                        <button @click="authMode = 'forgot'" class="text-xs text-emerald-600 font-bold">Åžifremi Unuttum</button>
                    </template>
                </div>
            </div>
        </div>
    </template>

    <!-- 2. ANA UYGULAMA -->
    <div x-show="isLoggedIn" x-cloak>
        
        <!-- ÃœST BAR -->
        <header class="glass sticky top-0 z-50 px-4 py-3 flex justify-between items-center">
            <div class="flex items-center gap-2">
                <div class="w-9 h-9 bg-emerald-500 rounded-xl flex items-center justify-center shadow-lg shadow-emerald-200">
                    <i class="fas fa-leaf text-white text-sm"></i>
                </div>
                <h1 class="text-xl font-black tracking-tighter">AgroLink</h1>
            </div>
            <div class="flex items-center gap-3">
                <!-- KeÅŸfet Butonu -->
                <button @click="showExplore = true; loadExplorePosts()" class="w-9 h-9 rounded-full bg-[var(--input-bg)] flex items-center justify-center transition hover:bg-emerald-100" title="KeÅŸfet">
                    <i class="fas fa-search text-slate-500"></i>
                </button>
                <!-- Ayarlar MenÃ¼sÃ¼ -->
                <button @click="showSettingsMenu = true" class="w-9 h-9 rounded-full bg-[var(--input-bg)] flex items-center justify-center transition">
                    <i class="fas fa-cog text-slate-500"></i>
                </button>
                <button @click="darkMode = !darkMode" class="w-9 h-9 rounded-full bg-[var(--input-bg)] flex items-center justify-center transition">
                    <i class="fas" :class="darkMode ? 'fa-sun text-yellow-400' : 'fa-moon text-slate-600'"></i>
                </button>
                <div class="relative cursor-pointer" data-onboarding="notifications" @click="activeTab = 'notifications'; loadNotifications()">
                    <i class="far fa-bell text-2xl" :class="activeTab === 'notifications' ? 'fas text-emerald-500' : 'text-slate-500'"></i>
                    <span x-show="unreadNotifs > 0" class="absolute -top-1 -right-1 bg-red-500 text-white text-[10px] w-4 h-4 rounded-full flex items-center justify-center font-bold" x-text="unreadNotifs > 9 ? '9+' : unreadNotifs"></span>
                </div>
            </div>
        </header>

        <main class="max-w-xl mx-auto px-4 pt-4 pb-24">
            
            <!-- HÄ°KAYELER -->
            <div x-show="activeTab === 'home'" class="mb-6 -mx-4 px-4 overflow-x-auto no-scrollbar">
                <div class="flex gap-4">
                    <!-- Hikaye Ekle -->
                    <div @click="showStoryModal = true" class="flex flex-col items-center gap-1 flex-shrink-0 cursor-pointer">
                        <div class="w-16 h-16 rounded-full bg-[var(--input-bg)] border-2 border-dashed border-emerald-400 flex items-center justify-center">
                            <i class="fas fa-plus text-emerald-500"></i>
                        </div>
                        <span class="text-[10px] font-bold text-slate-500">Hikaye Ekle</span>
                    </div>
                    <!-- Kendi Hikayelerim -->
                    <template x-for="story in myStories" :key="story.id">
                        <div @click="viewStory(story)" class="flex flex-col items-center gap-1 flex-shrink-0 cursor-pointer">
                            <div class="story-ring">
                                <img :src="story.userProfilePic || story.profilePic || 'https://ui-avatars.com/api/?name='+(story.username || 'User')" class="w-14 h-14 rounded-full object-cover">
                            </div>
                            <span class="text-[10px] font-bold truncate w-16 text-center">Sen</span>
                        </div>
                    </template>
                    <!-- Takip Edilen Hikayeler -->
                    <template x-for="storyGroup in stories" :key="storyGroup.userId">
                        <div @click="viewStoryGroup(storyGroup)" class="flex flex-col items-center gap-1 flex-shrink-0 cursor-pointer">
                            <div class="story-ring" :class="!storyGroup.hasUnviewed ? 'watched' : ''">
                                <img :src="storyGroup.profilePic || 'https://ui-avatars.com/api/?name='+(storyGroup.username || 'User')" class="w-14 h-14 rounded-full object-cover">
                            </div>
                            <span class="text-[10px] font-bold truncate w-16 text-center" x-text="storyGroup.username"></span>
                        </div>
                    </template>
                </div>
            </div>

            <!-- ARAMA ALANI - Sadece Ana Sayfada GÃ¶ster -->
            <div x-show="activeTab === 'home'" class="mb-6 relative" data-onboarding="search">
                <div class="relative">
                    <i class="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"></i>
                    <input type="text" x-model="searchQuery" @input="handleSearch" @focus="showSearchResults = true" @blur="setTimeout(() => showSearchResults = false, 200)" placeholder="Ã‡iftÃ§i, Ã¼rÃ¼n veya #hashtag ara..." class="w-full bg-[var(--bg-card)] border border-[var(--border)] p-4 pl-12 rounded-2xl shadow-sm focus:ring-2 focus:ring-emerald-500 outline-none">
                </div>
                <!-- Arama SonuÃ§larÄ± -->
                <div x-show="showSearchResults && (searchResults.length > 0 || hashtagResults.length > 0)" class="absolute top-16 w-full z-40 agro-card shadow-xl p-2 space-y-1 max-h-80 overflow-y-auto">
                    <!-- Hashtag SonuÃ§larÄ± -->
                    <template x-for="tag in hashtagResults" :key="tag.id || tag.tag">
                        <div @click="searchByHashtag(tag.tag)" class="flex items-center gap-3 p-3 hover:bg-emerald-50 dark:hover:bg-emerald-900/20 rounded-xl cursor-pointer">
                            <div class="w-10 h-10 bg-emerald-100 rounded-full flex items-center justify-center">
                                <i class="fas fa-hashtag text-emerald-600"></i>
                            </div>
                            <div>
                                <p class="text-sm font-bold" x-text="'#'+tag.tag"></p>
                                <p class="text-[10px] text-slate-500" x-text="(tag.postCount || 0) + ' gÃ¶nderi'"></p>
                            </div>
                        </div>
                    </template>
                    <!-- KullanÄ±cÄ± SonuÃ§larÄ± -->
                    <template x-for="res in searchResults" :key="res.id">
                        <div @click="viewProfile(res.id)" class="flex items-center gap-3 p-3 hover:bg-emerald-50 dark:hover:bg-emerald-900/20 rounded-xl cursor-pointer">
                            <!-- Profil resmi yoksa varsayÄ±lan avatar gÃ¶ster -->
                            <div class="w-10 h-10 rounded-full overflow-hidden bg-gradient-to-br from-emerald-400 to-teal-500 flex items-center justify-center flex-shrink-0">
                                <template x-if="res.profilePic">
                                    <img :src="res.profilePic" class="w-full h-full object-cover">
                                </template>
                                <template x-if="!res.profilePic">
                                    <div class="w-full h-full flex items-center justify-center text-white font-bold text-lg" x-text="(res.name || 'K').charAt(0).toUpperCase()"></div>
                                </template>
                            </div>
                            <div>
                                <p class="text-sm font-bold" x-text="res.name"></p>
                                <p class="text-[10px] text-slate-500" x-text="'@'+res.username"></p>
                            </div>
                        </div>
                    </template>
                </div>
            </div>

            <!-- FEED (AKIÅž) -->
            <div x-show="activeTab === 'home'" class="space-y-6">
                <!-- PaylaÅŸÄ±m BaÅŸlatÄ±cÄ± -->
                <div class="agro-card p-4 flex items-center gap-4">
                    <img :src="user.profilePic || 'https://ui-avatars.com/api/?name='+user.name" class="w-12 h-12 rounded-full object-cover border-2 border-emerald-500">
                    <button @click="showPostModal = true" class="flex-1 bg-[var(--input-bg)] text-left px-5 py-3 rounded-2xl text-slate-400 font-medium">
                        BugÃ¼n hasat nasÄ±l, <span x-text="user.name?.split(' ')[0]"></span>?
                    </button>
                </div>

                <!-- Post Listesi - ANÄ°MASYON EKLENDÄ° -->
                <template x-for="(post, postIndex) in feed" :key="post.id">
                    <div class="post-card-modern post-card-animate" :style="'animation-delay: ' + (postIndex * 50) + 'ms'">
                        <!-- Header -->
                        <div class="p-4 flex justify-between items-center">
                            <div class="flex items-center gap-3 cursor-pointer" @click="viewProfile(post.userId)">
                                <img :src="post.userProfilePic || 'https://ui-avatars.com/api/?name='+post.userName" class="w-10 h-10 rounded-full object-cover shadow-sm">
                                <div>
                                    <div class="flex items-center gap-1.5">
                                        <span class="font-bold text-sm" x-text="post.userName"></span>
                                        <template x-if="post.isVerified || post.userVerified || post.verified">
                                            <span class="verified-badge verified-badge-sm">
                                                <svg viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                    <path d="M17.7508 9.41667C17.7508 8.1 17.0217 6.95833 15.9608 6.41667C16.0892 6.05417 16.1592 5.6625 16.1592 5.25C16.1592 3.40833 14.7342 1.91833 12.9775 1.91833C12.5858 1.91833 12.2108 1.98833 11.8642 2.12667C11.3492 1.0125 10.2592 0.25 9.00083 0.25C7.7425 0.25 6.65417 1.01417 6.13667 2.125C5.79083 1.9875 5.415 1.91667 5.02333 1.91667C3.265 1.91667 1.84167 3.40833 1.84167 5.25C1.84167 5.66167 1.91083 6.05333 2.03917 6.41667C0.979167 6.95833 0.25 8.09833 0.25 9.41667C0.25 10.6625 0.901667 11.7483 1.86833 12.3217C1.85167 12.4633 1.84167 12.605 1.84167 12.75C1.84167 14.5917 3.265 16.0833 5.02333 16.0833C5.415 16.0833 5.79 16.0117 6.13583 15.875C6.6525 16.9867 7.74083 17.75 9 17.75C10.26 17.75 11.3483 16.9867 11.8642 15.875C12.21 16.0108 12.585 16.0817 12.9775 16.0817C14.7358 16.0817 16.1592 14.59 16.1592 12.7483C16.1592 12.6033 16.1492 12.4617 16.1317 12.3208C17.0967 11.7483 17.7508 10.6625 17.7508 9.4175V9.41667ZM12.2375 6.63833L8.62583 12.055C8.505 12.2358 8.3075 12.3333 8.105 12.3333C7.98583 12.3333 7.865 12.3 7.75833 12.2283L7.6625 12.15L5.65 10.1375C5.40583 9.89333 5.40583 9.4975 5.65 9.25417C5.89417 9.01083 6.29 9.00917 6.53333 9.25417L8.00833 10.7267L11.1958 5.94333C11.3875 5.65583 11.7758 5.58 12.0625 5.77083C12.3508 5.9625 12.4292 6.35083 12.2375 6.6375V6.63833Z" fill="#1D9BF0"/>
                                                </svg>
                                            </span>
                                        </template>
                                    </div>
                                    <p class="text-xs text-[var(--text-sec)]" x-text="'@' + (post.userUsername || post.userName?.toLowerCase().replace(' ', ''))"></p>
                                    <div class="flex items-center gap-2">
                                        <span class="text-[10px] text-slate-400 font-bold uppercase" x-text="formatDate(post.createdAt)"></span>
                                        <!-- KullanÄ±cÄ± Tipi Rozeti -->
                                        <template x-if="post.userType">
                                            <span class="inline-flex items-center gap-0.5 px-1.5 py-0.5 bg-emerald-100 text-emerald-700 rounded text-[9px] font-semibold">
                                                <i class="fas" :class="{
                                                    'fa-chalkboard-teacher': post.userType === 'tarim_ogretmeni',
                                                    'fa-graduation-cap': post.userType === 'tarim_ogrencisi',
                                                    'fa-book': post.userType === 'ogretmen',
                                                    'fa-flask': post.userType === 'ziraat_muhendisi',
                                                    'fa-user': post.userType === 'normal_kullanici',
                                                    'fa-horse': post.userType === 'ciftci_hayvancilik'
                                                }"></i>
                                                <span x-text="{
                                                    'tarim_ogretmeni': 'TarÄ±m Ã–ÄŸretmeni',
                                                    'tarim_ogrencisi': 'TarÄ±m Ã–ÄŸrencisi',
                                                    'ogretmen': 'Ã–ÄŸretmen',
                                                    'ziraat_muhendisi': 'Ziraat MÃ¼hendisi',
                                                    'normal_kullanici': 'KullanÄ±cÄ±',
                                                    'ciftci_hayvancilik': 'Ã‡iftÃ§i'
                                                }[post.userType] || 'KullanÄ±cÄ±'"></span>
                                            </span>
                                        </template>
                                        <template x-if="post.locationName">
                                            <span class="text-[10px] text-emerald-600"><i class="fas fa-map-marker-alt"></i> <span x-text="post.locationName"></span></span>
                                        </template>
                                    </div>
                                </div>
                            </div>
                            <div class="flex items-center gap-2">
                                <!-- Takip Et Butonu - Sadece takip edilmeyenlerde gÃ¶ster -->
                                <template x-if="post.userId !== user.id && !isFollowing(post.userId)">
                                    <button 
                                        @click.stop="toggleFollow(post.userId)" 
                                        class="text-xs font-bold px-3 py-1.5 rounded-full transition-all bg-emerald-500 text-white hover:bg-emerald-600">
                                        <span>Takip Et</span>
                                    </button>
                                </template>
                                <button @click="openPostOptions(post)" class="text-slate-400 p-2"><i class="fas fa-ellipsis-h"></i></button>
                            </div>
                        </div>
                        
                        <!-- Content -->
                        <div class="px-5 pb-3">
                            <div x-show="!post.showFullContent && post.content && post.content.length > 100">
                                <p class="text-sm leading-relaxed" x-html="formatContent(post.content.substring(0, 100)) + '...'"></p>
                                <button @click="post.showFullContent = true" class="text-emerald-600 text-xs font-bold mt-1">daha fazla gÃ¶ster</button>
                            </div>
                            <div x-show="post.showFullContent || !post.content || post.content.length <= 100">
                                <p class="text-sm leading-relaxed whitespace-pre-wrap" x-html="formatContent(post.content || '')"></p>
                                <button x-show="post.showFullContent && post.content && post.content.length > 100" @click="post.showFullContent = false" class="text-slate-400 text-xs font-bold mt-1">daha az gÃ¶ster</button>
                            </div>
                        </div>

                        <!-- Anket -->
                        <template x-if="post.isPoll && post.pollOptions">
                            <div class="px-5 pb-4 space-y-2">
                                <p class="font-bold text-sm mb-3" x-text="post.pollQuestion"></p>
                                <template x-for="(option, idx) in JSON.parse(post.pollOptions || '[]')" :key="idx">
                                    <div @click="votePoll(post, idx)" class="poll-bar-bg cursor-pointer relative">
                                        <div class="poll-bar-fill" :style="'width: ' + getPollPercentage(post, idx) + '%'"></div>
                                        <div class="absolute inset-0 flex items-center justify-between px-4">
                                            <span class="text-sm font-bold" x-text="option.text"></span>
                                            <span class="text-xs font-bold text-emerald-600" x-text="getPollPercentage(post, idx) + '%'"></span>
                                        </div>
                                    </div>
                                </template>
                                <p class="text-[10px] text-slate-400 mt-2" x-text="getTotalVotes(post) + ' oy'"></p>
                            </div>
                        </template>

                        <!-- Medya (Resim veya Video) - TikTok TarzÄ± KaydÄ±rma -->
                        <template x-if="post.mediaUrl && !post.isPoll">
                            <div class="px-2 pb-2 relative group" @dblclick="doubleTapLike(post)">
                                <!-- Kalp Atma Animasyonu -->
                                <div x-show="showHeartAnimation === post.id" 
                                     class="heart-animation"
                                     :class="showHeartAnimation === post.id ? 'animate' : ''">
                                    <i class="fas fa-heart"></i>
                                </div>
                                
                                <!-- Resim -->
                                <template x-if="post.mediaType === 'image'">
                                    <img :src="post.mediaUrl" 
                                         @click="openTikTokScroll(post)" 
                                         class="w-full max-h-[450px] object-cover rounded-[1.2rem] cursor-pointer" 
                                         loading="lazy" 
                                         @error="$el.style.display='none'">
                                </template>
                                <!-- Video - Otomatik Oynatma (Sessiz) -->
                                <template x-if="post.mediaType === 'video'">
                                    <div class="relative video-hover-container" 
                                         @click="openTikTokScroll(post)"
                                         x-data="{ isPlaying: false, isMuted: true }"
                                         x-init="
                                            const observer = new IntersectionObserver((entries) => {
                                                entries.forEach(entry => {
                                                    const video = $el.querySelector('video');
                                                    if (entry.isIntersecting) {
                                                        video.muted = true; // Her zaman sessiz baÅŸla
                                                        video.play().then(() => isPlaying = true).catch(() => {});
                                                    } else {
                                                        video.pause();
                                                        isPlaying = false;
                                                    }
                                                });
                                            }, { threshold: 0.5 });
                                            observer.observe($el);
                                         ">
                                        <video 
                                            :src="post.mediaUrl" 
                                            class="w-full max-h-[450px] rounded-[1.2rem] bg-black cursor-pointer" 
                                            preload="metadata"
                                            playsinline
                                            loop
                                            muted
                                            :poster="post.thumbnail || ''"
                                        ></video>
                                        <!-- Ses AÃ§/Kapat Butonu -->
                                        <button @click.stop="
                                            const video = $el.parentElement.querySelector('video');
                                            video.muted = !video.muted;
                                            isMuted = video.muted;
                                        " class="absolute bottom-3 right-3 w-10 h-10 bg-black/50 rounded-full flex items-center justify-center text-white mute-btn z-10">
                                            <i class="fas" :class="isMuted ? 'fa-volume-mute' : 'fa-volume-up'"></i>
                                        </button>
                                        <!-- Oynatma Ä°konu -->
                                        <div class="absolute inset-0 flex items-center justify-center bg-black/30 pointer-events-none" x-show="!isPlaying">
                                            <i class="fas fa-play text-white text-4xl opacity-80"></i>
                                        </div>
                                        <div class="absolute inset-0 flex items-center justify-center bg-black/30 opacity-0 group-hover:opacity-100 transition pointer-events-none">
                                            <i class="fas fa-expand text-white text-3xl"></i>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </template>

                        <!-- Actions -->
                        <div class="px-4 py-3 flex items-center justify-between border-t border-[var(--border)]">
                            <div class="flex items-center gap-5">
                                <button @click="likePost(post)" 
                                        class="flex items-center gap-2 transition-transform active:scale-110" 
                                        :class="post.isLiked ? 'text-red-500' : 'text-slate-500'">
                                    <i class="text-xl" :class="post.isLiked ? 'fas fa-heart' : 'far fa-heart'"></i>
                                    <span class="text-xs font-black" x-text="post.likeCount || 0"></span>
                                </button>
                                <button @click="openComments(post)" class="flex items-center gap-2 text-slate-500">
                                    <i class="far fa-comment text-xl"></i>
                                    <span class="text-xs font-black" x-text="post.commentCount || 0"></span>
                                </button>
                                <!-- Ä°ki PaylaÅŸ Butonu -->
                                <div class="flex items-center gap-2">
                                    <!-- URL PaylaÅŸ -->
                                    <button @click="sharePostURL(post)" 
                                            class="flex items-center gap-1.5 text-slate-500 hover:text-emerald-500 transition-colors"
                                            title="Link Kopyala">
                                        <i class="fas fa-link text-lg"></i>
                                    </button>
                                    <!-- DM'de PaylaÅŸ -->
                                    <button @click="openShareToDMModal(post)" 
                                            class="flex items-center gap-1.5 text-slate-500 hover:text-emerald-500 transition-colors"
                                            title="DM'de PaylaÅŸ">
                                        <i class="fas fa-paper-plane text-lg"></i>
                                    </button>
                                </div>
                            </div>
                            <button @click="savePost(post)" class="transition-transform active:scale-110" :class="post.isSaved ? 'text-emerald-500' : 'text-slate-400'">
                                <i :class="post.isSaved ? 'fas fa-bookmark' : 'far fa-bookmark'" class="text-xl"></i>
                            </button>
                        </div>
                    </div>
                </template>
                
                <div x-show="loadingMore" class="text-center p-4">
                    <i class="fas fa-circle-notch fa-spin text-emerald-500 text-2xl"></i>
                </div>
                
                <div x-show="!hasMore && feed.length > 0" class="text-center p-4 text-slate-400 text-sm">
                    TÃ¼m gÃ¶nderiler yÃ¼klendi ðŸŒ¾
                </div>
            </div>

            <!-- BÄ°LDÄ°RÄ°MLER TAB -->
            <div x-show="activeTab === 'notifications'" class="space-y-4">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-black">Bildirimler</h2>
                    <button @click="markAllNotificationsRead" x-show="unreadNotifs > 0" class="text-xs text-emerald-600 font-bold">TÃ¼mÃ¼nÃ¼ Okundu Yap</button>
                </div>
                
                <template x-if="notifications.length === 0">
                    <div class="agro-card p-8 text-center">
                        <i class="far fa-bell text-4xl text-slate-300 mb-4"></i>
                        <p class="text-slate-500">HenÃ¼z bildirim yok</p>
                    </div>
                </template>
                
                <template x-for="notif in notifications" :key="notif.id">
                    <div @click="handleNotificationClick(notif)" class="agro-card p-4 flex items-start gap-3 cursor-pointer" :class="notif.read ? 'opacity-60' : ''">
                        <!-- Takip bildirimi iÃ§in profil resmi -->
                        <template x-if="notif.type === 'follow' && notif.data?.followerId">
                            <img :src="getNotifUserPic(notif)" class="notif-avatar flex-shrink-0">
                        </template>
                        <template x-if="notif.type !== 'follow' || !notif.data?.followerId">
                            <div class="w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0" :class="getNotifIcon(notif.type).bg">
                                <i :class="getNotifIcon(notif.type).icon" class="text-white"></i>
                            </div>
                        </template>
                        <div class="flex-1">
                            <p class="text-sm font-medium" x-text="notif.message"></p>
                            <p class="text-[10px] text-slate-400 mt-1" x-text="formatDate(notif.createdAt)"></p>
                        </div>
                        <div x-show="!notif.read" class="w-2 h-2 bg-emerald-500 rounded-full"></div>
                    </div>
                </template>
            </div>

            <!-- MAÄžAZA TAB -->
            <div x-show="activeTab === 'store'" class="space-y-6">
                <div class="flex justify-between items-center">
                    <h2 class="text-2xl font-black">TarÄ±m PazarÄ±</h2>
                    <div class="flex items-center gap-2">
                        <button @click="openFarmbook()" class="bg-gradient-to-r from-green-600 to-emerald-500 text-white px-4 py-2 rounded-xl font-bold text-xs flex items-center gap-2 shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-105">
                            <i class="fas fa-book-open"></i> Farmbook
                        </button>
                        <button @click="showAddProduct = true" class="bg-emerald-500 text-white px-4 py-2 rounded-xl font-bold text-xs flex items-center gap-2">
                            <i class="fas fa-plus"></i> Ä°lan Ver
                        </button>
                    </div>
                </div>
                
                <template x-if="products.length === 0">
                    <div class="agro-card p-8 text-center">
                        <i class="fas fa-store text-4xl text-slate-300 mb-4"></i>
                        <p class="text-slate-500">HenÃ¼z Ã¼rÃ¼n yok</p>
                    </div>
                </template>
                
                <div class="grid grid-cols-2 gap-4">
                    <template x-for="item in products" :key="item.id">
                        <div @click="openProductDetail(item)" class="agro-card p-3 space-y-3 group cursor-pointer">
                            <div class="h-32 bg-slate-100 rounded-2xl overflow-hidden relative">
                                <img :src="item.image || (item.images && item.images[0]) || 'https://via.placeholder.com/200x200?text=ÃœrÃ¼n'" class="w-full h-full object-cover group-hover:scale-110 transition duration-500">
                                <div class="absolute top-2 right-2 bg-emerald-500 text-white px-2 py-1 rounded-lg text-[10px] font-black" x-text="item.price + ' â‚º'"></div>
                                <!-- Ã‡oklu gÃ¶rsel gÃ¶stergesi -->
                                <div x-show="item.images && item.images.length > 1" class="absolute top-2 left-2 bg-black/50 text-white px-2 py-1 rounded-lg text-[10px]">
                                    <i class="fas fa-images"></i> <span x-text="item.images.length"></span>
                                </div>
                            </div>
                            <h4 class="font-bold text-sm truncate" x-text="item.name"></h4>
                            <p class="text-[10px] text-slate-400 truncate" x-text="item.sellerName"></p>
                            <button @click.stop="startChatWithSeller(item)" class="w-full py-2 bg-emerald-50 text-emerald-600 rounded-xl text-xs font-bold border border-emerald-100 hover:bg-emerald-100 transition">
                                <i class="fas fa-comment-dots mr-1"></i> Mesaj GÃ¶nder
                            </button>
                        </div>
                    </template>
                </div>
            </div>

            <!-- MESAJLAR TAB -->
            <div x-show="activeTab === 'messages'" class="space-y-2">
                <!-- DM Header -->
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-2xl font-black">Mesajlar</h2>
                    <div class="flex items-center gap-2">
                        <span class="text-xs font-bold text-[var(--text-sec)] bg-[var(--input-bg)] px-3 py-1.5 rounded-full" x-text="conversations.length + ' sohbet'"></span>
                    </div>
                </div>
                
                <!-- Arama Ã‡ubuÄŸu -->
                <div class="relative mb-3">
                    <i class="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 text-sm"></i>
                    <input type="text" placeholder="Sohbet ara..." class="w-full bg-[var(--input-bg)] border border-[var(--border)] p-3 pl-11 rounded-2xl text-sm outline-none focus:ring-2 focus:ring-emerald-500">
                </div>
                
                <template x-if="conversations.length === 0">
                    <div class="agro-card p-12 text-center">
                        <div class="w-20 h-20 bg-emerald-50 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="far fa-comments text-3xl text-emerald-400"></i>
                        </div>
                        <h3 class="font-bold text-lg mb-1">HenÃ¼z mesaj yok</h3>
                        <p class="text-sm text-[var(--text-sec)]">Birinin profiline gidip mesaj gÃ¶ndermeye baÅŸlayÄ±n</p>
                    </div>
                </template>
                
                <div class="space-y-2">
                    <template x-for="conv in conversations" :key="conv.oderId || conv.recipientId || conv.userId">
                        <div class="dm-conversation-item group" @click="openChat(conv)">
                            <!-- Avatar -->
                            <div class="dm-avatar-wrapper">
                                <img :src="conv.profilePic || 'https://ui-avatars.com/api/?name='+conv.name" class="dm-avatar">
                                <div x-show="conv.isOnline || conv.online" class="dm-online-dot"></div>
                            </div>
                            <!-- Ä°Ã§erik -->
                            <div class="dm-content">
                                <div class="dm-name-row">
                                    <span class="dm-name" x-text="conv.name"></span>
                                    <template x-if="conv.isVerified">
                                        <span class="verified-badge verified-badge-sm">
                                            <svg viewBox="0 0 18 18" fill="none"><path d="M17.7508 9.41667C17.7508 8.1 17.0217 6.95833 15.9608 6.41667C16.0892 6.05417 16.1592 5.6625 16.1592 5.25C16.1592 3.40833 14.7342 1.91833 12.9775 1.91833C12.5858 1.91833 12.2108 1.98833 11.8642 2.12667C11.3492 1.0125 10.2592 0.25 9.00083 0.25C7.7425 0.25 6.65417 1.01417 6.13667 2.125C5.79083 1.9875 5.415 1.91667 5.02333 1.91667C3.265 1.91667 1.84167 3.40833 1.84167 5.25C1.84167 5.66167 1.91083 6.05333 2.03917 6.41667C0.979167 6.95833 0.25 8.09833 0.25 9.41667C0.25 10.6625 0.901667 11.7483 1.86833 12.3217C1.85167 12.4633 1.84167 12.605 1.84167 12.75C1.84167 14.5917 3.265 16.0833 5.02333 16.0833C5.415 16.0833 5.79 16.0117 6.13583 15.875C6.6525 16.9867 7.74083 17.75 9 17.75C10.26 17.75 11.3483 16.9867 11.8642 15.875C12.21 16.0108 12.585 16.0817 12.9775 16.0817C14.7358 16.0817 16.1592 14.59 16.1592 12.7483C16.1592 12.6033 16.1492 12.4617 16.1317 12.3208C17.0967 11.7483 17.7508 10.6625 17.7508 9.4175V9.41667ZM12.2375 6.63833L8.62583 12.055C8.505 12.2358 8.3075 12.3333 8.105 12.3333C7.98583 12.3333 7.865 12.3 7.75833 12.2283L7.6625 12.15L5.65 10.1375C5.40583 9.89333 5.40583 9.4975 5.65 9.25417C5.89417 9.01083 6.29 9.00917 6.53333 9.25417L8.00833 10.7267L11.1958 5.94333C11.3875 5.65583 11.7758 5.58 12.0625 5.77083C12.3508 5.9625 12.4292 6.35083 12.2375 6.6375V6.63833Z" fill="#1D9BF0"/></svg>
                                        </span>
                                    </template>
                                </div>
                                <p class="dm-last-message" :class="conv.unreadCount > 0 ? 'unread' : ''" x-text="conv.lastMessage || 'HenÃ¼z mesaj yok'"></p>
                            </div>
                            <!-- Meta -->
                            <div class="dm-meta">
                                <span class="dm-time" x-text="formatDate(conv.lastMessageAt || conv.lastMessageTime)"></span>
                                <div x-show="conv.unreadCount > 0" class="dm-unread-badge" x-text="conv.unreadCount"></div>
                            </div>
                            <!-- Silme Butonu -->
                            <button @click.stop="deleteConversation(conv)" class="dm-delete-btn" title="KonuÅŸmayÄ± Sil">
                                <i class="fas fa-trash-alt text-xs"></i>
                            </button>
                        </div>
                    </template>
                </div>
            </div>

            <!-- PROFÄ°L TAB - YENÄ° TASARIM -->
            <div x-show="activeTab === 'profile'" class="-mx-4" x-data="{ profileTab: 'posts' }">
                
                <!-- Header Bar -->
                <div class="px-4 py-3 flex items-center gap-4 bg-[var(--bg-main)]">
                    <button @click="activeTab = 'home'" class="text-[var(--text-main)]">
                        <i class="fas fa-arrow-left text-lg"></i>
                    </button>
                    <div>
                        <h2 class="font-bold text-lg leading-tight" x-text="user.name"></h2>
                        <p class="text-xs text-[var(--text-sec)]" x-text="(userStats.postCount || userStats.postsCount || 0) + ' gÃ¶nderi'"></p>
                    </div>
                </div>
                
                <!-- Kapak ve Profil FotoÄŸrafÄ± -->
                <div class="profile-header">
                    <!-- Kapak FotoÄŸrafÄ± -->
                    <div class="profile-cover-container">
                        <template x-if="user.coverPic">
                            <img :src="user.coverPic" alt="Kapak">
                        </template>
                        <template x-if="!user.coverPic">
                            <img src="https://images.unsplash.com/photo-1500382017468-9049fed747ef?w=800&q=80" alt="Kapak">
                        </template>
                    </div>
                    
                    <!-- Profil FotoÄŸrafÄ± -->
                    <div class="profile-avatar-container">
                        <div class="profile-avatar-ring">
                            <img :src="user.profilePic || 'https://ui-avatars.com/api/?name='+user.name" alt="Profil">
                        </div>
                    </div>
                    
                </div>
                
                <!-- Profil Bilgileri -->
                <div class="px-6 pt-20 pb-4 relative">
                    <!-- Profilini DeÄŸiÅŸtir ve PaylaÅŸ ButonlarÄ± - SaÄŸ Ãœstte -->
                    <div class="absolute top-4 right-4 flex gap-2">
                        <button @click="shareProfile()" 
                                class="px-4 py-2 border border-[var(--border)] rounded-full font-semibold text-sm bg-[var(--bg-card)] hover:bg-[var(--input-bg)] transition shadow-sm">
                            <i class="fas fa-share-alt mr-1"></i>PaylaÅŸ
                        </button>
                        <button @click="initEditForm(); showEditModal = true" 
                                class="px-4 py-2 border border-[var(--border)] rounded-full font-semibold text-sm bg-[var(--bg-card)] hover:bg-[var(--input-bg)] transition shadow-sm">
                            <i class="fas fa-edit mr-1"></i>DÃ¼zenle
                        </button>
                    </div>
                    <!-- Ä°sim, Onay, Ã‡evrimiÃ§i Durumu -->
                    <div class="flex items-center gap-2 flex-wrap">
                        <h1 class="text-2xl font-bold" x-text="user.name"></h1>
                        <template x-if="user.isVerified || user.verified">
                            <span class="verified-badge">
                                <svg viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M17.7508 9.41667C17.7508 8.1 17.0217 6.95833 15.9608 6.41667C16.0892 6.05417 16.1592 5.6625 16.1592 5.25C16.1592 3.40833 14.7342 1.91833 12.9775 1.91833C12.5858 1.91833 12.2108 1.98833 11.8642 2.12667C11.3492 1.0125 10.2592 0.25 9.00083 0.25C7.7425 0.25 6.65417 1.01417 6.13667 2.125C5.79083 1.9875 5.415 1.91667 5.02333 1.91667C3.265 1.91667 1.84167 3.40833 1.84167 5.25C1.84167 5.66167 1.91083 6.05333 2.03917 6.41667C0.979167 6.95833 0.25 8.09833 0.25 9.41667C0.25 10.6625 0.901667 11.7483 1.86833 12.3217C1.85167 12.4633 1.84167 12.605 1.84167 12.75C1.84167 14.5917 3.265 16.0833 5.02333 16.0833C5.415 16.0833 5.79 16.0117 6.13583 15.875C6.6525 16.9867 7.74083 17.75 9 17.75C10.26 17.75 11.3483 16.9867 11.8642 15.875C12.21 16.0108 12.585 16.0817 12.9775 16.0817C14.7358 16.0817 16.1592 14.59 16.1592 12.7483C16.1592 12.6033 16.1492 12.4617 16.1317 12.3208C17.0967 11.7483 17.7508 10.6625 17.7508 9.4175V9.41667ZM12.2375 6.63833L8.62583 12.055C8.505 12.2358 8.3075 12.3333 8.105 12.3333C7.98583 12.3333 7.865 12.3 7.75833 12.2283L7.6625 12.15L5.65 10.1375C5.40583 9.89333 5.40583 9.4975 5.65 9.25417C5.89417 9.01083 6.29 9.00917 6.53333 9.25417L8.00833 10.7267L11.1958 5.94333C11.3875 5.65583 11.7758 5.58 12.0625 5.77083C12.3508 5.9625 12.4292 6.35083 12.2375 6.6375V6.63833Z" fill="#1D9BF0"/>
                                </svg>
                            </span>
                        </template>
                        <span class="online-status">Ã‡evrimiÃ§i</span>
                    </div>
                    
                    <!-- @username -->
                    <p class="text-[var(--text-sec)] mt-1" x-text="'@' + user.username"></p>
                    
                    <!-- KullanÄ±cÄ± Tipi Rozeti -->
                    <div class="mt-2">
                        <span class="inline-flex items-center gap-1 px-3 py-1 bg-emerald-100 text-emerald-700 rounded-full text-xs font-semibold">
                            <i class="fas" :class="{
                                'fa-chalkboard-teacher': user.userType === 'tarim_ogretmeni',
                                'fa-graduation-cap': user.userType === 'tarim_ogrencisi',
                                'fa-book': user.userType === 'ogretmen',
                                'fa-flask': user.userType === 'ziraat_muhendisi',
                                'fa-user': user.userType === 'normal_kullanici',
                                'fa-horse': user.userType === 'ciftci_hayvancilik'
                            }"></i>
                            <span x-text="{
                                'tarim_ogretmeni': 'TarÄ±m Ã–ÄŸretmeni',
                                'tarim_ogrencisi': 'TarÄ±m Ã–ÄŸrencisi',
                                'ogretmen': 'Ã–ÄŸretmen',
                                'ziraat_muhendisi': 'Ziraat MÃ¼hendisi',
                                'normal_kullanici': 'Normal KullanÄ±cÄ±',
                                'ciftci_hayvancilik': 'Ã‡iftÃ§i & HayvancÄ±lÄ±k'
                            }[user.userType] || 'Normal KullanÄ±cÄ±'"></span>
                        </span>
                    </div>
                    
                    <!-- Bio -->
                    <p class="mt-3 text-[var(--text-main)] leading-relaxed" x-text="user.bio || 'HenÃ¼z bir biyografi eklenmedi ðŸŒ±'"></p>
                    
                    <!-- Website Linki -->
                    <template x-if="user.website">
                        <a :href="user.website.startsWith('http') ? user.website : 'https://' + user.website" 
                           target="_blank" 
                           class="mt-2 inline-flex items-center gap-1 text-blue-500 hover:text-blue-600 text-sm font-medium">
                            <i class="fas fa-link"></i>
                            <span x-text="user.website.replace(/^https?:\/\//, '')"></span>
                        </a>
                    </template>
                    
                    <!-- Konum ve KatÄ±lÄ±m Tarihi -->
                    <div class="flex items-center gap-4 mt-3 text-[var(--text-sec)] text-sm flex-wrap">
                        <template x-if="user.location">
                            <span class="flex items-center gap-1">
                                <i class="fas fa-map-marker-alt"></i>
                                <span x-text="user.location"></span>
                            </span>
                        </template>
                        <span class="flex items-center gap-1">
                            <i class="far fa-calendar-alt"></i>
                            <span x-text="formatJoinDate(user.createdAt)"></span>
                        </span>
                    </div>
                    
                    <!-- Takip Ä°statistikleri -->
                    <div class="flex items-center gap-6 mt-4">
                        <div @click="showConnections('following')" class="stat-inline">
                            <strong x-text="formatCount(userStats.followingCount || userStats.following || 0)"></strong>
                            <span>Takip</span>
                        </div>
                        <div @click="showConnections('followers')" class="stat-inline">
                            <strong x-text="formatCount(userStats.followerCount || userStats.followers || 0)"></strong>
                            <span>TakipÃ§i</span>
                        </div>
                    </div>
                </div>
                
                <!-- Sekmeler -->
                <div class="profile-tabs">
                    <div @click="profileTab = 'posts'" class="profile-tab" :class="profileTab === 'posts' ? 'active' : ''">
                        GÃ¶nderiler
                    </div>
                    <div @click="profileTab = 'media'" class="profile-tab" :class="profileTab === 'media' ? 'active' : ''">
                        Medya
                    </div>
                    <div @click="profileTab = 'likes'; loadLikedPosts()" class="profile-tab" :class="profileTab === 'likes' ? 'active' : ''">
                        BeÄŸeniler
                    </div>
                </div>
                
                <!-- Sekme Ä°Ã§erikleri -->
                <div class="px-4 py-4">
                    
                    <!-- GÃ¶nderiler Sekmesi -->
                    <div x-show="profileTab === 'posts'" class="space-y-4">
                        <template x-if="myPosts.length === 0">
                            <div class="text-center py-12 text-[var(--text-sec)]">
                                <i class="fas fa-seedling text-4xl mb-3 opacity-50"></i>
                                <p class="font-medium">HenÃ¼z gÃ¶nderi yok</p>
                            </div>
                        </template>
                        <template x-for="post in myPosts" :key="post.id">
                            <div class="agro-card p-4">
                                <div class="flex items-start gap-3">
                                    <img :src="user.profilePic || 'https://ui-avatars.com/api/?name='+user.name" class="w-10 h-10 rounded-full object-cover flex-shrink-0">
                                    <div class="flex-1 min-w-0">
                                        <div class="flex items-center gap-1.5 flex-wrap">
                                            <span class="font-bold text-sm" x-text="user.name"></span>
                                            <template x-if="user.isVerified">
                                                <span class="verified-badge verified-badge-sm"></span>
                                            </template>
                                            <span class="text-[var(--text-sec)] text-xs" x-text="'@' + user.username"></span>
                                            <span class="text-[var(--text-sec)] text-xs">Â·</span>
                                            <span class="text-[var(--text-sec)] text-xs" x-text="formatDate(post.createdAt)"></span>
                                        </div>
                                        <p class="mt-2 text-sm" x-html="formatContent(post.content)"></p>
                                        <template x-if="post.mediaUrl">
                                            <div class="mt-3">
                                                <template x-if="post.mediaType === 'video'">
                                                    <video :src="post.mediaUrl" class="rounded-2xl w-full max-h-80 object-cover" controls></video>
                                                </template>
                                                <template x-if="post.mediaType !== 'video'">
                                                    <img :src="post.mediaUrl" @click="openFullScreen(post.mediaUrl, 'image')" class="rounded-2xl w-full max-h-80 object-cover cursor-pointer">
                                                </template>
                                            </div>
                                        </template>
                                        <div class="flex items-center gap-6 mt-3 text-[var(--text-sec)] text-sm">
                                            <span class="flex items-center gap-1"><i class="far fa-comment"></i><span x-text="post.commentCount || 0"></span></span>
                                            <span class="flex items-center gap-1"><i class="far fa-heart"></i><span x-text="post.likeCount || 0"></span></span>
                                            <span class="flex items-center gap-1"><i class="fas fa-chart-bar"></i><span x-text="post.viewCount || 0"></span></span>
                                            <button @click="deleteMyPost(post)" class="ml-auto text-red-400 hover:text-red-600 transition">
                                                <i class="fas fa-trash text-xs"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </template>
                    </div>
                    
                    <!-- Medya Sekmesi -->
                    <div x-show="profileTab === 'media'" class="grid grid-cols-3 gap-1">
                        <template x-for="post in myPosts.filter(p => p.mediaUrl)" :key="'media-'+post.id">
                            <div class="aspect-square overflow-hidden rounded-lg cursor-pointer hover:opacity-80 transition" @click="openFullScreen(post.mediaUrl, post.mediaType || 'image')">
                                <template x-if="post.mediaType === 'video'">
                                    <div class="w-full h-full bg-slate-800 flex items-center justify-center relative">
                                        <video :src="post.mediaUrl" class="w-full h-full object-cover"></video>
                                        <i class="fas fa-play absolute text-white text-xl"></i>
                                    </div>
                                </template>
                                <template x-if="post.mediaType !== 'video'">
                                    <img :src="post.mediaUrl" class="w-full h-full object-cover">
                                </template>
                            </div>
                        </template>
                        <template x-if="myPosts.filter(p => p.mediaUrl).length === 0">
                            <div class="col-span-3 text-center py-12 text-[var(--text-sec)]">
                                <i class="fas fa-images text-4xl mb-3 opacity-50"></i>
                                <p class="font-medium">HenÃ¼z medya yok</p>
                            </div>
                        </template>
                    </div>
                    
                    <!-- BeÄŸeniler Sekmesi -->
                    <div x-show="profileTab === 'likes'" class="space-y-4">
                        <template x-if="likedPosts.length === 0">
                            <div class="text-center py-12 text-[var(--text-sec)]">
                                <i class="fas fa-heart text-4xl mb-3 opacity-50"></i>
                                <p class="font-medium">HenÃ¼z beÄŸeni yok</p>
                            </div>
                        </template>
                        <template x-for="post in likedPosts" :key="'liked-'+post.id">
                            <div class="agro-card p-4">
                                <div class="flex items-start gap-3">
                                    <img :src="post.userProfilePic || 'https://ui-avatars.com/api/?name='+(post.userName || 'User')" class="w-10 h-10 rounded-full object-cover flex-shrink-0">
                                    <div class="flex-1 min-w-0">
                                        <div class="flex items-center gap-1 flex-wrap">
                                            <span class="font-bold text-sm" x-text="post.userName || 'KullanÄ±cÄ±'"></span>
                                            <span class="text-[var(--text-sec)] text-xs" x-text="'@' + (post.userUsername || 'user')"></span>
                                        </div>
                                        <p class="mt-2 text-sm" x-text="post.content?.substring(0, 150) + (post.content?.length > 150 ? '...' : '')"></p>
                                    </div>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>
                
                <!-- Alt MenÃ¼ ButonlarÄ± -->
                <div class="px-4 pb-6 space-y-2">
                    <button @click="loadSavedPosts" class="w-full p-4 agro-card flex items-center gap-3 text-left hover:bg-[var(--input-bg)] transition">
                        <i class="fas fa-bookmark text-emerald-500"></i>
                        <span class="font-medium">KayÄ±tlÄ± GÃ¶nderiler</span>
                        <i class="fas fa-chevron-right text-[var(--text-sec)] ml-auto"></i>
                    </button>
                    <button @click="showSettingsMenu = true" class="w-full p-4 agro-card flex items-center gap-3 text-left hover:bg-[var(--input-bg)] transition">
                        <i class="fas fa-cog text-[var(--text-sec)]"></i>
                        <span class="font-medium">Ayarlar</span>
                        <i class="fas fa-chevron-right text-[var(--text-sec)] ml-auto"></i>
                    </button>
                </div>
            </div>
        </main>

        <!-- ALT NAVÄ°GASYON -->
        <nav class="fixed bottom-0 left-0 right-0 glass px-4 py-3 flex justify-around items-center z-50" style="backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border-top: 1px solid rgba(16,185,129,0.08);">
            <button @click="switchTab('home')" data-onboarding="home" :class="activeTab === 'home' ? 'nav-icon active' : 'nav-icon'">
                <i class="fas fa-home"></i>
            </button>
            <button @click="switchTab('store')" data-onboarding="store" :class="activeTab === 'store' ? 'nav-icon active' : 'nav-icon'">
                <i class="fas fa-shopping-basket"></i>
            </button>
            <button @click="showPostModal = true" data-onboarding="create-post" class="w-14 h-14 rounded-2xl flex items-center justify-center -mt-8 border-4 border-[var(--bg-main)] transition-all duration-300 hover:scale-110 hover:shadow-xl" style="background: linear-gradient(135deg, #10b981, #059669); box-shadow: 0 8px 24px rgba(16,185,129,0.35);">
                <i class="fas fa-plus text-white text-xl"></i>
            </button>
            <button @click="switchTab('messages')" data-onboarding="messages" :class="activeTab === 'messages' ? 'nav-icon active' : 'nav-icon'">
                <i class="fas fa-comment-dots"></i>
            </button>
            <button @click="switchTab('profile')" data-onboarding="profile" :class="activeTab === 'profile' ? 'nav-icon active' : 'nav-icon'">
                <i class="fas fa-user"></i>
            </button>
        </nav>
    </div>

    <!-- ============ MODALLAR ============ -->
    
    <!-- ========== KEÅžFET SAYFASI MODAL ========== -->
    <div x-show="showExplore" x-transition x-cloak class="fixed inset-0 z-[100] flex flex-col bg-[var(--bg-main)]">
        <!-- KeÅŸfet Header -->
        <div class="glass px-4 py-3 flex items-center gap-4">
            <button @click="showExplore = false" class="w-10 h-10 rounded-full bg-[var(--input-bg)] flex items-center justify-center text-[var(--text-main)] hover:bg-[var(--border)] transition">
                <i class="fas fa-arrow-left"></i>
            </button>
            <div class="flex-1">
                <h3 class="text-xl font-black flex items-center gap-2">
                    <i class="fas fa-compass text-emerald-500"></i> KeÅŸfet
                </h3>
            </div>
            <button @click="loadExplorePosts()" class="w-10 h-10 rounded-full bg-[var(--input-bg)] flex items-center justify-center hover:bg-[var(--border)] transition">
                <i class="fas fa-sync-alt text-sm" :class="exploreLoading ? 'fa-spin' : ''"></i>
            </button>
        </div>
        
        <!-- Kategori Filtreleri -->
        <div class="px-4 py-3 overflow-x-auto no-scrollbar">
            <div class="flex gap-2">
                <button @click="exploreCategory = 'all'; loadExplorePosts()" class="explore-category-chip" :class="exploreCategory === 'all' ? 'active' : ''">
                    <i class="fas fa-fire"></i> Trend
                </button>
                <button @click="exploreCategory = 'liked'; loadExplorePosts()" class="explore-category-chip" :class="exploreCategory === 'liked' ? 'active' : ''">
                    <i class="fas fa-heart"></i> En Ã‡ok BeÄŸenilen
                </button>
                <button @click="exploreCategory = 'commented'; loadExplorePosts()" class="explore-category-chip" :class="exploreCategory === 'commented' ? 'active' : ''">
                    <i class="fas fa-comment"></i> En Ã‡ok Yorumlanan
                </button>
                <button @click="exploreCategory = 'media'; loadExplorePosts()" class="explore-category-chip" :class="exploreCategory === 'media' ? 'active' : ''">
                    <i class="fas fa-images"></i> Medya
                </button>
            </div>
        </div>
        
        <!-- KeÅŸfet Ä°Ã§erik -->
        <div class="flex-1 overflow-y-auto px-3 pb-4 no-scrollbar">
            <!-- YÃ¼kleniyor -->
            <div x-show="exploreLoading" class="flex items-center justify-center py-12">
                <div class="text-center">
                    <i class="fas fa-spinner fa-spin text-3xl text-emerald-500 mb-3"></i>
                    <p class="text-sm text-[var(--text-sec)] font-medium">Trend gÃ¶nderiler yÃ¼kleniyor...</p>
                </div>
            </div>
            
            <!-- BoÅŸ State -->
            <div x-show="!exploreLoading && explorePosts.length === 0" class="flex items-center justify-center py-12">
                <div class="text-center">
                    <div class="w-20 h-20 bg-emerald-50 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-seedling text-3xl text-emerald-400"></i>
                    </div>
                    <h3 class="font-bold text-lg mb-1">HenÃ¼z keÅŸfedilecek iÃ§erik yok</h3>
                    <p class="text-sm text-[var(--text-sec)]">Yeni gÃ¶nderiler paylaÅŸÄ±ldÄ±ÄŸÄ±nda burada gÃ¶rÃ¼necek</p>
                </div>
            </div>
            
            <!-- Masonry Grid -->
            <div x-show="!exploreLoading && explorePosts.length > 0" class="explore-grid">
                <template x-for="(post, idx) in explorePosts" :key="post.id">
                    <div class="explore-card" @click="openTikTokScroll(post)">
                        <!-- Trend Rozeti -->
                        <div x-show="idx < 3" class="explore-trending-badge">
                            <i class="fas fa-fire"></i>
                            <span x-text="'#' + (idx + 1)"></span>
                        </div>
                        
                        <!-- MedyalÄ± Post -->
                        <template x-if="post.mediaUrl">
                            <div class="relative">
                                <template x-if="post.mediaType === 'video'">
                                    <div class="relative">
                                        <img :src="post.thumbnail || post.mediaUrl" class="w-full" style="min-height: 140px; max-height: 280px;" onerror="this.style.display='none'">
                                        <div class="absolute top-10 right-10 bg-black/50 rounded-full w-10 h-10 flex items-center justify-center text-white backdrop-blur-sm">
                                            <i class="fas fa-play ml-0.5"></i>
                                        </div>
                                    </div>
                                </template>
                                <template x-if="post.mediaType !== 'video'">
                                    <img :src="post.mediaUrl" class="w-full" style="min-height: 140px; max-height: 280px;" loading="lazy">
                                </template>
                                <!-- Overlay -->
                                <div class="explore-card-overlay">
                                    <!-- KullanÄ±cÄ± Bilgisi -->
                                    <div class="flex items-center gap-2 mb-2">
                                        <img :src="post.userProfilePic || 'https://ui-avatars.com/api/?name='+post.userName" class="w-6 h-6 rounded-full object-cover border border-white/30">
                                        <span class="text-xs font-bold truncate" x-text="post.userName"></span>
                                        <!-- Verified Rozet -->
                                        <template x-if="post.userIsVerified || post.isVerified">
                                            <span class="verified-badge verified-badge-sm flex-shrink-0">
                                                <svg viewBox="0 0 18 18" fill="none"><path d="M17.7508 9.41667C17.7508 8.1 17.0217 6.95833 15.9608 6.41667C16.0892 6.05417 16.1592 5.6625 16.1592 5.25C16.1592 3.40833 14.7342 1.91833 12.9775 1.91833C12.5858 1.91833 12.2108 1.98833 11.8642 2.12667C11.3492 1.0125 10.2592 0.25 9.00083 0.25C7.7425 0.25 6.65417 1.01417 6.13667 2.125C5.79083 1.9875 5.415 1.91667 5.02333 1.91667C3.265 1.91667 1.84167 3.40833 1.84167 5.25C1.84167 5.66167 1.91083 6.05333 2.03917 6.41667C0.979167 6.95833 0.25 8.09833 0.25 9.41667C0.25 10.6625 0.901667 11.7483 1.86833 12.3217C1.85167 12.4633 1.84167 12.605 1.84167 12.75C1.84167 14.5917 3.265 16.0833 5.02333 16.0833C5.415 16.0833 5.79 16.0117 6.13583 15.875C6.6525 16.9867 7.74083 17.75 9 17.75C10.26 17.75 11.3483 16.9867 11.8642 15.875C12.21 16.0108 12.585 16.0817 12.9775 16.0817C14.7358 16.0817 16.1592 14.59 16.1592 12.7483C16.1592 12.6033 16.1492 12.4617 16.1317 12.3208C17.0967 11.7483 17.7508 10.6625 17.7508 9.4175V9.41667ZM12.2375 6.63833L8.62583 12.055C8.505 12.2358 8.3075 12.3333 8.105 12.3333C7.98583 12.3333 7.865 12.3 7.75833 12.2283L7.6625 12.15L5.65 10.1375C5.40583 9.89333 5.40583 9.4975 5.65 9.25417C5.89417 9.01083 6.29 9.00917 6.53333 9.25417L8.00833 10.7267L11.1958 5.94333C11.3875 5.65583 11.7758 5.58 12.0625 5.77083C12.3508 5.9625 12.4292 6.35083 12.2375 6.6375V6.63833Z" fill="#1D9BF0"/></svg>
                                            </span>
                                        </template>
                                        <!-- Farmer Rozet -->
                                        <template x-if="post.userHasFarmerBadge">
                                            <span class="farmer-badge farmer-badge-sm flex-shrink-0"></span>
                                        </template>
                                    </div>
                                    <!-- Ä°statistikler -->
                                    <div class="explore-card-stats">
                                        <span><i class="fas fa-heart"></i> <span x-text="post.likeCount || 0"></span></span>
                                        <span><i class="fas fa-comment"></i> <span x-text="post.commentCount || 0"></span></span>
                                        <span><i class="fas fa-eye"></i> <span x-text="post.viewCount || 0"></span></span>
                                    </div>
                                </div>
                            </div>
                        </template>
                        
                        <!-- Metin Post (medyasÄ±z) -->
                        <template x-if="!post.mediaUrl">
                            <div class="explore-text-card" :class="'gradient-' + ((idx % 4) + 1)">
                                <!-- KullanÄ±cÄ± Bilgisi -->
                                <div class="flex items-center gap-2 mb-3">
                                    <img :src="post.userProfilePic || 'https://ui-avatars.com/api/?name='+post.userName" class="w-7 h-7 rounded-full object-cover border border-white/30">
                                    <span class="text-xs font-bold" x-text="post.userName"></span>
                                    <template x-if="post.userIsVerified || post.isVerified">
                                        <span class="verified-badge verified-badge-sm flex-shrink-0">
                                            <svg viewBox="0 0 18 18" fill="none"><path d="M17.7508 9.41667C17.7508 8.1 17.0217 6.95833 15.9608 6.41667C16.0892 6.05417 16.1592 5.6625 16.1592 5.25C16.1592 3.40833 14.7342 1.91833 12.9775 1.91833C12.5858 1.91833 12.2108 1.98833 11.8642 2.12667C11.3492 1.0125 10.2592 0.25 9.00083 0.25C7.7425 0.25 6.65417 1.01417 6.13667 2.125C5.79083 1.9875 5.415 1.91667 5.02333 1.91667C3.265 1.91667 1.84167 3.40833 1.84167 5.25C1.84167 5.66167 1.91083 6.05333 2.03917 6.41667C0.979167 6.95833 0.25 8.09833 0.25 9.41667C0.25 10.6625 0.901667 11.7483 1.86833 12.3217C1.85167 12.4633 1.84167 12.605 1.84167 12.75C1.84167 14.5917 3.265 16.0833 5.02333 16.0833C5.415 16.0833 5.79 16.0117 6.13583 15.875C6.6525 16.9867 7.74083 17.75 9 17.75C10.26 17.75 11.3483 16.9867 11.8642 15.875C12.21 16.0108 12.585 16.0817 12.9775 16.0817C14.7358 16.0817 16.1592 14.59 16.1592 12.7483C16.1592 12.6033 16.1492 12.4617 16.1317 12.3208C17.0967 11.7483 17.7508 10.6625 17.7508 9.4175V9.41667ZM12.2375 6.63833L8.62583 12.055C8.505 12.2358 8.3075 12.3333 8.105 12.3333C7.98583 12.3333 7.865 12.3 7.75833 12.2283L7.6625 12.15L5.65 10.1375C5.40583 9.89333 5.40583 9.4975 5.65 9.25417C5.89417 9.01083 6.29 9.00917 6.53333 9.25417L8.00833 10.7267L11.1958 5.94333C11.3875 5.65583 11.7758 5.58 12.0625 5.77083C12.3508 5.9625 12.4292 6.35083 12.2375 6.6375V6.63833Z" fill="#1D9BF0"/></svg>
                                        </span>
                                    </template>
                                </div>
                                <!-- Ä°Ã§erik -->
                                <p class="text-sm font-medium leading-relaxed mb-3 line-clamp-4" x-text="post.content?.substring(0, 120) + (post.content?.length > 120 ? '...' : '')"></p>
                                <!-- Ä°statistikler -->
                                <div class="explore-card-stats" style="color: rgba(255,255,255,0.85);">
                                    <span><i class="fas fa-heart"></i> <span x-text="post.likeCount || 0"></span></span>
                                    <span><i class="fas fa-comment"></i> <span x-text="post.commentCount || 0"></span></span>
                                </div>
                            </div>
                        </template>
                    </div>
                </template>
            </div>
        </div>
    </div>
    
    <!-- Ayarlar MenÃ¼sÃ¼ Modal - TAM EKRAN -->
    <div x-show="showSettingsMenu" x-transition x-cloak class="fixed inset-0 z-[100] flex flex-col bg-[var(--bg-main)]">
        <!-- Ayarlar Header -->
        <div class="glass px-4 py-4 flex items-center justify-between">
            <button @click="showSettingsMenu = false" class="text-slate-500"><i class="fas fa-arrow-left text-xl"></i></button>
            <h3 class="text-xl font-black" x-text="t('settings')">Ayarlar</h3>
            <div class="w-8"></div>
        </div>
        
        <!-- Ayarlar Ä°Ã§eriÄŸi -->
        <div class="flex-1 overflow-y-auto p-4 space-y-3">
            <!-- Hesap BÃ¶lÃ¼mÃ¼ -->
            <div class="agro-card p-4">
                <h4 class="text-sm font-bold text-[var(--text-sec)] mb-3 uppercase tracking-wide" x-text="t('account')">Hesap</h4>
                <div class="space-y-1">
                    <div class="settings-item" @click="showChangePassword = true; showSettingsMenu = false">
                        <i class="fas fa-key text-emerald-500 w-6"></i>
                        <span class="font-bold flex-1" x-text="t('changePassword')">Åžifre DeÄŸiÅŸtir</span>
                        <i class="fas fa-chevron-right text-[var(--text-sec)]"></i>
                    </div>
                    <div class="settings-item" @click="initEditForm(); showEditModal = true; showSettingsMenu = false">
                        <i class="fas fa-user-edit text-blue-500 w-6"></i>
                        <span class="font-bold flex-1" x-text="t('editProfile')">Profili DÃ¼zenle</span>
                        <i class="fas fa-chevron-right text-[var(--text-sec)]"></i>
                    </div>
                    <div class="settings-item" @click="showBlockedAccounts = true; showSettingsMenu = false; loadBlockedAccounts()">
                        <i class="fas fa-ban text-red-500 w-6"></i>
                        <span class="font-bold flex-1" x-text="t('blockedAccounts')">Engellenen Hesaplar</span>
                        <i class="fas fa-chevron-right text-[var(--text-sec)]"></i>
                    </div>
                    <div class="settings-item" @click="showSavedPosts = true; showSettingsMenu = false; loadSavedPosts()">
                        <i class="fas fa-bookmark text-yellow-500 w-6"></i>
                        <span class="font-bold flex-1" x-text="t('savedPosts')">Kaydedilen GÃ¶nderiler</span>
                        <i class="fas fa-chevron-right text-[var(--text-sec)]"></i>
                    </div>
                </div>
            </div>
            
            <!-- GÃ¶rÃ¼nÃ¼m BÃ¶lÃ¼mÃ¼ -->
            <div class="agro-card p-4">
                <h4 class="text-sm font-bold text-[var(--text-sec)] mb-3 uppercase tracking-wide" x-text="t('appearance')">GÃ¶rÃ¼nÃ¼m</h4>
                <div class="space-y-1">
                    <div class="settings-item" @click="darkMode = !darkMode">
                        <i class="fas w-6" :class="darkMode ? 'fa-sun text-yellow-400' : 'fa-moon text-slate-600'"></i>
                        <span class="font-bold flex-1" x-text="darkMode ? t('lightMode') : t('darkMode')"></span>
                        <div class="w-12 h-7 rounded-full p-1 transition-all" :class="darkMode ? 'bg-emerald-500' : 'bg-slate-300'">
                            <div class="w-5 h-5 bg-white rounded-full shadow transition-transform" :class="darkMode ? 'translate-x-5' : ''"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Dil BÃ¶lÃ¼mÃ¼ -->
            <div class="agro-card p-4">
                <h4 class="text-sm font-bold text-[var(--text-sec)] mb-3 uppercase tracking-wide" x-text="t('language')">Dil</h4>
                <div class="space-y-1">
                    <div class="settings-item" @click="showLanguageModal = true">
                        <i class="fas fa-globe text-blue-500 w-6"></i>
                        <span class="font-bold flex-1" x-text="t('selectLanguage')">Dil SeÃ§imi</span>
                        <div class="flex items-center gap-2">
                            <span class="text-sm text-[var(--text-sec)]" x-text="getLanguageName(currentLanguage)"></span>
                            <i class="fas fa-chevron-right text-[var(--text-sec)]"></i>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Bildirimler BÃ¶lÃ¼mÃ¼ -->
            <div class="agro-card p-4">
                <h4 class="text-sm font-bold text-[var(--text-sec)] mb-3 uppercase tracking-wide" x-text="t('notificationsTitle')">Bildirimler</h4>
                <div class="space-y-1">
                    <div class="settings-item">
                        <i class="fas fa-bell text-purple-500 w-6"></i>
                        <span class="font-bold flex-1" x-text="t('pushNotifications')">Push Bildirimleri</span>
                        <div class="w-12 h-7 bg-emerald-500 rounded-full p-1">
                            <div class="w-5 h-5 bg-white rounded-full shadow translate-x-5"></div>
                        </div>
                    </div>
                    <div class="settings-item">
                        <i class="fas fa-envelope text-pink-500 w-6"></i>
                        <span class="font-bold flex-1" x-text="t('emailNotifications')">E-posta Bildirimleri</span>
                        <div class="w-12 h-7 bg-emerald-500 rounded-full p-1">
                            <div class="w-5 h-5 bg-white rounded-full shadow translate-x-5"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- GÃ¼venlik BÃ¶lÃ¼mÃ¼ - 2FA Kapatma -->
            <div class="agro-card p-4">
                <h4 class="text-sm font-bold text-[var(--text-sec)] mb-3 uppercase tracking-wide" x-text="t('security')">GÃ¼venlik</h4>
                <div class="space-y-1">
                    <div class="settings-item" @click="toggle2FA()">
                        <i class="fas fa-shield-alt text-indigo-500 w-6"></i>
                        <span class="font-bold flex-1" x-text="t('twoFactorAuth')">2FA E-posta DoÄŸrulama</span>
                        <div class="w-12 h-7 rounded-full p-1 transition-all" :class="user.twoFactorEnabled !== false ? 'bg-emerald-500' : 'bg-slate-300'">
                            <div class="w-5 h-5 bg-white rounded-full shadow transition-transform" :class="user.twoFactorEnabled !== false ? 'translate-x-5' : ''"></div>
                        </div>
                    </div>
                    <p class="text-xs text-[var(--text-sec)] px-4">KapalÄ±ysa giriÅŸ yaparken e-posta doÄŸrulamasÄ± istenmez.</p>
                </div>
            </div>
            
            <!-- HakkÄ±nda BÃ¶lÃ¼mÃ¼ -->
            <div class="agro-card p-4">
                <h4 class="text-sm font-bold text-[var(--text-sec)] mb-3 uppercase tracking-wide" x-text="t('about')">HakkÄ±nda</h4>
                <div class="space-y-1">
                    <div class="settings-item">
                    <i class="fas fa-info-circle text-blue-400 w-6"></i>
                        <span class="font-bold flex-1" x-text="t('appVersion')">Uygulama Versiyonu</span>
                        <span class="text-[var(--text-sec)] text-sm font-bold">v5.3.9</span>
                    </div>
                    <div class="settings-item" @click="showReleaseNotes = true; showSettingsMenu = false">
                        <i class="fas fa-file-alt text-purple-500 w-6"></i>
                        <span class="font-bold flex-1" x-text="t('releaseNotes')">SÃ¼rÃ¼m NotlarÄ±</span>
                        <i class="fas fa-chevron-right text-[var(--text-sec)]"></i>
                    </div>
                    <a href="https://salih-ozt.github.io/Agrolink-kullan-c-s-zle-mesi-ekran-/" target="_blank" class="settings-item">
                        <i class="fas fa-file-contract text-slate-500 w-6"></i>
                        <span class="font-bold flex-1" x-text="t('termsOfService')">KullanÄ±m KoÅŸullarÄ±</span>
                        <i class="fas fa-external-link-alt text-[var(--text-sec)]"></i>
                    </a>
                    <a href="https://salih-ozt.github.io/Agrolink-kullan-c-s-zle-mesi-ekran-/" target="_blank" class="settings-item">
                        <i class="fas fa-shield-alt text-slate-500 w-6"></i>
                        <span class="font-bold flex-1" x-text="t('privacyPolicy')">Gizlilik PolitikasÄ±</span>
                        <i class="fas fa-external-link-alt text-[var(--text-sec)]"></i>
                    </a>
                </div>
            </div>
            
            <!-- DoÄŸrulama BÃ¶lÃ¼mÃ¼ -->
            <div class="agro-card p-4">
                <h4 class="text-sm font-bold text-[var(--text-sec)] mb-3 uppercase tracking-wide" x-text="t('verification')">DoÄŸrulama</h4>
                <div class="space-y-1">
                    <div class="settings-item" @click="showVerificationModal = true; showSettingsMenu = false">
                        <div class="verified-badge w-6 h-6 flex items-center justify-center"></div>
                        <span class="font-bold flex-1" x-text="t('getVerified')">DoÄŸrulanmÄ±ÅŸ Rozet Al</span>
                        <template x-if="user.isVerified">
                            <span class="text-emerald-500 text-xs font-bold" x-text="t('verified') + ' âœ“'">DoÄŸrulanmÄ±ÅŸ âœ“</span>
                        </template>
                        <template x-if="!user.isVerified">
                            <i class="fas fa-chevron-right text-[var(--text-sec)]"></i>
                        </template>
                    </div>
                </div>
            </div>
            
            <!-- Oturum ve Tehlikeli BÃ¶lÃ¼mÃ¼ -->
            <div class="agro-card p-4">
                <h4 class="text-sm font-bold text-[var(--text-sec)] mb-3 uppercase tracking-wide" x-text="t('session')">Oturum</h4>
                <div class="space-y-1">
                    <div class="settings-item" @click="logout()">
                        <i class="fas fa-sign-out-alt text-orange-500 w-6"></i>
                        <span class="font-bold flex-1" x-text="t('logout')">Ã‡Ä±kÄ±ÅŸ Yap</span>
                        <i class="fas fa-chevron-right text-[var(--text-sec)]"></i>
                    </div>
                    <div class="settings-item danger" @click="showDeleteAccount = true; showSettingsMenu = false">
                        <i class="fas fa-trash-alt w-6"></i>
                        <span class="font-bold flex-1" x-text="t('deleteAccount')">HesabÄ± Sil</span>
                        <i class="fas fa-chevron-right"></i>
                    </div>
                </div>
            </div>
            
            <!-- Bilgiler BÃ¶lÃ¼mÃ¼ -->
            <div class="agro-card p-4">
                <h4 class="text-sm font-bold text-[var(--text-sec)] mb-3 uppercase tracking-wide" x-text="t('info')">Bilgiler</h4>
                <div class="space-y-1">
                    <div class="settings-item">
                        <i class="fas fa-copyright text-emerald-500 w-6"></i>
                        <span class="font-bold flex-1" x-text="t('allRightsReserved')">2026 TÃ¼m HaklarÄ± SaklÄ±dÄ±r</span>
                    </div>
                    <div class="settings-item">
                        <i class="fas fa-code text-blue-500 w-6"></i>
                        <span class="text-sm text-[var(--text-sec)] flex-1">Salih Ã–ztÃ¼rk'Ã¼n ÃœrÃ¼nÃ¼dÃ¼r</span>
                    </div>
                </div>
            </div>
            
            <!-- Alt boÅŸluk -->
            <div class="h-8"></div>
        </div>
    </div>
    
    <!-- Hesap Sil Modal -->
    <div x-show="showDeleteAccount" x-transition x-cloak class="fixed inset-0 z-[70] flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/60" @click="showDeleteAccount = false"></div>
        <div class="bg-[var(--bg-card)] w-full max-w-md rounded-[2.5rem] p-6 relative animate-slide-up">
            <div class="text-center mb-6">
                <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-exclamation-triangle text-red-500 text-2xl"></i>
                </div>
                <h3 class="text-xl font-black text-red-600">HesabÄ± Sil</h3>
                <p class="text-sm text-slate-500 mt-2">Bu iÅŸlem geri alÄ±namaz. HesabÄ±nÄ±z kalÄ±cÄ± olarak silinecektir.</p>
            </div>
            
            <div class="space-y-4">
                <input type="password" x-model="deleteAccountPassword" placeholder="Åžifrenizi onaylayÄ±n" class="w-full bg-[var(--input-bg)] p-4 rounded-2xl border-none outline-none focus:ring-2 focus:ring-red-500">
            </div>
            
            <div class="flex gap-3 mt-6">
                <button @click="showDeleteAccount = false" class="flex-1 py-3 bg-[var(--input-bg)] rounded-2xl font-bold">
                    Ä°ptal
                </button>
                <button @click="deleteAccount" class="flex-1 py-3 bg-red-500 text-white rounded-2xl font-bold" :disabled="loading">
                    <span x-show="!loading">HesabÄ± Sil</span>
                    <i x-show="loading" class="fas fa-spinner fa-spin"></i>
                </button>
            </div>
        </div>
    </div>
    
    <!-- Dil SeÃ§im Modal -->
    <div x-show="showLanguageModal" x-transition x-cloak class="fixed inset-0 z-[70] flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/60" @click="showLanguageModal = false"></div>
        <div class="bg-[var(--bg-card)] w-full max-w-md rounded-[2.5rem] p-6 relative animate-slide-up max-h-[80vh] overflow-hidden flex flex-col">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-black" x-text="t('selectLanguage')">Dil SeÃ§imi</h3>
                <button @click="showLanguageModal = false" class="text-slate-400"><i class="fas fa-times text-xl"></i></button>
            </div>
            
            <div class="flex-1 overflow-y-auto space-y-2">
                <template x-for="lang in availableLanguages" :key="lang.code">
                    <div class="settings-item" @click="setLanguage(lang.code)" :class="currentLanguage === lang.code ? 'bg-emerald-50 dark:bg-emerald-900/20 border-emerald-200' : ''">
                        <span class="text-2xl w-8" x-text="lang.flag"></span>
                        <span class="font-bold flex-1" x-text="lang.name"></span>
                        <template x-if="currentLanguage === lang.code">
                            <i class="fas fa-check text-emerald-500"></i>
                        </template>
                    </div>
                </template>
            </div>
        </div>
    </div>
    
    <!-- Åžifre DeÄŸiÅŸtir Modal -->
    <div x-show="showChangePassword" x-transition x-cloak class="fixed inset-0 z-[70] flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/60" @click="showChangePassword = false"></div>
        <div class="bg-[var(--bg-card)] w-full max-w-md rounded-[2.5rem] p-6 relative animate-slide-up">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-black">Åžifre DeÄŸiÅŸtir</h3>
                <button @click="showChangePassword = false" class="text-slate-400"><i class="fas fa-times text-xl"></i></button>
            </div>
            
            <div class="space-y-4">
                <input type="password" x-model="passwordForm.currentPassword" placeholder="Mevcut Åžifre" class="w-full bg-[var(--input-bg)] p-4 rounded-2xl border-none outline-none focus:ring-2 focus:ring-emerald-500">
                <input type="password" x-model="passwordForm.newPassword" placeholder="Yeni Åžifre (en az 6 karakter)" class="w-full bg-[var(--input-bg)] p-4 rounded-2xl border-none outline-none focus:ring-2 focus:ring-emerald-500">
                <input type="password" x-model="passwordForm.confirmPassword" placeholder="Yeni Åžifre Tekrar" class="w-full bg-[var(--input-bg)] p-4 rounded-2xl border-none outline-none focus:ring-2 focus:ring-emerald-500">
            </div>
            
            <button @click="changePassword" class="w-full mt-6 py-4 btn-agro" :disabled="loading">
                <span x-show="!loading">Åžifreyi DeÄŸiÅŸtir</span>
                <i x-show="loading" class="fas fa-spinner fa-spin"></i>
            </button>
        </div>
    </div>

    <!-- GÃ¶nderi PaylaÅŸ Modal - TAM EKRAN (Screenshot referansÄ±na gÃ¶re) -->
    <div x-show="showPostModal" x-transition x-cloak class="fixed inset-0 z-[100] flex flex-col bg-[var(--bg-main)]">
        <!-- Post Header -->
        <div class="glass px-4 py-3 flex items-center justify-between border-b border-[var(--border)]">
            <button @click="showPostModal = false" class="text-slate-500 p-2"><i class="fas fa-times text-xl"></i></button>
            <h3 class="text-lg font-black">Yeni GÃ¶nderi</h3>
            <button @click="submitPost" class="btn-agro px-5 py-2.5 text-sm" :disabled="loading || isUploading">
                <span x-show="!loading && !isUploading">PaylaÅŸ</span>
                <i x-show="loading || isUploading" class="fas fa-spinner fa-spin"></i>
            </button>
        </div>
        
        <!-- Post Ä°Ã§erik - Scrollable -->
        <div class="flex-1 overflow-y-auto no-scrollbar">
            <!-- KullanÄ±cÄ± Bilgisi -->
            <div class="p-4 flex items-center gap-3">
                <img :src="user.profilePic || 'https://ui-avatars.com/api/?name='+user.name" class="w-12 h-12 rounded-full object-cover border-2 border-emerald-200">
                <div>
                    <p class="font-bold text-sm" x-text="user.username || user.name"></p>
                </div>
            </div>
            
            <!-- Post Tipi SeÃ§imi -->
            <div class="px-4 mb-4">
                <div class="flex gap-2">
                    <button @click="postForm.type = 'normal'" class="flex-1 py-2.5 rounded-xl font-bold text-sm transition" :class="postForm.type === 'normal' ? 'bg-emerald-500 text-white' : 'bg-[var(--input-bg)]'">
                        <i class="fas fa-pen mr-2"></i>GÃ¶nderi
                    </button>
                    <button @click="postForm.type = 'poll'" class="flex-1 py-2.5 rounded-xl font-bold text-sm transition" :class="postForm.type === 'poll' ? 'bg-emerald-500 text-white' : 'bg-[var(--input-bg)]'">
                        <i class="fas fa-poll mr-2"></i>Anket
                    </button>
                </div>
            </div>

            <!-- Normal GÃ¶nderi -->
            <template x-if="postForm.type === 'normal'">
                <div class="px-4 space-y-4">
                    <!-- YazÄ± AlanÄ± -->
                    <textarea 
                        x-model="postForm.content" 
                        placeholder="AklÄ±ndan neler geÃ§iyor? #hashtag @etiket kullanabilirsin..." 
                        rows="6" 
                        class="w-full bg-transparent text-lg placeholder:text-[var(--text-sec)] border-none outline-none resize-none"
                    ></textarea>
                    
                    <!-- Medya Ã–nizleme - CapCut TarzÄ± Edit -->
                    <div x-show="postForm.preview" class="relative">
                        <template x-if="postForm.mediaType === 'image'">
                            <div class="relative">
                                <img :src="postForm.preview" class="w-full max-h-80 object-cover rounded-2xl" 
                                     :style="`filter: brightness(${postEditForm.brightness}%) contrast(${postEditForm.contrast}%) saturate(${postEditForm.saturation}%)`">
                                
                                <!-- CapCut TarzÄ± Edit AraÃ§larÄ± -->
                                <div class="absolute bottom-0 left-0 right-0 bg-black/70 backdrop-blur p-3 rounded-b-2xl">
                                    <div class="flex items-center justify-around">
                                        <button @click="postEditForm.filter = 'none'; postEditForm.brightness = 100; postEditForm.contrast = 100; postEditForm.saturation = 100" 
                                                class="flex flex-col items-center gap-1" :class="postEditForm.filter === 'none' ? 'text-emerald-400' : 'text-white'">
                                            <i class="fas fa-sun"></i>
                                            <span class="text-[10px]">Orijinal</span>
                                        </button>
                                        <button @click="postEditForm.filter = 'vintage'; postEditForm.brightness = 110; postEditForm.contrast = 90; postEditForm.saturation = 80" 
                                                class="flex flex-col items-center gap-1" :class="postEditForm.filter === 'vintage' ? 'text-emerald-400' : 'text-white'">
                                            <i class="fas fa-history"></i>
                                            <span class="text-[10px]">Vintage</span>
                                        </button>
                                        <button @click="postEditForm.filter = 'bright'; postEditForm.brightness = 130; postEditForm.contrast = 110; postEditForm.saturation = 120" 
                                                class="flex flex-col items-center gap-1" :class="postEditForm.filter === 'bright' ? 'text-emerald-400' : 'text-white'">
                                            <i class="fas fa-lightbulb"></i>
                                            <span class="text-[10px]">Parlak</span>
                                        </button>
                                        <button @click="postEditForm.filter = 'dark'; postEditForm.brightness = 70; postEditForm.contrast = 120; postEditForm.saturation = 90" 
                                                class="flex flex-col items-center gap-1" :class="postEditForm.filter === 'dark' ? 'text-emerald-400' : 'text-white'">
                                            <i class="fas fa-moon"></i>
                                            <span class="text-[10px]">KaranlÄ±k</span>
                                        </button>
                                        <button @click="postEditForm.filter = 'bw'; postEditForm.saturation = 0" 
                                                class="flex flex-col items-center gap-1" :class="postEditForm.filter === 'bw' ? 'text-emerald-400' : 'text-white'">
                                            <i class="fas fa-tint-slash"></i>
                                            <span class="text-[10px]">S/B</span>
                                        </button>
                                    </div>
                                    
                                    <!-- Ayar Slider'larÄ± -->
                                    <div class="mt-3 space-y-2">
                                        <div class="flex items-center gap-2">
                                            <i class="fas fa-sun text-white text-xs w-4"></i>
                                            <input type="range" min="50" max="150" x-model="postEditForm.brightness" class="flex-1 h-1 bg-white/30 rounded-lg appearance-none">
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <i class="fas fa-adjust text-white text-xs w-4"></i>
                                            <input type="range" min="50" max="150" x-model="postEditForm.contrast" class="flex-1 h-1 bg-white/30 rounded-lg appearance-none">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </template>
                        <template x-if="postForm.mediaType === 'video'">
                            <div class="relative">
                                <video :src="postForm.preview" 
                                       class="w-full max-h-80 object-cover rounded-2xl" 
                                       controls 
                                       autoplay 
                                       playsinline
                                       preload="auto"
                                       x-init="$el.play().catch(() => {})"></video>
                                <button @click="postForm.media = null; postForm.preview = ''; postForm.mediaType = null; postEditForm = { brightness: 100, contrast: 100, saturation: 100, filter: 'none' }" class="absolute top-3 right-3 w-10 h-10 bg-black/60 text-white rounded-full flex items-center justify-center z-10">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </template>
                        <button @click="postForm.media = null; postForm.preview = ''; postForm.mediaType = null; postEditForm = { brightness: 100, contrast: 100, saturation: 100, filter: 'none' }" class="absolute top-3 right-3 w-10 h-10 bg-black/60 text-white rounded-full flex items-center justify-center z-10">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <!-- Konum Ekleme -->
                    <div class="agro-card p-4" @click="postForm.showLocation = !postForm.showLocation">
                        <div class="flex items-center gap-3">
                            <i class="fas fa-map-marker-alt text-[var(--text-sec)]"></i>
                            <input 
                                x-show="postForm.showLocation" 
                                x-model="postForm.locationName" 
                                type="text" 
                                placeholder="Konum ekle..." 
                                @click.stop
                                class="flex-1 bg-transparent outline-none text-sm"
                            >
                            <span x-show="!postForm.showLocation" class="flex-1 text-sm text-[var(--text-sec)]">Konum ekle...</span>
                        </div>
                    </div>
                </div>
            </template>

            <!-- Anket - Media EKLENEMEZ (Sadece soru ve ÅŸÄ±klar) -->
            <template x-if="postForm.type === 'poll'">
                <div class="px-4 space-y-4">
                    <div class="bg-emerald-50 p-4 rounded-2xl mb-4">
                        <p class="text-emerald-700 text-sm font-medium">
                            <i class="fas fa-info-circle mr-2"></i>
                            Anketlerde sadece soru ve ÅŸÄ±klar olur, media eklenemez.
                        </p>
                    </div>
                    
                    <input type="text" x-model="postForm.pollQuestion" placeholder="Anket sorunuz nedir?" class="w-full bg-[var(--input-bg)] p-4 rounded-2xl border-none outline-none focus:ring-2 focus:ring-emerald-500 font-bold text-lg">
                    
                    <template x-for="(opt, idx) in postForm.pollOptions" :key="idx">
                        <div class="flex gap-2">
                            <input type="text" x-model="postForm.pollOptions[idx]" :placeholder="'SeÃ§enek ' + (idx + 1)" class="flex-1 bg-[var(--input-bg)] border-none rounded-xl p-4 outline-none focus:ring-2 focus:ring-emerald-500">
                            <button x-show="postForm.pollOptions.length > 2" @click="postForm.pollOptions.splice(idx, 1)" class="text-red-500 px-4">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </template>
                    
                    <button x-show="postForm.pollOptions.length < 4" @click="postForm.pollOptions.push('')" class="w-full py-3 border-2 border-dashed border-emerald-300 rounded-xl text-emerald-600 font-bold">
                        <i class="fas fa-plus mr-2"></i>SeÃ§enek Ekle
                    </button>
                </div>
            </template>
            
            <!-- YÃ¼kleme Progress Bar -->
            <div x-show="isUploading" class="px-4 py-6">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-sm font-bold text-emerald-600">YÃ¼kleniyor...</span>
                    <span class="text-sm font-black text-emerald-600" x-text="uploadProgress + '%'"></span>
                </div>
                <div class="w-full h-3 bg-[var(--input-bg)] rounded-full overflow-hidden">
                    <div class="h-full bg-gradient-to-r from-emerald-400 to-emerald-600 rounded-full transition-all duration-300 ease-out" :style="'width: ' + uploadProgress + '%'"></div>
                </div>
                <p class="text-xs text-center text-slate-400 mt-2" x-show="uploadProgress < 100">LÃ¼tfen bekleyin, dosyanÄ±z iÅŸleniyor...</p>
                <p class="text-xs text-center text-emerald-500 mt-2" x-show="uploadProgress === 100"><i class="fas fa-check-circle mr-1"></i>TamamlandÄ±!</p>
            </div>
        </div>
        
        <!-- Alt Toolbar - Sabit (Anket modunda gizli) -->
        <div class="glass border-t border-[var(--border)] px-4 py-4" x-show="postForm.type === 'normal'">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-4">
                    <label class="flex items-center gap-2 px-4 py-2.5 text-emerald-600 cursor-pointer">
                        <i class="fas fa-image text-xl"></i>
                        <span class="text-sm font-bold">FotoÄŸraf</span>
                        <input type="file" class="hidden" @change="handlePostMedia" accept="image/*">
                    </label>
                    <label class="flex items-center gap-2 px-4 py-2.5 text-emerald-600 cursor-pointer">
                        <i class="fas fa-video text-xl"></i>
                        <span class="text-sm font-bold">Video</span>
                        <input type="file" class="hidden" @change="handlePostMedia" accept="video/*">
                    </label>
                </div>
                <div class="flex items-center gap-3">
                    <button class="text-[var(--text-sec)]"><i class="fas fa-hashtag text-xl"></i></button>
                    <button class="text-[var(--text-sec)]"><i class="fas fa-at text-xl"></i></button>
                    <button class="text-[var(--text-sec)]"><i class="far fa-smile text-xl"></i></button>
                </div>
            </div>
        </div>
    </div>

    <!-- Yorumlar Modal -->
    <div x-show="showCommentModal" x-transition x-cloak class="fixed inset-0 z-[300] flex items-end justify-center">
        <div class="absolute inset-0 bg-black/40" @click="showCommentModal = false"></div>
        <div class="bg-[var(--bg-card)] w-full max-w-xl h-[80vh] rounded-t-[2.5rem] relative flex flex-col p-6 overflow-hidden animate-slide-up">
            <div class="w-12 h-1.5 bg-slate-300 rounded-full mx-auto mb-4"></div>
            <h3 class="text-center font-black text-lg mb-4">Yorumlar</h3>
            
            <div class="flex-1 overflow-y-auto space-y-4 no-scrollbar">
                <template x-if="activeComments.length === 0">
                    <div class="text-center text-slate-400 py-8">
                        <i class="far fa-comment text-4xl mb-2"></i>
                        <p>HenÃ¼z yorum yok</p>
                    </div>
                </template>
                
                <template x-for="c in activeComments" :key="c.id">
                    <div class="flex gap-3 group" @dblclick="likeComment(c)">
                        <img :src="c.profilePic || c.userProfilePic || 'https://ui-avatars.com/api/?name='+(c.name || c.userName)" class="w-8 h-8 rounded-full flex-shrink-0 object-cover cursor-pointer" @click="viewProfile(c.userId)">
                        <div class="bg-[var(--input-bg)] p-3 rounded-2xl flex-1 relative">
                            <!-- Kalp Atma Animasyonu -->
                            <div x-show="showHeartAnimation === c.id" 
                                 class="heart-animation"
                                 style="font-size: 50px;"
                                 :class="showHeartAnimation === c.id ? 'animate' : ''">
                                <i class="fas fa-heart"></i>
                            </div>
                            
                            <div class="flex items-center gap-2">
                                <p class="text-[11px] font-black text-emerald-600 cursor-pointer" @click="viewProfile(c.userId)" x-text="c.name || c.userName"></p>
                                <span class="text-[9px] text-slate-400" x-text="formatDate(c.createdAt)"></span>
                            </div>
                            <p class="text-sm font-medium mt-1" x-text="c.content"></p>
                            
                            <!-- Yorum BeÄŸenme -->
                            <div class="flex items-center gap-3 mt-2">
                                <button @click="likeComment(c)" 
                                        class="flex items-center gap-1 text-xs"
                                        :class="c.isLiked ? 'text-red-500' : 'text-slate-400'">
                                    <i :class="c.isLiked ? 'fas fa-heart' : 'far fa-heart'"></i>
                                    <span x-text="c.likeCount || 0"></span>
                                </button>
                            </div>
                            
                            <!-- Yorum Silme (sadece kendi yorumlarÄ±) -->
                            <button x-show="c.userId === user.id" @click="deleteComment(c)" class="absolute top-2 right-2 text-red-400 opacity-0 group-hover:opacity-100 transition">
                                <i class="fas fa-trash text-xs"></i>
                            </button>
                        </div>
                    </div>
                </template>
            </div>

            <div class="mt-4 pt-4 border-t border-[var(--border)]">
                <!-- YanÄ±tlanan yorum bilgisi -->
                <div x-show="replyingToComment" class="mb-2 p-2 bg-emerald-50 rounded-lg flex items-center gap-2">
                    <div class="flex-1">
                        <span class="text-xs text-emerald-600 font-medium">
                            <i class="fas fa-reply mr-1"></i>
                            <span x-text="replyingToComment?.name || replyingToComment?.userName"></span> yanÄ±tlanÄ±yor
                        </span>
                    </div>
                    <button @click="cancelReply()" class="text-slate-400 hover:text-red-500">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="flex gap-2">
                    <input type="text" 
                           x-model="commentInput" 
                           @keyup.enter="submitComment" 
                           :placeholder="replyingToComment ? 'YanÄ±tÄ±nÄ± yaz...' : 'Yorumunu yaz...'" 
                           class="flex-1 bg-[var(--input-bg)] border-none rounded-xl p-3 text-sm font-medium outline-none focus:ring-2 focus:ring-emerald-500">
                    <button @click="submitComment" class="bg-emerald-500 text-white px-4 rounded-xl font-bold" :disabled="!commentInput.trim()">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Profil DÃ¼zenle Modal -->
    <!-- Profili DÃ¼zenle Modal - Tam Ekran -->
    <div x-show="showEditModal" x-transition x-cloak class="fixed inset-0 z-[100] flex flex-col bg-[var(--bg-main)]">
        <div class="glass px-4 py-4 flex items-center justify-between border-b border-[var(--border)]">
            <button @click="showEditModal = false" class="text-slate-500 p-2"><i class="fas fa-arrow-left text-xl"></i></button>
            <h3 class="text-lg font-black">Profili DÃ¼zenle</h3>
            <button @click="updateProfile" class="btn-agro px-5 py-2 text-sm" :disabled="loading">
                <span x-show="!loading">Kaydet</span>
                <i x-show="loading" class="fas fa-spinner fa-spin"></i>
            </button>
        </div>
        
        <div class="flex-1 overflow-y-auto no-scrollbar p-4">
            
            <!-- Arka Plan Resmi -->
            <div class="relative mb-6">
                <label class="cursor-pointer block">
                    <div class="w-full h-24 bg-gradient-to-r from-emerald-400 to-teal-500 rounded-2xl overflow-hidden relative">
                        <template x-if="editForm.coverPicPreview || user.coverPic">
                            <img :src="editForm.coverPicPreview || user.coverPic" class="w-full h-full object-cover">
                        </template>
                        <div class="absolute inset-0 bg-black/30 flex items-center justify-center opacity-0 hover:opacity-100 transition">
                            <i class="fas fa-camera text-white text-xl"></i>
                        </div>
                    </div>
                    <input type="file" class="hidden" @change="previewEditCover" accept="image/*">
                </label>
                <p class="text-[10px] text-center text-slate-400 mt-1">Arka plan resmi</p>
            </div>
            
            <!-- Profil FotoÄŸrafÄ± -->
            <div class="flex flex-col items-center gap-2 mb-6">
                <label class="relative cursor-pointer group">
                    <img :src="editForm.profilePic || user.profilePic || 'https://ui-avatars.com/api/?name='+user.name" class="w-24 h-24 rounded-[2rem] object-cover border-4 border-emerald-200">
                    <div class="absolute inset-0 bg-black/40 rounded-[2rem] flex items-center justify-center opacity-0 group-hover:opacity-100 transition">
                        <i class="fas fa-camera text-white text-xl"></i>
                    </div>
                    <input type="file" class="hidden" @change="previewEditAvatar" accept="image/*">
                </label>
                <!-- Profil Resmini KaldÄ±r Butonu -->
                <button x-show="user.profilePic || editForm.profilePic" 
                        @click="removeProfilePic()" 
                        class="mt-2 px-4 py-2 bg-red-50 text-red-600 rounded-full text-xs font-bold hover:bg-red-100 transition flex items-center gap-2">
                    <i class="fas fa-trash-alt"></i>
                    Profil Resmini KaldÄ±r
                </button>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="text-xs font-bold text-slate-500 mb-1 block">Ad Soyad</label>
                    <input type="text" x-model="editForm.name" class="w-full bg-[var(--input-bg)] p-4 rounded-2xl border-none outline-none focus:ring-2 focus:ring-emerald-500">
                </div>
                <div>
                    <label class="text-xs font-bold text-slate-500 mb-1 block">E-posta</label>
                    <input type="email" x-model="editForm.email" placeholder="E-posta adresiniz" class="w-full bg-[var(--input-bg)] p-4 rounded-2xl border-none outline-none focus:ring-2 focus:ring-emerald-500">
                </div>
                <div>
                    <label class="text-xs font-bold text-slate-500 mb-1 block">Hesap Tipi</label>
                    <select x-model="editForm.userType" class="w-full bg-[var(--input-bg)] p-4 rounded-2xl border-none outline-none focus:ring-2 focus:ring-emerald-500">
                        <option value="">Hesap tipi seÃ§in</option>
                        <option value="tarim_ogretmeni">ðŸŒ¾ TarÄ±m Ã–ÄŸretmeni</option>
                        <option value="tarim_ogrencisi">ðŸŽ“ TarÄ±m Ã–ÄŸrencisi</option>
                        <option value="ogretmen">ðŸ“š Ã–ÄŸretmen</option>
                        <option value="ziraat_muhendisi">ðŸ”¬ Ziraat MÃ¼hendisi</option>
                        <option value="normal_kullanici">ðŸ‘¤ Normal KullanÄ±cÄ±</option>
                        <option value="ciftci_hayvancilik">ðŸ„ Ã‡iftÃ§i & HayvancÄ±lÄ±k</option>
                    </select>
                </div>
                <div>
                    <label class="text-xs font-bold text-slate-500 mb-1 block">Biyografi</label>
                    <textarea x-model="editForm.bio" rows="3" class="w-full bg-[var(--input-bg)] p-4 rounded-2xl border-none outline-none focus:ring-2 focus:ring-emerald-500 resize-none"></textarea>
                </div>
                <div>
                    <label class="text-xs font-bold text-slate-500 mb-1 block">Konum</label>
                    <input type="text" x-model="editForm.location" placeholder="Åžehir, Ãœlke" class="w-full bg-[var(--input-bg)] p-4 rounded-2xl border-none outline-none focus:ring-2 focus:ring-emerald-500">
                </div>
                <div>
                    <label class="text-xs font-bold text-slate-500 mb-1 block">Website</label>
                    <input type="url" x-model="editForm.website" placeholder="https://" class="w-full bg-[var(--input-bg)] p-4 rounded-2xl border-none outline-none focus:ring-2 focus:ring-emerald-500">
                </div>
            </div>
            
            <button @click="updateProfile" class="w-full mt-6 py-4 btn-agro" :disabled="loading">
                <span x-show="!loading">Kaydet</span>
                <i x-show="loading" class="fas fa-spinner fa-spin"></i>
            </button>
        </div>
    </div>

    <!-- ÃœrÃ¼n Ekle Modal -->
    <div x-show="showAddProduct" x-transition x-cloak class="fixed inset-0 z-[60] flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/60" @click="showAddProduct = false"></div>
        <div class="bg-[var(--bg-card)] w-full max-w-md rounded-[2.5rem] p-6 relative animate-slide-up max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-black">ÃœrÃ¼n Ekle</h3>
                <button @click="showAddProduct = false" class="text-slate-400"><i class="fas fa-times text-xl"></i></button>
            </div>
            
            <!-- ÃœrÃ¼n FotoÄŸraflarÄ± (Ã‡oklu) -->
            <div class="mb-6">
                <label class="text-xs font-bold text-slate-500 mb-2 block">ÃœrÃ¼n FotoÄŸraflarÄ± (En fazla 5)</label>
                <div class="grid grid-cols-3 gap-2">
                    <!-- Mevcut FotoÄŸraflar -->
                    <template x-for="(img, index) in productForm.images" :key="index">
                        <div class="relative aspect-square bg-[var(--input-bg)] rounded-xl overflow-hidden">
                            <img :src="img.preview" class="w-full h-full object-cover">
                            <button @click="removeProductImage(index)" class="absolute top-1 right-1 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center text-xs">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </template>
                    <!-- Yeni FotoÄŸraf Ekle Butonu -->
                    <label x-show="productForm.images.length < 5" class="cursor-pointer aspect-square bg-[var(--input-bg)] rounded-xl flex flex-col items-center justify-center border-2 border-dashed border-slate-300 hover:border-emerald-500 transition">
                        <i class="fas fa-plus text-2xl text-slate-400"></i>
                        <span class="text-[10px] text-slate-400 mt-1">Ekle</span>
                        <input type="file" class="hidden" @change="handleProductImage" accept="image/*" multiple>
                    </label>
                </div>
            </div>
            
            <div class="space-y-4">
                <input type="text" x-model="productForm.name" placeholder="ÃœrÃ¼n AdÄ±" class="w-full bg-[var(--input-bg)] p-4 rounded-2xl border-none outline-none focus:ring-2 focus:ring-emerald-500">
                <input type="number" x-model="productForm.price" placeholder="Fiyat (â‚º)" class="w-full bg-[var(--input-bg)] p-4 rounded-2xl border-none outline-none focus:ring-2 focus:ring-emerald-500">
                <textarea x-model="productForm.description" placeholder="AÃ§Ä±klama" rows="3" class="w-full bg-[var(--input-bg)] p-4 rounded-2xl border-none outline-none focus:ring-2 focus:ring-emerald-500 resize-none"></textarea>
            </div>
            
            <button @click="addProduct" class="w-full mt-6 py-4 btn-agro" :disabled="loading">
                <span x-show="!loading">Ä°lan Ver</span>
                <i x-show="loading" class="fas fa-spinner fa-spin"></i>
            </button>
        </div>
    </div>

    <!-- Chat Modal (CanlÄ± Sohbet) -->
    <div x-show="showChatModal" x-transition x-cloak class="fixed inset-0 z-[80] flex flex-col bg-[var(--bg-main)]">
        <!-- Chat Header - Profesyonel TasarÄ±m -->
        <div class="chat-header-pro">
            <button @click="showChatModal = false" class="w-10 h-10 rounded-full bg-[var(--input-bg)] flex items-center justify-center text-[var(--text-main)] hover:bg-[var(--border)] transition">
                <i class="fas fa-arrow-left"></i>
            </button>
            <div class="relative cursor-pointer" @click="viewProfile(activeChat.otherId)">
                <img :src="activeChat.profilePic || 'https://ui-avatars.com/api/?name='+activeChat.name" class="w-11 h-11 rounded-full object-cover border-2 border-emerald-200">
                <div x-show="activeChat.isOnline" class="absolute bottom-0 right-0 w-3.5 h-3.5 bg-emerald-500 rounded-full border-2 border-[var(--bg-card)]"></div>
            </div>
            <div class="chat-header-info">
                <h4 class="chat-header-name" x-text="activeChat.name"></h4>
                <div x-show="activeChat.isOnline" class="chat-header-status">Ã‡evrimiÃ§i</div>
                <p x-show="!activeChat.isOnline" class="text-xs text-[var(--text-sec)]">Ã‡evrimdÄ±ÅŸÄ±</p>
            </div>
            <button @click="initiateAudioCall(activeChat.otherId)" class="chat-action-btn audio-btn" title="Sesli Ara">
                <i class="fas fa-phone"></i>
            </button>
            <button @click="initiateVideoCall(activeChat.otherId)" class="chat-action-btn video-btn" title="GÃ¶rÃ¼ntÃ¼lÃ¼ Ara">
                <i class="fas fa-video"></i>
            </button>
        </div>
        
        <!-- Chat Messages - WhatsApp TarzÄ± -->
        <div class="flex-1 overflow-y-auto p-4 space-y-4 no-scrollbar" id="chatMessages" x-init="markMessagesAsRead(activeChat.otherId)">
            <template x-for="msg in chatMessages" :key="msg.id">
                <div class="flex flex-col" :class="msg.senderId === user.id ? 'items-end' : 'items-start'">
                    <!-- WhatsApp TarzÄ±: GÃ¶nderen Bilgisi ve Profil Resmi - DÃ¼zeltilmiÅŸ -->
                    <div class="flex items-center gap-2 mb-1" :class="msg.senderId === user.id ? 'flex-row-reverse' : 'flex-row'">
                        <img :src="msg.senderId === user.id 
                                    ? (user.profilePic || 'https://ui-avatars.com/api/?name='+encodeURIComponent(user.name || 'User')) 
                                    : (msg.senderProfilePic || activeChat.profilePic || 'https://ui-avatars.com/api/?name='+encodeURIComponent(msg.senderName || activeChat.name || 'User'))" 
                             class="w-6 h-6 rounded-full object-cover border border-[var(--border)]">
                        <span class="text-xs text-[var(--text-sec)] font-medium" 
                              x-text="msg.senderId === user.id ? 'Sen' : (msg.senderName || activeChat.name || 'KullanÄ±cÄ±')"></span>
                    </div>
                    
                    <div class="flex" :class="msg.senderId === user.id ? 'justify-end' : 'justify-start'">
                        <!-- SilinmiÅŸ Mesaj -->
                        <template x-if="msg.isDeleted">
                            <div class="max-w-[75%] p-3 rounded-2xl bg-[var(--input-bg)] italic text-[var(--text-sec)] text-sm">
                                <i class="fas fa-ban mr-1"></i> Bu mesaj silindi
                            </div>
                        </template>
                        <!-- Normal Mesaj -->
                        <template x-if="!msg.isDeleted">
                            <div class="max-w-[75%] p-3 relative group" :class="msg.senderId === user.id ? 'chat-bubble-sent' : 'chat-bubble-received'">
                                <!-- PaylaÅŸÄ±lan Post - Ã‡erÃ§eveli ve TÄ±klanabilir -->
                                <template x-if="msg.messageType === 'shared_post' && msg.sharedPost">
                                    <div @click="openSharedPost(msg.sharedPost.id)" 
                                         class="mb-2 rounded-xl overflow-hidden border border-white/20 bg-gradient-to-br from-emerald-500/20 to-teal-500/20 cursor-pointer hover:scale-[1.02] transition-transform">
                                        <!-- Post BaÅŸlÄ±ÄŸÄ± -->
                                        <div class="p-2 flex items-center gap-2 border-b border-white/10">
                                            <img :src="msg.sharedPost.profilePic || 'https://ui-avatars.com/api/?name='+(msg.sharedPost.userName || 'User')" 
                                                 class="w-6 h-6 rounded-full object-cover">
                                            <p class="text-xs font-bold" x-text="msg.sharedPost.userName || 'KullanÄ±cÄ±'"></p>
                                            <i class="fas fa-external-link-alt ml-auto text-xs opacity-60"></i>
                                        </div>
                                        <!-- Post Ä°Ã§eriÄŸi -->
                                        <div class="p-2">
                                            <template x-if="msg.sharedPost.mediaUrl">
                                                <img :src="msg.sharedPost.mediaUrl" 
                                                     class="w-full h-32 object-cover rounded-lg mb-2">
                                            </template>
                                            <p class="text-xs opacity-90 line-clamp-2" x-text="msg.sharedPost.content?.substring(0, 100) || 'GÃ¶nderiyi gÃ¶rÃ¼ntÃ¼lemek iÃ§in tÄ±klayÄ±n'"></p>
                                        </div>
                                        <!-- Post Footer -->
                                        <div class="px-2 pb-2 flex items-center gap-3 text-[10px] opacity-70">
                                            <span><i class="fas fa-heart mr-1"></i><span x-text="msg.sharedPost.likeCount || 0"></span></span>
                                            <span><i class="fas fa-comment mr-1"></i><span x-text="msg.sharedPost.commentCount || 0"></span></span>
                                        </div>
                                    </div>
                                </template>
                                <!-- Sesli Mesaj -->
                                <template x-if="msg.type === 'voice'">
                                    <div class="flex items-center gap-2">
                                        <button @click="playVoiceMessage(msg)" class="w-8 h-8 rounded-full bg-white/20 flex items-center justify-center">
                                            <i class="fas" :class="msg.isPlaying ? 'fa-pause' : 'fa-play'"></i>
                                        </button>
                                        <div class="flex-1 h-1 bg-white/30 rounded-full">
                                            <div class="h-1 bg-white rounded-full" style="width: 0%"></div>
                                        </div>
                                        <span class="text-xs" x-text="msg.duration || '0:00'"></span>
                                    </div>
                                </template>
                                <!-- GÃ¶rsel Mesaj - DÃ¼zeltilmiÅŸ URL KontrolÃ¼ -->
                                <template x-if="msg.type === 'image' || (msg.content && (msg.content.startsWith('/uploads/') || msg.content.startsWith('http')))">
                                    <div class="relative">
                                        <img :src="getMessageImageUrl(msg)" 
                                             class="max-w-full max-h-64 rounded-lg cursor-pointer object-cover" 
                                             @click="openFullScreen(getMessageImageUrl(msg), 'image')"
                                             @error="handleMessageImageError($event, msg)"
                                             loading="lazy">
                                        <template x-if="msg.isUploading">
                                            <div class="absolute inset-0 bg-black/50 flex items-center justify-center rounded-lg">
                                                <i class="fas fa-spinner fa-spin text-white"></i>
                                            </div>
                                        </template>
                                    </div>
                                </template>
                                <!-- Video Mesaj -->
                                <template x-if="msg.type === 'video' || (msg.mediaType === 'video' && msg.mediaUrl)">
                                    <div class="relative">
                                        <video :src="msg.mediaUrl || msg.content" 
                                               class="max-w-full max-h-64 rounded-lg" 
                                               controls 
                                               preload="metadata"
                                               @error="console.log('Video yÃ¼klenemedi:', msg.mediaUrl || msg.content)">
                                        </video>
                                    </div>
                                </template>
                                <!-- Normal Mesaj (medya deÄŸilse ve URL deÄŸilse) -->
                                <template x-if="msg.type !== 'voice' && msg.type !== 'image' && msg.type !== 'video' && !msg.mediaUrl && msg.messageType !== 'shared_post' && !isImageUrl(msg.content)">
                                    <p class="text-sm whitespace-pre-wrap" x-html="formatMessageContent(msg.content)"></p>
                                </template>
                                <template x-if="msg.messageType === 'shared_post' && msg.content">
                                    <p class="text-sm" x-html="formatMessageContent(msg.content)"></p>
                                </template>
                                <!-- Saat ve Okundu Durumu -->
                                <div class="flex items-center justify-end gap-1 mt-1">
                                    <span class="text-[9px] opacity-70" x-text="formatTime(msg.createdAt)"></span>
                                    <!-- WhatsApp tarzÄ± okundu bilgisi (sadece gÃ¶nderen iÃ§in) -->
                                    <template x-if="msg.senderId === user.id">
                                        <span class="message-status">
                                            <i class="fas fa-check check" :class="msg.readAt ? 'read' : ''"></i>
                                            <i class="fas fa-check check" :class="msg.readAt ? 'read' : ''" style="margin-left: -6px;"></i>
                                        </span>
                                    </template>
                                </div>
                                <!-- Mesaj Silme Butonu (sadece gÃ¶nderen iÃ§in) -->
                                <button x-show="msg.senderId === user.id" @click="deleteMessage(msg)" class="absolute -top-2 -right-2 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition text-xs">
                                    <i class="fas fa-trash text-[10px]"></i>
                                </button>
                            </div>
                        </template>
                    </div>
                </div>
            </template>
        </div>
        
        <!-- Chat Input - Profesyonel -->
        <div class="chat-input-pro">
            <!-- Ses KayÄ±t Ã–nizleme -->
            <div x-show="voicePreview" class="mb-3 p-3 bg-[var(--input-bg)] rounded-2xl flex items-center gap-3">
                <div class="voice-wave">
                    <span></span><span></span><span></span><span></span><span></span>
                </div>
                <span class="text-sm font-medium" x-text="voiceDuration + ' sn'"></span>
                <button @click="sendVoiceMessage" class="ml-auto w-8 h-8 rounded-full bg-emerald-500 text-white flex items-center justify-center">
                    <i class="fas fa-paper-plane text-xs"></i>
                </button>
                <button @click="cancelVoiceRecord" class="w-8 h-8 rounded-full bg-red-500 text-white flex items-center justify-center">
                    <i class="fas fa-times text-xs"></i>
                </button>
            </div>
            
            <div class="chat-input-row" x-show="!voicePreview">
                <!-- Ses KayÄ±t Butonu -->
                <button @click="startVoiceRecord" 
                        class="chat-attach-btn"
                        :class="isRecording ? 'text-red-500' : ''"
                        :disabled="isRecording">
                    <i class="fas" :class="isRecording ? 'fa-stop' : 'fa-microphone'"></i>
                </button>
                
                <!-- Galeriden GÃ¶rsel -->
                <label class="chat-attach-btn cursor-pointer">
                    <i class="fas fa-image"></i>
                    <input type="file" class="hidden" @change="sendImageMessage($event)" accept="image/*">
                </label>
                
                <input type="text" x-model="messageInput" @keyup.enter="sendMessage" placeholder="Mesaj yaz..." class="chat-input-field">
                
                <button @click="sendMessage" class="chat-send-btn" :disabled="!messageInput.trim() && !messageImagePreview">
                    <i class="fas fa-paper-plane text-sm"></i>
                </button>
            </div>
            
            <!-- GÃ¶rsel Ã–nizleme -->
            <div x-show="messageImagePreview" class="mt-3 relative inline-block">
                <img :src="messageImagePreview" class="w-24 h-24 object-cover rounded-xl border-2 border-emerald-200">
                <button @click="messageImagePreview = null; messageImageFile = null" class="absolute -top-2 -right-2 w-6 h-6 bg-red-500 text-white rounded-full text-xs flex items-center justify-center shadow-lg">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Hikaye GÃ¶rÃ¼ntÃ¼leme Modal -->
    <div x-show="showStoryViewer" x-transition x-cloak class="fixed inset-0 z-[90] bg-black flex flex-col">
        <!-- Progress Bar - Ã‡oklu Hikaye Ä°Ã§in -->
        <div class="absolute top-0 left-0 right-0 z-20 flex gap-1 p-2" x-show="currentStoryGroup && currentStoryGroup.stories && currentStoryGroup.stories.length > 1">
            <template x-for="(story, index) in currentStoryGroup.stories" :key="story.id">
                <div class="flex-1 h-1 bg-white/30 rounded-full overflow-hidden">
                    <div class="h-full bg-white transition-all duration-300" 
                         :style="`width: ${index < currentStoryIndex ? '100%' : (index === currentStoryIndex ? '50%' : '0%')}`"></div>
                </div>
            </template>
        </div>
        
        <div class="absolute top-4 left-4 right-4 z-10 flex items-center gap-3">
            <img :src="activeStory.userProfilePic || activeStory.profilePic || 'https://ui-avatars.com/api/?name='+(activeStory.username || 'User')" class="w-10 h-10 rounded-full object-cover border-2 border-white">
            <div class="flex-1">
                <p class="text-white font-bold text-sm" x-text="activeStory.username"></p>
                <p class="text-white/60 text-xs" x-text="formatDate(activeStory.createdAt)"></p>
            </div>
            <button @click="showStoryViewer = false; stopStoryProgress()" class="text-white w-10 h-10 rounded-full bg-white/20 flex items-center justify-center"><i class="fas fa-times text-xl"></i></button>
        </div>
        
        <!-- Instagram TarzÄ± Ä°leri/Geri ButonlarÄ± -->
        <div class="absolute inset-y-0 left-0 w-1/3 z-10 flex items-center justify-start pl-4" 
             x-show="currentStoryGroup && currentStoryGroup.stories && currentStoryGroup.stories.length > 1 && currentStoryIndex > 0"
             @click="prevStory()">
            <button class="w-12 h-12 rounded-full bg-white/20 backdrop-blur flex items-center justify-center text-white hover:bg-white/30 transition">
                <i class="fas fa-chevron-left text-xl"></i>
            </button>
        </div>
        
        <div class="absolute inset-y-0 right-0 w-1/3 z-10 flex items-center justify-end pr-4"
             x-show="currentStoryGroup && currentStoryGroup.stories && currentStoryGroup.stories.length > 1"
             @click="nextStory()">
            <button class="w-12 h-12 rounded-full bg-white/20 backdrop-blur flex items-center justify-center text-white hover:bg-white/30 transition">
                <i class="fas fa-chevron-right text-xl"></i>
            </button>
        </div>
        
        <div class="flex-1 flex items-center justify-center p-4">
            <template x-if="activeStory.mediaType === 'image'">
                <img :src="activeStory.mediaUrl" class="max-w-full max-h-full object-contain rounded-2xl">
            </template>
            <template x-if="activeStory.mediaType === 'video'">
                <video :src="activeStory.mediaUrl" class="max-w-full max-h-full rounded-2xl" autoplay controls></video>
            </template>
        </div>
        
        <!-- Hikayemi Kimler GÃ¶rmÃ¼ÅŸ - GÃ¶z Butonu -->
        <button x-show="activeStory.userId === user.id" 
                @click="loadStoryViewers(activeStory.id)"
                class="story-viewers-btn">
            <i class="fas fa-eye"></i>
            <span>Kimler GÃ¶rdÃ¼</span>
        </button>
        
        <template x-if="activeStory.text">
            <div class="absolute bottom-20 left-4 right-4 text-center">
                <p class="text-white text-lg font-bold bg-black/50 p-4 rounded-2xl" x-text="activeStory.text"></p>
            </div>
        </template>
    </div>

    <!-- Hikaye GÃ¶rÃ¼ntÃ¼leyenler Modal -->
    <div x-show="showStoryViewers" x-transition x-cloak class="fixed inset-0 z-[95] flex items-end justify-center">
        <div class="absolute inset-0 bg-black/60" @click="showStoryViewers = false"></div>
        <div class="bg-[var(--bg-card)] w-full max-w-xl h-[70vh] rounded-t-[2.5rem] relative flex flex-col p-6 overflow-hidden animate-slide-up">
            <div class="w-12 h-1.5 bg-slate-300 rounded-full mx-auto mb-4"></div>
            <h3 class="text-center font-black text-lg mb-4">Hikayeni Kimler GÃ¶rdÃ¼</h3>
            
            <div class="flex-1 overflow-y-auto space-y-3 no-scrollbar">
                <template x-if="storyViewersList.length === 0">
                    <div class="text-center py-12 text-[var(--text-sec)]">
                        <i class="fas fa-eye-slash text-4xl mb-3 opacity-50"></i>
                        <p class="font-medium">HenÃ¼z kimse gÃ¶rmedi</p>
                    </div>
                </template>
                
                <template x-for="viewer in storyViewersList" :key="viewer.id">
                    <div class="flex items-center gap-3 p-3 rounded-xl hover:bg-[var(--input-bg)]">
                        <img :src="viewer.profilePic || 'https://ui-avatars.com/api/?name='+viewer.name" 
                             @click="viewProfile(viewer.id)"
                             class="w-12 h-12 rounded-full object-cover cursor-pointer">
                        <div class="flex-1" @click="viewProfile(viewer.id)">
                            <p class="font-bold text-sm" x-text="viewer.name"></p>
                            <p class="text-xs text-slate-500" x-text="'@'+viewer.username"></p>
                        </div>
                        <span class="text-xs text-[var(--text-sec)]" x-text="formatDate(viewer.viewedAt)"></span>
                    </div>
                </template>
            </div>
        </div>
    </div>

    <!-- ÃœrÃ¼n Detay Modal (Trendyol TarzÄ±) -->
    <div x-show="showProductDetail" x-transition x-cloak class="fixed inset-0 z-[85] flex flex-col bg-[var(--bg-main)]">
        <div class="glass px-4 py-3 flex items-center justify-between border-b border-[var(--border)]">
            <button @click="showProductDetail = false" class="text-slate-500 p-2"><i class="fas fa-arrow-left text-xl"></i></button>
            <h3 class="text-lg font-black">ÃœrÃ¼n DetayÄ±</h3>
            <div class="flex gap-2">
                <!-- ÃœrÃ¼n Sahibi Ä°Ã§in Silme Butonu -->
                <template x-if="selectedProduct && selectedProduct.sellerId === user.id">
                    <button @click="deleteProduct(selectedProduct.id)" class="w-10 h-10 rounded-full bg-red-100 text-red-500 flex items-center justify-center hover:bg-red-200 transition" title="ÃœrÃ¼nÃ¼ Sil">
                        <i class="fas fa-trash"></i>
                    </button>
                </template>
                <button @click="shareProduct(selectedProduct)" class="w-10 h-10 rounded-full bg-slate-100 text-slate-600 flex items-center justify-center hover:bg-slate-200 transition" title="PaylaÅŸ">
                    <i class="fas fa-share-alt"></i>
                </button>
            </div>
        </div>
        
        <div class="flex-1 overflow-y-auto no-scrollbar" x-show="selectedProduct">
            <!-- ÃœrÃ¼n GÃ¶rselleri Galerisi -->
            <div class="relative bg-slate-100">
                <div class="aspect-square flex items-center justify-center overflow-hidden">
                    <img :src="selectedProductImages[currentProductImageIndex] || selectedProduct?.image || 'https://via.placeholder.com/400x400?text=ÃœrÃ¼n'" 
                         class="w-full h-full object-cover">
                </div>
                <!-- GÃ¶rsel SayacÄ± -->
                <div x-show="selectedProductImages.length > 1" class="absolute bottom-4 left-1/2 -translate-x-1/2 bg-black/60 text-white px-3 py-1 rounded-full text-sm">
                    <span x-text="currentProductImageIndex + 1"></span> / <span x-text="selectedProductImages.length"></span>
                </div>
                <!-- GÃ¶rsel Navigasyon ButonlarÄ± -->
                <button x-show="selectedProductImages.length > 1 && currentProductImageIndex > 0" 
                        @click="currentProductImageIndex--" 
                        class="absolute left-4 top-1/2 -translate-y-1/2 w-10 h-10 bg-white/80 rounded-full flex items-center justify-center shadow-lg">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <button x-show="selectedProductImages.length > 1 && currentProductImageIndex < selectedProductImages.length - 1" 
                        @click="currentProductImageIndex++" 
                        class="absolute right-4 top-1/2 -translate-y-1/2 w-10 h-10 bg-white/80 rounded-full flex items-center justify-center shadow-lg">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
            
            <!-- KÃ¼Ã§Ã¼k GÃ¶rsel Ã–nizlemeleri -->
            <div x-show="selectedProductImages.length > 1" class="flex gap-2 p-4 overflow-x-auto no-scrollbar">
                <template x-for="(img, index) in selectedProductImages" :key="index">
                    <button @click="currentProductImageIndex = index" 
                            :class="currentProductImageIndex === index ? 'ring-2 ring-emerald-500' : ''"
                            class="w-16 h-16 rounded-xl overflow-hidden flex-shrink-0">
                        <img :src="img" class="w-full h-full object-cover">
                    </button>
                </template>
            </div>
            
            <!-- ÃœrÃ¼n Bilgileri -->
            <div class="p-4 space-y-4">
                <!-- Fiyat ve Ä°sim -->
                <div>
                    <h2 class="text-2xl font-black text-emerald-600" x-text="selectedProduct?.price + ' â‚º'"></h2>
                    <h1 class="text-xl font-bold mt-1" x-text="selectedProduct?.name"></h1>
                </div>
                
                <!-- SatÄ±cÄ± Bilgisi -->
                <div class="flex items-center gap-3 p-3 bg-[var(--input-bg)] rounded-2xl" @click="viewProfile(selectedProduct?.sellerId)">
                    <img :src="selectedProduct?.sellerProfilePic || 'https://ui-avatars.com/api/?name='+selectedProduct?.sellerName" class="w-12 h-12 rounded-full object-cover">
                    <div class="flex-1">
                        <p class="font-bold text-sm" x-text="selectedProduct?.sellerName"></p>
                        <p class="text-xs text-slate-500">SatÄ±cÄ±</p>
                    </div>
                    <i class="fas fa-chevron-right text-slate-400"></i>
                </div>
                
                <!-- AÃ§Ä±klama -->
                <div>
                    <h3 class="font-bold text-sm text-slate-500 mb-2">AÃ§Ä±klama</h3>
                    <p class="text-sm leading-relaxed" x-text="selectedProduct?.description || 'AÃ§Ä±klama bulunmuyor'"></p>
                </div>
                
                <!-- Kategori ve Stok -->
                <div class="flex gap-4">
                    <div x-show="selectedProduct?.category" class="flex-1 p-3 bg-[var(--input-bg)] rounded-xl">
                        <p class="text-xs text-slate-500">Kategori</p>
                        <p class="font-semibold text-sm" x-text="selectedProduct?.category"></p>
                    </div>
                    <div class="flex-1 p-3 bg-[var(--input-bg)] rounded-xl">
                        <p class="text-xs text-slate-500">Stok</p>
                        <p class="font-semibold text-sm" x-text="(selectedProduct?.stock || 1) + ' adet'"></p>
                    </div>
                </div>
                
                <!-- PaylaÅŸÄ±m Tarihi -->
                <div class="flex items-center gap-2 text-xs text-slate-400">
                    <i class="far fa-clock"></i>
                    <span x-text="'Ä°lan tarihi: ' + formatDate(selectedProduct?.createdAt)"></span>
                </div>
            </div>
        </div>
        
        <!-- Alt Butonlar -->
        <div class="p-4 border-t border-[var(--border)] bg-[var(--bg-card)]">
            <button @click="startChatWithSeller(selectedProduct)" class="w-full py-4 btn-agro flex items-center justify-center gap-2">
                <i class="fas fa-comment-dots"></i>
                <span>SatÄ±cÄ±yla MesajlaÅŸ</span>
            </button>
        </div>
    </div>

    <!-- Hikaye OluÅŸtur Modal -->
    <div x-show="showStoryModal" x-transition x-cloak class="fixed inset-0 z-[60] flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/60" @click="showStoryModal = false"></div>
        <div class="bg-[var(--bg-card)] w-full max-w-md rounded-[2.5rem] p-6 relative animate-slide-up">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-black">Hikaye PaylaÅŸ</h3>
                <button @click="showStoryModal = false" class="text-slate-400"><i class="fas fa-times text-xl"></i></button>
            </div>
            
            <div class="flex flex-col items-center gap-4">
                <label class="w-full cursor-pointer">
                    <div class="w-full h-64 bg-[var(--input-bg)] rounded-2xl flex items-center justify-center border-2 border-dashed border-slate-300 overflow-hidden">
                        <template x-if="!storyForm.preview">
                            <div class="text-center">
                                <i class="fas fa-camera text-4xl text-slate-300 mb-2"></i>
                                <p class="text-sm text-slate-400">FotoÄŸraf veya Video SeÃ§</p>
                            </div>
                        </template>
                        <template x-if="storyForm.preview && storyForm.mediaType === 'image'">
                            <img :src="storyForm.preview" class="w-full h-full object-cover">
                        </template>
                        <template x-if="storyForm.preview && storyForm.mediaType === 'video'">
                            <video :src="storyForm.preview" class="w-full h-full object-cover" controls></video>
                        </template>
                    </div>
                    <input type="file" class="hidden" @change="handleStoryMedia" accept="image/*,video/*">
                </label>
                
                <input type="text" x-model="storyForm.text" placeholder="Bir ÅŸeyler yaz... (opsiyonel)" class="w-full bg-[var(--input-bg)] p-4 rounded-2xl border-none outline-none focus:ring-2 focus:ring-emerald-500">
            </div>
            
            <button @click="submitStory" class="w-full mt-6 py-4 btn-agro" :disabled="loading || !storyForm.media">
                <span x-show="!loading">Hikaye PaylaÅŸ</span>
                <i x-show="loading" class="fas fa-spinner fa-spin"></i>
            </button>
        </div>
    </div>

    <!-- TakipÃ§i/Takip Listesi Modal -->
    <div x-show="showConnectionsModal" x-transition x-cloak class="fixed inset-0 z-[60] flex items-end justify-center">
        <div class="absolute inset-0 bg-black/40" @click="showConnectionsModal = false"></div>
        <div class="bg-[var(--bg-card)] w-full max-w-xl h-[70vh] rounded-t-[2.5rem] relative flex flex-col p-6 overflow-hidden animate-slide-up">
            <div class="w-12 h-1.5 bg-slate-300 rounded-full mx-auto mb-4"></div>
            <h3 class="text-center font-black text-lg mb-4" x-text="connectionsType === 'followers' ? 'TakipÃ§iler' : 'Takip Edilenler'"></h3>
            
            <div class="flex-1 overflow-y-auto space-y-3 no-scrollbar">
                <template x-for="conn in connectionsList" :key="conn.id">
                    <div class="flex items-center gap-3 p-3 rounded-xl hover:bg-[var(--input-bg)]">
                        <img :src="conn.profilePic || 'https://ui-avatars.com/api/?name='+conn.name" @click="viewProfile(conn.id)" class="w-12 h-12 rounded-full object-cover cursor-pointer">
                        <div class="flex-1" @click="viewProfile(conn.id)">
                            <p class="font-bold text-sm" x-text="conn.name"></p>
                            <p class="text-xs text-slate-500" x-text="'@'+conn.username"></p>
                        </div>
                        <button @click="toggleFollow(conn)" class="px-4 py-2 rounded-xl text-xs font-bold transition" :class="conn.isFollowing ? 'bg-[var(--input-bg)]' : 'bg-emerald-500 text-white'">
                            <span x-text="conn.isFollowing ? 'Takipten Ã‡Ä±k' : 'Takip Et'"></span>
                        </button>
                    </div>
                </template>
            </div>
        </div>
    </div>

    <!-- DiÄŸer KullanÄ±cÄ± Profili - TAM SAYFA TASARIM -->
    <div x-show="showUserProfile" x-transition x-cloak class="fixed inset-0 z-[70] bg-[var(--bg-main)] overflow-y-auto" x-data="{ userProfileTab: 'posts' }">
        
        <!-- Header Bar -->
        <div class="sticky top-0 z-10 px-4 py-3 flex items-center gap-4 bg-[var(--bg-main)] border-b border-[var(--border)]">
            <button @click="showUserProfile = false" class="text-[var(--text-main)]">
                <i class="fas fa-arrow-left text-lg"></i>
            </button>
            <div>
                <h2 class="font-bold text-lg leading-tight" x-text="viewedUser.name"></h2>
                <p class="text-xs text-[var(--text-sec)]" x-text="(viewedUser.postCount || viewedUser.postsCount || 0) + ' gÃ¶nderi'"></p>
            </div>
        </div>
        
        <!-- Kapak ve Profil FotoÄŸrafÄ± -->
        <div class="profile-header">
            <!-- Kapak FotoÄŸrafÄ± - TÄ±klanabilir YakÄ±nlaÅŸtÄ±rma -->
            <div class="profile-cover-container cursor-pointer" @click="openCoverZoom(viewedUser.coverPic || 'https://images.unsplash.com/photo-1500382017468-9049fed747ef?w=800&q=80')">
                <template x-if="viewedUser.coverPic">
                    <img :src="viewedUser.coverPic" alt="Kapak">
                </template>
                <template x-if="!viewedUser.coverPic">
                    <img src="https://images.unsplash.com/photo-1500382017468-9049fed747ef?w=800&q=80" alt="Kapak">
                </template>
                <div class="absolute inset-0 bg-black/0 hover:bg-black/20 transition flex items-center justify-center opacity-0 hover:opacity-100">
                    <i class="fas fa-search-plus text-white text-2xl"></i>
                </div>
            </div>
            
            <!-- Profil FotoÄŸrafÄ± - TÄ±klanabilir Tam Ekran -->
            <div class="profile-avatar-container cursor-pointer" @click="openFullScreen(viewedUser.profilePic || 'https://ui-avatars.com/api/?name='+viewedUser.name, 'image')">
                <div class="profile-avatar-ring relative group">
                    <img :src="viewedUser.profilePic || 'https://ui-avatars.com/api/?name='+viewedUser.name" alt="Profil">
                    <div class="absolute inset-0 bg-black/0 group-hover:bg-black/20 transition rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100">
                        <i class="fas fa-expand text-white text-lg"></i>
                    </div>
                </div>
            </div>
            
            <!-- Takip Et / Mesaj / PaylaÅŸ ButonlarÄ± -->
            <div class="profile-edit-btn flex gap-2">
                <button @click="toggleFollowUser(viewedUser)" 
                        class="px-5 py-2.5 rounded-full font-semibold text-sm transition"
                        :class="viewedUser.isFollowing ? 'border border-[var(--border)] bg-[var(--bg-card)] text-[var(--text-main)]' : 'bg-emerald-500 text-white'">
                    <span x-text="viewedUser.isFollowing ? 'Takip Ediliyor' : 'Takip Et'"></span>
                </button>
                <!-- Video/Sesli Arama ButonlarÄ± KALDIRILDI - Sadece mesaj ve paylaÅŸ -->
                <button @click="startChatWithUser(viewedUser)" 
                        class="w-10 h-10 flex items-center justify-center rounded-full border border-[var(--border)] bg-[var(--bg-card)]">
                    <i class="fas fa-comment-dots"></i>
                </button>
                <button @click="shareProfile(viewedUser)" 
                        class="w-10 h-10 flex items-center justify-center rounded-full border border-[var(--border)] bg-[var(--bg-card)]">
                    <i class="fas fa-share-alt"></i>
                </button>
            </div>
        </div>
        
        <!-- Profil Bilgileri -->
        <div class="px-6 pt-16 pb-4">
            <!-- Ä°sim, Onay, Ã‡evrimiÃ§i Durumu -->
            <div class="flex items-center gap-2 flex-wrap">
                <h1 class="text-2xl font-bold" x-text="viewedUser.name"></h1>
                <template x-if="viewedUser.isVerified || viewedUser.verified">
                    <span class="verified-badge">
                        <svg viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M17.7508 9.41667C17.7508 8.1 17.0217 6.95833 15.9608 6.41667C16.0892 6.05417 16.1592 5.6625 16.1592 5.25C16.1592 3.40833 14.7342 1.91833 12.9775 1.91833C12.5858 1.91833 12.2108 1.98833 11.8642 2.12667C11.3492 1.0125 10.2592 0.25 9.00083 0.25C7.7425 0.25 6.65417 1.01417 6.13667 2.125C5.79083 1.9875 5.415 1.91667 5.02333 1.91667C3.265 1.91667 1.84167 3.40833 1.84167 5.25C1.84167 5.66167 1.91083 6.05333 2.03917 6.41667C0.979167 6.95833 0.25 8.09833 0.25 9.41667C0.25 10.6625 0.901667 11.7483 1.86833 12.3217C1.85167 12.4633 1.84167 12.605 1.84167 12.75C1.84167 14.5917 3.265 16.0833 5.02333 16.0833C5.415 16.0833 5.79 16.0117 6.13583 15.875C6.6525 16.9867 7.74083 17.75 9 17.75C10.26 17.75 11.3483 16.9867 11.8642 15.875C12.21 16.0108 12.585 16.0817 12.9775 16.0817C14.7358 16.0817 16.1592 14.59 16.1592 12.7483C16.1592 12.6033 16.1492 12.4617 16.1317 12.3208C17.0967 11.7483 17.7508 10.6625 17.7508 9.4175V9.41667ZM12.2375 6.63833L8.62583 12.055C8.505 12.2358 8.3075 12.3333 8.105 12.3333C7.98583 12.3333 7.865 12.3 7.75833 12.2283L7.6625 12.15L5.65 10.1375C5.40583 9.89333 5.40583 9.4975 5.65 9.25417C5.89417 9.01083 6.29 9.00917 6.53333 9.25417L8.00833 10.7267L11.1958 5.94333C11.3875 5.65583 11.7758 5.58 12.0625 5.77083C12.3508 5.9625 12.4292 6.35083 12.2375 6.6375V6.63833Z" fill="#1D9BF0"/>
                        </svg>
                    </span>
                </template>
                <span x-show="viewedUser.isOnline" class="online-status">Ã‡evrimiÃ§i</span>
            </div>
            
            <!-- @username -->
            <p class="text-[var(--text-sec)] mt-1" x-text="'@' + viewedUser.username"></p>
            
            <!-- Bio -->
            <p class="mt-3 text-[var(--text-main)] leading-relaxed" x-text="viewedUser.bio || 'HenÃ¼z bir biyografi eklenmedi ðŸŒ±'"></p>
            
            <!-- Konum, Website ve KatÄ±lÄ±m Tarihi -->
            <div class="flex items-center gap-4 mt-3 text-[var(--text-sec)] text-sm flex-wrap">
                <template x-if="viewedUser.location">
                    <span class="flex items-center gap-1">
                        <i class="fas fa-map-marker-alt"></i>
                        <span x-text="viewedUser.location"></span>
                    </span>
                </template>
                <!-- WEB SÄ°TESÄ° EKLENDÄ° -->
                <template x-if="viewedUser.website">
                    <a :href="viewedUser.website.startsWith('http') ? viewedUser.website : 'https://' + viewedUser.website" 
                       target="_blank" 
                       rel="noopener noreferrer"
                       class="flex items-center gap-1 text-blue-500 hover:underline">
                        <i class="fas fa-link"></i>
                        <span x-text="viewedUser.website.replace(/^https?:\/\//, '').split('/')[0]"></span>
                    </a>
                </template>
                <span class="flex items-center gap-1">
                    <i class="far fa-calendar-alt"></i>
                    <span x-text="formatJoinDate(viewedUser.createdAt)"></span>
                </span>
            </div>
            
            <!-- Takip Ä°statistikleri - TIKLANABÄ°LÄ°R -->
            <div class="flex items-center gap-6 mt-4">
                <div class="stat-inline cursor-pointer hover:underline" @click="showUserConnections('following')">
                    <strong x-text="formatCount(viewedUser.followingCount || viewedUser.following || 0)"></strong>
                    <span>Takip</span>
                </div>
                <div class="stat-inline cursor-pointer hover:underline" @click="showUserConnections('followers')">
                    <strong x-text="formatCount(viewedUser.followerCount || viewedUser.followers || 0)"></strong>
                    <span>TakipÃ§i</span>
                </div>
            </div>
            
            <!-- Ortak TakipÃ§iler - GÃ–RÃœNÃœR VE TIKLANABÄ°LÄ°R -->
            <div x-show="mutualFollowers && mutualFollowers.length > 0" 
                 class="mutual-followers mt-4" 
                 @click="showMutualFollowersModal = true"
                 style="display: flex !important;">
                <div class="mutual-followers-avatars">
                    <template x-for="(mf, idx) in mutualFollowers.slice(0, 3)" :key="mf.id || idx">
                        <div class="w-7 h-7 rounded-full overflow-hidden border-2 border-white -ml-2 first:ml-0 bg-gradient-to-br from-emerald-400 to-teal-500">
                            <template x-if="mf.profilePic">
                                <img :src="mf.profilePic" :alt="mf.name" class="w-full h-full object-cover">
                            </template>
                            <template x-if="!mf.profilePic">
                                <div class="w-full h-full flex items-center justify-center text-white text-xs font-bold" x-text="(mf.name || 'K').charAt(0).toUpperCase()"></div>
                            </template>
                        </div>
                    </template>
                </div>
                <div class="flex-1 ml-2">
                    <p class="text-sm">
                        <span class="font-bold" x-text="mutualFollowers[0]?.name || 'ArkadaÅŸÄ±n'"></span>
                        <template x-if="mutualFollowers.length === 1">
                            <span class="text-[var(--text-sec)]"> da bu kiÅŸiyi takip ediyor</span>
                        </template>
                        <template x-if="mutualFollowers.length > 1">
                            <span class="text-[var(--text-sec)]"> ve <strong x-text="mutualFollowers.length - 1"></strong> kiÅŸi daha takip ediyor</span>
                        </template>
                    </p>
                </div>
                <i class="fas fa-chevron-right text-[var(--text-sec)]"></i>
            </div>
        </div>
        
        <!-- Sekmeler -->
        <div class="profile-tabs">
            <div @click="userProfileTab = 'posts'" class="profile-tab" :class="userProfileTab === 'posts' ? 'active' : ''">
                GÃ¶nderiler
            </div>
            <div @click="userProfileTab = 'media'" class="profile-tab" :class="userProfileTab === 'media' ? 'active' : ''">
                Medya
            </div>
        </div>
        
        <!-- Sekme Ä°Ã§erikleri -->
        <div class="px-4 py-4 pb-24">
            
            <!-- GÃ¶nderiler Sekmesi -->
            <div x-show="userProfileTab === 'posts'" class="space-y-4">
                <template x-if="viewedUserPosts.length === 0">
                    <div class="text-center py-12 text-[var(--text-sec)]">
                        <i class="fas fa-seedling text-4xl mb-3 opacity-50"></i>
                        <p class="font-medium">HenÃ¼z gÃ¶nderi yok</p>
                    </div>
                </template>
                <template x-for="post in viewedUserPosts" :key="post.id">
                    <div class="agro-card p-4">
                        <div class="flex items-start gap-3">
                            <img :src="viewedUser.profilePic || 'https://ui-avatars.com/api/?name='+viewedUser.name" class="w-10 h-10 rounded-full object-cover flex-shrink-0">
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-1.5 flex-wrap">
                                    <span class="font-bold text-sm" x-text="viewedUser.name"></span>
                                    <template x-if="viewedUser.isVerified">
                                        <span class="verified-badge verified-badge-sm"></span>
                                    </template>
                                    <span class="text-[var(--text-sec)] text-xs" x-text="'@' + viewedUser.username"></span>
                                    <span class="text-[var(--text-sec)] text-xs">Â·</span>
                                    <span class="text-[var(--text-sec)] text-xs" x-text="formatDate(post.createdAt)"></span>
                                </div>
                                <p class="mt-2 text-sm" x-html="formatContent(post.content)"></p>
                                <template x-if="post.mediaUrl">
                                    <div class="mt-3">
                                        <template x-if="post.mediaType === 'video'">
                                            <video :src="post.mediaUrl" class="rounded-2xl w-full max-h-80 object-cover" controls></video>
                                        </template>
                                        <template x-if="post.mediaType !== 'video'">
                                            <img :src="post.mediaUrl" @click="openFullScreen(post.mediaUrl, 'image')" class="rounded-2xl w-full max-h-80 object-cover cursor-pointer">
                                        </template>
                                    </div>
                                </template>
                                <div class="flex items-center gap-6 mt-3 text-[var(--text-sec)] text-sm">
                                    <span class="flex items-center gap-1"><i class="far fa-comment"></i><span x-text="post.commentCount || 0"></span></span>
                                    <span class="flex items-center gap-1"><i class="far fa-heart"></i><span x-text="post.likeCount || 0"></span></span>
                                    <span class="flex items-center gap-1"><i class="fas fa-chart-bar"></i><span x-text="post.viewCount || 0"></span></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </template>
            </div>
            
            <!-- Medya Sekmesi -->
            <div x-show="userProfileTab === 'media'" class="grid grid-cols-3 gap-1">
                <template x-for="post in viewedUserPosts.filter(p => p.mediaUrl)" :key="'user-media-'+post.id">
                    <div class="aspect-square overflow-hidden rounded-lg cursor-pointer hover:opacity-80 transition" @click="openFullScreen(post.mediaUrl, post.mediaType || 'image')">
                        <template x-if="post.mediaType === 'video'">
                            <div class="w-full h-full bg-slate-800 flex items-center justify-center relative">
                                <video :src="post.mediaUrl" class="w-full h-full object-cover"></video>
                                <i class="fas fa-play absolute text-white text-xl"></i>
                            </div>
                        </template>
                        <template x-if="post.mediaType !== 'video'">
                            <img :src="post.mediaUrl" class="w-full h-full object-cover">
                        </template>
                    </div>
                </template>
                <template x-if="viewedUserPosts.filter(p => p.mediaUrl).length === 0">
                    <div class="col-span-3 text-center py-12 text-[var(--text-sec)]">
                        <i class="fas fa-images text-4xl mb-3 opacity-50"></i>
                        <p class="font-medium">HenÃ¼z medya yok</p>
                    </div>
                </template>
            </div>
        </div>
    </div>

    <!-- Post SeÃ§enekleri Modal - TAM EKRAN -->
    <div x-show="showPostOptions" x-transition x-cloak class="fixed inset-0 z-[200] flex flex-col bg-[var(--bg-main)]">
        <!-- Header -->
        <div class="glass px-4 py-4 flex items-center justify-between">
            <button @click="showPostOptions = false" class="text-slate-500">
                <i class="fas fa-arrow-left text-xl"></i>
            </button>
            <h3 class="text-lg font-black">GÃ¶nderi SeÃ§enekleri</h3>
            <div class="w-8"></div>
        </div>
        
        <!-- Ä°Ã§erik -->
        <div class="flex-1 overflow-y-auto p-4">
            <!-- SeÃ§ilen Post Ã–nizleme -->
            <div class="agro-card p-4 mb-6" x-show="selectedPost">
                <div class="flex items-center gap-3">
                    <img :src="selectedPost?.userProfilePic || 'https://ui-avatars.com/api/?name='+(selectedPost?.userName || 'User')" class="w-12 h-12 rounded-full object-cover">
                    <div>
                        <p class="font-bold" x-text="selectedPost?.userName"></p>
                        <p class="text-sm text-[var(--text-sec)]" x-text="selectedPost?.content?.substring(0, 50) + '...'"></p>
                    </div>
                </div>
            </div>
            
            <div class="space-y-3">
                <!-- Kendi postum ise -->
                <template x-if="selectedPost?.userId === user.id">
                    <div class="agro-card overflow-hidden">
                        <button @click="deletePost(selectedPost)" class="w-full p-5 text-left hover:bg-red-50 text-red-600 font-bold flex items-center gap-4 border-b border-[var(--border)]">
                            <i class="fas fa-trash text-xl"></i> 
                            <div>
                                <p class="font-bold">GÃ¶nderiyi Sil</p>
                                <p class="text-sm font-normal text-slate-500">Bu gÃ¶nderi kalÄ±cÄ± olarak silinecek</p>
                            </div>
                        </button>
                    </div>
                </template>
                
                <!-- BaÅŸkasÄ±nÄ±n postu ise -->
                <template x-if="selectedPost?.userId !== user.id">
                    <div class="agro-card overflow-hidden">
                        <button @click="showReportModal = true; showPostOptions = false" class="w-full p-5 text-left hover:bg-orange-50 font-bold flex items-center gap-4 border-b border-[var(--border)]">
                            <i class="fas fa-flag text-orange-500 text-xl"></i>
                            <div>
                                <p class="font-bold text-orange-600">Åžikayet Et</p>
                                <p class="text-sm font-normal text-slate-500">Bu gÃ¶nderiyi uygunsuz olarak bildir</p>
                            </div>
                        </button>
                        <button @click="blockUserFromPost(selectedPost.userId)" class="w-full p-5 text-left hover:bg-red-50 text-red-600 font-bold flex items-center gap-4">
                            <i class="fas fa-ban text-xl"></i>
                            <div>
                                <p class="font-bold">KullanÄ±cÄ±yÄ± Engelle</p>
                                <p class="text-sm font-normal text-slate-500">Bu kullanÄ±cÄ±nÄ±n gÃ¶nderilerini gÃ¶rmeyeceksiniz</p>
                            </div>
                        </button>
                    </div>
                </template>
            </div>
        </div>
    </div>
    
    <!-- ÅžÄ°KAYET MODAL - TAM EKRAN -->
    <div x-show="showReportModal" x-transition x-cloak class="fixed inset-0 z-[250] flex flex-col bg-[var(--bg-main)]">
        <div class="glass px-4 py-4 flex items-center justify-between">
            <button @click="showReportModal = false" class="text-slate-500">
                <i class="fas fa-arrow-left text-xl"></i>
            </button>
            <h3 class="text-lg font-black">GÃ¶nderiyi Åžikayet Et</h3>
            <div class="w-8"></div>
        </div>
        
        <div class="flex-1 overflow-y-auto p-4">
            <div class="agro-card p-6 mb-4">
                <div class="flex items-center gap-3 mb-4">
                    <div class="w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center">
                        <i class="fas fa-flag text-orange-500 text-xl"></i>
                    </div>
                    <div>
                        <h4 class="font-bold">Åžikayet Nedeni</h4>
                        <p class="text-sm text-[var(--text-sec)]">Neden ÅŸikayet ediyorsunuz?</p>
                    </div>
                </div>
                
                <div class="space-y-2">
                    <button @click="reportReason = 'spam'" class="w-full p-4 text-left rounded-2xl border-2 transition" :class="reportReason === 'spam' ? 'border-orange-500 bg-orange-50' : 'border-[var(--border)]'">
                        <p class="font-bold">Spam veya Ä°stenmeyen Ä°Ã§erik</p>
                    </button>
                    <button @click="reportReason = 'harassment'" class="w-full p-4 text-left rounded-2xl border-2 transition" :class="reportReason === 'harassment' ? 'border-orange-500 bg-orange-50' : 'border-[var(--border)]'">
                        <p class="font-bold">Taciz veya ZorbalÄ±k</p>
                    </button>
                    <button @click="reportReason = 'violence'" class="w-full p-4 text-left rounded-2xl border-2 transition" :class="reportReason === 'violence' ? 'border-orange-500 bg-orange-50' : 'border-[var(--border)]'">
                        <p class="font-bold">Åžiddet veya Tehdit</p>
                    </button>
                    <button @click="reportReason = 'inappropriate'" class="w-full p-4 text-left rounded-2xl border-2 transition" :class="reportReason === 'inappropriate' ? 'border-orange-500 bg-orange-50' : 'border-[var(--border)]'">
                        <p class="font-bold">Uygunsuz Ä°Ã§erik</p>
                    </button>
                    <button @click="reportReason = 'other'" class="w-full p-4 text-left rounded-2xl border-2 transition" :class="reportReason === 'other' ? 'border-orange-500 bg-orange-50' : 'border-[var(--border)]'">
                        <p class="font-bold">DiÄŸer</p>
                    </button>
                </div>
                
                <textarea x-model="reportDescription" placeholder="Ek aÃ§Ä±klama (opsiyonel)..." class="w-full mt-4 bg-[var(--input-bg)] p-4 rounded-2xl border-none outline-none resize-none h-24"></textarea>
            </div>
            
            <button @click="submitReport()" class="w-full py-4 btn-agro bg-orange-500" :disabled="!reportReason || loading">
                <span x-show="!loading">Åžikayeti GÃ¶nder</span>
                <i x-show="loading" class="fas fa-spinner fa-spin"></i>
            </button>
            
            <p class="text-center text-xs text-[var(--text-sec)] mt-4">
                Åžikayetiniz <strong><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="c3a4aca8b7a6b3a6a5a2b7aea2f583a4aea2aaafeda0acae">[email&#160;protected]</a></strong> adresine iletilecektir.
            </p>
        </div>
    </div>

    <!-- ========== ORTAK TAKÄ°PÃ‡Ä°LER MODAL ========== -->
    <div x-show="showMutualFollowersModal" x-transition x-cloak class="fixed inset-0 z-[100] flex items-end justify-center">
        <div class="absolute inset-0 bg-black/40" @click="showMutualFollowersModal = false"></div>
        <div class="bg-[var(--bg-card)] w-full max-w-md rounded-t-[2.5rem] p-6 animate-slide-up max-h-[70vh] overflow-hidden flex flex-col">
            <div class="w-12 h-1.5 bg-slate-300 rounded-full mx-auto mb-4"></div>
            <h3 class="text-center font-black text-lg mb-4">Ortak Takip Edenler</h3>
            
            <div class="flex-1 overflow-y-auto space-y-2">
                <template x-for="mf in mutualFollowers" :key="mf.id || mf.username">
                    <div class="flex items-center gap-3 p-3 rounded-xl hover:bg-[var(--input-bg)] cursor-pointer" @click="viewProfile(mf.id); showMutualFollowersModal = false">
                        <!-- Profil resmi yoksa varsayÄ±lan avatar -->
                        <div class="w-12 h-12 rounded-full overflow-hidden bg-gradient-to-br from-emerald-400 to-teal-500 flex-shrink-0">
                            <template x-if="mf.profilePic">
                                <img :src="mf.profilePic" class="w-full h-full object-cover">
                            </template>
                            <template x-if="!mf.profilePic">
                                <div class="w-full h-full flex items-center justify-center text-white font-bold text-xl" x-text="(mf.name || 'K').charAt(0).toUpperCase()"></div>
                            </template>
                        </div>
                        <div class="flex-1">
                            <p class="font-bold text-sm" x-text="mf.name"></p>
                            <p class="text-xs text-[var(--text-sec)]" x-text="'@'+mf.username"></p>
                        </div>
                        <i class="fas fa-chevron-right text-[var(--text-sec)]"></i>
                    </div>
                </template>
                <template x-if="!mutualFollowers || mutualFollowers.length === 0">
                    <div class="text-center py-8 text-[var(--text-sec)]">
                        <i class="fas fa-users text-4xl mb-3 opacity-50"></i>
                        <p>Ortak takipÃ§i bulunamadÄ±</p>
                    </div>
                </template>
            </div>
        </div>
    </div>
    
    <!-- ========== KAPAK FOTOÄžRAFI ZOOM MODAL ========== -->
    <div x-show="showCoverZoom" x-transition x-cloak class="pinch-zoom-container" @click.self="showCoverZoom = false">
        <button @click="showCoverZoom = false" class="absolute top-4 left-4 z-10 w-10 h-10 rounded-full bg-black/50 text-white flex items-center justify-center">
            <i class="fas fa-times text-xl"></i>
        </button>
        
        <img :src="coverZoomUrl" 
             id="zoomableImage" 
             class="pinch-zoom-image"
             :style="`transform: scale(${zoomLevel})`"
             @wheel="handleZoomWheel($event)"
             @touchstart="handleTouchZoomStart($event)"
             @touchmove="handleTouchZoomMove($event)"
             @touchend="handleTouchZoomEnd($event)">
        
        <div class="pinch-zoom-controls">
            <button @click="zoomOut()"><i class="fas fa-search-minus"></i></button>
            <button @click="zoomReset()"><i class="fas fa-redo"></i></button>
            <button @click="zoomIn()"><i class="fas fa-search-plus"></i></button>
        </div>
    </div>

    <!-- ========== TIKTOK TARZI KAYDIRMA MODAL ========== -->
    <div x-show="showTikTokScroll" x-transition x-cloak class="tiktok-scroll-container">
        <button @click="closeTikTokScroll" class="absolute top-4 left-4 z-50 text-white p-2">
            <i class="fas fa-arrow-left text-2xl"></i>
        </button>
        
        <div class="tiktok-scroll-wrapper" @scroll="handleTikTokScroll">
            <template x-for="(post, index) in tikTokPosts" :key="post.id">
                <div class="tiktok-post" 
                     @dblclick="doubleTapLike(post)"
                     @touchstart="handleTouchStart($event)"
                     @touchend="handleTouchEnd($event, post)">
                    
                    <!-- Kalp Atma Animasyonu -->
                    <div x-show="showHeartAnimation === post.id" 
                         x-transition
                         class="heart-animation"
                         :class="showHeartAnimation === post.id ? 'animate' : ''">
                        <i class="fas fa-heart"></i>
                    </div>
                    
                    <!-- Medya -->
                    <template x-if="post.mediaType === 'video'">
                        <div class="relative w-full h-full flex items-center justify-center"
                             x-data="{ isMuted: true, showVolumeIndicator: false }"
                             x-init="
                                // Her scroll'da sadece gÃ¶rÃ¼nen video sesli olsun
                                $watch('currentTikTokIndex', (newIndex) => {
                                    const thisIndex = tikTokPosts.indexOf(post);
                                    const video = $el.querySelector('video');
                                    if (video) {
                                        if (thisIndex === newIndex) {
                                            video.play().catch(() => {});
                                        } else {
                                            video.pause();
                                            video.muted = true;
                                            isMuted = true;
                                        }
                                    }
                                });
                             "
                             @click="
                                const video = $el.querySelector('video');
                                video.muted = !video.muted;
                                isMuted = video.muted;
                                showVolumeIndicator = true;
                                setTimeout(() => showVolumeIndicator = false, 1500);
                             ">
                            <video :src="post.mediaUrl" 
                                   autoplay 
                                   loop 
                                   muted
                                   playsinline
                                   class="max-h-screen max-w-full"
                                   x-ref="tiktokvideo"></video>
                            <!-- Ses GÃ¶stergesi -->
                            <div x-show="showVolumeIndicator" 
                                 x-transition
                                 class="absolute inset-0 flex items-center justify-center bg-black/50 pointer-events-none">
                                <i class="fas text-white text-6xl" :class="isMuted ? 'fa-volume-mute' : 'fa-volume-up'"></i>
                            </div>
                            <!-- Ses Ä°konu (KÃ¼Ã§Ã¼k) -->
                            <div class="absolute top-20 right-4 bg-black/50 rounded-full p-3 pointer-events-none">
                                <i class="fas text-white text-xl" :class="isMuted ? 'fa-volume-mute' : 'fa-volume-up'"></i>
                            </div>
                        </div>
                    </template>
                    <template x-if="post.mediaType !== 'video' && post.mediaUrl">
                        <img :src="post.mediaUrl" class="max-h-screen max-w-full object-contain">
                    </template>
                    
                    <!-- Ä°Ã§erik (metin gÃ¶nderisi) -->
                    <template x-if="!post.mediaUrl">
                        <div class="text-white text-center p-8 max-w-md">
                            <p class="text-xl" x-text="post.content"></p>
                        </div>
                    </template>
                    
                    <!-- Sol Alt - KullanÄ±cÄ± Bilgisi -->
                    <div class="absolute bottom-20 left-4 right-24 text-white z-10">
                        <div class="flex items-center gap-2 mb-2">
                            <img :src="post.userProfilePic || 'https://ui-avatars.com/api/?name='+post.userName" 
                                 class="w-10 h-10 rounded-full border-2 border-white">
                            <span class="font-bold" x-text="post.userName"></span>
                            <template x-if="post.userVerified">
                                <i class="fas fa-check-circle text-blue-400"></i>
                            </template>
                        </div>
                        <p class="text-sm opacity-90 line-clamp-3" x-text="post.content"></p>
                        <p class="text-xs opacity-60 mt-1" x-text="formatDate(post.createdAt)"></p>
                    </div>
                    
                    <!-- SaÄŸ Taraf - Eylem ButonlarÄ± -->
                    <div class="side-actions">
                        <!-- Profil -->
                        <div class="side-action-btn" @click="viewProfile(post.userId)">
                            <img :src="post.userProfilePic || 'https://ui-avatars.com/api/?name='+post.userName" 
                                 class="w-10 h-10 rounded-full border-2 border-white">
                        </div>
                        
                        <!-- BeÄŸen -->
                        <button class="side-action-btn" @click="likePost(post)">
                            <i class="fas fa-heart" :class="post.isLiked ? 'text-red-500' : ''"></i>
                            <span x-text="post.likeCount || 0"></span>
                        </button>
                        
                        <!-- Yorum -->
                        <button class="side-action-btn" @click="openComments(post)">
                            <i class="fas fa-comment"></i>
                            <span x-text="post.commentCount || 0"></span>
                        </button>
                        
                        <!-- PaylaÅŸ -->
                        <button class="side-action-btn" @click="sharePost(post)">
                            <i class="fas fa-share"></i>
                            <span>PaylaÅŸ</span>
                        </button>
                    </div>
                </div>
            </template>
        </div>
    </div>

    <!-- Tam Ekran Medya Modal -->
    <div x-show="showFullScreen" x-transition x-cloak class="fixed inset-0 z-[100] bg-black flex items-center justify-center" @click="showFullScreen = false">
        <button class="absolute top-4 right-4 text-white z-10"><i class="fas fa-times text-2xl"></i></button>
        <template x-if="fullScreenMedia.type === 'image'">
            <img :src="fullScreenMedia.url" class="max-w-full max-h-full object-contain">
        </template>
        <template x-if="fullScreenMedia.type === 'video'">
            <video :src="fullScreenMedia.url" class="max-w-full max-h-full" controls autoplay></video>
        </template>
    </div>

    <!-- ========== POST DETAY MODAL ========== -->
    <div x-show="showPostDetail" x-transition x-cloak class="fixed inset-0 z-[250] flex flex-col bg-[var(--bg-main)]">
        <!-- Header -->
        <div class="glass px-4 py-4 flex items-center justify-between z-10">
            <button @click="showPostDetail = false" class="text-slate-500">
                <i class="fas fa-arrow-left text-xl"></i>
            </button>
            <h3 class="text-lg font-black">GÃ¶nderi</h3>
            <div class="w-8"></div>
        </div>
        
        <!-- Post Content -->
        <div class="flex-1 overflow-y-auto no-scrollbar" x-show="postDetail">
            <div class="agro-card mx-4 mt-4 mb-4">
                <!-- User Info -->
                <div class="flex items-start gap-3 p-4">
                    <img :src="postDetail?.userProfilePic || 'https://ui-avatars.com/api/?name='+postDetail?.userName" 
                         @click="viewProfile(postDetail?.userId)"
                         class="w-10 h-10 rounded-full object-cover flex-shrink-0 cursor-pointer">
                    <div class="flex-1 min-w-0">
                        <div class="flex items-center gap-1.5 flex-wrap">
                            <span class="font-black text-sm cursor-pointer" @click="viewProfile(postDetail?.userId)" x-text="postDetail?.userName"></span>
                            <template x-if="postDetail?.userVerified">
                                <i class="fas fa-check-circle text-blue-400 text-xs"></i>
                            </template>
                            <span class="text-[var(--text-sec)] text-xs" x-text="'@' + postDetail?.username"></span>
                            <span class="text-[var(--text-sec)] text-xs">Â·</span>
                            <span class="text-[var(--text-sec)] text-xs" x-text="formatDate(postDetail?.createdAt)"></span>
                        </div>
                        <p class="mt-2 text-sm font-medium" x-html="formatContent(postDetail?.content)"></p>
                        
                        <!-- Medya -->
                        <template x-if="postDetail?.mediaUrl">
                            <div class="mt-3">
                                <template x-if="postDetail?.mediaType === 'video'">
                                    <video :src="postDetail?.mediaUrl" class="rounded-2xl w-full max-h-80 object-cover" controls></video>
                                </template>
                                <template x-if="postDetail?.mediaType !== 'video'">
                                    <img :src="postDetail?.mediaUrl" @click="openFullScreen(postDetail?.mediaUrl, 'image')" class="rounded-2xl w-full max-h-80 object-cover cursor-pointer">
                                </template>
                            </div>
                        </template>
                        
                        <!-- Actions -->
                        <div class="flex items-center gap-6 mt-4 text-[var(--text-sec)]">
                            <button @click="likePost(postDetail)" class="flex items-center gap-2" :class="postDetail?.isLiked ? 'text-red-500' : ''">
                                <i :class="postDetail?.isLiked ? 'fas fa-heart' : 'far fa-heart'"></i>
                                <span x-text="postDetail?.likeCount || 0"></span>
                            </button>
                            <button @click="openComments(postDetail)" class="flex items-center gap-2">
                                <i class="far fa-comment"></i>
                                <span x-text="postDetail?.commentCount || 0"></span>
                            </button>
                            <button @click="sharePost(postDetail)" class="flex items-center gap-2">
                                <i class="far fa-paper-plane"></i>
                                <span>PaylaÅŸ</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- SÃ¼rÃ¼m NotlarÄ± Modal -->
    <div x-show="showReleaseNotes" x-transition x-cloak class="fixed inset-0 z-[100] flex flex-col bg-[var(--bg-main)]">
        <div class="glass px-4 py-4 flex items-center justify-between">
            <button @click="showReleaseNotes = false" class="text-slate-500"><i class="fas fa-arrow-left text-xl"></i></button>
            <h3 class="text-xl font-black">SÃ¼rÃ¼m NotlarÄ±</h3>
            <div class="w-8"></div>
        </div>
        
        <div class="flex-1 overflow-y-auto p-4 space-y-4 no-scrollbar">
            <div class="agro-card p-6">
                <div class="flex items-center gap-3 mb-4">
                    <div class="w-12 h-12 bg-emerald-500 rounded-2xl flex items-center justify-center">
                        <i class="fas fa-rocket text-white text-xl"></i>
                    </div>
                    <div>
                        <h4 class="font-black text-lg">Versiyon 5.3.9</h4>
                        <p class="text-xs text-[var(--text-sec)]">8 Åžubat 2026</p>
                    </div>
                </div>
                
                <div class="space-y-4">
                    <div class="flex items-start gap-3">
                        <i class="fas fa-check-circle text-emerald-500 mt-1"></i>
                        <div>
                            <p class="font-bold text-sm">ðŸ“ Dosya YÃ¼kleme Limiti ArtÄ±rÄ±ldÄ±</p>
                            <p class="text-xs text-[var(--text-sec)]">ArtÄ±k 50MB'a kadar dosya yÃ¼kleyebilirsiniz! Video ve resimlerinizi rahatÃ§a paylaÅŸÄ±n.</p>
                        </div>
                    </div>
                    <div class="flex items-start gap-3">
                        <i class="fas fa-check-circle text-emerald-500 mt-1"></i>
                        <div>
                            <p class="font-bold text-sm">ðŸ—³ï¸ Anket Oylama DÃ¼zeltildi</p>
                            <p class="text-xs text-[var(--text-sec)]">Anketlerde oy kullanma sorunu tamamen Ã§Ã¶zÃ¼ldÃ¼. ArtÄ±k oylarÄ±nÄ±z doÄŸru ÅŸekilde kaydediliyor.</p>
                        </div>
                    </div>
                    <div class="flex items-start gap-3">
                        <i class="fas fa-check-circle text-emerald-500 mt-1"></i>
                        <div>
                            <p class="font-bold text-sm">ðŸ›’ TarÄ±m MaÄŸazasÄ± Aktif</p>
                            <p class="text-xs text-[var(--text-sec)]">ÃœrÃ¼n ekleme, dÃ¼zenleme ve silme Ã¶zellikleri artÄ±k Ã§alÄ±ÅŸÄ±yor. ÃœrÃ¼nlerinizi satÄ±ÅŸa Ã§Ä±karÄ±n!</p>
                        </div>
                    </div>
                    <div class="flex items-start gap-3">
                        <i class="fas fa-check-circle text-emerald-500 mt-1"></i>
                        <div>
                            <p class="font-bold text-sm">ðŸ‘¥ Feed'de Takip Et Butonu</p>
                            <p class="text-xs text-[var(--text-sec)]">Ana sayfada gÃ¶nderilerin yanÄ±nda "Takip Et" butonu eklendi. Takip etmek artÄ±k Ã§ok daha kolay!</p>
                        </div>
                    </div>
                    <div class="flex items-start gap-3">
                        <i class="fas fa-check-circle text-emerald-500 mt-1"></i>
                        <div>
                            <p class="font-bold text-sm">ðŸ“ž WebRTC Video Call Tam Entegrasyon</p>
                            <p class="text-xs text-[var(--text-sec)]">GerÃ§ek zamanlÄ± gÃ¶rÃ¼ntÃ¼lÃ¼ arama artÄ±k tam Ã§alÄ±ÅŸÄ±yor! Socket.IO signaling ile kusursuz deneyim.</p>
                        </div>
                    </div>
                    <div class="flex items-start gap-3">
                        <i class="fas fa-check-circle text-emerald-500 mt-1"></i>
                        <div>
                            <p class="font-bold text-sm">ðŸ” 2FA AyarlarÄ± Ã‡alÄ±ÅŸÄ±yor</p>
                            <p class="text-xs text-[var(--text-sec)]">Ä°ki faktÃ¶rlÃ¼ kimlik doÄŸrulamayÄ± aÃ§Ä±p kapatma artÄ±k sorunsuz Ã§alÄ±ÅŸÄ±yor.</p>
                        </div>
                    </div>
                    <div class="flex items-start gap-3">
                        <i class="fas fa-check-circle text-emerald-500 mt-1"></i>
                        <div>
                            <p class="font-bold text-sm">ðŸŽ¨ Modern TasarÄ±m</p>
                            <p class="text-xs text-[var(--text-sec)]">Post kartlarÄ± modern gÃ¶rÃ¼nÃ¼mle yenilendi. Gradient renkler ve smooth animasyonlar eklendi.</p>
                        </div>
                    </div>
                    <div class="flex items-start gap-3">
                        <i class="fas fa-check-circle text-emerald-500 mt-1"></i>
                        <div>
                            <p class="font-bold text-sm">âš¡ Performans Ä°yileÅŸtirmeleri</p>
                            <p class="text-xs text-[var(--text-sec)]">Uygulama genel olarak hÄ±zlandÄ±rÄ±ldÄ± ve optimize edildi.</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Ã–nceki Versiyonlar -->
            <div class="agro-card p-6">
                <div class="flex items-center gap-3 mb-4">
                    <div class="w-12 h-12 bg-slate-500 rounded-2xl flex items-center justify-center">
                        <i class="fas fa-history text-white text-xl"></i>
                    </div>
                    <div>
                        <h4 class="font-black text-lg">Versiyon 5.1.9</h4>
                        <p class="text-xs text-[var(--text-sec)]">4 Åžubat 2026</p>
                    </div>
                </div>
                
                <div class="space-y-4">
                    <div class="flex items-start gap-3">
                        <i class="fas fa-check-circle text-slate-500 mt-1"></i>
                        <div>
                            <p class="font-bold text-sm">GerÃ§ek GÃ¶rÃ¼ntÃ¼lÃ¼ Arama</p>
                            <p class="text-xs text-[var(--text-sec)]">WebRTC ile gerÃ§ek zamanlÄ± gÃ¶rÃ¼ntÃ¼lÃ¼ ve sesli arama.</p>
                        </div>
                    </div>
                    <div class="flex items-start gap-3">
                        <i class="fas fa-check-circle text-slate-500 mt-1"></i>
                        <div>
                            <p class="font-bold text-sm">Mesajlarda Media GÃ¶sterimi</p>
                            <p class="text-xs text-[var(--text-sec)]">Mesajlardaki gÃ¶rseller ve videolar dÃ¼zgÃ¼n gÃ¶rÃ¼ntÃ¼leniyor.</p>
                        </div>
                    </div>
                    <div class="flex items-start gap-3">
                        <i class="fas fa-check-circle text-slate-500 mt-1"></i>
                        <div>
                            <p class="font-bold text-sm">Ortak TakipÃ§i Listesi</p>
                            <p class="text-xs text-[var(--text-sec)]">Ortak takipÃ§i ve arkadaÅŸlarÄ±nÄ±zÄ±n takip ettiÄŸi kiÅŸiler.</p>
                        </div>
                    </div>
                    <div class="flex items-start gap-3">
                        <i class="fas fa-check-circle text-slate-500 mt-1"></i>
                        <div>
                            <p class="font-bold text-sm">DoÄŸrulanmÄ±ÅŸ Rozet Sistemi</p>
                            <p class="text-xs text-[var(--text-sec)]">HesabÄ±nÄ±zÄ± doÄŸrulatÄ±n ve mavi tik alÄ±n.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- DoÄŸrulama BaÅŸvurusu Modal -->
    <div x-show="showVerificationModal" x-transition x-cloak class="fixed inset-0 z-[100] flex flex-col bg-[var(--bg-main)]">
        <div class="glass px-4 py-4 flex items-center justify-between">
            <button @click="showVerificationModal = false" class="text-slate-500"><i class="fas fa-arrow-left text-xl"></i></button>
            <h3 class="text-xl font-black">DoÄŸrulanmÄ±ÅŸ Rozet</h3>
            <div class="w-8"></div>
        </div>
        
        <div class="flex-1 overflow-y-auto p-4 space-y-4 no-scrollbar">
            <!-- Bilgi -->
            <div class="agro-card p-6">
                <div class="flex items-center gap-3 mb-4">
                    <div class="verified-badge verified-badge-lg">
                        <svg viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M17.7508 9.41667C17.7508 8.1 17.0217 6.95833 15.9608 6.41667C16.0892 6.05417 16.1592 5.6625 16.1592 5.25C16.1592 3.40833 14.7342 1.91833 12.9775 1.91833C12.5858 1.91833 12.2108 1.98833 11.8642 2.12667C11.3492 1.0125 10.2592 0.25 9.00083 0.25C7.7425 0.25 6.65417 1.01417 6.13667 2.125C5.79083 1.9875 5.415 1.91667 5.02333 1.91667C3.265 1.91667 1.84167 3.40833 1.84167 5.25C1.84167 5.66167 1.91083 6.05333 2.03917 6.41667C0.979167 6.95833 0.25 8.09833 0.25 9.41667C0.25 10.6625 0.901667 11.7483 1.86833 12.3217C1.85167 12.4633 1.84167 12.605 1.84167 12.75C1.84167 14.5917 3.265 16.0833 5.02333 16.0833C5.415 16.0833 5.79 16.0117 6.13583 15.875C6.6525 16.9867 7.74083 17.75 9 17.75C10.26 17.75 11.3483 16.9867 11.8642 15.875C12.21 16.0108 12.585 16.0817 12.9775 16.0817C14.7358 16.0817 16.1592 14.59 16.1592 12.7483C16.1592 12.6033 16.1492 12.4617 16.1317 12.3208C17.0967 11.7483 17.7508 10.6625 17.7508 9.4175V9.41667ZM12.2375 6.63833L8.62583 12.055C8.505 12.2358 8.3075 12.3333 8.105 12.3333C7.98583 12.3333 7.865 12.3 7.75833 12.2283L7.6625 12.15L5.65 10.1375C5.40583 9.89333 5.40583 9.4975 5.65 9.25417C5.89417 9.01083 6.29 9.00917 6.53333 9.25417L8.00833 10.7267L11.1958 5.94333C11.3875 5.65583 11.7758 5.58 12.0625 5.77083C12.3508 5.9625 12.4292 6.35083 12.2375 6.6375V6.63833Z" fill="#1D9BF0"/>
                        </svg>
                    </div>
                    <div>
                        <h4 class="font-black text-lg">DoÄŸrulanmÄ±ÅŸ Hesap</h4>
                        <p class="text-xs text-[var(--text-sec)]">KimliÄŸinizi doÄŸrulayarak mavi tik alÄ±n</p>
                    </div>
                </div>
                
                <!-- DetaylÄ± AÃ§Ä±klama -->
                <div class="space-y-3 text-sm text-[var(--text-main)]">
                    <p class="leading-relaxed">
                        <strong>DoÄŸrulanmÄ±ÅŸ Rozet (Mavi Tik)</strong>, hesabÄ±nÄ±zÄ±n gerÃ§ek bir kiÅŸi veya kuruluÅŸ tarafÄ±ndan yÃ¶netildiÄŸini gÃ¶steren bir gÃ¼venilirlik simgesidir. 
                        Bu rozet, diÄŸer kullanÄ±cÄ±lara sizin kim olduÄŸunuz konusunda gÃ¼ven verir.
                    </p>
                    
                    <div class="bg-emerald-50 dark:bg-emerald-900/20 p-4 rounded-2xl border-l-4 border-emerald-500">
                        <h5 class="font-bold text-emerald-700 dark:text-emerald-300 mb-2">âœ¨ DoÄŸrulanmÄ±ÅŸ Rozet Size Ne KazandÄ±rÄ±r?</h5>
                        <ul class="space-y-2 text-emerald-800 dark:text-emerald-200">
                            <li>âœ… Profilinizde mavi tik gÃ¶rÃ¼nÃ¼r</li>
                            <li>âœ… Arama sonuÃ§larÄ±nda Ã¶ncelikli sÄ±ralama</li>
                            <li>âœ… DiÄŸer kullanÄ±cÄ±larda gÃ¼ven oluÅŸturur</li>
                            <li>âœ… Sahte hesaplardan ayÄ±rt edilmenizi saÄŸlar</li>
                            <li>âœ… Ä°Ã§erikleriniz daha fazla gÃ¶rÃ¼nÃ¼rlÃ¼k kazanÄ±r</li>
                            <li>âœ… Toplulukta saygÄ±nlÄ±k ve itibar</li>
                        </ul>
                    </div>
                    
                    <div class="bg-blue-50 dark:bg-blue-900/20 p-4 rounded-2xl border-l-4 border-blue-500">
                        <h5 class="font-bold text-blue-700 dark:text-blue-300 mb-2">ðŸ“‹ DoÄŸrulama SÃ¼reci NasÄ±l Ä°ÅŸler?</h5>
                        <ol class="space-y-1 text-blue-800 dark:text-blue-200">
                            <li>1ï¸âƒ£ AÅŸaÄŸÄ±daki formu doldurarak baÅŸvuru yapÄ±n</li>
                            <li>2ï¸âƒ£ T.C. Kimlik kartÄ±nÄ±zÄ±n Ã¶n ve arka yÃ¼z fotoÄŸraflarÄ±nÄ± yÃ¼kleyin</li>
                            <li>3ï¸âƒ£ BaÅŸvurunuz ekibimiz tarafÄ±ndan incelenir</li>
                            <li>4ï¸âƒ£ OnaylandÄ±ÄŸÄ±nda mavi tik profilinize eklenir</li>
                            <li>5ï¸âƒ£ E-posta ile bilgilendirilirsiniz</li>
                        </ol>
                    </div>
                </div>
                
                <div class="bg-amber-50 dark:bg-amber-900/20 p-4 rounded-2xl border-l-4 border-amber-500 mt-4">
                    <p class="text-sm text-amber-700 dark:text-amber-300">
                        <i class="fas fa-info-circle mr-2"></i>
                        <strong>Ã–nemli:</strong> BaÅŸvurunuz manuel olarak incelenecektir. Ä°ÅŸlem 1-3 iÅŸ gÃ¼nÃ¼ sÃ¼rebilir. Kimlik bilgileriniz gizli tutulur ve sadece doÄŸrulama amacÄ±yla kullanÄ±lÄ±r.
                    </p>
                </div>
            </div>
            
            <!-- Form -->
            <div class="agro-card p-6">
                <h4 class="font-bold text-sm mb-4 text-[var(--text-sec)] uppercase">KiÅŸisel Bilgiler</h4>
                
                <div class="space-y-4">
                    <input type="text" x-model="verificationForm.name" placeholder="AdÄ±nÄ±z" class="w-full bg-[var(--input-bg)] p-4 rounded-2xl border-none outline-none focus:ring-2 focus:ring-emerald-500">
                    <input type="text" x-model="verificationForm.surname" placeholder="SoyadÄ±nÄ±z" class="w-full bg-[var(--input-bg)] p-4 rounded-2xl border-none outline-none focus:ring-2 focus:ring-emerald-500">
                </div>
            </div>
            
            <div class="agro-card p-6">
                <h4 class="font-bold text-sm mb-4 text-[var(--text-sec)] uppercase">T.C. Kimlik FotoÄŸraflarÄ±</h4>
                
                <div class="grid grid-cols-2 gap-4">
                    <!-- Ã–n YÃ¼z -->
                    <label class="cursor-pointer">
                        <div class="aspect-[4/3] bg-[var(--input-bg)] rounded-2xl flex flex-col items-center justify-center border-2 border-dashed border-slate-300 overflow-hidden">
                            <template x-if="!verificationForm.frontPreview">
                                <div class="text-center p-4">
                                    <i class="fas fa-id-card text-2xl text-slate-400 mb-2"></i>
                                    <p class="text-xs text-slate-500 font-bold">Ã–n YÃ¼z</p>
                                </div>
                            </template>
                            <template x-if="verificationForm.frontPreview">
                                <img :src="verificationForm.frontPreview" class="w-full h-full object-cover">
                            </template>
                        </div>
                        <input type="file" class="hidden" @change="handleVerificationImage($event, 'front')" accept="image/*">
                    </label>
                    
                    <!-- Arka YÃ¼z -->
                    <label class="cursor-pointer">
                        <div class="aspect-[4/3] bg-[var(--input-bg)] rounded-2xl flex flex-col items-center justify-center border-2 border-dashed border-slate-300 overflow-hidden">
                            <template x-if="!verificationForm.backPreview">
                                <div class="text-center p-4">
                                    <i class="fas fa-id-card text-2xl text-slate-400 mb-2"></i>
                                    <p class="text-xs text-slate-500 font-bold">Arka YÃ¼z</p>
                                </div>
                            </template>
                            <template x-if="verificationForm.backPreview">
                                <img :src="verificationForm.backPreview" class="w-full h-full object-cover">
                            </template>
                        </div>
                        <input type="file" class="hidden" @change="handleVerificationImage($event, 'back')" accept="image/*">
                    </label>
                </div>
            </div>
            
            <button @click="submitVerificationRequest" class="w-full py-4 btn-agro" :disabled="loading || !verificationForm.name || !verificationForm.surname || !verificationForm.frontImage || !verificationForm.backImage">
                <span x-show="!loading">BaÅŸvuruyu GÃ¶nder</span>
                <i x-show="loading" class="fas fa-spinner fa-spin"></i>
            </button>
            
            <p class="text-xs text-center text-[var(--text-sec)]">
                BaÅŸvurunuz <strong><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="0e60617c6b7e6277206f697c61626760654e69636f6762206d6163">[email&#160;protected]</a></strong> adresine PDF olarak gÃ¶nderilecektir.
            </p>
        </div>
    </div>
    
    <!-- Engellenen Hesaplar Modal -->
    <div x-show="showBlockedAccounts" x-transition x-cloak class="fixed inset-0 z-[100] flex flex-col bg-[var(--bg-main)]">
        <div class="glass px-4 py-4 flex items-center justify-between">
            <button @click="showBlockedAccounts = false" class="text-slate-500"><i class="fas fa-arrow-left text-xl"></i></button>
            <h3 class="text-xl font-black">Engellenen Hesaplar</h3>
            <div class="w-8"></div>
        </div>
        
        <div class="flex-1 overflow-y-auto p-4">
            <template x-if="blockedAccountsList.length === 0">
                <div class="text-center py-12">
                    <i class="fas fa-ban text-6xl text-slate-300 mb-4"></i>
                    <p class="text-[var(--text-sec)]">HenÃ¼z engellenen hesap yok</p>
                </div>
            </template>
            <template x-for="user in blockedAccountsList" :key="user.id">
                <div class="agro-card p-4 mb-3 flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <img :src="user.profilePic || 'https://ui-avatars.com/api/?name='+user.name" class="w-12 h-12 rounded-full object-cover">
                        <div>
                            <p class="font-bold" x-text="user.name"></p>
                            <p class="text-sm text-[var(--text-sec)]" x-text="'@'+user.username"></p>
                        </div>
                    </div>
                    <button @click="unblockUser(user.id)" class="px-4 py-2 bg-emerald-500 text-white rounded-full text-sm font-bold">
                        Engeli KaldÄ±r
                    </button>
                </div>
            </template>
        </div>
    </div>
    
    <!-- Kaydedilen GÃ¶nderiler Modal -->
    <div x-show="showSavedPosts" x-transition x-cloak class="fixed inset-0 z-[100] flex flex-col bg-[var(--bg-main)]">
        <div class="glass px-4 py-4 flex items-center justify-between">
            <button @click="showSavedPosts = false" class="text-slate-500"><i class="fas fa-arrow-left text-xl"></i></button>
            <h3 class="text-xl font-black">Kaydedilen GÃ¶nderiler</h3>
            <div class="w-8"></div>
        </div>
        
        <div class="flex-1 overflow-y-auto p-4">
            <template x-if="savedPostsList.length === 0">
                <div class="text-center py-12">
                    <i class="fas fa-bookmark text-6xl text-slate-300 mb-4"></i>
                    <p class="text-[var(--text-sec)]">HenÃ¼z kaydedilen gÃ¶nderi yok</p>
                </div>
            </template>
            <div class="grid grid-cols-3 gap-1">
                <template x-for="post in savedPostsList" :key="post.id">
                    <div @click="openTikTokScroll(post)" class="aspect-square bg-slate-200 relative overflow-hidden cursor-pointer">
                        <template x-if="post.mediaType === 'video'">
                            <video :src="post.mediaUrl || post.media" class="w-full h-full object-cover"></video>
                        </template>
                        <template x-if="post.mediaType !== 'video'">
                            <img :src="post.mediaUrl || post.media" class="w-full h-full object-cover">
                        </template>
                        <div class="absolute inset-0 bg-black/20 flex items-center justify-center opacity-0 hover:opacity-100 transition">
                            <i class="fas fa-play text-white text-2xl"></i>
                        </div>
                    </div>
                </template>
            </div>
        </div>
    </div>
    
    <!-- ========== DM'DE PAYLAÅžIM MODAL ========== -->
    <div x-show="showShareToDMModal" x-transition x-cloak class="fixed inset-0 z-[100] flex items-end justify-center">
        <div class="absolute inset-0 bg-black/40" @click="showShareToDMModal = false"></div>
        <div class="bg-[var(--bg-card)] w-full max-w-md rounded-t-[2.5rem] p-6 animate-slide-up">
            <div class="w-12 h-1.5 bg-slate-300 rounded-full mx-auto mb-4"></div>
            <h3 class="text-center font-black text-lg mb-4">DM'de PaylaÅŸ</h3>
            
            <!-- PaylaÅŸÄ±lacak Post Ã–nizleme -->
            <div x-show="postToShare" class="agro-card p-3 mb-4 flex items-center gap-3">
                <template x-if="postToShare?.mediaUrl">
                    <img :src="postToShare.mediaUrl" class="w-16 h-16 rounded-xl object-cover">
                </template>
                <div class="flex-1 min-w-0">
                    <p class="text-sm font-bold truncate" x-text="postToShare?.userName"></p>
                    <p class="text-xs text-[var(--text-sec)] line-clamp-2" x-text="postToShare?.content?.substring(0, 60) + '...'"></p>
                </div>
            </div>
            
            <!-- Arama -->
            <div class="relative mb-4">
                <i class="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"></i>
                <input type="text" 
                       x-model="dmShareSearchQuery" 
                       @input="searchUsersForDMShare"
                       placeholder="KullanÄ±cÄ± ara..." 
                       class="w-full bg-[var(--input-bg)] pl-12 pr-4 py-3 rounded-2xl border-none outline-none focus:ring-2 focus:ring-emerald-500">
            </div>
            
            <!-- SonuÃ§lar -->
            <div class="max-h-60 overflow-y-auto space-y-2">
                <template x-if="dmShareSearchQuery && dmShareResults.length === 0">
                    <p class="text-center text-slate-400 py-4">KullanÄ±cÄ± bulunamadÄ±</p>
                </template>
                <template x-for="user in dmShareResults" :key="user.id">
                    <div @click="sharePostToDM(user.id)" class="flex items-center gap-3 p-3 rounded-xl hover:bg-[var(--input-bg)] cursor-pointer">
                        <img :src="user.profilePic || 'https://ui-avatars.com/api/?name='+user.name" class="w-12 h-12 rounded-full object-cover">
                        <div class="flex-1">
                            <p class="font-bold text-sm" x-text="user.name"></p>
                            <p class="text-xs text-[var(--text-sec)]" x-text="'@'+user.username"></p>
                        </div>
                        <i class="fas fa-paper-plane text-emerald-500"></i>
                    </div>
                </template>
                
                <!-- Son KonuÅŸmalar -->
                <template x-if="!dmShareSearchQuery">
                    <div>
                        <p class="text-xs font-bold text-slate-400 uppercase mb-2">Son KonuÅŸmalar</p>
                        <template x-for="conv in conversations.slice(0, 5)" :key="conv.userId || conv.id">
                            <div @click="sharePostToDM(conv.userId || conv.id)" class="flex items-center gap-3 p-3 rounded-xl hover:bg-[var(--input-bg)] cursor-pointer">
                                <img :src="conv.profilePic || 'https://ui-avatars.com/api/?name='+(conv.name || conv.recipientName)" class="w-12 h-12 rounded-full object-cover">
                                <div class="flex-1">
                                    <p class="font-bold text-sm" x-text="conv.name || conv.recipientName"></p>
                                    <p class="text-xs text-[var(--text-sec)]" x-text="conv.lastMessage?.substring(0, 30) + '...'"></p>
                                </div>
                                <i class="fas fa-paper-plane text-emerald-500"></i>
                            </div>
                        </template>
                    </div>
                </template>
            </div>
        </div>
    </div>
    
    <!-- ========== GELEN ARAMA MODAL ========== -->
    <div x-show="showIncomingCallModal" x-transition x-cloak class="fixed inset-0 z-[200] bg-black/90 flex flex-col items-center justify-center">
        <div class="text-center text-white">
            <p class="text-lg mb-2">Gelen Arama</p>
            <img :src="incomingCall?.caller?.profilePic || 'https://ui-avatars.com/api/?name='+(incomingCall?.caller?.name || 'User')" 
                 class="w-24 h-24 rounded-full mx-auto mb-4 border-4 border-emerald-500">
            <h3 class="text-2xl font-bold mb-1" x-text="incomingCall?.caller?.name"></h3>
            <p class="text-slate-400" x-text="incomingCall?.caller?.username ? '@' + incomingCall.caller.username : ''"></p>
            <p class="text-emerald-400 mt-4"><i class="fas fa-video mr-2"></i>GÃ¶rÃ¼ntÃ¼lÃ¼ Arama</p>
        </div>
        
        <div class="flex items-center gap-8 mt-12">
            <button @click="rejectIncomingCall()" class="w-16 h-16 bg-red-500 rounded-full flex items-center justify-center text-white text-2xl hover:bg-red-600 transition">
                <i class="fas fa-phone-slash"></i>
            </button>
            <button @click="acceptIncomingCall()" class="w-16 h-16 bg-emerald-500 rounded-full flex items-center justify-center text-white text-2xl hover:bg-emerald-600 transition">
                <i class="fas fa-phone"></i>
            </button>
        </div>
    </div>
    
    <!-- ========== AKTÄ°F ARAMA MODAL (WEBRTC) ========== -->
    <div x-show="showVideoCallModal" x-transition x-cloak class="fixed inset-0 z-[200] bg-black flex flex-col">
        <!-- Arama Header -->
        <div class="absolute top-0 left-0 right-0 z-10 p-4 flex items-center justify-between bg-gradient-to-b from-black/60 to-transparent">
            <div class="flex items-center gap-3">
                <button @click="endCall()" class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center text-white">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <div>
                    <h4 class="text-white font-bold" x-text="activeCall?.recipient?.name"></h4>
                    <p class="text-white/70 text-sm" x-text="formatCallDuration(callDuration)"></p>
                </div>
            </div>
        </div>
        
        <!-- Video AlanlarÄ± -->
        <div class="flex-1 relative">
            <!-- Uzak Video (BÃ¼yÃ¼k) -->
            <video id="remoteVideo" autoplay playsinline class="w-full h-full object-cover"></video>
            
            <!-- Yerel Video (KÃ¼Ã§Ã¼k - PIP) -->
            <div class="absolute bottom-24 right-4 w-32 h-44 rounded-2xl overflow-hidden border-2 border-white/30 shadow-lg">
                <video id="localVideo" autoplay playsinline muted class="w-full h-full object-cover"></video>
            </div>
            
            <!-- Video KapalÄ± Durumu -->
            <div x-show="isVideoOff" class="absolute inset-0 flex items-center justify-center bg-slate-800">
                <div class="text-center text-white">
                    <i class="fas fa-video-slash text-6xl mb-4"></i>
                    <p>Kamera KapalÄ±</p>
                </div>
            </div>
        </div>
        
        <!-- Kontrol ButonlarÄ± -->
        <div class="absolute bottom-8 left-0 right-0 flex items-center justify-center gap-6">
            <button @click="toggleMute()" 
                    :class="isMuted ? 'bg-red-500' : 'bg-white/20'"
                    class="w-14 h-14 rounded-full flex items-center justify-center text-white text-xl transition">
                <i :class="isMuted ? 'fas fa-microphone-slash' : 'fas fa-microphone'"></i>
            </button>
            <button @click="toggleVideo()" 
                    :class="isVideoOff ? 'bg-red-500' : 'bg-white/20'"
                    class="w-14 h-14 rounded-full flex items-center justify-center text-white text-xl transition">
                <i :class="isVideoOff ? 'fas fa-video-slash' : 'fas fa-video'"></i>
            </button>
            <button @click="endCall()" class="w-16 h-16 bg-red-500 rounded-full flex items-center justify-center text-white text-2xl hover:bg-red-600 transition">
                <i class="fas fa-phone-slash"></i>
            </button>
            <button class="w-14 h-14 bg-white/20 rounded-full flex items-center justify-center text-white text-xl">
                <i class="fas fa-camera-rotate"></i>
            </button>
        </div>
    </div>
    
    <!-- ========== PAYLAÅžILAN POST SAYFASI (MODERN) ========== -->
    <div x-show="showSharedPostPage" x-transition x-cloak class="fixed inset-0 z-[150] bg-[var(--bg-main)] flex flex-col">
        <!-- Header -->
        <div class="glass px-4 py-3 flex items-center justify-between">
            <button @click="showSharedPostPage = false; window.history.pushState({}, '', '/');" class="w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center text-slate-600">
                <i class="fas fa-arrow-left"></i>
            </button>
            <h3 class="font-black text-lg">GÃ¶nderi</h3>
            <button @click="sharePostURL(sharedPost)" class="w-10 h-10 rounded-full bg-emerald-500 flex items-center justify-center text-white">
                <i class="fas fa-share"></i>
            </button>
        </div>
        
        <!-- Post Ä°Ã§eriÄŸi -->
        <div class="flex-1 overflow-y-auto" x-show="sharedPost">
            <!-- KullanÄ±cÄ± Bilgisi -->
            <div class="px-4 py-3 flex items-center gap-3 border-b border-[var(--border)]">
                <img :src="sharedPost?.profilePic || 'https://ui-avatars.com/api/?name='+(sharedPost?.userName || 'User')" 
                     class="w-12 h-12 rounded-full object-cover border-2 border-emerald-500">
                <div class="flex-1">
                    <p class="font-bold" x-text="sharedPost?.userName"></p>
                    <p class="text-sm text-[var(--text-sec)]" x-text="'@'+sharedPost?.username"></p>
                </div>
                <button @click="viewProfile(sharedPost?.userId)" class="px-4 py-2 bg-emerald-500 text-white rounded-full text-sm font-bold">
                    Profili GÃ¶r
                </button>
            </div>
            
            <!-- Post Medya -->
            <div class="relative">
                <template x-if="sharedPost?.mediaType === 'video'">
                    <video :src="sharedPost?.mediaUrl" 
                           controls 
                           autoplay
                           class="w-full max-h-[70vh] bg-black"
                           playsinline></video>
                </template>
                <template x-if="sharedPost?.mediaType === 'image'">
                    <img :src="sharedPost?.mediaUrl" 
                         class="w-full max-h-[70vh] object-cover"
                         @click="openFullScreen(sharedPost?.mediaUrl, 'image')">
                </template>
            </div>
            
            <!-- Post Ä°Ã§erik -->
            <div class="p-4">
                <p class="text-base leading-relaxed whitespace-pre-wrap" x-text="sharedPost?.content"></p>
                <p class="text-sm text-[var(--text-sec)] mt-2" x-text="formatTime(sharedPost?.createdAt)"></p>
            </div>
            
            <!-- EtkileÅŸimler -->
            <div class="px-4 py-3 flex items-center justify-between border-t border-[var(--border)]">
                <div class="flex items-center gap-6">
                    <button @click="likePost(sharedPost)" 
                            class="flex items-center gap-2 transition-transform active:scale-110" 
                            :class="sharedPost?.isLiked ? 'text-red-500' : 'text-slate-500'">
                        <i class="text-2xl" :class="sharedPost?.isLiked ? 'fas fa-heart' : 'far fa-heart'"></i>
                        <span class="font-bold" x-text="sharedPost?.likeCount || 0"></span>
                    </button>
                    <button @click="openComments(sharedPost)" class="flex items-center gap-2 text-slate-500">
                        <i class="far fa-comment text-2xl"></i>
                        <span class="font-bold" x-text="sharedPost?.commentCount || 0"></span>
                    </button>
                </div>
                <button @click="savePost(sharedPost)" :class="sharedPost?.isSaved ? 'text-emerald-500' : 'text-slate-400'">
                    <i :class="sharedPost?.isSaved ? 'fas fa-bookmark' : 'far fa-bookmark'" class="text-2xl"></i>
                </button>
            </div>
            
            <!-- Yorumlar -->
            <div class="border-t border-[var(--border)] p-4">
                <h4 class="font-bold mb-3">Yorumlar</h4>
                <template x-if="sharedPostComments.length === 0">
                    <p class="text-center text-[var(--text-sec)] py-4">HenÃ¼z yorum yok</p>
                </template>
                <template x-for="comment in sharedPostComments" :key="comment.id">
                    <div class="flex gap-3 mb-4">
                        <img :src="comment.profilePic || 'https://ui-avatars.com/api/?name='+comment.userName" 
                             class="w-10 h-10 rounded-full object-cover">
                        <div class="flex-1">
                            <div class="bg-[var(--input-bg)] rounded-2xl rounded-tl-sm p-3">
                                <p class="font-bold text-sm" x-text="comment.userName"></p>
                                <p class="text-sm" x-text="comment.content"></p>
                            </div>
                            <p class="text-xs text-[var(--text-sec)] mt-1" x-text="formatTime(comment.createdAt)"></p>
                        </div>
                    </div>
                </template>
            </div>
        </div>
    </div>
    
    <!-- ========== PAYLAÅžILAN PROFÄ°L SAYFASI (MODERN) ========== -->
    <div x-show="showSharedProfilePage" x-transition x-cloak class="fixed inset-0 z-[150] bg-[var(--bg-main)] flex flex-col">
        <!-- Header -->
        <div class="glass px-4 py-3 flex items-center justify-between">
            <button @click="showSharedProfilePage = false; window.history.pushState({}, '', '/');" class="w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center text-slate-600">
                <i class="fas fa-arrow-left"></i>
            </button>
            <h3 class="font-black text-lg" x-text="sharedProfile?.username"></h3>
            <button @click="shareProfile(sharedProfile)" class="w-10 h-10 rounded-full bg-emerald-500 flex items-center justify-center text-white">
                <i class="fas fa-share"></i>
            </button>
        </div>
        
        <!-- Profil Ä°Ã§eriÄŸi -->
        <div class="flex-1 overflow-y-auto" x-show="sharedProfile">
            <!-- Kapak FotoÄŸrafÄ± -->
            <div class="relative h-48 bg-gradient-to-br from-emerald-400 to-teal-600">
                <img x-show="sharedProfile?.coverPic" :src="sharedProfile?.coverPic" class="w-full h-full object-cover">
            </div>
            
            <!-- Profil Bilgisi -->
            <div class="px-4 pb-4">
                <div class="relative -mt-16 mb-4 flex justify-between items-end">
                    <img :src="sharedProfile?.profilePic || 'https://ui-avatars.com/api/?name='+(sharedProfile?.name || 'User')" 
                         class="w-32 h-32 rounded-full object-cover border-4 border-[var(--bg-main)] bg-white">
                    <button @click="followUser(sharedProfile)" 
                            :class="sharedProfile?.isFollowing ? 'bg-slate-200 text-slate-700' : 'bg-emerald-500 text-white'"
                            class="px-6 py-2 rounded-full font-bold mb-4">
                        <span x-text="sharedProfile?.isFollowing ? 'Takip Ediliyor' : 'Takip Et'"></span>
                    </button>
                </div>
                
                <h2 class="text-2xl font-black" x-text="sharedProfile?.name"></h2>
                <p class="text-[var(--text-sec)]" x-text="'@'+sharedProfile?.username"></p>
                
                <p x-show="sharedProfile?.bio" class="mt-3 text-sm" x-text="sharedProfile?.bio"></p>
                
                <!-- Ä°statistikler -->
                <div class="flex gap-6 mt-4 py-3 border-y border-[var(--border)]">
                    <div class="text-center">
                        <p class="font-black text-lg" x-text="sharedProfile?.postCount || 0"></p>
                        <p class="text-xs text-[var(--text-sec)]">GÃ¶nderi</p>
                    </div>
                    <div class="text-center">
                        <p class="font-black text-lg" x-text="sharedProfile?.followerCount || 0"></p>
                        <p class="text-xs text-[var(--text-sec)]">TakipÃ§i</p>
                    </div>
                    <div class="text-center">
                        <p class="font-black text-lg" x-text="sharedProfile?.followingCount || 0"></p>
                        <p class="text-xs text-[var(--text-sec)]">Takip</p>
                    </div>
                </div>
            </div>
            
            <!-- GÃ¶nderiler -->
            <div class="p-4">
                <h4 class="font-bold mb-3">GÃ¶nderiler</h4>
                <div class="grid grid-cols-3 gap-1">
                    <template x-for="post in sharedProfilePosts" :key="post.id">
                        <div @click="openTikTokScroll(post)" class="aspect-square relative overflow-hidden cursor-pointer">
                            <img :src="post.mediaUrl || post.thumbnail || 'https://ui-avatars.com/api/?name=Post'" 
                                 class="w-full h-full object-cover">
                            <div x-show="post.mediaType === 'video'" class="absolute top-2 right-2 text-white">
                                <i class="fas fa-video"></i>
                            </div>
                        </div>
                    </template>
                </div>
                <template x-if="sharedProfilePosts.length === 0">
                    <p class="text-center text-[var(--text-sec)] py-8">HenÃ¼z gÃ¶nderi yok</p>
                </template>
            </div>
        </div>
    </div>

    <!-- ============ SCRIPT ============ -->
    <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
        function agroApp() {
            return {
                // Auth & User
                // ========== GÃœVENLÄ° STORAGE SÄ°STEMÄ° ==========
                // IIFE ile kapsÃ¼llenmiÅŸ - konsoldan eriÅŸilemez
                SecureStorage: (function() {
                    const _encKey = 'AgroL!nk$3cur3K3y2024!' + navigator.userAgent.slice(0, 10);
                    const _prefix = '_agro_secure_';
                    
                    function _encrypt(data) {
                        try {
                            const jsonStr = JSON.stringify(data);
                            const encoded = btoa(encodeURIComponent(jsonStr));
                            // XOR ÅŸifreleme
                            let result = '';
                            for (let i = 0; i < encoded.length; i++) {
                                result += String.fromCharCode(encoded.charCodeAt(i) ^ _encKey.charCodeAt(i % _encKey.length));
                            }
                            return btoa(result);
                        } catch (e) {
                            return null;
                        }
                    }
                    
                    function _decrypt(encrypted) {
                        try {
                            const decoded = atob(encrypted);
                            let result = '';
                            for (let i = 0; i < decoded.length; i++) {
                                result += String.fromCharCode(decoded.charCodeAt(i) ^ _encKey.charCodeAt(i % _encKey.length));
                            }
                            const jsonStr = decodeURIComponent(atob(result));
                            return JSON.parse(jsonStr);
                        } catch (e) {
                            return null;
                        }
                    }
                    
                    return {
                        set: function(key, value) {
                            try {
                                const encrypted = _encrypt(value);
                                if (encrypted) {
                                    localStorage.setItem(_prefix + key, encrypted);
                                    return true;
                                }
                            } catch (e) {}
                            return false;
                        },
                        
                        get: function(key, defaultValue) {
                            if (defaultValue === undefined) defaultValue = null;
                            try {
                                const encrypted = localStorage.getItem(_prefix + key);
                                if (encrypted) {
                                    const decrypted = _decrypt(encrypted);
                                    return decrypted !== null ? decrypted : defaultValue;
                                }
                            } catch (e) {}
                            return defaultValue;
                        },
                        
                        remove: function(key) {
                            localStorage.removeItem(_prefix + key);
                        },
                        
                        clear: function() {
                            const keysToRemove = [];
                            for (let i = 0; i < localStorage.length; i++) {
                                const key = localStorage.key(i);
                                if (key && key.startsWith(_prefix)) {
                                    keysToRemove.push(key);
                                }
                            }
                            keysToRemove.forEach(function(k) { localStorage.removeItem(k); });
                        },
                        
                        // Migration: Eski verileri taÅŸÄ±
                        migrateFromLegacy: function() {
                            // Eski token'Ä± taÅŸÄ±
                            const oldToken = localStorage.getItem('token');
                            if (oldToken && !localStorage.getItem(_prefix + 'token')) {
                                this.set('token', oldToken);
                                localStorage.removeItem('token');
                            }
                            
                            // Eski user'Ä± taÅŸÄ±
                            const oldUser = localStorage.getItem('user');
                            if (oldUser && !localStorage.getItem(_prefix + 'user')) {
                                try {
                                    const userObj = JSON.parse(oldUser);
                                    this.set('user', userObj);
                                    localStorage.removeItem('user');
                                } catch(e) {}
                            }
                            
                            // Eski agrolink_user'Ä± taÅŸÄ±
                            const oldAgroUser = localStorage.getItem('agrolink_user');
                            if (oldAgroUser && !localStorage.getItem(_prefix + 'agrolink_user')) {
                                try {
                                    const userObj = JSON.parse(oldAgroUser);
                                    this.set('agrolink_user', userObj);
                                    localStorage.removeItem('agrolink_user');
                                } catch(e) {}
                            }
                        }
                    };
                })(),
                
                // Auth & User - SecureStorage ile
                isLoggedIn: false,
                darkMode: localStorage.getItem('theme') === 'dark',
                user: {},
                followingIds: [], // Takip edilen kullanÄ±cÄ±larÄ±n ID'leri
                authMode: 'login',
                authForm: { name: '', username: '', email: '', password: '', avatarFile: null, avatarPreview: '', userType: '' },
                captcha: { q: '', a: null, userAns: '' },
                
                // ========== DÄ°L SÄ°STEMÄ° ==========
                currentLanguage: localStorage.getItem('agrolink_lang') || 'tr',
                showLanguageModal: false,
                availableLanguages: [
                    { code: 'tr', name: 'TÃ¼rkÃ§e', flag: 'ðŸ‡¹ðŸ‡·' },
                    { code: 'en', name: 'English', flag: 'ðŸ‡ºðŸ‡¸' },
                    { code: 'de', name: 'Deutsch', flag: 'ðŸ‡©ðŸ‡ª' },
                    { code: 'fr', name: 'FranÃ§ais', flag: 'ðŸ‡«ðŸ‡·' },
                    { code: 'es', name: 'EspaÃ±ol', flag: 'ðŸ‡ªðŸ‡¸' }
                ],
                translations: {
                    tr: {
                        // Genel
                        home: 'Ana Sayfa',
                        explore: 'KeÅŸfet',
                        messages: 'Mesajlar',
                        notifications: 'Bildirimler',
                        profile: 'Profil',
                        settings: 'Ayarlar',
                        search: 'Ara',
                        cancel: 'Ä°ptal',
                        save: 'Kaydet',
                        delete: 'Sil',
                        edit: 'DÃ¼zenle',
                        share: 'PaylaÅŸ',
                        follow: 'Takip Et',
                        following: 'Takip Ediliyor',
                        followers: 'TakipÃ§i',
                        posts: 'GÃ¶nderiler',
                        likes: 'BeÄŸeniler',
                        comments: 'Yorumlar',
                        // Ayarlar
                        appearance: 'GÃ¶rÃ¼nÃ¼m',
                        darkMode: 'Koyu Mod',
                        lightMode: 'AÃ§Ä±k Mod',
                        language: 'Dil',
                        selectLanguage: 'Dil SeÃ§imi',
                        account: 'Hesap',
                        changePassword: 'Åžifre DeÄŸiÅŸtir',
                        editProfile: 'Profili DÃ¼zenle',
                        blockedAccounts: 'Engellenen Hesaplar',
                        savedPosts: 'Kaydedilen GÃ¶nderiler',
                        notificationsTitle: 'Bildirimler',
                        pushNotifications: 'Push Bildirimleri',
                        emailNotifications: 'E-posta Bildirimleri',
                        security: 'GÃ¼venlik',
                        twoFactorAuth: '2FA E-posta DoÄŸrulama',
                        about: 'HakkÄ±nda',
                        appVersion: 'Uygulama Versiyonu',
                        releaseNotes: 'SÃ¼rÃ¼m NotlarÄ±',
                        termsOfService: 'KullanÄ±m KoÅŸullarÄ±',
                        privacyPolicy: 'Gizlilik PolitikasÄ±',
                        verification: 'DoÄŸrulama',
                        getVerified: 'DoÄŸrulanmÄ±ÅŸ Rozet Al',
                        verified: 'DoÄŸrulanmÄ±ÅŸ',
                        session: 'Oturum',
                        logout: 'Ã‡Ä±kÄ±ÅŸ Yap',
                        deleteAccount: 'HesabÄ± Sil',
                        info: 'Bilgiler',
                        allRightsReserved: '2026 TÃ¼m HaklarÄ± SaklÄ±dÄ±r',
                        // MaÄŸaza
                        store: 'TarÄ±m PazarÄ±',
                        addProduct: 'Ä°lan Ver',
                        noProducts: 'HenÃ¼z Ã¼rÃ¼n yok',
                        sendMessage: 'Mesaj GÃ¶nder',
                        productDetail: 'ÃœrÃ¼n DetayÄ±',
                        // Mesajlar
                        noMessages: 'HenÃ¼z mesaj yok',
                        startConversation: 'Birinin profiline gidip mesaj gÃ¶ndermeye baÅŸlayÄ±n',
                        searchChats: 'Sohbet ara...',
                        typeMessage: 'Mesaj yaz...',
                        // GÃ¶nderi
                        newPost: 'Yeni GÃ¶nderi',
                        whatsOnYourMind: 'AklÄ±ndan neler geÃ§iyor?',
                        post: 'GÃ¶nderi',
                        poll: 'Anket',
                        addLocation: 'Konum Ekle',
                        postShared: 'GÃ¶nderi paylaÅŸÄ±ldÄ±!',
                        // Profil
                        online: 'Ã‡evrimiÃ§i',
                        joined: 'KatÄ±ldÄ±',
                        noBioYet: 'HenÃ¼z bir biyografi eklenmedi ðŸŒ±',
                        media: 'Medya',
                        liked: 'BeÄŸenilenler',
                        // Auth
                        login: 'GiriÅŸ Yap',
                        register: 'KayÄ±t Ol',
                        email: 'E-posta',
                        password: 'Åžifre',
                        confirmPassword: 'Åžifreyi Onayla',
                        name: 'Ad Soyad',
                        username: 'KullanÄ±cÄ± AdÄ±',
                        // DiÄŸer
                        loading: 'YÃ¼kleniyor...',
                        noPostsYet: 'HenÃ¼z gÃ¶nderi yok',
                        copied: 'KopyalandÄ±',
                        linkCopied: 'Link kopyalandÄ±',
                        trend: 'Trend',
                        mostLiked: 'En Ã‡ok BeÄŸenilen',
                        mostCommented: 'En Ã‡ok Yorumlanan'
                    },
                    en: {
                        // General
                        home: 'Home',
                        explore: 'Explore',
                        messages: 'Messages',
                        notifications: 'Notifications',
                        profile: 'Profile',
                        settings: 'Settings',
                        search: 'Search',
                        cancel: 'Cancel',
                        save: 'Save',
                        delete: 'Delete',
                        edit: 'Edit',
                        share: 'Share',
                        follow: 'Follow',
                        following: 'Following',
                        followers: 'Followers',
                        posts: 'Posts',
                        likes: 'Likes',
                        comments: 'Comments',
                        // Settings
                        appearance: 'Appearance',
                        darkMode: 'Dark Mode',
                        lightMode: 'Light Mode',
                        language: 'Language',
                        selectLanguage: 'Select Language',
                        account: 'Account',
                        changePassword: 'Change Password',
                        editProfile: 'Edit Profile',
                        blockedAccounts: 'Blocked Accounts',
                        savedPosts: 'Saved Posts',
                        notificationsTitle: 'Notifications',
                        pushNotifications: 'Push Notifications',
                        emailNotifications: 'Email Notifications',
                        security: 'Security',
                        twoFactorAuth: '2FA Email Verification',
                        about: 'About',
                        appVersion: 'App Version',
                        releaseNotes: 'Release Notes',
                        termsOfService: 'Terms of Service',
                        privacyPolicy: 'Privacy Policy',
                        verification: 'Verification',
                        getVerified: 'Get Verified Badge',
                        verified: 'Verified',
                        session: 'Session',
                        logout: 'Logout',
                        deleteAccount: 'Delete Account',
                        info: 'Information',
                        allRightsReserved: '2026 All Rights Reserved',
                        // Store
                        store: 'Farm Market',
                        addProduct: 'Add Listing',
                        noProducts: 'No products yet',
                        sendMessage: 'Send Message',
                        productDetail: 'Product Detail',
                        // Messages
                        noMessages: 'No messages yet',
                        startConversation: 'Go to someone\'s profile to start a conversation',
                        searchChats: 'Search chats...',
                        typeMessage: 'Type a message...',
                        // Post
                        newPost: 'New Post',
                        whatsOnYourMind: 'What\'s on your mind?',
                        post: 'Post',
                        poll: 'Poll',
                        addLocation: 'Add Location',
                        postShared: 'Post shared!',
                        // Profile
                        online: 'Online',
                        joined: 'Joined',
                        noBioYet: 'No bio added yet ðŸŒ±',
                        media: 'Media',
                        liked: 'Liked',
                        // Auth
                        login: 'Login',
                        register: 'Register',
                        email: 'Email',
                        password: 'Password',
                        confirmPassword: 'Confirm Password',
                        name: 'Full Name',
                        username: 'Username',
                        // Other
                        loading: 'Loading...',
                        noPostsYet: 'No posts yet',
                        copied: 'Copied',
                        linkCopied: 'Link copied',
                        trend: 'Trending',
                        mostLiked: 'Most Liked',
                        mostCommented: 'Most Commented'
                    },
                    de: {
                        // Allgemein
                        home: 'Startseite',
                        explore: 'Entdecken',
                        messages: 'Nachrichten',
                        notifications: 'Benachrichtigungen',
                        profile: 'Profil',
                        settings: 'Einstellungen',
                        search: 'Suchen',
                        cancel: 'Abbrechen',
                        save: 'Speichern',
                        delete: 'LÃ¶schen',
                        edit: 'Bearbeiten',
                        share: 'Teilen',
                        follow: 'Folgen',
                        following: 'Folge ich',
                        followers: 'Follower',
                        posts: 'BeitrÃ¤ge',
                        likes: 'GefÃ¤llt mir',
                        comments: 'Kommentare',
                        // Einstellungen
                        appearance: 'Erscheinungsbild',
                        darkMode: 'Dunkelmodus',
                        lightMode: 'Hellmodus',
                        language: 'Sprache',
                        selectLanguage: 'Sprache wÃ¤hlen',
                        account: 'Konto',
                        changePassword: 'Passwort Ã¤ndern',
                        editProfile: 'Profil bearbeiten',
                        blockedAccounts: 'Blockierte Konten',
                        savedPosts: 'Gespeicherte BeitrÃ¤ge',
                        notificationsTitle: 'Benachrichtigungen',
                        pushNotifications: 'Push-Benachrichtigungen',
                        emailNotifications: 'E-Mail-Benachrichtigungen',
                        security: 'Sicherheit',
                        twoFactorAuth: '2FA E-Mail-Verifizierung',
                        about: 'Ãœber',
                        appVersion: 'App-Version',
                        releaseNotes: 'Versionshinweise',
                        termsOfService: 'Nutzungsbedingungen',
                        privacyPolicy: 'Datenschutzrichtlinie',
                        verification: 'Verifizierung',
                        getVerified: 'Verifiziertes Abzeichen erhalten',
                        verified: 'Verifiziert',
                        session: 'Sitzung',
                        logout: 'Abmelden',
                        deleteAccount: 'Konto lÃ¶schen',
                        info: 'Informationen',
                        allRightsReserved: '2026 Alle Rechte vorbehalten',
                        // GeschÃ¤ft
                        store: 'Bauernmarkt',
                        addProduct: 'Anzeige hinzufÃ¼gen',
                        noProducts: 'Noch keine Produkte',
                        sendMessage: 'Nachricht senden',
                        productDetail: 'Produktdetail',
                        // Nachrichten
                        noMessages: 'Noch keine Nachrichten',
                        startConversation: 'Gehen Sie zu einem Profil, um eine Unterhaltung zu beginnen',
                        searchChats: 'Chats suchen...',
                        typeMessage: 'Nachricht eingeben...',
                        // Beitrag
                        newPost: 'Neuer Beitrag',
                        whatsOnYourMind: 'Was denkst du gerade?',
                        post: 'Beitrag',
                        poll: 'Umfrage',
                        addLocation: 'Standort hinzufÃ¼gen',
                        postShared: 'Beitrag geteilt!',
                        // Profil
                        online: 'Online',
                        joined: 'Beigetreten',
                        noBioYet: 'Noch keine Biografie hinzugefÃ¼gt ðŸŒ±',
                        media: 'Medien',
                        liked: 'GefÃ¤llt mir',
                        // Auth
                        login: 'Anmelden',
                        register: 'Registrieren',
                        email: 'E-Mail',
                        password: 'Passwort',
                        confirmPassword: 'Passwort bestÃ¤tigen',
                        name: 'VollstÃ¤ndiger Name',
                        username: 'Benutzername',
                        // Sonstiges
                        loading: 'Wird geladen...',
                        noPostsYet: 'Noch keine BeitrÃ¤ge',
                        copied: 'Kopiert',
                        linkCopied: 'Link kopiert',
                        trend: 'Trend',
                        mostLiked: 'Am meisten geliked',
                        mostCommented: 'Am meisten kommentiert'
                    },
                    fr: {
                        // GÃ©nÃ©ral
                        home: 'Accueil',
                        explore: 'Explorer',
                        messages: 'Messages',
                        notifications: 'Notifications',
                        profile: 'Profil',
                        settings: 'ParamÃ¨tres',
                        search: 'Rechercher',
                        cancel: 'Annuler',
                        save: 'Enregistrer',
                        delete: 'Supprimer',
                        edit: 'Modifier',
                        share: 'Partager',
                        follow: 'Suivre',
                        following: 'AbonnÃ©',
                        followers: 'AbonnÃ©s',
                        posts: 'Publications',
                        likes: 'J\'aime',
                        comments: 'Commentaires',
                        // ParamÃ¨tres
                        appearance: 'Apparence',
                        darkMode: 'Mode sombre',
                        lightMode: 'Mode clair',
                        language: 'Langue',
                        selectLanguage: 'SÃ©lectionner la langue',
                        account: 'Compte',
                        changePassword: 'Changer le mot de passe',
                        editProfile: 'Modifier le profil',
                        blockedAccounts: 'Comptes bloquÃ©s',
                        savedPosts: 'Publications enregistrÃ©es',
                        notificationsTitle: 'Notifications',
                        pushNotifications: 'Notifications push',
                        emailNotifications: 'Notifications par e-mail',
                        security: 'SÃ©curitÃ©',
                        twoFactorAuth: 'VÃ©rification 2FA par e-mail',
                        about: 'Ã€ propos',
                        appVersion: 'Version de l\'application',
                        releaseNotes: 'Notes de version',
                        termsOfService: 'Conditions d\'utilisation',
                        privacyPolicy: 'Politique de confidentialitÃ©',
                        verification: 'VÃ©rification',
                        getVerified: 'Obtenir le badge vÃ©rifiÃ©',
                        verified: 'VÃ©rifiÃ©',
                        session: 'Session',
                        logout: 'DÃ©connexion',
                        deleteAccount: 'Supprimer le compte',
                        info: 'Informations',
                        allRightsReserved: '2026 Tous droits rÃ©servÃ©s',
                        // Boutique
                        store: 'MarchÃ© agricole',
                        addProduct: 'Ajouter une annonce',
                        noProducts: 'Pas encore de produits',
                        sendMessage: 'Envoyer un message',
                        productDetail: 'DÃ©tail du produit',
                        // Messages
                        noMessages: 'Pas encore de messages',
                        startConversation: 'Allez sur le profil de quelqu\'un pour dÃ©marrer une conversation',
                        searchChats: 'Rechercher des discussions...',
                        typeMessage: 'Ã‰crire un message...',
                        // Publication
                        newPost: 'Nouvelle publication',
                        whatsOnYourMind: 'Ã€ quoi pensez-vous?',
                        post: 'Publication',
                        poll: 'Sondage',
                        addLocation: 'Ajouter un lieu',
                        postShared: 'Publication partagÃ©e!',
                        // Profil
                        online: 'En ligne',
                        joined: 'Inscrit',
                        noBioYet: 'Pas encore de biographie ðŸŒ±',
                        media: 'MÃ©dias',
                        liked: 'AimÃ©',
                        // Auth
                        login: 'Connexion',
                        register: 'S\'inscrire',
                        email: 'E-mail',
                        password: 'Mot de passe',
                        confirmPassword: 'Confirmer le mot de passe',
                        name: 'Nom complet',
                        username: 'Nom d\'utilisateur',
                        // Autre
                        loading: 'Chargement...',
                        noPostsYet: 'Pas encore de publications',
                        copied: 'CopiÃ©',
                        linkCopied: 'Lien copiÃ©',
                        trend: 'Tendance',
                        mostLiked: 'Les plus aimÃ©s',
                        mostCommented: 'Les plus commentÃ©s'
                    },
                    es: {
                        // General
                        home: 'Inicio',
                        explore: 'Explorar',
                        messages: 'Mensajes',
                        notifications: 'Notificaciones',
                        profile: 'Perfil',
                        settings: 'ConfiguraciÃ³n',
                        search: 'Buscar',
                        cancel: 'Cancelar',
                        save: 'Guardar',
                        delete: 'Eliminar',
                        edit: 'Editar',
                        share: 'Compartir',
                        follow: 'Seguir',
                        following: 'Siguiendo',
                        followers: 'Seguidores',
                        posts: 'Publicaciones',
                        likes: 'Me gusta',
                        comments: 'Comentarios',
                        // ConfiguraciÃ³n
                        appearance: 'Apariencia',
                        darkMode: 'Modo oscuro',
                        lightMode: 'Modo claro',
                        language: 'Idioma',
                        selectLanguage: 'Seleccionar idioma',
                        account: 'Cuenta',
                        changePassword: 'Cambiar contraseÃ±a',
                        editProfile: 'Editar perfil',
                        blockedAccounts: 'Cuentas bloqueadas',
                        savedPosts: 'Publicaciones guardadas',
                        notificationsTitle: 'Notificaciones',
                        pushNotifications: 'Notificaciones push',
                        emailNotifications: 'Notificaciones por correo',
                        security: 'Seguridad',
                        twoFactorAuth: 'VerificaciÃ³n 2FA por correo',
                        about: 'Acerca de',
                        appVersion: 'VersiÃ³n de la app',
                        releaseNotes: 'Notas de la versiÃ³n',
                        termsOfService: 'TÃ©rminos de servicio',
                        privacyPolicy: 'PolÃ­tica de privacidad',
                        verification: 'VerificaciÃ³n',
                        getVerified: 'Obtener insignia verificada',
                        verified: 'Verificado',
                        session: 'SesiÃ³n',
                        logout: 'Cerrar sesiÃ³n',
                        deleteAccount: 'Eliminar cuenta',
                        info: 'InformaciÃ³n',
                        allRightsReserved: '2026 Todos los derechos reservados',
                        // Tienda
                        store: 'Mercado agrÃ­cola',
                        addProduct: 'Agregar anuncio',
                        noProducts: 'AÃºn no hay productos',
                        sendMessage: 'Enviar mensaje',
                        productDetail: 'Detalle del producto',
                        // Mensajes
                        noMessages: 'AÃºn no hay mensajes',
                        startConversation: 'Ve al perfil de alguien para iniciar una conversaciÃ³n',
                        searchChats: 'Buscar chats...',
                        typeMessage: 'Escribe un mensaje...',
                        // PublicaciÃ³n
                        newPost: 'Nueva publicaciÃ³n',
                        whatsOnYourMind: 'Â¿QuÃ© estÃ¡s pensando?',
                        post: 'PublicaciÃ³n',
                        poll: 'Encuesta',
                        addLocation: 'Agregar ubicaciÃ³n',
                        postShared: 'Â¡PublicaciÃ³n compartida!',
                        // Perfil
                        online: 'En lÃ­nea',
                        joined: 'Se uniÃ³',
                        noBioYet: 'AÃºn no hay biografÃ­a ðŸŒ±',
                        media: 'Medios',
                        liked: 'Me gustÃ³',
                        // Auth
                        login: 'Iniciar sesiÃ³n',
                        register: 'Registrarse',
                        email: 'Correo electrÃ³nico',
                        password: 'ContraseÃ±a',
                        confirmPassword: 'Confirmar contraseÃ±a',
                        name: 'Nombre completo',
                        username: 'Nombre de usuario',
                        // Otro
                        loading: 'Cargando...',
                        noPostsYet: 'AÃºn no hay publicaciones',
                        copied: 'Copiado',
                        linkCopied: 'Enlace copiado',
                        trend: 'Tendencia',
                        mostLiked: 'MÃ¡s gustados',
                        mostCommented: 'MÃ¡s comentados'
                    }
                },
                
                // ========== ONBOARDING SÄ°STEMÄ° ==========
                showOnboarding: false,
                onboardingStep: 0,
                onboardingSteps: [
                    {
                        target: '[data-onboarding="home"]',
                        icon: 'fa-home',
                        title: 'Ana Sayfa',
                        text: 'Buradan arkadaÅŸlarÄ±nÄ±zÄ±n paylaÅŸÄ±mlarÄ±nÄ± gÃ¶rebilir, beÄŸenebilir ve yorum yapabilirsiniz.',
                        position: 'top'
                    },
                    {
                        target: '[data-onboarding="create-post"]',
                        icon: 'fa-plus',
                        title: 'GÃ¶nderi OluÅŸtur',
                        text: 'FotoÄŸraf, video veya yazÄ± paylaÅŸmak iÃ§in bu butona tÄ±klayÄ±n. Anket ve konum da ekleyebilirsiniz!',
                        position: 'top'
                    },
                    {
                        target: '[data-onboarding="messages"]',
                        icon: 'fa-comment',
                        title: 'Mesajlar',
                        text: 'DiÄŸer Ã§iftÃ§ilerle Ã¶zel mesajlaÅŸabilir, sesli mesaj gÃ¶nderebilirsiniz.',
                        position: 'top'
                    },
                    {
                        target: '[data-onboarding="notifications"]',
                        icon: 'fa-bell',
                        title: 'Bildirimler',
                        text: 'BeÄŸeniler, yorumlar ve yeni takipÃ§i bildirimleri burada gÃ¶rÃ¼nÃ¼r.',
                        position: 'top'
                    },
                    {
                        target: '[data-onboarding="profile"]',
                        icon: 'fa-user',
                        title: 'Profiliniz',
                        text: 'Profilinizi dÃ¼zenleyebilir, paylaÅŸÄ±mlarÄ±nÄ±zÄ± gÃ¶rÃ¼ntÃ¼leyebilirsiniz.',
                        position: 'top'
                    },
                    {
                        target: '[data-onboarding="search"]',
                        icon: 'fa-search',
                        title: 'Arama',
                        text: 'KullanÄ±cÄ±, gÃ¶nderi veya hashtag aramak iÃ§in bu alanÄ± kullanÄ±n.',
                        position: 'bottom'
                    }
                ],
                
                // Navigation
                activeTab: 'home',
                loading: false,
                
                // PaylaÅŸÄ±m SayfalarÄ±
                showSharedPostPage: false,
                sharedPost: null,
                sharedPostComments: [],
                showSharedProfilePage: false,
                sharedProfile: null,
                sharedProfilePosts: [],
                loadingMore: false,
                
                // Toast
                toast: { show: false, message: '' },
                
                // Feed
                feed: [],
                currentPage: 1,
                hasMore: true,
                
                // Stories
                stories: [],
                myStories: [],
                showStoryModal: false,
                showStoryViewer: false,
                activeStory: {},
                storyForm: { media: null, preview: '', text: '', mediaType: null, textColor: '#FFFFFF' },
                
                // Search
                searchQuery: '',
                searchResults: [],
                hashtagResults: [],
                showSearchResults: false,
                
                // Products
                products: [],
                showAddProduct: false,
                showProductDetail: false,
                selectedProduct: null,
                selectedProductImages: [],
                currentProductImageIndex: 0,
                productForm: { name: '', price: '', description: '', image: null, preview: '', images: [], category: '', stock: 1 },
                
                // Messages
                conversations: [],
                showChatModal: false,
                activeChat: {},
                chatMessages: [],
                messageInput: '',
                isRecording: false,
                
                // Notifications
                notifications: [],
                unreadNotifs: 0,
                
                // Posts
                showPostModal: false,
                postForm: { content: '', media: null, preview: '', mediaType: null, type: 'normal', pollQuestion: '', pollOptions: ['', ''], showLocation: false, locationName: '' },
                uploadProgress: 0,
                isUploading: false,
                
                // Comments
                showCommentModal: false,
                activeComments: [],
                activePostId: null,
                commentInput: '',
                
                // Profile
                userStats: {},
                myPosts: [],
                likedPosts: [],
                showEditModal: false,
                editForm: { name: '', email: '', userType: '', bio: '', location: '', website: '', profilePic: '', profilePicFile: null, coverPicFile: null, coverPicPreview: '' },
                showSettings: false,
                
                // Settings
                showSettingsMenu: false,
                showDeleteAccount: false,
                deleteAccountPassword: '',
                showChangePassword: false,
                passwordForm: { currentPassword: '', newPassword: '', confirmPassword: '' },
                showReleaseNotes: false,
                showVerificationModal: false,
                verificationForm: { name: '', surname: '', frontImage: null, frontPreview: '', backImage: null, backPreview: '' },
                verificationStatus: 'none', // none, pending, approved
                
                // Blocked Accounts & Saved Posts
                showBlockedAccounts: false,
                blockedAccountsList: [],
                showSavedPosts: false,
                savedPostsList: [],
                
                // Story Navigation
                currentStoryIndex: 0,
                currentStoryGroup: null,
                
                // Post Edit Modal
                showPostEditModal: false,
                postEditForm: { brightness: 100, contrast: 100, saturation: 100, filter: 'none' },
                
                // Message Image
                messageImagePreview: null,
                messageImageFile: null,
                
                // Voice Recording
                isRecording: false,
                mediaRecorder: null,
                recordedChunks: [],
                voicePreview: null,
                voiceDuration: 0,
                recordingTimer: null,
                
                // TikTok Scroll
                showTikTokScroll: false,
                tikTokPosts: [],
                currentTikTokIndex: 0,
                
                // Heart Animation
                showHeartAnimation: false,
                
                // Story Viewers
                showStoryViewers: false,
                storyViewersList: [],
                
                // Connections
                showConnectionsModal: false,
                connectionsType: 'followers',
                connectionsList: [],
                
                // User Profile
                showUserProfile: false,
                viewedUser: {},
                viewedUserPosts: [],
                mutualFollowers: [],
                showMutualFollowersModal: false,
                
                // Cover Zoom
                showCoverZoom: false,
                coverZoomUrl: '',
                zoomLevel: 1,
                touchZoomDistance: 0,
                
                // Post Options
                showPostOptions: false,
                selectedPost: null,
                
                // Report Modal
                showReportModal: false,
                reportReason: '',
                reportDescription: '',
                
                // Full Screen
                showFullScreen: false,
                fullScreenMedia: { url: '', type: '' },
                
                // Post Detail
                showPostDetail: false,
                postDetail: null,
                
                // Touch
                touchStartY: 0,
                
                // Explore / KeÅŸfet
                showExplore: false,
                explorePosts: [],
                exploreCategory: 'all',
                exploreLoading: false,
                
                // Socket
                socket: null,
                
                // ========== 2FA (2 FAKTÃ–RLÃœ DOÄžRULAMA) ==========
                show2FAModal: false,
                twoFAData: { tempToken: '', email: '', userId: '' },
                twoFAInput: ['', '', '', '', '', ''],
                twoFAError: '',
                twoFAResendTimer: 0,
                twoFATimer: 300, // 5 dakika = 300 saniye
                twoFATimerInterval: null,
                
                // ========== E-POSTA DOÄžRULAMA ==========
                showEmailVerifyModal: false,
                emailVerifyData: { email: '' },
                emailVerifyInput: ['', '', '', '', '', ''],
                emailVerifyError: '',
                emailResendTimer: 0,
                emailVerifyTimer: 300, // 5 dakika = 300 saniye
                emailVerifyTimerInterval: null,
                pendingRegistrationData: null,

                // ========== ðŸ“— FARMBOOK - Ã‡Ä°FTÃ‡Ä° KAYIT DEFTERÄ° ==========
                showFarmbook: false,
                farmbookTab: 'records', // 'records', 'add', 'stats', 'export'
                farmbookRecords: [],
                farmbookStats: null,
                farmbookLoading: false,
                farmbookFilters: {
                    season: '',
                    year: new Date().getFullYear(),
                    type: ''
                },
                farmbookForm: {
                    recordType: 'ekim',
                    productName: '',
                    quantity: '',
                    unit: 'kg',
                    cost: '',
                    income: '',
                    recordDate: new Date().toISOString().split('T')[0],
                    fieldName: '',
                    fieldSize: '',
                    fieldSizeUnit: 'dekar',
                    season: '',
                    year: new Date().getFullYear(),
                    notes: '',
                    harvestAmount: '',
                    harvestUnit: 'kg',
                    qualityRating: 3,
                    weatherCondition: ''
                },
                farmbookFields: [],
                farmbookEditMode: false,
                farmbookEditId: null,
                farmbookRecordTypes: [
                    { value: 'ekim', label: 'Ekim', icon: 'fa-seedling', color: 'bg-green-500' },
                    { value: 'gubre', label: 'GÃ¼bre', icon: 'fa-leaf', color: 'bg-amber-500' },
                    { value: 'ilac', label: 'Ä°laÃ§/Zirai MÃ¼cadele', icon: 'fa-spray-can', color: 'bg-red-500' },
                    { value: 'sulama', label: 'Sulama', icon: 'fa-tint', color: 'bg-blue-500' },
                    { value: 'hasat', label: 'Hasat', icon: 'fa-wheat-alt', color: 'bg-yellow-500' },
                    { value: 'gider', label: 'Gider', icon: 'fa-money-bill-wave', color: 'bg-rose-500' },
                    { value: 'gelir', label: 'Gelir', icon: 'fa-coins', color: 'bg-emerald-500' },
                    { value: 'notlar', label: 'Notlar', icon: 'fa-sticky-note', color: 'bg-purple-500' }
                ],
                farmbookSeasons: [
                    { value: 'ilkbahar', label: 'Ä°lkbahar' },
                    { value: 'yaz', label: 'Yaz' },
                    { value: 'sonbahar', label: 'Sonbahar' },
                    { value: 'kis', label: 'KÄ±ÅŸ' }
                ],
                farmbookUnits: ['kg', 'ton', 'litre', 'adet', 'Ã§uval', 'kasa', 'dekar', 'hektar'],
                farmbookWeatherOptions: [
                    { value: 'gunesli', label: 'GÃ¼neÅŸli', icon: 'fa-sun' },
                    { value: 'bulutlu', label: 'Bulutlu', icon: 'fa-cloud' },
                    { value: 'yagmurlu', label: 'YaÄŸmurlu', icon: 'fa-cloud-rain' },
                    { value: 'karli', label: 'KarlÄ±', icon: 'fa-snowflake' },
                    { value: 'ruzgarli', label: 'RÃ¼zgarlÄ±', icon: 'fa-wind' }
                ],

                // ============ INIT ============
                init() {
                    // SecureStorage migration - eski verileri gÃ¼venli storage'a taÅŸÄ±
                    this.SecureStorage.migrateFromLegacy();
                    
                    // GÃ¼venli storage'dan veri oku
                    const secureToken = this.SecureStorage.get('token');
                    const secureUser = this.SecureStorage.get('user');
                    
                    this.isLoggedIn = !!secureToken;
                    this.user = secureUser || {};
                    
                    this.generateCaptcha();
                    
                    // URL'den post ID kontrolÃ¼
                    this.checkUrlForPost();
                    
                    // Telefon geri tuÅŸu desteÄŸi - Her sayfa iÃ§in
                    this.setupBackButtonHandler();
                    
                    if (this.isLoggedIn) {
                        this.setupAxios();
                        
                        // YÃ¼kleme ekranÄ±nÄ± maksimum 8 saniye sonra kapat (sunucu yanÄ±t vermezse bile)
                        const loadingTimeout = setTimeout(() => {
                            console.warn('[AgroLink] Veri yÃ¼kleme zaman aÅŸÄ±mÄ±na uÄŸradÄ±, ekran aÃ§Ä±lÄ±yor...');
                            this.hideLoadingOverlay();
                        }, 8000);
                        
                        this.loadInitialData()
                            .catch(err => {
                                console.warn('[AgroLink] Veri yÃ¼kleme hatasÄ±:', err);
                            })
                            .finally(() => {
                                clearTimeout(loadingTimeout);
                                // YÃ¼kleme ekranÄ±nÄ± kapat
                                this.hideLoadingOverlay();
                                
                                // Ä°lk kez giriÅŸ yapan kullanÄ±cÄ±ya onboarding gÃ¶ster
                                this.$nextTick(() => {
                                    this.checkAndShowOnboarding();
                                });
                            });
                        this.setupSocket();
                        this.initEditForm();
                        this.requestPushNotifications();
                    } else {
                        // GiriÅŸ yapÄ±lmamÄ±ÅŸsa yÃ¼kleme ekranÄ±nÄ± hemen kapat
                        this.hideLoadingOverlay();
                    }
                    this.$watch('darkMode', val => localStorage.setItem('theme', val ? 'dark' : 'light'));
                },
                
                // YÃ¼kleme ekranÄ±nÄ± kapat
                hideLoadingOverlay() {
                    const overlay = document.getElementById('pageLoadingOverlay');
                    if (overlay) {
                        overlay.classList.add('hidden');
                        setTimeout(() => {
                            overlay.remove();
                        }, 500);
                    }
                },
                
                // ========== DÄ°L FONKSÄ°YONLARI ==========
                t(key) {
                    const lang = this.translations[this.currentLanguage] || this.translations['tr'];
                    return lang[key] || this.translations['tr'][key] || key;
                },
                
                setLanguage(langCode) {
                    this.currentLanguage = langCode;
                    localStorage.setItem('agrolink_lang', langCode);
                    this.showLanguageModal = false;
                    this.showToast(this.getLanguageName(langCode) + ' ' + (langCode === 'tr' ? 'seÃ§ildi' : 'selected'));
                },
                
                getLanguageName(code) {
                    const lang = this.availableLanguages.find(l => l.code === code);
                    return lang ? lang.name : 'TÃ¼rkÃ§e';
                },
                
                // ========== ONBOARDING FONKSÄ°YONLARI ==========
                checkAndShowOnboarding() {
                    // Daha Ã¶nce onboarding gÃ¶sterilmiÅŸ mi kontrol et
                    const hasSeenOnboarding = localStorage.getItem('agrolink_onboarding_seen');
                    if (!hasSeenOnboarding && this.isLoggedIn) {
                        setTimeout(() => {
                            this.showOnboarding = true;
                            this.onboardingStep = 0;
                        }, 1000); // 1 saniye bekle
                    }
                },
                
                startOnboarding() {
                    this.showOnboarding = true;
                    this.onboardingStep = 0;
                },
                
                nextOnboardingStep() {
                    if (this.onboardingStep < this.onboardingSteps.length - 1) {
                        this.onboardingStep++;
                    } else {
                        this.finishOnboarding();
                    }
                },
                
                prevOnboardingStep() {
                    if (this.onboardingStep > 0) {
                        this.onboardingStep--;
                    }
                },
                
                skipOnboarding() {
                    this.finishOnboarding();
                },
                
                finishOnboarding() {
                    this.showOnboarding = false;
                    localStorage.setItem('agrolink_onboarding_seen', 'true');
                    this.showToast('Harika! ArtÄ±k AgroLink\'i keÅŸfetmeye hazÄ±rsÄ±nÄ±z! ðŸŒ¾');
                },
                
                getOnboardingTargetRect() {
                    const step = this.onboardingSteps[this.onboardingStep];
                    if (!step) return { top: 0, left: 0, width: 0, height: 0 };
                    
                    const target = document.querySelector(step.target);
                    if (!target) return { top: 0, left: 0, width: 100, height: 100 };
                    
                    const rect = target.getBoundingClientRect();
                    return {
                        top: rect.top - 8,
                        left: rect.left - 8,
                        width: rect.width + 16,
                        height: rect.height + 16
                    };
                },
                
                getOnboardingTooltipStyle() {
                    const step = this.onboardingSteps[this.onboardingStep];
                    const rect = this.getOnboardingTargetRect();
                    
                    let style = {};
                    const tooltipWidth = 300;
                    const tooltipHeight = 250;
                    const padding = 20;
                    
                    if (step.position === 'top') {
                        style = {
                            bottom: (window.innerHeight - rect.top + padding) + 'px',
                            left: Math.max(padding, Math.min(rect.left + rect.width/2 - tooltipWidth/2, window.innerWidth - tooltipWidth - padding)) + 'px'
                        };
                    } else if (step.position === 'bottom') {
                        style = {
                            top: (rect.top + rect.height + padding) + 'px',
                            left: Math.max(padding, Math.min(rect.left + rect.width/2 - tooltipWidth/2, window.innerWidth - tooltipWidth - padding)) + 'px'
                        };
                    }
                    
                    return style;
                },
                
                getOnboardingArrowClass() {
                    const step = this.onboardingSteps[this.onboardingStep];
                    return step.position === 'top' ? 'arrow-bottom' : 'arrow-top';
                },
                
                // Telefon geri tuÅŸu handler'Ä± - TÃ¼m sayfalar iÃ§in
                setupBackButtonHandler() {
                    // History API'yi kullanarak geri tuÅŸu yakalama
                    window.history.pushState({ page: 'initial' }, '', window.location.href);
                    
                    window.addEventListener('popstate', (event) => {
                        // Ã–nce modal'larÄ± kapat
                        if (this.showExplore) {
                            this.showExplore = false;
                            window.history.pushState({ page: 'home' }, '', window.location.href);
                            return;
                        }
                        if (this.showUserProfile) {
                            this.showUserProfile = false;
                            this.activeTab = 'home';
                            window.history.pushState({ page: 'home' }, '', window.location.href);
                            return;
                        }
                        if (this.showChatModal) {
                            this.showChatModal = false;
                            window.history.pushState({ page: 'messages' }, '', window.location.href);
                            return;
                        }
                        if (this.showStoryViewer) {
                            this.showStoryViewer = false;
                            this.activeStory = null;
                            window.history.pushState({ page: 'home' }, '', window.location.href);
                            return;
                        }
                        if (this.showTikTokScroll) {
                            this.closeTikTokScroll();
                            window.history.pushState({ page: 'home' }, '', window.location.href);
                            return;
                        }
                        if (this.showFullScreen) {
                            this.showFullScreen = false;
                            window.history.pushState({ page: 'home' }, '', window.location.href);
                            return;
                        }
                        if (this.showPostOptions) {
                            this.showPostOptions = false;
                            window.history.pushState({ page: 'home' }, '', window.location.href);
                            return;
                        }
                        if (this.showCommentModal) {
                            this.showCommentModal = false;
                            window.history.pushState({ page: 'home' }, '', window.location.href);
                            return;
                        }
                        if (this.showEditModal) {
                            this.showEditModal = false;
                            window.history.pushState({ page: 'profile' }, '', window.location.href);
                            return;
                        }
                        if (this.showSettingsModal) {
                            this.showSettingsModal = false;
                            window.history.pushState({ page: 'profile' }, '', window.location.href);
                            return;
                        }
                        if (this.showAddProduct) {
                            this.showAddProduct = false;
                            window.history.pushState({ page: 'store' }, '', window.location.href);
                            return;
                        }
                        if (this.showVerificationModal) {
                            this.showVerificationModal = false;
                            window.history.pushState({ page: 'profile' }, '', window.location.href);
                            return;
                        }
                        if (this.showStoryModal) {
                            this.showStoryModal = false;
                            window.history.pushState({ page: 'home' }, '', window.location.href);
                            return;
                        }
                        if (this.showPostModal) {
                            this.showPostModal = false;
                            window.history.pushState({ page: 'home' }, '', window.location.href);
                            return;
                        }
                        if (this.showBlockedAccounts) {
                            this.showBlockedAccounts = false;
                            window.history.pushState({ page: 'settings' }, '', window.location.href);
                            return;
                        }
                        if (this.showSavedPosts) {
                            this.showSavedPosts = false;
                            window.history.pushState({ page: 'settings' }, '', window.location.href);
                            return;
                        }
                        
                        // Sekmeler arasÄ±nda gezinme
                        if (this.activeTab !== 'home') {
                            this.activeTab = 'home';
                            window.history.pushState({ page: 'home' }, '', window.location.href);
                            return;
                        }
                    });
                },
                
                // URL'den post ID kontrolÃ¼
                checkUrlForPost() {
                    const path = window.location.pathname;
                    const match = path.match(/\/post\/(.+)/);
                    if (match) {
                        const postId = match[1];
                        if (this.isLoggedIn) {
                            this.loadPostDetail(postId);
                        } else {
                            // Login gerekiyor, post ID'yi kaydet
                            this.pendingPostId = postId;
                        }
                    }
                },
                
                // Post detayÄ±nÄ± yÃ¼kle
                async loadPostDetail(postId) {
                    try {
                        this.loading = true;
                        const res = await axios.get(`/api/posts/${postId}`);
                        this.postDetail = res.data.post;
                        this.showPostDetail = true;
                        // URL'i temizle
                        window.history.replaceState({}, '', '/');
                    } catch (e) {
                        this.showToast('GÃ¶nderi bulunamadÄ±');
                    } finally {
                        this.loading = false;
                    }
                },
                
                // Push Notification Ä°zni Ä°ste
                async requestPushNotifications() {
                    if (!('Notification' in window)) {
                        console.log('Bu tarayÄ±cÄ± bildirimleri desteklemiyor');
                        return;
                    }
                    
                    if (Notification.permission === 'granted') {
                        this.registerServiceWorker();
                    } else if (Notification.permission !== 'denied') {
                        const permission = await Notification.requestPermission();
                        if (permission === 'granted') {
                            this.registerServiceWorker();
                            this.showToast('Bildirimler aÃ§Ä±ldÄ±! ðŸ””');
                        }
                    }
                },
                
                // Service Worker KayÄ±t
                async registerServiceWorker() {
                    if ('serviceWorker' in navigator) {
                        try {
                            const registration = await navigator.serviceWorker.register('/sw.js');
                            console.log('Service Worker kaydedildi:', registration);
                        } catch (error) {
                            console.log('Service Worker kaydÄ± baÅŸarÄ±sÄ±z:', error);
                        }
                    }
                },
                
                // Push Notification GÃ¶nder
                sendPushNotification(title, body, icon = '/favicon.ico') {
                    if (Notification.permission === 'granted') {
                        const notification = new Notification(title, {
                            body: body,
                            icon: icon,
                            badge: '/favicon.ico',
                            tag: 'agrolink-notification',
                            renotify: true,
                            vibrate: [200, 100, 200]
                        });
                        
                        notification.onclick = () => {
                            window.focus();
                            notification.close();
                        };
                    }
                },

                setupAxios() {
                    const secureToken = this.SecureStorage.get('token');
                    axios.defaults.headers.common['Authorization'] = `Bearer ${secureToken || ''}`;
                    axios.defaults.baseURL = '/';
                },

                setupSocket() {
                    try {
                        const secureToken = this.SecureStorage.get('token');
                        this.socket = io();
                        this.socket.emit('authenticate', { token: secureToken });
                        this.socket.on('notification', (data) => {
                            this.unreadNotifs++;
                            this.showToast(data.message || 'Yeni bildirim');
                            this.loadNotifications();
                            // Push notification gÃ¶nder
                            this.sendPushNotification('AgroLink', data.message || 'Yeni bildirim aldÄ±nÄ±z!');
                        });
                        this.socket.on('new_message', (msg) => {
                            if (this.showChatModal && this.activeChat.otherId === msg.senderId) {
                                this.chatMessages.push(msg);
                                this.scrollToBottom();
                                // MesajÄ± okundu olarak iÅŸaretle
                                this.markMessagesAsRead(msg.senderId);
                            } else {
                                this.loadConversations();
                                // Push notification gÃ¶nder
                                this.sendPushNotification('Yeni Mesaj', msg.content || 'Yeni bir mesaj aldÄ±nÄ±z!', msg.senderProfilePic || '/favicon.ico');
                            }
                        });
                        // Mesaj okundu bildirimi
                        this.socket.on('messages_read', (data) => {
                            if (this.showChatModal && this.activeChat.otherId === data.readerId) {
                                this.chatMessages.forEach(m => {
                                    if (m.senderId === this.user.id && !m.readAt) {
                                        m.readAt = data.readAt || new Date().toISOString();
                                    }
                                });
                            }
                        });
                        // Mesaj silindi bildirimi
                        this.socket.on('message_deleted', (data) => {
                            const idx = this.chatMessages.findIndex(m => m.id === data.messageId);
                            if (idx !== -1) {
                                this.chatMessages[idx].isDeleted = true;
                            }
                        });
                        
                        // ========== GÃ–RÃœNTÃœLÃœ ARAMA BÄ°LDÄ°RÄ°MLERÄ° ==========
                        // Gelen arama bildirimi
                        this.socket.on('incoming_call', (data) => {
                            this.incomingCall = data;
                            this.showIncomingCallModal = true;
                            // Bildirim sesi Ã§al
                            this.playNotificationSound('call');
                        });
                        
                        // Arama kabul edildi
                        this.socket.on('call_accepted', (data) => {
                            this.showToast('ðŸ“ž Arama kabul edildi');
                        });
                        
                        // Arama reddedildi
                        this.socket.on('call_rejected', (data) => {
                            this.showToast('âŒ Arama reddedildi');
                            this.endCall();
                        });
                        
                        // Arama cevapsÄ±z
                        this.socket.on('call_missed', (data) => {
                            this.showToast('ðŸ“µ Arama cevapsÄ±z kaldÄ±');
                            this.showIncomingCallModal = false;
                            this.incomingCall = null;
                        });
                        
                        // Arama sonlandÄ±rÄ±ldÄ±
                        this.socket.on('call_ended', (data) => {
                            this.showToast('ðŸ“ž Arama sonlandÄ±rÄ±ldÄ±');
                            this.endCall();
                        });
                        
                        // WebRTC Sinyal MesajlarÄ±
                        this.socket.on('webrtc_offer', async (data) => {
                            if (this.peerConnection) {
                                await this.peerConnection.setRemoteDescription(new RTCSessionDescription(data.offer));
                                const answer = await this.peerConnection.createAnswer();
                                await this.peerConnection.setLocalDescription(answer);
                                await axios.post('/api/calls/signal/answer', {
                                    callId: data.callId,
                                    answer: answer
                                });
                            }
                        });
                        
                        this.socket.on('webrtc_answer', async (data) => {
                            if (this.peerConnection) {
                                await this.peerConnection.setRemoteDescription(new RTCSessionDescription(data.answer));
                            }
                        });
                        
                        this.socket.on('webrtc_ice_candidate', async (data) => {
                            if (this.peerConnection) {
                                await this.peerConnection.addIceCandidate(new RTCIceCandidate(data.candidate));
                            }
                        });
                        
                        this.socket.on('new_post', () => this.fetchPosts(true));
                        this.socket.on('account_deleted', () => this.logout());
                        this.socket.on('force_logout', () => this.logout());
                    } catch (e) { console.log('Socket error:', e); }
                },
                
                // Bildirim sesi Ã§al
                playNotificationSound(type) {
                    try {
                        const audio = new Audio();
                        audio.src = type === 'call' 
                            ? 'data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYIG2m98OScTgwOUarm7blmFgU7k9n1unEiBC13yO/eizEIHWq+8+OWT' 
                            : '';
                        audio.play().catch(() => {});
                    } catch (e) {}
                },
                
                // PaylaÅŸÄ±lan postu aÃ§
                openSharedPost(postId) {
                    this.showChatModal = false;
                    this.openTikTokScroll({ id: postId });
                },
                
                // MesajlarÄ± okundu olarak iÅŸaretle
                async markMessagesAsRead(userId) {
                    try {
                        await axios.post(`/api/messages/${userId}/read`);
                    } catch (e) { console.log('Okundu iÅŸareti gÃ¶nderilemedi'); }
                },

                async loadInitialData() {
                    // Promise.allSettled kullan: bir API baÅŸarÄ±sÄ±z olsa bile diÄŸerleri Ã§alÄ±ÅŸsÄ±n
                    const results = await Promise.allSettled([
                        this.fetchPosts(),
                        this.loadStats(),
                        this.loadProducts(),
                        this.loadConversations(),
                        this.loadNotifications(),
                        this.loadStories(),
                        this.loadFollowing() // Takip edilenleri yÃ¼kle
                    ]);
                    
                    // BaÅŸarÄ±sÄ±z olanlarÄ± logla
                    results.forEach((result, i) => {
                        if (result.status === 'rejected') {
                            const names = ['fetchPosts', 'loadStats', 'loadProducts', 'loadConversations', 'loadNotifications', 'loadStories', 'loadFollowing'];
                            console.warn('[AgroLink] ' + names[i] + ' yÃ¼klenemedi:', result.reason);
                        }
                    });
                },
                
                // Takip edilenleri yÃ¼kle
                async loadFollowing() {
                    try {
                        const res = await axios.get('/api/users/following');
                        this.followingIds = res.data.following?.map(f => f.id) || [];
                        console.log('âœ… Takip edilenler yÃ¼klendi:', this.followingIds.length);
                    } catch (e) {
                        console.error('Takip edilenler yÃ¼klenemedi:', e);
                    }
                },

                initEditForm() {
                    this.editForm = {
                        name: this.user.name || '',
                        email: this.user.email || '',
                        userType: this.user.userType || '',
                        bio: this.user.bio || '',
                        location: this.user.location || '',
                        website: this.user.website || '',
                        profilePic: this.user.profilePic || '',
                        profilePicFile: null,
                        coverPicFile: null,
                        coverPicPreview: ''
                    };
                },
                
                // Tab deÄŸiÅŸtir ve verileri yenile
                switchTab(tab) {
                    this.activeTab = tab;
                    if (tab === 'home') {
                        this.fetchPosts(true);
                        this.loadStories();
                    } else if (tab === 'store') {
                        this.loadProducts();
                    } else if (tab === 'messages') {
                        this.loadConversations();
                    } else if (tab === 'profile') {
                        this.loadMyPosts();
                        this.loadStats();
                    }
                },

                // ============ AUTH ============
                generateCaptcha() {
                    const n1 = Math.floor(Math.random() * 10);
                    const n2 = Math.floor(Math.random() * 10);
                    this.captcha.q = `${n1} + ${n2}`;
                    this.captcha.a = n1 + n2;
                },

                previewAvatar(e) {
                    const file = e.target.files[0];
                    if (!file) return;
                    this.authForm.avatarFile = file;
                    this.authForm.avatarPreview = URL.createObjectURL(file);
                },

                async authAction() {
                    if (parseInt(this.captcha.userAns) !== this.captcha.a) {
                        this.showToast("GÃ¼venlik sorusu yanlÄ±ÅŸ!");
                        this.generateCaptcha();
                        return;
                    }

                    this.loading = true;
                    try {
                        if (this.authMode === 'register') {
                            // YENÄ°: KayÄ±t - E-posta doÄŸrulama ile
                            const fd = new FormData();
                            fd.append('name', window.sanitizeInput ? window.sanitizeInput(this.authForm.name) : this.authForm.name);
                            fd.append('username', window.sanitizeInput ? window.sanitizeInput(this.authForm.username) : this.authForm.username);
                            fd.append('email', window.sanitizeInput ? window.sanitizeInput(this.authForm.email) : this.authForm.email);
                            fd.append('password', this.authForm.password);
                            fd.append('userType', this.authForm.userType || 'normal_kullanici');
                            if (this.authForm.avatarFile) fd.append('profilePic', this.authForm.avatarFile);
                            
                            const res = await axios.post('/api/auth/register-init', fd);
                            
                            // E-posta doÄŸrulama modalÄ±nÄ± gÃ¶ster
                            this.emailVerifyData.email = this.authForm.email;
                            this.pendingRegistrationData = {
                                email: this.authForm.email,
                                password: this.authForm.password
                            };
                            this.showEmailVerifyModal = true;
                            this.startEmailVerifyTimer();
                            this.showToast(res.data.message);
                            
                        } else {
                            // YENÄ°: GiriÅŸ - 2FA ile
                            const res = await axios.post('/api/auth/login', { 
                                email: window.sanitizeInput ? window.sanitizeInput(this.authForm.email) : this.authForm.email, 
                                password: this.authForm.password 
                            });
                            
                            if (res.data.requires2FA) {
                                // 2FA modalÄ±nÄ± gÃ¶ster
                                this.twoFAData = {
                                    tempToken: res.data.tempToken,
                                    email: res.data.email,
                                    userId: res.data.userId
                                };
                                this.show2FAModal = true;
                                this.start2FATimer();
                                this.showToast(res.data.message);
                            } else {
                                // Normal giriÅŸ (fallback)
                                this.SecureStorage.set('token', res.data.token || res.data.accessToken);
                                this.SecureStorage.set('user', res.data.user);
                                location.reload();
                            }
                        }
                    } catch (e) {
                        this.showToast(e.response?.data?.error || "Ä°ÅŸlem baÅŸarÄ±sÄ±z!");
                        this.generateCaptcha();
                    } finally { 
                        this.loading = false; 
                    }
                },
                
                // ========== 2FA (2 FAKTÃ–RLÃœ DOÄžRULAMA) FONKSÄ°YONLARI ==========
                
                // 2FA Input Handler - SERÄ° GÄ°RÄ°Åž DESTEÄžÄ° (YAPIÅžTIRILMIÅž KOD)
                handle2FAInput(index, event) {
                    const value = event.target.value;
                    
                    // YapÄ±ÅŸtÄ±rma kontrolÃ¼ - 6 haneli kod yapÄ±ÅŸtÄ±rÄ±ldÄ±ysa tÃ¼mÃ¼nÃ¼ daÄŸÄ±t
                    if (value.length > 1) {
                        const digits = value.replace(/\D/g, '').slice(0, 6);
                        if (digits.length > 0) {
                            for (let i = 0; i < 6; i++) {
                                this.twoFAInput[i] = digits[i] || '';
                                const inp = this.$refs['2fa-' + i];
                                if (inp) inp.value = digits[i] || '';
                            }
                            // Son dolu input'a odaklan
                            const lastFilledIndex = Math.min(digits.length - 1, 5);
                            const lastInput = this.$refs['2fa-' + lastFilledIndex];
                            if (lastInput) lastInput.focus();
                            
                            // TÃ¼m alanlar doluysa otomatik doÄŸrula
                            if (digits.length === 6) {
                                this.$nextTick(() => this.verify2FA());
                            }
                            return;
                        }
                    }
                    
                    // Sadece sayÄ± kabul et
                    if (!/^\d*$/.test(value)) {
                        this.twoFAInput[index] = '';
                        event.target.value = '';
                        return;
                    }
                    
                    // Sadece son karakteri al
                    const digit = value.slice(-1);
                    this.twoFAInput[index] = digit;
                    event.target.value = digit;
                    
                    // Sonraki input'a HEMEN geÃ§
                    if (digit && index < 5) {
                        const nextInput = this.$refs['2fa-' + (index + 1)];
                        if (nextInput) {
                            nextInput.focus();
                            nextInput.select();
                        }
                    }
                    
                    // TÃ¼m alanlar doluysa otomatik doÄŸrula
                    if (this.is2FAComplete()) {
                        this.$nextTick(() => this.verify2FA());
                    }
                },
                
                // 2FA Backspace Handler
                handle2FABackspace(index, event) {
                    if (event.key === 'Backspace' && !this.twoFAInput[index] && index > 0) {
                        this.$nextTick(() => {
                            const prevInput = this.$refs['2fa-' + (index - 1)];
                            if (prevInput) prevInput.focus();
                        });
                    }
                },
                
                // 2FA kodu tamamlandÄ± mÄ±?
                is2FAComplete() {
                    return this.twoFAInput.every(digit => digit && /^\d$/.test(digit));
                },
                
                // 2FA kodunu formatla
                get2FACode() {
                    return this.twoFAInput.join('');
                },
                
                // 2FA Timer baÅŸlat
                start2FATimer() {
                    this.twoFATimer = 300; // 5 dakika
                    this.twoFAResendTimer = 60; // 1 dakika bekleme
                    
                    if (this.twoFATimerInterval) clearInterval(this.twoFATimerInterval);
                    
                    this.twoFATimerInterval = setInterval(() => {
                        if (this.twoFATimer > 0) this.twoFATimer--;
                        if (this.twoFAResendTimer > 0) this.twoFAResendTimer--;
                        
                        if (this.twoFATimer === 0) {
                            clearInterval(this.twoFATimerInterval);
                            this.twoFAError = 'Kodun sÃ¼resi doldu. LÃ¼tfen tekrar giriÅŸ yapÄ±n.';
                        }
                    }, 1000);
                },
                
                // 2FA Timer formatla
                format2FATimer() {
                    const minutes = Math.floor(this.twoFATimer / 60);
                    const seconds = this.twoFATimer % 60;
                    return `${minutes}:${seconds.toString().padStart(2, '0')}`;
                },
                
                // 2FA DoÄŸrula
                async verify2FA() {
                    if (!this.is2FAComplete()) {
                        this.twoFAError = 'LÃ¼tfen 6 haneli kodu tam girin';
                        return;
                    }
                    
                    this.loading = true;
                    this.twoFAError = '';
                    
                    try {
                        const res = await axios.post('/api/auth/verify-2fa', {
                            tempToken: this.twoFAData.tempToken,
                            code: this.get2FACode()
                        });
                        
                        // Timer'Ä± durdur
                        if (this.twoFATimerInterval) clearInterval(this.twoFATimerInterval);
                        
                        // BaÅŸarÄ±lÄ± giriÅŸ
                        this.SecureStorage.set('token', res.data.token || res.data.accessToken);
                        this.SecureStorage.set('user', res.data.user);
                        this.showToast('GiriÅŸ baÅŸarÄ±lÄ±!');
                        location.reload();
                        
                    } catch (e) {
                        this.twoFAError = e.response?.data?.error || 'Kod doÄŸrulanamadÄ±. LÃ¼tfen tekrar deneyin.';
                        // InputlarÄ± temizle
                        this.twoFAInput = ['', '', '', '', '', ''];
                        this.$nextTick(() => {
                            const firstInput = this.$refs['2fa-0'];
                            if (firstInput) firstInput.focus();
                        });
                    } finally {
                        this.loading = false;
                    }
                },
                
                // 2FA Kodu tekrar gÃ¶nder
                async resend2FACode() {
                    if (this.twoFAResendTimer > 0) return;
                    
                    this.loading = true;
                    try {
                        const res = await axios.post('/api/auth/resend-2fa', {
                            tempToken: this.twoFAData.tempToken
                        });
                        
                        this.twoFAResendTimer = 60;
                        this.twoFAError = '';
                        this.showToast('Yeni kod gÃ¶nderildi!');
                        
                    } catch (e) {
                        this.twoFAError = e.response?.data?.error || 'Kod gÃ¶nderilemedi';
                    } finally {
                        this.loading = false;
                    }
                },
                
                // 2FA Ä°ptal
                cancel2FA() {
                    if (this.twoFATimerInterval) clearInterval(this.twoFATimerInterval);
                    this.show2FAModal = false;
                    this.twoFAData = { tempToken: '', email: '', userId: '' };
                    this.twoFAInput = ['', '', '', '', '', ''];
                    this.twoFAError = '';
                    this.twoFATimer = 300;
                    this.twoFAResendTimer = 0;
                },
                
                // ========== E-POSTA DOÄžRULAMA FONKSÄ°YONLARI ==========
                
                // Email Verify Input Handler - SERÄ° GÄ°RÄ°Åž DESTEÄžÄ° (YAPIÅžTIRILMIÅž KOD)
                handleEmailVerifyInput(index, event) {
                    const value = event.target.value;
                    
                    // YapÄ±ÅŸtÄ±rma kontrolÃ¼ - 6 haneli kod yapÄ±ÅŸtÄ±rÄ±ldÄ±ysa tÃ¼mÃ¼nÃ¼ daÄŸÄ±t
                    if (value.length > 1) {
                        const digits = value.replace(/\D/g, '').slice(0, 6);
                        if (digits.length > 0) {
                            for (let i = 0; i < 6; i++) {
                                this.emailVerifyInput[i] = digits[i] || '';
                                const inp = this.$refs['email-verify-' + i];
                                if (inp) inp.value = digits[i] || '';
                            }
                            // Son dolu input'a odaklan
                            const lastFilledIndex = Math.min(digits.length - 1, 5);
                            const lastInput = this.$refs['email-verify-' + lastFilledIndex];
                            if (lastInput) lastInput.focus();
                            
                            // TÃ¼m alanlar doluysa otomatik doÄŸrula
                            if (digits.length === 6) {
                                this.$nextTick(() => this.verifyEmailCode());
                            }
                            return;
                        }
                    }
                    
                    // Sadece sayÄ± kabul et
                    if (!/^\d*$/.test(value)) {
                        this.emailVerifyInput[index] = '';
                        event.target.value = '';
                        return;
                    }
                    
                    // Sadece son karakteri al
                    const digit = value.slice(-1);
                    this.emailVerifyInput[index] = digit;
                    event.target.value = digit;
                    
                    // Sonraki input'a HEMEN geÃ§
                    if (digit && index < 5) {
                        const nextInput = this.$refs['email-verify-' + (index + 1)];
                        if (nextInput) {
                            nextInput.focus();
                            nextInput.select();
                        }
                    }
                    
                    // TÃ¼m alanlar doluysa otomatik doÄŸrula
                    if (this.isEmailVerifyComplete()) {
                        this.$nextTick(() => this.verifyEmailCode());
                    }
                },
                
                // Email Verify Backspace Handler
                handleEmailVerifyBackspace(index, event) {
                    if (event.key === 'Backspace' && !this.emailVerifyInput[index] && index > 0) {
                        this.$nextTick(() => {
                            const prevInput = this.$refs['email-verify-' + (index - 1)];
                            if (prevInput) prevInput.focus();
                        });
                    }
                },
                
                // Email Verify kodu tamamlandÄ± mÄ±?
                isEmailVerifyComplete() {
                    return this.emailVerifyInput.every(digit => digit && /^\d$/.test(digit));
                },
                
                // Email Verify kodunu formatla
                getEmailVerifyCode() {
                    return this.emailVerifyInput.join('');
                },
                
                // Email Verify Timer baÅŸlat
                startEmailVerifyTimer() {
                    this.emailVerifyTimer = 300; // 5 dakika
                    this.emailResendTimer = 60; // 1 dakika bekleme
                    
                    if (this.emailVerifyTimerInterval) clearInterval(this.emailVerifyTimerInterval);
                    
                    this.emailVerifyTimerInterval = setInterval(() => {
                        if (this.emailVerifyTimer > 0) this.emailVerifyTimer--;
                        if (this.emailResendTimer > 0) this.emailResendTimer--;
                        
                        if (this.emailVerifyTimer === 0) {
                            clearInterval(this.emailVerifyTimerInterval);
                            this.emailVerifyError = 'Kodun sÃ¼resi doldu. LÃ¼tfen tekrar kayÄ±t olun.';
                        }
                    }, 1000);
                },
                
                // Email Verify Timer formatla
                formatEmailVerifyTimer() {
                    const minutes = Math.floor(this.emailVerifyTimer / 60);
                    const seconds = this.emailVerifyTimer % 60;
                    return `${minutes}:${seconds.toString().padStart(2, '0')}`;
                },
                
                // Email Kod DoÄŸrula
                async verifyEmailCode() {
                    if (!this.isEmailVerifyComplete()) {
                        this.emailVerifyError = 'LÃ¼tfen 6 haneli kodu tam girin';
                        return;
                    }
                    
                    this.loading = true;
                    this.emailVerifyError = '';
                    
                    try {
                        const res = await axios.post('/api/auth/register-verify', {
                            email: this.emailVerifyData.email,
                            code: this.getEmailVerifyCode()
                        });
                        
                        // Timer'Ä± durdur
                        if (this.emailVerifyTimerInterval) clearInterval(this.emailVerifyTimerInterval);
                        
                        // BaÅŸarÄ±lÄ± kayÄ±t
                        this.SecureStorage.set('token', res.data.token || res.data.accessToken);
                        this.SecureStorage.set('user', res.data.user);
                        this.showToast('KayÄ±t baÅŸarÄ±yla tamamlandÄ±!');
                        location.reload();
                        
                    } catch (e) {
                        this.emailVerifyError = e.response?.data?.error || 'Kod doÄŸrulanamadÄ±. LÃ¼tfen tekrar deneyin.';
                        this.emailVerifyInput = ['', '', '', '', '', ''];
                        this.$nextTick(() => {
                            const firstInput = this.$refs['email-verify-0'];
                            if (firstInput) firstInput.focus();
                        });
                    } finally {
                        this.loading = false;
                    }
                },
                
                // Email Kodu tekrar gÃ¶nder
                async resendEmailCode() {
                    if (this.emailResendTimer > 0) return;
                    
                    this.loading = true;
                    try {
                        const res = await axios.post('/api/auth/resend-verification', {
                            email: this.emailVerifyData.email
                        });
                        
                        this.emailResendTimer = 60;
                        this.emailVerifyError = '';
                        this.showToast('Yeni kod gÃ¶nderildi!');
                        
                    } catch (e) {
                        this.emailVerifyError = e.response?.data?.error || 'Kod gÃ¶nderilemedi';
                    } finally {
                        this.loading = false;
                    }
                },
                
                // Email Verify Ä°ptal
                cancelEmailVerify() {
                    if (this.emailVerifyTimerInterval) clearInterval(this.emailVerifyTimerInterval);
                    this.showEmailVerifyModal = false;
                    this.emailVerifyData = { email: '' };
                    this.emailVerifyInput = ['', '', '', '', '', ''];
                    this.emailVerifyError = '';
                    this.emailVerifyTimer = 300;
                    this.emailResendTimer = 0;
                    this.pendingRegistrationData = null;
                },

                async forgotPassword() {
                    if (!this.authForm.email || !this.authForm.username) {
                        this.showToast("E-posta adresi ve kullanÄ±cÄ± adÄ± gerekli");
                        return;
                    }
                    this.loading = true;
                    try {
                        // XSS korumasÄ±
                        const sanitizedEmail = window.sanitizeInput ? window.sanitizeInput(this.authForm.email) : this.authForm.email;
                        const sanitizedUsername = window.sanitizeInput ? window.sanitizeInput(this.authForm.username) : this.authForm.username;
                        await axios.post('/api/auth/forgot-password', { email: sanitizedEmail, username: sanitizedUsername });
                        this.showToast("Åžifre sÄ±fÄ±rlama linki e-posta adresinize gÃ¶nderildi");
                        this.authMode = 'login';
                    } catch (e) {
                        this.showToast(e.response?.data?.error || "Hata oluÅŸtu");
                    } finally {
                        this.loading = false;
                    }
                },

                logout() {
                    // SecureStorage'Ä± temizle
                    this.SecureStorage.clear();
                    // Eski localStorage verilerini de temizle
                    localStorage.removeItem('token');
                    localStorage.removeItem('user');
                    localStorage.removeItem('agrolink_user');
                    location.reload();
                },
                
                // Hesap Silme
                async deleteAccount() {
                    if (!this.deleteAccountPassword) {
                        this.showToast("Åžifrenizi girin");
                        return;
                    }
                    
                    if (!confirm('HesabÄ±nÄ±zÄ± kalÄ±cÄ± olarak silmek istediÄŸinize emin misiniz? Bu iÅŸlem geri alÄ±namaz!')) {
                        return;
                    }
                    
                    this.loading = true;
                    try {
                        await axios.delete('/api/users/account', { 
                            data: { password: this.deleteAccountPassword }
                        });
                        this.showToast("HesabÄ±nÄ±z silindi");
                        setTimeout(() => this.logout(), 1500);
                    } catch (e) {
                        this.showToast(e.response?.data?.error || "Hesap silinemedi");
                    } finally {
                        this.loading = false;
                    }
                },
                
                // Åžifre DeÄŸiÅŸtirme
                async changePassword() {
                    if (!this.passwordForm.currentPassword || !this.passwordForm.newPassword || !this.passwordForm.confirmPassword) {
                        this.showToast("TÃ¼m alanlarÄ± doldurun");
                        return;
                    }
                    
                    if (this.passwordForm.newPassword !== this.passwordForm.confirmPassword) {
                        this.showToast("Yeni ÅŸifreler eÅŸleÅŸmiyor");
                        return;
                    }
                    
                    if (this.passwordForm.newPassword.length < 6) {
                        this.showToast("Åžifre en az 6 karakter olmalÄ±");
                        return;
                    }
                    
                    this.loading = true;
                    try {
                        await axios.post('/api/users/change-password', this.passwordForm);
                        this.showToast("Åžifre deÄŸiÅŸtirildi");
                        this.showChangePassword = false;
                        this.passwordForm = { currentPassword: '', newPassword: '', confirmPassword: '' };
                    } catch (e) {
                        this.showToast(e.response?.data?.error || "Åžifre deÄŸiÅŸtirilemedi");
                    } finally {
                        this.loading = false;
                    }
                },

                // ============ KEÅžFET ============
                async loadExplorePosts() {
                    this.exploreLoading = true;
                    try {
                        // TÃ¼m postlarÄ± Ã§ek ve popÃ¼lerliÄŸe gÃ¶re sÄ±rala
                        const res = await axios.get('/api/posts?page=1&limit=50');
                        let posts = res.data.posts || [];
                        
                        // Medya URL dÃ¼zelt
                        posts.forEach(post => {
                            if (post.media) {
                                const filename = post.media.split('/').pop();
                                if (post.mediaType === 'video') {
                                    post.mediaUrl = post.mediaUrl || '/uploads/videos/' + filename;
                                } else {
                                    post.mediaUrl = post.mediaUrl || post.media;
                                }
                            }
                        });
                        
                        // Kategoriye gÃ¶re filtrele ve sÄ±rala
                        if (this.exploreCategory === 'liked') {
                            posts.sort((a, b) => (b.likeCount || 0) - (a.likeCount || 0));
                        } else if (this.exploreCategory === 'commented') {
                            posts.sort((a, b) => (b.commentCount || 0) - (a.commentCount || 0));
                        } else if (this.exploreCategory === 'media') {
                            posts = posts.filter(p => p.mediaUrl);
                            posts.sort((a, b) => ((b.likeCount || 0) + (b.commentCount || 0)) - ((a.likeCount || 0) + (a.commentCount || 0)));
                        } else {
                            // Trend: beÄŸeni + yorum toplamÄ±na gÃ¶re sÄ±rala
                            posts.sort((a, b) => {
                                const scoreA = (a.likeCount || 0) * 2 + (a.commentCount || 0) * 3 + (a.viewCount || 0);
                                const scoreB = (b.likeCount || 0) * 2 + (b.commentCount || 0) * 3 + (b.viewCount || 0);
                                return scoreB - scoreA;
                            });
                        }
                        
                        this.explorePosts = posts;
                    } catch (e) {
                        console.error('Explore error:', e);
                        this.showToast('KeÅŸfet yÃ¼klenemedi');
                    } finally {
                        this.exploreLoading = false;
                    }
                },

                // ============ FEED ============
                async fetchPosts(refresh = false) {
                    if (!this.hasMore && !refresh || this.loadingMore) return;
                    this.loadingMore = true;
                    
                    if (refresh) {
                        this.currentPage = 1;
                        this.feed = [];
                        this.hasMore = true;
                    }
                    
                    try {
                        const res = await axios.get(`api/posts?page=${this.currentPage}&limit=10`);
                        const posts = res.data.posts || [];
                        
                        posts.forEach(post => {
                            post.showFullContent = false;
                            // Takip durumunu kontrol et ve ekle
                            post.isFollowing = this.followingIds.includes(post.userId);
                            if (post.media) {
                                const filename = post.media.split('/').pop();
                                if (post.mediaType === 'video') {
                                    post.mediaUrl = post.mediaUrl || `/uploads/videos/${filename}`;
                                } else {
                                    post.mediaUrl = post.mediaUrl || post.media;
                                }
                            }
                        });
                        
                        this.feed = refresh ? posts : [...this.feed, ...posts];
                        this.hasMore = res.data.hasMore;
                        this.currentPage++;
                    } catch (e) { 
                        console.error('Feed error:', e); 
                    } finally { 
                        this.loadingMore = false; 
                    }
                },

                handleScroll() {
                    if ((window.innerHeight + window.scrollY) >= document.body.offsetHeight - 500) {
                        this.fetchPosts();
                    }
                },

                // ============ POSTS ============
                handlePostMedia(e) {
                    const file = e.target.files[0];
                    if (!file) return;
                    
                    // Dosya boyutu kontrolÃ¼ - 50MB (52428800 bytes)
                    const maxSize = 50 * 1024 * 1024; // 52428800 bytes
                    const fileSizeMB = (file.size / 1024 / 1024).toFixed(2);
                    
                    if (file.size > maxSize) {
                        this.showToast(`âŒ Dosya Ã§ok bÃ¼yÃ¼k: ${fileSizeMB}MB. Maksimum 50MB olabilir.`);
                        e.target.value = ''; // Input'u temizle
                        return;
                    }
                    
                    console.log(`âœ… Dosya boyutu OK: ${fileSizeMB}MB / 50MB`);
                    
                    this.postForm.media = file;
                    this.postForm.preview = URL.createObjectURL(file);
                    this.postForm.mediaType = file.type.startsWith('video/') ? 'video' : 'image';
                },

                async submitPost() {
                    console.log('\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
                    console.log('ðŸ“ POST GÃ–NDERME BAÅžLADI');
                    console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
                    console.log('Tip:', this.postForm.type);
                    console.log('Ä°Ã§erik:', this.postForm.content ? this.postForm.content.substring(0, 50) + '...' : 'YOK');
                    console.log('Medya:', this.postForm.media ? 'VAR (' + (this.postForm.media.size / 1024 / 1024).toFixed(2) + ' MB)' : 'YOK');
                    console.log('Medya Tipi:', this.postForm.mediaType || 'YOK');
                    
                    // VALÄ°DASYON KONTROLÃœ
                    if (this.postForm.type === 'normal' && !this.postForm.content && !this.postForm.media) {
                        console.error('âŒ Validasyon hatasÄ±: BoÅŸ iÃ§erik');
                        this.showToast("âŒ Ä°Ã§erik veya medya eklemelisiniz");
                        return;
                    }
                    
                    if (this.postForm.type === 'poll' && (!this.postForm.pollQuestion || this.postForm.pollOptions.filter(o => o.trim()).length < 2)) {
                        console.error('âŒ Validasyon hatasÄ±: Eksik anket bilgisi');
                        this.showToast("âŒ Anket sorusu ve en az 2 seÃ§enek gerekli");
                        return;
                    }

                    this.loading = true;
                    this.isUploading = this.postForm.media ? true : false;
                    this.uploadProgress = 0;
                    
                    try {
                        console.log('ðŸ“¦ FormData hazÄ±rlanÄ±yor...');
                        const fd = new FormData();
                        
                        if (this.postForm.type === 'poll') {
                            // â•â•â• ANKET MODU â•â•â•
                            console.log('ðŸ—³ï¸ Anket modu aktif');
                            
                            const sanitizedQuestion = window.sanitizeInput ? window.sanitizeInput(this.postForm.pollQuestion) : this.postForm.pollQuestion;
                            fd.append('isPoll', 'true');
                            fd.append('pollQuestion', sanitizedQuestion);
                            
                            const sanitizedOptions = this.postForm.pollOptions
                                .filter(o => o.trim())
                                .map(o => window.sanitizeInput ? window.sanitizeInput(o) : o);
                            fd.append('pollOptions', JSON.stringify(sanitizedOptions));
                            
                            console.log('   âœ… Anket sorusu:', sanitizedQuestion.substring(0, 50));
                            console.log('   âœ… SeÃ§enek sayÄ±sÄ±:', sanitizedOptions.length);
                            
                        } else {
                            // â•â•â• NORMAL POST MODU â•â•â•
                            console.log('ðŸ“„ Normal post modu aktif');
                            
                            const sanitizedContent = window.sanitizeInput ? window.sanitizeInput(this.postForm.content) : this.postForm.content;
                            fd.append('content', sanitizedContent);
                            fd.append('isPoll', 'false');
                            
                            console.log('   âœ… Ä°Ã§erik eklendi:', sanitizedContent ? sanitizedContent.substring(0, 50) + '...' : 'BOÅž');
                            
                            // MEDYA EKLEME
                            if (this.postForm.media) {
                                const isVideo = this.postForm.mediaType === 'video';
                                const fileSizeMB = (this.postForm.media.size / 1024 / 1024).toFixed(2);
                                
                                console.log('   ðŸ“ Medya ekleniyor...');
                                console.log('      - Tip:', isVideo ? 'VÄ°DEO' : 'RESÄ°M');
                                console.log('      - Boyut:', fileSizeMB + ' MB');
                                console.log('      - Dosya adÄ±:', this.postForm.media.name);
                                
                                if (isVideo && this.postForm.media.size > 10 * 1024 * 1024) {
                                    console.log('   âš ï¸ BÃ¼yÃ¼k video, yÃ¼kleme biraz sÃ¼rebilir...');
                                    this.showToast('Video yÃ¼kleniyor, lÃ¼tfen bekleyin...');
                                }
                                
                                fd.append('media', this.postForm.media);
                                console.log('   âœ… Medya FormData\'ya eklendi');
                            }
                            
                            // KONUM EKLEME
                            if (this.postForm.locationName) {
                                const sanitizedLocation = window.sanitizeInput ? window.sanitizeInput(this.postForm.locationName) : this.postForm.locationName;
                                fd.append('locationName', sanitizedLocation);
                                console.log('   ðŸ“ Konum eklendi:', sanitizedLocation);
                            }
                        }

                        // API Ä°STEÄžÄ° GÃ–NDER
                        console.log('ðŸš€ API isteÄŸi gÃ¶nderiliyor...');
                        console.log('   URL: /api/posts');
                        console.log('   Method: POST');
                        console.log('   Content-Type: multipart/form-data');
                        
                        const response = await axios.post('/api/posts', fd, {
                            headers: {
                                'Content-Type': 'multipart/form-data'
                            },
                            onUploadProgress: (progressEvent) => {
                                if (progressEvent.total) {
                                    const percentCompleted = Math.round((progressEvent.loaded * 100) / progressEvent.total);
                                    this.uploadProgress = percentCompleted;
                                    if (percentCompleted % 10 === 0) { // Her %10'da bir log
                                        console.log(`   ðŸ“Š Upload ilerleme: ${percentCompleted}%`);
                                    }
                                }
                            },
                            timeout: 300000, // 5 dakika
                            validateStatus: function (status) {
                                return status >= 200 && status < 600; // TÃ¼m statuslarÄ± kabul et
                            }
                        });
                        
                        console.log('ðŸ“¨ RESPONSE ALINDI:');
                        console.log('   Status:', response.status);
                        console.log('   Status Text:', response.statusText);
                        console.log('   Data:', response.data);
                        
                        // RESPONSE KONTROLÃœ
                        if (response.status === 201 || response.status === 200) {
                            // BaÅŸarÄ±lÄ± response
                            if (response.data.success === true || response.data.post) {
                                console.log('âœ… POST BAÅžARILI!');
                                console.log('   Post ID:', response.data.post?.id);
                                console.log('   Ä°ÅŸlem sÃ¼resi:', response.data.processingTime);
                                
                                this.uploadProgress = 100;
                                await new Promise(r => setTimeout(r, 500));
                                
                                // Modal kapat ve formu temizle
                                this.showPostModal = false;
                                this.postForm = { 
                                    content: '', 
                                    media: null, 
                                    preview: '', 
                                    mediaType: null, 
                                    type: 'normal', 
                                    pollQuestion: '', 
                                    pollOptions: ['', ''], 
                                    showLocation: false, 
                                    locationName: '' 
                                };
                                
                                // Feed'i yenile
                                this.fetchPosts(true);
                                this.showToast("âœ… GÃ¶nderi baÅŸarÄ±yla paylaÅŸÄ±ldÄ±!");
                                
                            } else {
                                // Success flag false
                                console.error('âŒ Response geldi ama success=false');
                                console.error('   Error:', response.data.error);
                                console.error('   Code:', response.data.code);
                                
                                const errorMsg = response.data.error || response.data.message || 'Bilinmeyen hata';
                                this.showToast(`âŒ ${errorMsg}`);
                            }
                            
                        } else if (response.status === 400) {
                            // Bad Request
                            console.error('âŒ 400 BAD REQUEST');
                            console.error('   Error:', response.data.error);
                            console.error('   Code:', response.data.code);
                            
                            const errorMsg = response.data.error || 'GeÃ§ersiz istek';
                            this.showToast(`âŒ ${errorMsg}`);
                            
                        } else if (response.status === 401) {
                            // Unauthorized
                            console.error('âŒ 401 UNAUTHORIZED - Oturum geÃ§ersiz');
                            this.showToast('âŒ Oturumunuz sonlanmÄ±ÅŸ. LÃ¼tfen tekrar giriÅŸ yapÄ±n.');
                            setTimeout(() => this.logout(), 2000);
                            
                        } else if (response.status === 403) {
                            // Forbidden
                            console.error('âŒ 403 FORBIDDEN - Hesap kÄ±sÄ±tlÄ±');
                            const errorMsg = response.data.error || 'Bu iÅŸlem iÃ§in yetkiniz yok';
                            this.showToast(`âŒ ${errorMsg}`);
                            
                        } else if (response.status === 413) {
                            // Payload Too Large
                            console.error('âŒ 413 PAYLOAD TOO LARGE');
                            this.showToast('âŒ Dosya Ã§ok bÃ¼yÃ¼k. LÃ¼tfen daha kÃ¼Ã§Ã¼k bir dosya seÃ§in (maks. 50MB)');
                            
                        } else if (response.status === 503) {
                            // Service Unavailable
                            console.error('âŒ 503 SERVICE UNAVAILABLE');
                            this.showToast('âŒ Sunucu hazÄ±rlanÄ±yor. LÃ¼tfen 10 saniye sonra tekrar deneyin.');
                            
                        } else {
                            // DiÄŸer hatalar
                            console.error(`âŒ HTTP ${response.status}: ${response.statusText}`);
                            console.error('   Data:', response.data);
                            
                            const errorMsg = response.data?.error || `Sunucu hatasÄ± (${response.status})`;
                            this.showToast(`âŒ ${errorMsg}`);
                        }
                        
                    } catch (error) {
                        console.error('\nâŒâŒâŒ AXIOS HATASI âŒâŒâŒ');
                        console.error('Error Type:', error.name);
                        console.error('Error Message:', error.message);
                        
                        if (error.response) {
                            // Sunucu hata response'u dÃ¶ndÃ¼
                            console.error('â”â”â” SERVER RESPONSE ERROR â”â”â”');
                            console.error('Status:', error.response.status);
                            console.error('Status Text:', error.response.statusText);
                            console.error('Headers:', error.response.headers);
                            console.error('Data:', error.response.data);
                            
                            const errorMsg = error.response.data?.error || 
                                           error.response.data?.message || 
                                           `Sunucu hatasÄ± (${error.response.status})`;
                            this.showToast(`âŒ ${errorMsg}`);
                            
                        } else if (error.request) {
                            // Ä°stek gÃ¶nderildi ama yanÄ±t alÄ±namadÄ±
                            console.error('â”â”â” NO RESPONSE FROM SERVER â”â”â”');
                            console.error('Request:', error.request);
                            this.showToast('âŒ Sunucuya ulaÅŸÄ±lamÄ±yor. Ä°nternet baÄŸlantÄ±nÄ±zÄ± kontrol edin.');
                            
                        } else if (error.code === 'ECONNABORTED') {
                            // Timeout
                            console.error('â”â”â” REQUEST TIMEOUT â”â”â”');
                            this.showToast('âŒ Ä°stek zaman aÅŸÄ±mÄ±na uÄŸradÄ±. LÃ¼tfen tekrar deneyin.');
                            
                        } else {
                            // Ä°stek hazÄ±rlanÄ±rken hata
                            console.error('â”â”â” REQUEST SETUP ERROR â”â”â”');
                            console.error('Error:', error);
                            this.showToast(`âŒ Ä°stek hatasÄ±: ${error.message}`);
                        }
                        
                    } finally {
                        console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
                        console.log('ðŸ POST GÃ–NDERME TAMAMLANDI');
                        console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n');
                        
                        this.loading = false;
                        this.isUploading = false;
                        this.uploadProgress = 0;
                    }
                },

                async likePost(post) {
                    post.isLiked = !post.isLiked;
                    post.likeCount = (post.likeCount || 0) + (post.isLiked ? 1 : -1);
                    try {
                        await axios.post(`/api/posts/${post.id}/like`);
                    } catch (e) {
                        post.isLiked = !post.isLiked;
                        post.likeCount = (post.likeCount || 0) + (post.isLiked ? 1 : -1);
                    }
                },

                async savePost(post) {
                    post.isSaved = !post.isSaved;
                    try {
                        await axios.post(`/api/posts/${post.id}/save`);
                        this.showToast(post.isSaved ? "Kaydedildi" : "KayÄ±ttan kaldÄ±rÄ±ldÄ±");
                    } catch (e) {
                        post.isSaved = !post.isSaved;
                        this.showToast("Ä°ÅŸlem baÅŸarÄ±sÄ±z");
                    }
                },

                async sharePost(post) {
                    try {
                        await axios.post(`/api/stories/share/${post.id}`);
                        this.showToast("Hikayeye paylaÅŸÄ±ldÄ±!");
                    } catch (e) {
                        this.showToast("PaylaÅŸÄ±lamadÄ±");
                    }
                },
                
                // Video hata yÃ¶netimi
                handleVideoError(event, post) {
                    console.log('Video yÃ¼klenemedi:', post.mediaUrl);
                    // Alternatif URL dene
                    if (post.media && !event.target.src.includes(post.media)) {
                        event.target.src = post.media;
                    }
                },

                // ============ POLLS ============
                async votePoll(post, optionIndex) {
                    try {
                        await axios.post(`/api/posts/${post.id}/vote`, { optionIndex });
                        const res = await axios.get(`/api/posts/${post.id}`);
                        const idx = this.feed.findIndex(p => p.id === post.id);
                        if (idx !== -1 && res.data.post) {
                            this.feed[idx] = { ...this.feed[idx], ...res.data.post };
                        }
                        this.showToast('âœ… Oyunuz kaydedildi');
                    } catch (e) {
                        console.error('Poll vote error:', e);
                        this.showToast(e.response?.data?.error || "âŒ Oy verilemedi");
                    }
                },

                // Anket yÃ¼zdesi hesaplama - Daha yakÄ±n ve gerÃ§ekÃ§i tahminler
                getPollPercentage(post, optionIndex) {
                    try {
                        const options = JSON.parse(post.pollOptions || '[]');
                        const totalVotes = options.reduce((sum, opt) => sum + (opt.votes || 0), 0);
                        if (totalVotes === 0) {
                            // Oy yoksa eÅŸit daÄŸÄ±lÄ±m tahmini (daha gerÃ§ekÃ§i)
                            return Math.round(100 / options.length);
                        }
                        // Kesirli hesaplama, yuvarlamadan Ã¶nce
                        const exactPercentage = ((options[optionIndex].votes || 0) / totalVotes) * 100;
                        // Daha hassas yuvarlama (1 ondalÄ±k basamak)
                        return Math.round(exactPercentage * 10) / 10;
                    } catch { return 0; }
                },

                getTotalVotes(post) {
                    try {
                        const options = JSON.parse(post.pollOptions || '[]');
                        return options.reduce((sum, opt) => sum + (opt.votes || 0), 0);
                    } catch { return 0; }
                },

                // ============ COMMENTS ============
                async openComments(post) {
                    this.activePostId = post.id;
                    this.showCommentModal = true;
                    try {
                        const res = await axios.get(`api/posts/${post.id}/comments`);
                        this.activeComments = res.data.comments || [];
                    } catch (e) { 
                        console.error(e); 
                    }
                },

                async submitComment() {
                    if (!this.commentInput.trim()) return;
                    try {
                        // XSS korumasÄ± uygula
                        const sanitizedContent = window.sanitizeInput ? window.sanitizeInput(this.commentInput) : this.commentInput;
                        await axios.post(`/api/posts/${this.activePostId}/comments`, { content: sanitizedContent });
                        this.commentInput = '';
                        this.openComments({ id: this.activePostId });
                        
                        const post = this.feed.find(p => p.id === this.activePostId);
                        if (post) post.commentCount = (post.commentCount || 0) + 1;
                    } catch (e) { 
                        this.showToast("Yorum gÃ¶nderilemedi"); 
                    }
                },
                
                // Yorum Silme
                async deleteComment(comment) {
                    if (!confirm('Bu yorumu silmek istediÄŸinize emin misiniz?')) return;
                    
                    try {
                        await axios.delete(`api/comments/${comment.id}`);
                        this.activeComments = this.activeComments.filter(c => c.id !== comment.id);
                        
                        const post = this.feed.find(p => p.id === this.activePostId);
                        if (post) post.commentCount = Math.max(0, (post.commentCount || 0) - 1);
                        
                        this.showToast("Yorum silindi");
                    } catch (e) {
                        this.showToast("Yorum silinemedi");
                    }
                },

                // ============ STORIES ============
                async loadStories() {
                    try {
                        const res = await axios.get('/api/stories');
                        this.stories = res.data.stories || [];
                        this.myStories = res.data.myStories || [];
                        console.log('Hikayeler yÃ¼klendi:', { stories: this.stories, myStories: this.myStories });
                    } catch (e) { 
                        console.error('Hikayeler yÃ¼klenemedi:', e); 
                    }
                },

                handleStoryMedia(e) {
                    const file = e.target.files[0];
                    if (!file) return;
                    
                    // Dosya boyutu kontrolÃ¼ - 50MB (52428800 bytes)
                    const maxSize = 50 * 1024 * 1024; // 52428800 bytes
                    const fileSizeMB = (file.size / 1024 / 1024).toFixed(2);
                    
                    if (file.size > maxSize) {
                        this.showToast(`âŒ Dosya Ã§ok bÃ¼yÃ¼k: ${fileSizeMB}MB. Maksimum 50MB olabilir.`);
                        e.target.value = ''; // Input'u temizle
                        return;
                    }
                    
                    console.log(`âœ… Story dosya boyutu OK: ${fileSizeMB}MB / 50MB`);
                    
                    this.storyForm.media = file;
                    this.storyForm.preview = URL.createObjectURL(file);
                    this.storyForm.mediaType = file.type.startsWith('video/') ? 'video' : 'image';
                },

                async submitStory() {
                    if (!this.storyForm.media) return;
                    this.loading = true;
                    try {
                        const fd = new FormData();
                        fd.append('media', this.storyForm.media);
                        // XSS korumasÄ± uygula
                        if (this.storyForm.text) {
                            const sanitizedText = window.sanitizeInput ? window.sanitizeInput(this.storyForm.text) : this.storyForm.text;
                            fd.append('text', sanitizedText);
                        }
                        
                        const res = await axios.post('/api/stories', fd);
                        console.log('Hikaye eklendi:', res.data);
                        this.showStoryModal = false;
                        this.storyForm = { media: null, preview: '', text: '', mediaType: null };
                        await this.loadStories();
                        this.showToast("Hikaye paylaÅŸÄ±ldÄ±!");
                    } catch (e) { 
                        console.error('Hikaye ekleme hatasÄ±:', e);
                        this.showToast(e.response?.data?.error || "Hikaye paylaÅŸÄ±lamadÄ±"); 
                    } finally { 
                        this.loading = false; 
                    }
                },

                async viewStory(story, storyGroup = null) {
                    console.log('Hikaye gÃ¶rÃ¼ntÃ¼leniyor:', story);
                    this.activeStory = story;
                    this.currentStoryGroup = storyGroup;
                    if (storyGroup && storyGroup.stories) {
                        this.currentStoryIndex = storyGroup.stories.findIndex(s => s.id === story.id);
                    } else {
                        this.currentStoryIndex = 0;
                    }
                    this.showStoryViewer = true;
                    try {
                        await axios.post(`/api/stories/${story.id}/view`);
                        story.watched = true;
                        console.log('Hikaye gÃ¶rÃ¼ntÃ¼leme kaydedildi:', story.id);
                    } catch (e) { 
                        console.error('Hikaye gÃ¶rÃ¼ntÃ¼leme hatasÄ±:', e);
                    }
                },
                
                // Sonraki hikayeye geÃ§
                nextStory() {
                    if (this.currentStoryGroup && this.currentStoryGroup.stories) {
                        const stories = this.currentStoryGroup.stories;
                        if (this.currentStoryIndex < stories.length - 1) {
                            this.currentStoryIndex++;
                            this.activeStory = stories[this.currentStoryIndex];
                            axios.post(`/api/stories/${this.activeStory.id}/view`).catch(() => {});
                        } else {
                            // Grup bitti, kapat
                            this.showStoryViewer = false;
                            this.activeStory = null;
                            this.currentStoryGroup = null;
                        }
                    } else {
                        this.showStoryViewer = false;
                        this.activeStory = null;
                    }
                },
                
                // Ã–nceki hikayeye dÃ¶n
                prevStory() {
                    if (this.currentStoryGroup && this.currentStoryGroup.stories) {
                        const stories = this.currentStoryGroup.stories;
                        if (this.currentStoryIndex > 0) {
                            this.currentStoryIndex--;
                            this.activeStory = stories[this.currentStoryIndex];
                        }
                    }
                },
                
                viewStoryGroup(storyGroup) {
                    if (storyGroup.stories && storyGroup.stories.length > 0) {
                        this.viewStory(storyGroup.stories[0], storyGroup);
                    } else {
                        // Tek hikaye
                        this.activeStory = {
                            ...storyGroup,
                            username: storyGroup.username,
                            profilePic: storyGroup.profilePic
                        };
                        this.showStoryViewer = true;
                    }
                },

                // ============ PRODUCTS ============
                async loadProducts() {
                    try {
                        const res = await axios.get('/api/store/products');
                        this.products = res.data.products || res.data || [];
                    } catch (e) { 
                        console.error(e); 
                    }
                },

                handleProductImage(e) {
                    const files = Array.from(e.target.files);
                    if (!files.length) return;
                    
                    // En fazla 5 fotoÄŸraf kontrolÃ¼
                    const remainingSlots = 5 - this.productForm.images.length;
                    const filesToAdd = files.slice(0, remainingSlots);
                    
                    filesToAdd.forEach(file => {
                        this.productForm.images.push({
                            file: file,
                            preview: URL.createObjectURL(file)
                        });
                    });
                    
                    // Ana gÃ¶rseli ilk fotoÄŸraf olarak ayarla
                    if (this.productForm.images.length > 0 && !this.productForm.preview) {
                        this.productForm.image = this.productForm.images[0].file;
                        this.productForm.preview = this.productForm.images[0].preview;
                    }
                },
                
                removeProductImage(index) {
                    this.productForm.images.splice(index, 1);
                    // Ana gÃ¶rseli gÃ¼ncelle
                    if (this.productForm.images.length > 0) {
                        this.productForm.image = this.productForm.images[0].file;
                        this.productForm.preview = this.productForm.images[0].preview;
                    } else {
                        this.productForm.image = null;
                        this.productForm.preview = '';
                    }
                },

                async addProduct() {
                    if (!this.productForm.name || !this.productForm.price) {
                        this.showToast("Ä°sim ve fiyat gerekli");
                        return;
                    }
                    this.loading = true;
                    try {
                        const fd = new FormData();
                        // XSS korumasÄ± uygula
                        fd.append('name', window.sanitizeInput ? window.sanitizeInput(this.productForm.name) : this.productForm.name);
                        fd.append('price', this.productForm.price);
                        fd.append('description', window.sanitizeInput ? window.sanitizeInput(this.productForm.description) : this.productForm.description);
                        fd.append('category', this.productForm.category || '');
                        fd.append('stock', this.productForm.stock || 1);
                        
                        // TÃ¼m fotoÄŸraflarÄ± ekle
                        this.productForm.images.forEach((img, index) => {
                            fd.append(`images`, img.file);
                        });
                        
                        // Ana gÃ¶rseli de ekle (geriye uyumluluk iÃ§in)
                        if (this.productForm.image) fd.append('image', this.productForm.image);

                        await axios.post('/api/store/products', fd);
                        this.showAddProduct = false;
                        this.productForm = { name: '', price: '', description: '', image: null, preview: '', images: [], category: '', stock: 1 };
                        this.loadProducts();
                        this.showToast("ÃœrÃ¼n eklendi!");
                    } catch (e) { 
                        this.showToast(e.response?.data?.error || "Hata oluÅŸtu"); 
                    } finally { 
                        this.loading = false; 
                    }
                },
                
                // ÃœrÃ¼n silme
                async deleteProduct(product) {
                    if (!confirm('Bu Ã¼rÃ¼nÃ¼ silmek istediÄŸinize emin misiniz?')) return;
                    
                    try {
                        await axios.delete(`api/store/products/${product.id}`);
                        this.products = this.products.filter(p => p.id !== product.id);
                        this.showToast("ÃœrÃ¼n silindi");
                    } catch (e) {
                        this.showToast("ÃœrÃ¼n silinemedi");
                    }
                },

                // ============ MESSAGES (CANLI SOHBET) ============
                async loadConversations() {
                    try {
                        const res = await axios.get('/api/messages/conversations');
                        this.conversations = res.data.conversations || [];
                    } catch (e) { 
                        console.error(e); 
                    }
                },

                async openChat(conv) {
                    const otherUserId = conv.userId || conv.recipientId || conv.id;
                    if (!otherUserId) {
                        this.showToast("KullanÄ±cÄ± bilgisi bulunamadÄ±");
                        return;
                    }
                    this.activeChat = {
                        otherId: otherUserId,
                        name: conv.name || conv.recipientName || conv.username,
                        profilePic: conv.profilePic || conv.recipientProfilePic,
                        isOnline: conv.isOnline || conv.online
                    };
                    this.showChatModal = true;
                    this.chatMessages = [];
                    
                    try {
                        const res = await axios.get(`/api/messages/${this.activeChat.otherId}`);
                        this.chatMessages = res.data.messages || [];
                        this.scrollToBottom();
                    } catch (e) { 
                        console.error(e); 
                        this.showToast("Mesajlar yÃ¼klenirken hata oluÅŸtu");
                    }
                },
                
                async deleteConversation(conv) {
                    if (!confirm('Bu konuÅŸmayÄ± silmek istediÄŸinize emin misiniz?')) return;
                    
                    const otherUserId = conv.userId || conv.recipientId || conv.id;
                    if (!otherUserId) {
                        this.showToast("KullanÄ±cÄ± bilgisi bulunamadÄ±");
                        return;
                    }
                    
                    try {
                        await axios.delete(`/api/messages/conversation/${otherUserId}`);
                        this.conversations = this.conversations.filter(c => 
                            (c.userId || c.recipientId || c.id) !== otherUserId
                        );
                        this.showToast("KonuÅŸma silindi!");
                    } catch (e) {
                        console.error(e);
                        this.showToast(e.response?.data?.error || "KonuÅŸma silinirken hata oluÅŸtu");
                    }
                },

                async sendMessage() {
                    if (!this.messageInput.trim()) return;
                    if (!this.activeChat.otherId) {
                        this.showToast("Sohbet bilgisi eksik");
                        return;
                    }
                    
                    // XSS korumasÄ± uygula
                    const content = window.sanitizeInput ? window.sanitizeInput(this.messageInput) : this.messageInput;
                    this.messageInput = '';
                    
                    // Optimistic update
                    const tempId = Date.now();
                    this.chatMessages.push({
                        id: tempId,
                        senderId: this.user.id,
                        senderName: this.user.name,
                        senderProfilePic: this.user.profilePic,
                        content: content,
                        type: 'text',
                        createdAt: new Date().toISOString()
                    });
                    this.scrollToBottom();
                    
                    try {
                        const res = await axios.post('/api/messages', {
                            recipientId: this.activeChat.otherId,
                            content: content
                        });
                        // Update temp message with real id
                        const idx = this.chatMessages.findIndex(m => m.id === tempId);
                        if (idx !== -1) {
                            this.chatMessages[idx].id = res.data.messageId;
                        }
                    } catch (e) { 
                        this.showToast("Mesaj gÃ¶nderilemedi: " + (e.response?.data?.error || "Bilinmeyen hata"));
                        // Remove failed message
                        this.chatMessages = this.chatMessages.filter(m => m.id !== tempId);
                    }
                },
                
                // DM Ã¼zerinden post paylaÅŸma
                async sharePostInDM(post) {
                    if (!this.activeChat.otherId) {
                        this.showToast("Ã–nce bir sohbet seÃ§in");
                        return;
                    }
                    
                    try {
                        await axios.post('/api/messages/share-post', {
                            postId: post.id,
                            recipientId: this.activeChat.otherId
                        });
                        
                        // Optimistic update
                        this.chatMessages.push({
                            id: Date.now(),
                            senderId: this.user.id,
                            senderName: this.user.name,
                            senderProfilePic: this.user.profilePic,
                            content: `ðŸ“· PaylaÅŸÄ±lan gÃ¶nderi: ${post.content?.substring(0, 50) || 'GÃ¶rsel'}...`,
                            type: 'post_share',
                            postId: post.id,
                            createdAt: new Date().toISOString()
                        });
                        this.scrollToBottom();
                        this.showToast("GÃ¶nderi paylaÅŸÄ±ldÄ±");
                    } catch (e) {
                        this.showToast("GÃ¶nderi paylaÅŸÄ±lamadÄ±");
                    }
                },
                
                // DM Ã¼zerinden gÃ¶rsel mesaj gÃ¶nderme
                async sendImageMessage(event) {
                    const file = event.target.files[0];
                    if (!file) return;
                    if (!this.activeChat.otherId) {
                        this.showToast("Sohbet bilgisi eksik");
                        return;
                    }
                    
                    const formData = new FormData();
                    formData.append('image', file);
                    formData.append('recipientId', this.activeChat.otherId);
                    
                    // Optimistic update
                    const tempId = Date.now();
                    const previewUrl = URL.createObjectURL(file);
                    this.chatMessages.push({
                        id: tempId,
                        senderId: this.user.id,
                        senderName: this.user.name,
                        senderProfilePic: this.user.profilePic,
                        content: previewUrl,
                        type: 'image',
                        isUploading: true,
                        createdAt: new Date().toISOString()
                    });
                    this.scrollToBottom();
                    
                    try {
                        const res = await axios.post('/api/messages/image', formData, {
                            headers: { 'Content-Type': 'multipart/form-data' }
                        });
                        
                        const idx = this.chatMessages.findIndex(m => m.id === tempId);
                        if (idx !== -1) {
                            this.chatMessages[idx].id = res.data.messageId;
                            this.chatMessages[idx].isUploading = false;
                        }
                    } catch (e) {
                        this.showToast("GÃ¶rsel gÃ¶nderilemedi");
                        this.chatMessages = this.chatMessages.filter(m => m.id !== tempId);
                    }
                },
                
                // DM Ã¼zerinden sesli mesaj gÃ¶nderme (demo)
                async sendVoiceMessageDemo() {
                    this.showToast("ðŸ”Š Sesli mesaj Ã¶zelliÄŸi demo modunda!");
                    
                    // Demo iÃ§in sahte sesli mesaj ekle
                    this.chatMessages.push({
                        id: Date.now(),
                        senderId: this.user.id,
                        senderName: this.user.name,
                        senderProfilePic: this.user.profilePic,
                        content: 'ðŸ”Š Sesli mesaj (0:05)',
                        type: 'voice',
                        duration: 5,
                        createdAt: new Date().toISOString()
                    });
                    this.scrollToBottom();
                },

                scrollToBottom() {
                    setTimeout(() => {
                        const el = document.getElementById('chatMessages');
                        if (el) el.scrollTop = el.scrollHeight;
                    }, 100);
                },

                startChatWithSeller(item) {
                    if (!item || !item.sellerId) {
                        this.showToast("SatÄ±cÄ± bilgisi bulunamadÄ±");
                        return;
                    }
                    this.openChat({
                        userId: item.sellerId,
                        name: item.sellerName || item.sellerFullName,
                        profilePic: item.sellerProfilePic
                    });
                },
                
                openProductDetail(item) {
                    this.selectedProduct = item;
                    this.currentProductImageIndex = 0;
                    
                    // GÃ¶rselleri hazÄ±rla
                    this.selectedProductImages = [];
                    if (item.images && Array.isArray(item.images)) {
                        this.selectedProductImages = item.images;
                    } else if (item.image) {
                        this.selectedProductImages = [item.image];
                    }
                    
                    this.showProductDetail = true;
                },
                
                async deleteProduct(productId) {
                    if (!confirm('Bu Ã¼rÃ¼nÃ¼ silmek istediÄŸinize emin misiniz?')) return;
                    
                    try {
                        await axios.delete(`/api/store/products/${productId}`);
                        this.showProductDetail = false;
                        this.selectedProduct = null;
                        this.loadProducts();
                        this.showToast("ÃœrÃ¼n silindi!");
                    } catch (e) {
                        this.showToast(e.response?.data?.error || "ÃœrÃ¼n silinirken hata oluÅŸtu");
                    }
                },
                
                shareProduct(product) {
                    if (navigator.share) {
                        navigator.share({
                            title: product.name,
                            text: `${product.name} - ${product.price} â‚º`,
                            url: window.location.href
                        });
                    } else {
                        // Kopyala
                        const text = `${product.name} - ${product.price} â‚º`;
                        navigator.clipboard.writeText(text).then(() => {
                            this.showToast("ÃœrÃ¼n bilgisi kopyalandÄ±!");
                        });
                    }
                },

                startChatWithUser(user) {
                    this.showUserProfile = false;
                    this.openChat({
                        userId: user.id,
                        name: user.name,
                        profilePic: user.profilePic
                    });
                },

                startVoiceRecord() {
                    // GerÃ§ek ses kaydÄ± baÅŸlat
                    if (this.isRecording) {
                        this.stopVoiceRecord();
                        return;
                    }
                    
                    // Ses kaydÄ± iÃ§in permission iste ve kayda baÅŸla
                    navigator.mediaDevices.getUserMedia({ audio: true })
                        .then(stream => {
                            this.mediaRecorder = new MediaRecorder(stream);
                            this.recordedChunks = [];
                            this.voiceDuration = 0;
                            
                            this.mediaRecorder.ondataavailable = (e) => {
                                if (e.data.size > 0) {
                                    this.recordedChunks.push(e.data);
                                }
                            };
                            
                            this.mediaRecorder.onstop = () => {
                                const blob = new Blob(this.recordedChunks, { type: 'audio/webm' });
                                this.voicePreview = URL.createObjectURL(blob);
                                this.voiceBlob = blob;
                            };
                            
                            this.mediaRecorder.start();
                            this.isRecording = true;
                            
                            // SÃ¼re sayacÄ±
                            this.recordingTimer = setInterval(() => {
                                this.voiceDuration++;
                                if (this.voiceDuration >= 60) {
                                    this.stopVoiceRecord();
                                }
                            }, 1000);
                        })
                        .catch(err => {
                            console.error('Mikrofon eriÅŸim hatasÄ±:', err);
                            this.showToast('Mikrofona eriÅŸilemedi');
                        });
                },

                playVoiceMessage(msg) {
                    msg.isPlaying = !msg.isPlaying;
                },
                
                // Mesaj Silme
                async deleteMessage(msg) {
                    if (!confirm('Bu mesajÄ± silmek istediÄŸinize emin misiniz?')) return;
                    
                    try {
                        await axios.delete(`api/messages/${msg.id}`);
                        msg.isDeleted = true;
                        this.showToast("Mesaj silindi");
                    } catch (e) {
                        this.showToast("Mesaj silinemedi");
                    }
                },
                
                // ============ GÃ–RSEL MESAJ YARDIMCI FONKSÄ°YONLAR ============
                // Mesaj iÃ§indeki URL'in gÃ¶rsel olup olmadÄ±ÄŸÄ±nÄ± kontrol et
                isImageUrl(content) {
                    if (!content || typeof content !== 'string') return false;
                    // Sunucu URL'lerini veya http URL'lerini kontrol et
                    return content.startsWith('/uploads/') || 
                           content.startsWith('http') && (
                               content.includes('.jpg') || 
                               content.includes('.jpeg') || 
                               content.includes('.png') || 
                               content.includes('.gif') || 
                               content.includes('.webp')
                           );
                },
                
                // Mesaj gÃ¶rselinin URL'ini al
                getMessageImageUrl(msg) {
                    // Ã–ncelik: mediaUrl > content (eÄŸer URL ise)
                    if (msg.mediaUrl) return msg.mediaUrl;
                    if (msg.content && this.isImageUrl(msg.content)) return msg.content;
                    if (msg.content && msg.content.startsWith('blob:')) return msg.content; // GeÃ§ici blob URL
                    return null;
                },
                
                // GÃ¶rsel yÃ¼klenemezse fallback
                handleMessageImageError(event, msg) {
                    console.log('GÃ¶rsel yÃ¼klenemedi:', msg.content);
                    // Alternatif URL dene
                    if (msg.content && !event.target.src.includes(msg.content)) {
                        event.target.src = msg.content;
                    } else {
                        event.target.style.display = 'none';
                    }
                },
                
                // Verified Badge Info
                showVerifiedInfo() {
                    this.showToast("Bu hesap resmi olarak doÄŸrulanmÄ±ÅŸtÄ±r âœ“");
                },
                
                // Ã‡iftÃ§i rozeti bilgisi
                showFarmerBadgeInfo() {
                    this.showToast("ðŸŒ¾ Ã‡iftÃ§i YÃ¼ksek EtkileÅŸim Rozeti - Bu kullanÄ±cÄ± aktif bir Ã§iftÃ§i!");
                },
                
                // ============ VERÄ°FÄ°CATÄ°ON ============
                // Resim sÄ±kÄ±ÅŸtÄ±rma fonksiyonu
                async compressImage(file, maxWidth = 1200, quality = 0.8) {
                    return new Promise((resolve, reject) => {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            const img = new Image();
                            img.onload = () => {
                                const canvas = document.createElement('canvas');
                                let width = img.width;
                                let height = img.height;
                                
                                // Boyut kÃ¼Ã§Ã¼ltme
                                if (width > maxWidth) {
                                    height = (height * maxWidth) / width;
                                    width = maxWidth;
                                }
                                
                                canvas.width = width;
                                canvas.height = height;
                                
                                const ctx = canvas.getContext('2d');
                                ctx.drawImage(img, 0, 0, width, height);
                                
                                canvas.toBlob((blob) => {
                                    if (blob) {
                                        const compressedFile = new File([blob], file.name, {
                                            type: 'image/jpeg',
                                            lastModified: Date.now()
                                        });
                                        resolve(compressedFile);
                                    } else {
                                        reject(new Error('SÄ±kÄ±ÅŸtÄ±rma baÅŸarÄ±sÄ±z'));
                                    }
                                }, 'image/jpeg', quality);
                            };
                            img.onerror = reject;
                            img.src = e.target.result;
                        };
                        reader.onerror = reject;
                        reader.readAsDataURL(file);
                    });
                },
                
                async handleVerificationImage(e, side) {
                    const file = e.target.files[0];
                    if (!file) return;
                    
                    // Dosya boyutu kontrolÃ¼ - 10MB Ã¼zeriyse sÄ±kÄ±ÅŸtÄ±r
                    let processedFile = file;
                    if (file.size > 10 * 1024 * 1024) {
                        this.showToast("Resim sÄ±kÄ±ÅŸtÄ±rÄ±lÄ±yor...");
                        try {
                            processedFile = await this.compressImage(file, 1200, 0.7);
                            this.showToast("Resim sÄ±kÄ±ÅŸtÄ±rÄ±ldÄ± âœ“");
                        } catch (err) {
                            this.showToast("Daha kÃ¼Ã§Ã¼k boyutlu bir resim seÃ§in (max 10MB)");
                            return;
                        }
                    } else if (file.size > 5 * 1024 * 1024) {
                        // 5-10MB arasÄ± iÃ§in hafif sÄ±kÄ±ÅŸtÄ±rma
                        try {
                            processedFile = await this.compressImage(file, 1500, 0.85);
                        } catch (err) {
                            // SÄ±kÄ±ÅŸtÄ±rma baÅŸarÄ±sÄ±z olursa orijinal dosyayÄ± kullan
                            processedFile = file;
                        }
                    }
                    
                    if (side === 'front') {
                        this.verificationForm.frontImage = processedFile;
                        this.verificationForm.frontPreview = URL.createObjectURL(processedFile);
                    } else {
                        this.verificationForm.backImage = processedFile;
                        this.verificationForm.backPreview = URL.createObjectURL(processedFile);
                    }
                },
                
                async submitVerificationRequest() {
                    if (!this.verificationForm.name || !this.verificationForm.surname || !this.verificationForm.frontImage || !this.verificationForm.backImage) {
                        this.showToast("TÃ¼m alanlarÄ± doldurun");
                        return;
                    }
                    this.loading = true;
                    try {
                        const fd = new FormData();
                        fd.append('name', this.verificationForm.name);
                        fd.append('surname', this.verificationForm.surname);
                        fd.append('frontImage', this.verificationForm.frontImage);
                        fd.append('backImage', this.verificationForm.backImage);
                        
                        await axios.post('/api/verification/request', fd);
                        this.showVerificationModal = false;
                        this.verificationForm = { name: '', surname: '', frontImage: null, frontPreview: '', backImage: null, backPreview: '' };
                        this.showToast("BaÅŸvurunuz alÄ±ndÄ±! Ä°nceleniyor... ðŸ“§");
                    } catch (e) {
                        this.showToast(e.response?.data?.error || "BaÅŸvuru gÃ¶nderilemedi");
                    } finally {
                        this.loading = false;
                    }
                },
                
                // ============ MESSAGE IMAGE (Ana fonksiyon yukarÄ±da sendImageMessage olarak tanÄ±mlÄ±) ============

                // ============ NOTIFICATIONS ============
                async loadNotifications() {
                    try {
                        const res = await axios.get('/api/notifications');
                        this.notifications = res.data.notifications || [];
                        this.unreadNotifs = res.data.unreadCount || 0;
                    } catch (e) { 
                        console.error(e); 
                    }
                },

                async markAllNotificationsRead() {
                    try {
                        await axios.post('/api/notifications/read');
                        this.notifications.forEach(n => n.read = true);
                        this.unreadNotifs = 0;
                    } catch (e) { }
                },

                handleNotificationClick(notif) {
                    if (!notif.read) {
                        axios.post('/api/notifications/read', { ids: [notif.id] });
                        notif.read = true;
                        this.unreadNotifs = Math.max(0, this.unreadNotifs - 1);
                    }
                    
                    const data = notif.data || {};
                    if (notif.type === 'follow' && data.followerId) {
                        this.viewProfile(data.followerId);
                    } else if (notif.type === 'like' && data.postId) {
                        // Post'a scroll
                    } else if (notif.type === 'comment' && data.postId) {
                        this.openComments({ id: data.postId });
                    }
                },

                getNotifIcon(type) {
                    const icons = {
                        like: { icon: 'fas fa-heart', bg: 'bg-red-500' },
                        comment: { icon: 'fas fa-comment', bg: 'bg-blue-500' },
                        follow: { icon: 'fas fa-user-plus', bg: 'bg-emerald-500' },
                        post: { icon: 'fas fa-image', bg: 'bg-purple-500' },
                        message: { icon: 'fas fa-envelope', bg: 'bg-orange-500' },
                        message_like: { icon: 'fas fa-heart', bg: 'bg-pink-500' }
                    };
                    return icons[type] || { icon: 'fas fa-bell', bg: 'bg-slate-500' };
                },
                
                // Bildirimde takipÃ§i profil resmi
                getNotifUserPic(notif) {
                    if (notif.data?.followerProfilePic) return notif.data.followerProfilePic;
                    if (notif.data?.followerUsername) return `https://ui-avatars.com/api/?name=${notif.data.followerUsername}`;
                    return 'https://ui-avatars.com/api/?name=User';
                },

                // ============ PROFILE ============
                async loadStats() {
                    try {
                        const res = await axios.get(`api/users/${this.user.id}/stats`);
                        this.userStats = res.data || {};
                    } catch (e) { 
                        console.error(e); 
                    }
                },

                async loadMyPosts() {
                    try {
                        // TÃœM POSTLARI Ã‡EK - sayfalama kaldÄ±rÄ±ldÄ±
                        const res = await axios.get(`api/users/${this.user.id}/posts?limit=1000`);
                        const posts = res.data.posts || [];
                        posts.forEach(post => {
                            if (post.media) {
                                const filename = post.media.split('/').pop();
                                if (post.mediaType === 'video') {
                                    post.mediaUrl = post.mediaUrl || `/uploads/videos/${filename}`;
                                } else {
                                    post.mediaUrl = post.mediaUrl || post.media;
                                }
                            }
                        });
                        this.myPosts = posts;
                        console.log('TÃ¼m postlar yÃ¼klendi:', posts.length);
                    } catch (e) { 
                        console.error('Postlar yÃ¼klenemedi:', e); 
                    }
                },
                
                // Kendi postumu sil
                async deleteMyPost(post) {
                    if (!confirm('Bu gÃ¶nderiyi silmek istediÄŸinize emin misiniz?')) return;
                    
                    try {
                        await axios.delete(`api/posts/${post.id}`);
                        this.myPosts = this.myPosts.filter(p => p.id !== post.id);
                        this.feed = this.feed.filter(p => p.id !== post.id);
                        this.showToast("GÃ¶nderi silindi");
                    } catch (e) {
                        this.showToast("GÃ¶nderi silinemedi");
                    }
                },

                previewEditAvatar(e) {
                    const file = e.target.files[0];
                    if (!file) return;
                    this.editForm.profilePicFile = file;
                    this.editForm.profilePic = URL.createObjectURL(file);
                },
                
                previewEditCover(e) {
                    const file = e.target.files[0];
                    if (!file) return;
                    this.editForm.coverPicFile = file;
                    this.editForm.coverPicPreview = URL.createObjectURL(file);
                },
                
                // Profil resmini kaldÄ±r
                async removeProfilePic() {
                    if (!confirm('Profil resminizi kaldÄ±rmak istediÄŸinize emin misiniz?')) return;
                    
                    this.loading = true;
                    try {
                        await axios.delete('/api/users/profile-pic');
                        this.user.profilePic = null;
                        this.editForm.profilePic = '';
                        this.editForm.profilePicFile = null;
                        // SecureStorage ile kaydet
                        this.SecureStorage.set('user', this.user);
                        this.showToast("Profil resmi kaldÄ±rÄ±ldÄ±");
                    } catch (e) {
                        // Demo mod - sunucu olmadan da Ã§alÄ±ÅŸsÄ±n
                        this.user.profilePic = null;
                        this.editForm.profilePic = '';
                        this.editForm.profilePicFile = null;
                        this.SecureStorage.set('user', this.user);
                        this.showToast("Profil resmi kaldÄ±rÄ±ldÄ±");
                    } finally {
                        this.loading = false;
                    }
                },

                async updateProfile() {
                    this.loading = true;
                    try {
                        const fd = new FormData();
                        // XSS korumasÄ± uygula
                        fd.append('name', window.sanitizeInput ? window.sanitizeInput(this.editForm.name) : this.editForm.name);
                        fd.append('email', window.sanitizeInput ? window.sanitizeInput(this.editForm.email) : this.editForm.email);
                        // HESAP TÄ°PÄ° DÃœZELTÄ°LDÄ° - boÅŸ string kontrolÃ¼
                        if (this.editForm.userType) {
                            fd.append('userType', this.editForm.userType);
                        }
                        fd.append('bio', window.sanitizeInput ? window.sanitizeInput(this.editForm.bio) : this.editForm.bio);
                        fd.append('location', window.sanitizeInput ? window.sanitizeInput(this.editForm.location) : this.editForm.location);
                        fd.append('website', window.sanitizeInput ? window.sanitizeInput(this.editForm.website) : this.editForm.website);
                        if (this.editForm.profilePicFile) {
                            fd.append('profilePic', this.editForm.profilePicFile);
                        }
                        if (this.editForm.coverPicFile) {
                            fd.append('coverPic', this.editForm.coverPicFile);
                        }

                        const res = await axios.put('/api/users/profile', fd);
                        const updatedUser = res.data.user;
                        
                        // User objesini gÃ¼ncelle - userType dahil
                        this.user = { 
                            ...this.user, 
                            ...updatedUser,
                            userType: updatedUser.userType || this.editForm.userType // userType'Ä± koru
                        };
                        // SecureStorage ile kaydet
                        this.SecureStorage.set('user', this.user);
                        
                        this.showEditModal = false;
                        this.showToast("Profil gÃ¼ncellendi!");
                    } catch (e) { 
                        this.showToast(e.response?.data?.error || "Hata oluÅŸtu"); 
                    } finally { 
                        this.loading = false; 
                    }
                },

                async loadSavedPosts() {
                    try {
                        const res = await axios.get('/api/posts/saved');
                        this.savedPostsList = res.data.posts || [];
                        console.log('Kaydedilen gÃ¶nderiler:', this.savedPostsList);
                    } catch (e) { 
                        console.error('Kaydedilen gÃ¶nderiler yÃ¼klenemedi:', e);
                        this.savedPostsList = [];
                    }
                },
                
                // Engellenen hesaplarÄ± yÃ¼kle
                async loadBlockedAccounts() {
                    try {
                        const res = await axios.get('/api/users/blocked');
                        this.blockedAccountsList = res.data.blockedUsers || [];
                        console.log('Engellenen hesaplar:', this.blockedAccountsList);
                    } catch (e) {
                        console.error('Engellenen hesaplar yÃ¼klenemedi:', e);
                        this.blockedAccountsList = [];
                    }
                },
                
                // KullanÄ±cÄ±nÄ±n engelini kaldÄ±r - DEMO DESTEKLÄ°
                async unblockUser(userId) {
                    try {
                        await axios.post(`/api/users/${userId}/unblock`);
                        this.blockedAccountsList = this.blockedAccountsList.filter(u => u.id !== userId);
                        this.showToast("KullanÄ±cÄ±nÄ±n engeli kaldÄ±rÄ±ldÄ±");
                    } catch (e) {
                        // DEMO: Sunucu olmadan da Ã§alÄ±ÅŸsÄ±n
                        this.blockedAccountsList = this.blockedAccountsList.filter(u => u.id !== userId);
                        this.showToast("KullanÄ±cÄ±nÄ±n engeli kaldÄ±rÄ±ldÄ± (demo)");
                    }
                },

                // ============ CONNECTIONS ============
                async showConnections(type, userId = null) {
                    const targetUserId = userId || this.user.id;
                    this.connectionsType = type;
                    this.showConnectionsModal = true;
                    try {
                        const endpoint = type === 'followers' ? 'followers' : 'following';
                        const res = await axios.get(`api/users/${targetUserId}/${endpoint}`);
                        this.connectionsList = res.data[endpoint] || res.data.followers || res.data.following || [];
                    } catch (e) { 
                        console.error(e); 
                    }
                },
                
                // BaÅŸka kullanÄ±cÄ±nÄ±n takipÃ§ilerini gÃ¶ster
                async showUserConnections(type) {
                    if (this.viewedUser && this.viewedUser.id) {
                        await this.showConnections(type, this.viewedUser.id);
                    }
                },

                async toggleFollow(userId) {
                    if (typeof userId === 'object') userId = userId.id; // Eski conn object desteÄŸi
                    try {
                        const res = await axios.post(`/api/users/${userId}/follow`);
                        if (res.data.isFollowing) {
                            if (!this.followingIds.includes(userId)) {
                                this.followingIds.push(userId);
                            }
                        } else {
                            this.followingIds = this.followingIds.filter(id => id !== userId);
                        }
                        // Feed'deki post'u gÃ¼ncelle
                        this.feed.forEach(post => {
                            if (post.userId === userId) {
                                post.isFollowing = res.data.isFollowing;
                            }
                        });
                        this.showToast(res.data.isFollowing ? 'âœ… Takip edildi' : 'âŒ Takip bÄ±rakÄ±ldÄ±');
                    } catch (e) {
                        console.error('Toggle follow error:', e);
                    }
                },
                
                // KullanÄ±cÄ±nÄ±n takip edilip edilmediÄŸini kontrol et
                isFollowing(userId) {
                    return this.followingIds.includes(userId);
                },
                
                // ============ 2FA TOGGLE ============
                async toggle2FA() {
                    const newState = this.user.twoFactorEnabled === false ? true : false;
                    try {
                        await axios.post('/api/users/2fa/toggle', { enabled: newState });
                        this.user.twoFactorEnabled = newState;
                        this.SecureStorage.set('user', this.user);
                        this.showToast(newState ? '2FA aÃ§Ä±ldÄ± - GiriÅŸ yaparken e-posta doÄŸrulamasÄ± istenecek' : '2FA kapatÄ±ldÄ± - Direkt giriÅŸ yapabilirsiniz');
                    } catch (e) {
                        this.showToast('2FA ayarÄ± deÄŸiÅŸtirilemedi');
                    }
                },

                // ============ USER PROFILE ============
                async viewProfile(userId) {
                    if (userId === this.user.id) {
                        this.activeTab = 'profile';
                        this.searchQuery = '';
                        this.searchResults = [];
                        this.showUserProfile = false;
                        return;
                    }
                    
                    try {
                        const [userRes, statsRes, postsRes, mutualRes] = await Promise.all([
                            axios.get(`api/users/${userId}`),
                            axios.get(`api/users/${userId}/stats`),
                            axios.get(`api/users/${userId}/posts`),
                            axios.get(`api/users/${userId}/mutual-followers`).catch(() => ({ data: { mutualFollowers: [] } }))
                        ]);
                        
                        this.viewedUser = { 
                            ...userRes.data.user, 
                            ...statsRes.data,
                            isFollowing: !!userRes.data.user?.isFollowing || !!userRes.data.isFollowing 
                        };
                        
                        // Ortak takipÃ§iler
                        this.mutualFollowers = mutualRes.data.mutualFollowers || [];
                        
                        // KullanÄ±cÄ±nÄ±n postlarÄ±nÄ± iÅŸle
                        const posts = postsRes.data.posts || [];
                        posts.forEach(post => {
                            if (post.media) {
                                const filename = post.media.split('/').pop();
                                if (post.mediaType === 'video') {
                                    post.mediaUrl = post.mediaUrl || `/uploads/videos/${filename}`;
                                } else {
                                    post.mediaUrl = post.mediaUrl || post.media;
                                }
                            }
                        });
                        this.viewedUserPosts = posts;
                        
                        this.showUserProfile = true;
                        this.searchQuery = '';
                        this.searchResults = [];
                    } catch (e) { 
                        this.showToast("KullanÄ±cÄ± bulunamadÄ±"); 
                    }
                },
                
                // ========== KAPAK FOTOÄžRAFI ZOOM FONKSÄ°YONLARI ==========
                openCoverZoom(url) {
                    this.coverZoomUrl = url;
                    this.zoomLevel = 1;
                    this.showCoverZoom = true;
                },
                
                zoomIn() {
                    this.zoomLevel = Math.min(this.zoomLevel + 0.5, 4);
                },
                
                zoomOut() {
                    this.zoomLevel = Math.max(this.zoomLevel - 0.5, 1);
                },
                
                zoomReset() {
                    this.zoomLevel = 1;
                },
                
                handleZoomWheel(e) {
                    e.preventDefault();
                    if (e.deltaY < 0) {
                        this.zoomIn();
                    } else {
                        this.zoomOut();
                    }
                },
                
                handleTouchZoomStart(e) {
                    if (e.touches.length === 2) {
                        this.touchZoomDistance = Math.hypot(
                            e.touches[0].pageX - e.touches[1].pageX,
                            e.touches[0].pageY - e.touches[1].pageY
                        );
                    }
                },
                
                handleTouchZoomMove(e) {
                    if (e.touches.length === 2) {
                        e.preventDefault();
                        const newDistance = Math.hypot(
                            e.touches[0].pageX - e.touches[1].pageX,
                            e.touches[0].pageY - e.touches[1].pageY
                        );
                        
                        const scale = newDistance / this.touchZoomDistance;
                        this.zoomLevel = Math.min(Math.max(this.zoomLevel * scale, 1), 4);
                        this.touchZoomDistance = newDistance;
                    }
                },
                
                handleTouchZoomEnd(e) {
                    this.touchZoomDistance = 0;
                },

                async toggleFollowUser(user) {
                    try {
                        const res = await axios.post(`/api/users/${user.id}/follow`);
                        user.isFollowing = res.data.isFollowing;
                        this.loadStats();
                    } catch (e) { }
                },

                // ============ SEARCH ============
                async handleSearch() {
                    if (!this.searchQuery.trim()) {
                        this.searchResults = [];
                        this.hashtagResults = [];
                        return;
                    }
                    
                    try {
                        // XSS korumasÄ± uygula
                        const sanitizedQuery = window.sanitizeInput ? window.sanitizeInput(this.searchQuery) : this.searchQuery;
                        
                        if (sanitizedQuery.startsWith('#')) {
                            const res = await axios.get(`api/hashtags/search?q=${encodeURIComponent(sanitizedQuery.slice(1))}`);
                            this.hashtagResults = res.data.hashtags || [];
                            this.searchResults = [];
                        } else {
                            const res = await axios.get(`api/users/search?q=${encodeURIComponent(sanitizedQuery)}`);
                            this.searchResults = res.data.users || [];
                            this.hashtagResults = [];
                        }
                    } catch (e) { 
                        console.error(e); 
                    }
                },

                async searchByHashtag(tag) {
                    try {
                        const res = await axios.get(`api/hashtags/${tag}/posts`);
                        this.feed = res.data.posts || [];
                        this.hasMore = false;
                        this.searchQuery = '';
                        this.hashtagResults = [];
                        this.activeTab = 'home';
                        this.showToast(`#${tag} gÃ¶nderileri`);
                    } catch (e) { }
                },

                // ============ POST OPTIONS ============
                openPostOptions(post) {
                    this.selectedPost = post;
                    this.showPostOptions = true;
                },

                async deletePost(post) {
                    if (!confirm('Bu gÃ¶nderiyi silmek istediÄŸinize emin misiniz?')) return;
                    try {
                        await axios.delete(`api/posts/${post.id}`);
                        this.feed = this.feed.filter(p => p.id !== post.id);
                        this.showPostOptions = false;
                        this.showToast("GÃ¶nderi silindi");
                    } catch (e) { 
                        this.showToast("Silinemedi"); 
                    }
                },

                async reportPost(post) {
                    this.selectedPost = post;
                    this.showPostOptions = false;
                    this.reportReason = '';
                    this.reportDescription = '';
                    this.showReportModal = true;
                },
                
                // Åžikayet gÃ¶nderme - goktepefatma6@gmail.com adresine mail gÃ¶nderir
                async submitReport() {
                    if (!this.reportReason) {
                        this.showToast("LÃ¼tfen bir ÅŸikayet nedeni seÃ§in");
                        return;
                    }
                    
                    this.loading = true;
                    try {
                        await axios.post('/api/reports/post', {
                            postId: this.selectedPost?.id,
                            reason: this.reportReason,
                            description: this.reportDescription,
                            reporterEmail: this.user.email,
                            reporterUsername: this.user.username
                        });
                        
                        this.showReportModal = false;
                        this.showToast("Åžikayet baÅŸarÄ±yla gÃ¶nderildi. Ä°ncelenecektir.");
                        this.reportReason = '';
                        this.reportDescription = '';
                        this.selectedPost = null;
                    } catch (e) {
                        this.showToast(e.response?.data?.error || "Åžikayet gÃ¶nderilemedi");
                    } finally {
                        this.loading = false;
                    }
                },

                async blockUser(userId) {
                    try {
                        await axios.post(`/api/users/${userId}/block`);
                        this.feed = this.feed.filter(p => p.userId !== userId);
                        // Engellenen kullanÄ±cÄ±yÄ± listeye ekle (demo)
                        if (!this.blockedAccountsList) this.blockedAccountsList = [];
                        const blockedUser = this.feed.find(p => p.userId === userId);
                        if (blockedUser) {
                            this.blockedAccountsList.push({
                                id: userId,
                                name: blockedUser.userName,
                                username: blockedUser.userUsername,
                                profilePic: blockedUser.userProfilePic
                            });
                        }
                        this.showPostOptions = false;
                        this.showToast("KullanÄ±cÄ± engellendi");
                    } catch (e) { 
                        // DEMO: Sunucu olmadan da Ã§alÄ±ÅŸsÄ±n
                        this.feed = this.feed.filter(p => p.userId !== userId);
                        this.showPostOptions = false;
                        this.showToast("KullanÄ±cÄ± engellendi (demo)");
                    }
                },
                
                // Post Ã¼zerinden engelleme - modal'Ä± kapatÄ±r
                async blockUserFromPost(userId) {
                    try {
                        await axios.post(`/api/users/${userId}/block`);
                        // Engellenen kullanÄ±cÄ± bilgisini al
                        const blockedUser = this.feed.find(p => p.userId === userId);
                        this.feed = this.feed.filter(p => p.userId !== userId);
                        // Engellenen kullanÄ±cÄ±yÄ± listeye ekle (demo)
                        if (!this.blockedAccountsList) this.blockedAccountsList = [];
                        if (blockedUser) {
                            this.blockedAccountsList.push({
                                id: userId,
                                name: blockedUser.userName,
                                username: blockedUser.userUsername,
                                profilePic: blockedUser.userProfilePic
                            });
                        }
                        this.showPostOptions = false;
                        this.showToast("KullanÄ±cÄ± engellendi. GÃ¶nderileri artÄ±k gÃ¶rÃ¼nmeyecek.");
                    } catch (e) { 
                        // DEMO: Sunucu olmadan da Ã§alÄ±ÅŸsÄ±n
                        const blockedUser = this.feed.find(p => p.userId === userId);
                        this.feed = this.feed.filter(p => p.userId !== userId);
                        if (!this.blockedAccountsList) this.blockedAccountsList = [];
                        if (blockedUser) {
                            this.blockedAccountsList.push({
                                id: userId,
                                name: blockedUser.userName,
                                username: blockedUser.userUsername,
                                profilePic: blockedUser.userProfilePic
                            });
                        }
                        this.showPostOptions = false;
                        this.showToast("KullanÄ±cÄ± engellendi (demo)");
                    }
                },

                // ============ MEDIA ============
                openFullScreen(url, type) {
                    this.fullScreenMedia = { url, type: type || 'image' };
                    this.showFullScreen = true;
                },

                // ============ HELPERS ============
                formatDate(date) {
                    if (!date) return '';
                    const d = new Date(date);
                    const now = new Date();
                    const diff = (now - d) / 1000;
                    
                    if (diff < 60) return 'Az Ã¶nce';
                    if (diff < 3600) return Math.floor(diff / 60) + ' dk';
                    if (diff < 86400) return Math.floor(diff / 3600) + ' sa';
                    if (diff < 604800) return Math.floor(diff / 86400) + ' gÃ¼n';
                    
                    return d.toLocaleDateString('tr-TR', { day: '2-digit', month: 'short' });
                },

                formatTime(date) {
                    if (!date) return '';
                    return new Date(date).toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit' });
                },

                formatJoinDate(date) {
                    if (!date) return 'Ocak 2024 tarihinde katÄ±ldÄ±';
                    const d = new Date(date);
                    const months = ['Ocak', 'Åžubat', 'Mart', 'Nisan', 'MayÄ±s', 'Haziran', 'Temmuz', 'AÄŸustos', 'EylÃ¼l', 'Ekim', 'KasÄ±m', 'AralÄ±k'];
                    return `${months[d.getMonth()]} ${d.getFullYear()} tarihinde katÄ±ldÄ±`;
                },

                formatCount(num) {
                    if (!num) return '0';
                    if (num >= 1000000) return (num / 1000000).toFixed(1).replace(/\.0$/, '') + 'M';
                    if (num >= 1000) return (num / 1000).toFixed(1).replace(/\.0$/, '') + 'K';
                    return num.toString();
                },

                formatContent(content) {
                    if (!content) return '';
                    // Ã–nce tÃ¼m iÃ§eriÄŸi escape et (XSS korumasÄ±)
                    const div = document.createElement('div');
                    div.textContent = content;
                    let escaped = div.innerHTML;
                    // Hashtags - tÄ±klanabilir (escape edilmiÅŸ iÃ§erik Ã¼zerinde)
                    escaped = escaped.replace(/#(\w+)/g, '<span class="hashtag" onclick="window.searchHashtag(\'$1\')">#$1</span>');
                    // Mentions - tÄ±klanabilir
                    escaped = escaped.replace(/@(\w+)/g, '<span class="mention" onclick="window.viewUserByUsername(\'$1\')">@$1</span>');
                    return escaped;
                },
                
                // DM MESAJLARI Ä°Ã‡Ä°N LÄ°NK FORMATLAMA - MAVÄ° VE TIKLANABÄ°LÄ°R
                formatMessageContent(content) {
                    if (!content) return '';
                    // Ã–nce tÃ¼m iÃ§eriÄŸi escape et (XSS korumasÄ±)
                    const div = document.createElement('div');
                    div.textContent = content;
                    let escaped = div.innerHTML;
                    // URL regex - http, https ve www ile baÅŸlayan linkler
                    const urlRegex = /(https?:\/\/[^\s<]+|www\.[^\s<]+)/gi;
                    // URL'leri mavi, tÄ±klanabilir linklere dÃ¶nÃ¼ÅŸtÃ¼r
                    escaped = escaped.replace(urlRegex, (url) => {
                        let href = url;
                        if (url.startsWith('www.')) {
                            href = 'https://' + url;
                        }
                        // href'i de encode et - javascript: protocol korumasÄ±
                        try {
                            const parsed = new URL(href, window.location.origin);
                            if (!['http:', 'https:'].includes(parsed.protocol)) return url;
                        } catch(e) { return url; }
                        return `<a href="${href}" target="_blank" rel="noopener noreferrer" class="text-blue-400 hover:underline break-all" onclick="event.stopPropagation()">${url}</a>`;
                    });
                    return escaped;
                },

                async loadLikedPosts() {
                    try {
                        const res = await axios.get('/api/posts/liked');
                        this.likedPosts = res.data.posts || [];
                    } catch (e) { 
                        console.error('BeÄŸenilen postlar yÃ¼klenemedi:', e); 
                    }
                },

                showToast(message) {
                    this.toast = { show: true, message };
                    setTimeout(() => { this.toast.show = false; }, 3000);
                },
                
                // ========== TIKTOK TARZI KAYDIRMA ==========
                openTikTokScroll(post) {
                    this.tikTokPosts = [...this.feed]; // Kopya oluÅŸtur
                    this.currentTikTokIndex = this.tikTokPosts.findIndex(p => p.id === post.id);
                    if (this.currentTikTokIndex === -1) this.currentTikTokIndex = 0;
                    this.showTikTokScroll = true;
                    document.body.style.overflow = 'hidden';
                    
                    // TÄ±klanan posta scroll yap
                    this.$nextTick(() => {
                        const container = document.querySelector('.tiktok-scroll-wrapper');
                        const posts = container?.querySelectorAll('.tiktok-post');
                        if (posts && posts[this.currentTikTokIndex]) {
                            posts[this.currentTikTokIndex].scrollIntoView({ behavior: 'instant' });
                        }
                    });
                },
                
                closeTikTokScroll() {
                    this.showTikTokScroll = false;
                    document.body.style.overflow = '';
                },
                
                handleTikTokScroll(e) {
                    const container = e.target;
                    const scrollTop = container.scrollTop;
                    const postHeight = window.innerHeight;
                    const newIndex = Math.round(scrollTop / postHeight);
                    
                    if (newIndex !== this.currentTikTokIndex && newIndex >= 0 && newIndex < this.tikTokPosts.length) {
                        this.currentTikTokIndex = newIndex;
                        
                        // Son videoya yaklaÅŸtÄ±ÄŸÄ±nda daha fazla video yÃ¼kle
                        if (newIndex >= this.tikTokPosts.length - 3 && this.hasMore && !this.loadingMore) {
                            this.fetchPosts().then(() => {
                                // Yeni postlarÄ± tikTokPosts'a ekle
                                const newPosts = this.feed.filter(p => !this.tikTokPosts.find(tp => tp.id === p.id));
                                this.tikTokPosts = [...this.tikTokPosts, ...newPosts];
                            });
                        }
                    }
                },
                
                handleTouchStart(e) {
                    this.touchStartY = e.touches[0].clientY;
                },
                
                handleTouchEnd(e, post) {
                    const touchEndY = e.changedTouches[0].clientY;
                    const diff = this.touchStartY - touchEndY;
                    
                    // YukarÄ± kaydÄ±r - sonraki post
                    if (diff > 50) {
                        this.nextTikTokPost();
                    }
                    // AÅŸaÄŸÄ± kaydÄ±r - Ã¶nceki post
                    else if (diff < -50) {
                        this.prevTikTokPost();
                    }
                },
                
                nextTikTokPost() {
                    if (this.currentTikTokIndex < this.tikTokPosts.length - 1) {
                        this.currentTikTokIndex++;
                        this.scrollToTikTokPost(this.currentTikTokIndex);
                    }
                },
                
                prevTikTokPost() {
                    if (this.currentTikTokIndex > 0) {
                        this.currentTikTokIndex--;
                        this.scrollToTikTokPost(this.currentTikTokIndex);
                    }
                },
                
                scrollToTikTokPost(index) {
                    this.$nextTick(() => {
                        const container = document.querySelector('.tiktok-scroll-wrapper');
                        const posts = container?.querySelectorAll('.tiktok-post');
                        if (posts && posts[index]) {
                            posts[index].scrollIntoView({ behavior: 'smooth' });
                        }
                    });
                },
                
                // ========== KALP ATMA ANIMasyonu ==========
                showHeartAnim(postId) {
                    this.showHeartAnimation = postId;
                    setTimeout(() => { this.showHeartAnimation = false; }, 800);
                },
                
                doubleTapLike(post) {
                    this.showHeartAnim(post.id);
                    if (!post.isLiked) {
                        this.likePost(post);
                    }
                },
                
                // ========== SES KAYIT ==========
                async startVoiceRecord() {
                    if (this.isRecording) {
                        this.stopVoiceRecord();
                        return;
                    }
                    
                    try {
                        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                        this.mediaRecorder = new MediaRecorder(stream);
                        this.recordedChunks = [];
                        this.voiceDuration = 0;
                        
                        this.mediaRecorder.ondataavailable = (e) => {
                            if (e.data.size > 0) {
                                this.recordedChunks.push(e.data);
                            }
                        };
                        
                        this.mediaRecorder.onstop = () => {
                            const blob = new Blob(this.recordedChunks, { type: 'audio/webm' });
                            this.voicePreview = URL.createObjectURL(blob);
                            this.voiceBlob = blob;
                        };
                        
                        this.mediaRecorder.start();
                        this.isRecording = true;
                        
                        // SÃ¼re sayacÄ±
                        this.recordingTimer = setInterval(() => {
                            this.voiceDuration++;
                            if (this.voiceDuration >= 60) { // Max 60 saniye
                                this.stopVoiceRecord();
                            }
                        }, 1000);
                        
                    } catch (err) {
                        console.error('Mikrofon eriÅŸim hatasÄ±:', err);
                        this.showToast('Mikrofona eriÅŸilemedi');
                    }
                },
                
                stopVoiceRecord() {
                    if (this.mediaRecorder && this.isRecording) {
                        this.mediaRecorder.stop();
                        this.mediaRecorder.stream.getTracks().forEach(track => track.stop());
                        clearInterval(this.recordingTimer);
                        this.isRecording = false;
                    }
                },
                
                cancelVoiceRecord() {
                    this.voicePreview = null;
                    this.voiceBlob = null;
                    this.voiceDuration = 0;
                },
                
                async sendVoiceMessage() {
                    if (!this.voiceBlob) return;
                    if (!this.activeChat.otherId) {
                        this.showToast("Sohbet bilgisi eksik");
                        return;
                    }
                    
                    const formData = new FormData();
                    formData.append('voice', this.voiceBlob, 'voice.webm');
                    formData.append('recipientId', this.activeChat.otherId);
                    
                    // Optimistic update
                    const tempId = Date.now();
                    this.chatMessages.push({
                        id: tempId,
                        senderId: this.user.id,
                        senderName: this.user.name,
                        senderProfilePic: this.user.profilePic,
                        content: this.voicePreview,
                        type: 'voice',
                        duration: this.voiceDuration,
                        isUploading: true,
                        createdAt: new Date().toISOString()
                    });
                    this.scrollToBottom();
                    
                    try {
                        const res = await axios.post('/api/messages/voice', formData, {
                            headers: { 'Content-Type': 'multipart/form-data' }
                        });
                        
                        const idx = this.chatMessages.findIndex(m => m.id === tempId);
                        if (idx !== -1) {
                            this.chatMessages[idx].id = res.data.messageId;
                            this.chatMessages[idx].isUploading = false;
                            this.chatMessages[idx].content = res.data.voiceUrl || this.voicePreview;
                        }
                        
                        this.voicePreview = null;
                        this.voiceBlob = null;
                        this.voiceDuration = 0;
                    } catch (e) {
                        this.showToast('Ses mesajÄ± gÃ¶nderilemedi');
                        this.chatMessages = this.chatMessages.filter(m => m.id !== tempId);
                    }
                },
                
                // ========== HÄ°KAYE GÃ–RÃœNTÃœLEYENLER ==========
                async loadStoryViewers(storyId) {
                    try {
                        const res = await axios.get(`/api/stories/${storyId}/viewers`);
                        this.storyViewersList = res.data.viewers || [];
                        this.showStoryViewers = true;
                        console.log('Hikaye gÃ¶rÃ¼ntÃ¼leyenler:', this.storyViewersList);
                    } catch (e) {
                        console.error('Hikaye gÃ¶rÃ¼ntÃ¼leyenler yÃ¼klenemedi:', e);
                    }
                },
                
                // ========== YORUM BEÄžENME ==========
                async likeComment(comment) {
                    try {
                        await axios.post(`/api/comments/${comment.id}/like`);
                        comment.isLiked = !comment.isLiked;
                        comment.likeCount = (comment.likeCount || 0) + (comment.isLiked ? 1 : -1);
                        this.showHeartAnim(comment.id);
                    } catch (e) {
                        console.error('Yorum beÄŸenme hatasÄ±:', e);
                    }
                },
                
                // ========== PAYLAÅž ==========
                async sharePost(post) {
                    const shareUrl = `${window.location.origin}/p/${post.id}`;
                    if (navigator.share) {
                        try {
                            await navigator.share({
                                title: 'AgroLink GÃ¶nderisi',
                                text: post.content?.substring(0, 100) || 'Bir gÃ¶nderi paylaÅŸtÄ±',
                                url: shareUrl
                            });
                        } catch (e) {
                            // KullanÄ±cÄ± iptal etti
                        }
                    } else {
                        // Kopyala
                        navigator.clipboard.writeText(shareUrl);
                        this.showToast('Link kopyalandÄ±: ' + shareUrl);
                    }
                },
                
                // Profil PaylaÅŸ
                async shareProfile(user) {
                    const userId = user?.id || this.viewedUser?.id || this.user?.id;
                    const userName = user?.username || this.viewedUser?.username || this.user?.username;
                    if (!userId) {
                        this.showToast('Profil bilgisi bulunamadÄ±');
                        return;
                    }
                    const shareUrl = `${window.location.origin}/u/${userId}`;
                    if (navigator.share) {
                        try {
                            await navigator.share({
                                title: `${userName} - AgroLink Profili`,
                                text: `${userName} kullanÄ±cÄ±sÄ±nÄ±n AgroLink profilini gÃ¶rÃ¼ntÃ¼le`,
                                url: shareUrl
                            });
                        } catch (e) {
                            // KullanÄ±cÄ± iptal etti
                        }
                    } else {
                        navigator.clipboard.writeText(shareUrl);
                        this.showToast('Profil linki kopyalandÄ±: ' + shareUrl);
                    }
                },
                
                // ========== POST URL PAYLAÅž (YENÄ°) ==========
                async sharePostURL(post) {
                    const shareUrl = `${window.location.origin}/p/${post.id}`;
                    try {
                        await navigator.clipboard.writeText(shareUrl);
                        this.showToast('ðŸ”— Link kopyalandÄ±!');
                    } catch (e) {
                        this.showToast('Link kopyalanamadÄ±');
                    }
                },
                
                // ========== DM'DE POST PAYLAÅž (YENÄ°) ==========
                showShareToDMModal: false,
                postToShare: null,
                dmShareSearchQuery: '',
                dmShareResults: [],
                
                openShareToDMModal(post) {
                    this.postToShare = post;
                    this.showShareToDMModal = true;
                    this.dmShareSearchQuery = '';
                    this.dmShareResults = [];
                    this.loadConversations();
                },
                
                async searchUsersForDMShare() {
                    if (!this.dmShareSearchQuery.trim()) {
                        this.dmShareResults = [];
                        return;
                    }
                    try {
                        const res = await axios.get(`api/users/search?q=${encodeURIComponent(this.dmShareSearchQuery)}`);
                        this.dmShareResults = res.data.users || [];
                    } catch (e) {
                        console.error('KullanÄ±cÄ± arama hatasÄ±:', e);
                    }
                },
                
                async sharePostToDM(userId) {
                    if (!this.postToShare) return;
                    try {
                        await axios.post('/api/messages/share-post', {
                            postId: this.postToShare.id,
                            recipientId: userId
                        });
                        this.showToast('ðŸ“¤ GÃ¶nderi paylaÅŸÄ±ldÄ±!');
                        this.showShareToDMModal = false;
                        this.postToShare = null;
                    } catch (e) {
                        this.showToast('GÃ¶nderi paylaÅŸÄ±lamadÄ±');
                    }
                },
                
                // ========== GÃ–RÃœNTÃœLÃœ ARAMA (WEBRTC - YENÄ°) ==========
                showVideoCallModal: false,
                showIncomingCallModal: false,
                activeCall: null,
                incomingCall: null,
                localStream: null,
                remoteStream: null,
                peerConnection: null,
                callTimer: null,
                callDuration: 0,
                isMuted: false,
                isVideoOff: false,
                
                async initiateVideoCall(recipientId) {
                    try {
                        // Aktif sohbet bilgilerini kullan
                        const recipientInfo = this.activeChat && this.activeChat.otherId === recipientId ? {
                            id: recipientId,
                            name: this.activeChat.name,
                            profilePic: this.activeChat.profilePic
                        } : null;

                        // Ã–nce kamera/mikrofon eriÅŸimi iste
                        try {
                            this.localStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
                        } catch (mediaError) {
                            this.showToast('Kamera ve mikrofon eriÅŸimi gerekli');
                            return;
                        }
                        
                        // Modal'Ä± hemen aÃ§ (baÄŸlantÄ± bekleniyor durumunda)
                        this.activeCall = {
                            callId: Date.now().toString(),
                            recipient: recipientInfo || { id: recipientId, name: 'KullanÄ±cÄ±', profilePic: '' },
                            type: 'video'
                        };
                        this.showVideoCallModal = true;
                        this.startCallTimer();
                        
                        // Yerel videoyu gÃ¶ster
                        this.$nextTick(() => {
                            const localVideo = document.getElementById('localVideo');
                            if (localVideo && this.localStream) {
                                localVideo.srcObject = this.localStream;
                            }
                        });
                        
                        // API'ye bildir (opsiyonel)
                        try {
                            const res = await axios.post('/api/calls/initiate', { recipientId });
                            if (res.data.callId) {
                                this.activeCall.callId = res.data.callId;
                            }
                        } catch (apiError) {
                            console.log('API baÄŸlantÄ±sÄ± yok, demo modda Ã§alÄ±ÅŸÄ±yor');
                        }
                        
                    } catch (e) {
                        console.error('Video arama hatasÄ±:', e);
                        this.showToast('Arama baÅŸlatÄ±lÄ±yor... Kamera eriÅŸimi kontrol ediliyor.');
                    }
                },
                
                async initiateAudioCall(recipientId) {
                    try {
                        // Aktif sohbet bilgilerini kullan
                        const recipientInfo = this.activeChat && this.activeChat.otherId === recipientId ? {
                            id: recipientId,
                            name: this.activeChat.name,
                            profilePic: this.activeChat.profilePic
                        } : null;

                        // Ã–nce mikrofon eriÅŸimi iste
                        try {
                            this.localStream = await navigator.mediaDevices.getUserMedia({ video: false, audio: true });
                        } catch (mediaError) {
                            this.showToast('Mikrofon eriÅŸimi gerekli');
                            return;
                        }
                        
                        // Modal'Ä± hemen aÃ§
                        this.activeCall = {
                            callId: Date.now().toString(),
                            recipient: recipientInfo || { id: recipientId, name: 'KullanÄ±cÄ±', profilePic: '' },
                            type: 'audio'
                        };
                        this.showVideoCallModal = true;
                        this.isVideoOff = true; // Sesli aramada video kapalÄ±
                        this.startCallTimer();
                        
                        // API'ye bildir (opsiyonel)
                        try {
                            const res = await axios.post('/api/calls/initiate', { recipientId });
                            if (res.data.callId) {
                                this.activeCall.callId = res.data.callId;
                            }
                        } catch (apiError) {
                            console.log('API baÄŸlantÄ±sÄ± yok, demo modda Ã§alÄ±ÅŸÄ±yor');
                        }
                        
                    } catch (e) {
                        console.error('Sesli arama hatasÄ±:', e);
                        this.showToast('Arama baÅŸlatÄ±lÄ±yor...');
                    }
                },
                
                async initializeWebRTC(recipientId, type) {
                    try {
                        // Kamera/Mikrofon eriÅŸimi
                        const constraints = type === 'video' 
                            ? { video: true, audio: true }
                            : { video: false, audio: true };
                        
                        this.localStream = await navigator.mediaDevices.getUserMedia(constraints);
                        
                        // Yerel videoyu gÃ¶ster
                        const localVideo = document.getElementById('localVideo');
                        if (localVideo) {
                            localVideo.srcObject = this.localStream;
                        }
                        
                        // PeerConnection oluÅŸtur
                        this.peerConnection = new RTCPeerConnection({
                            iceServers: [
                                { urls: 'stun:stun.l.google.com:19302' },
                                { urls: 'stun:stun1.l.google.com:19302' }
                            ]
                        });
                        
                        // Yerel stream'i ekle
                        this.localStream.getTracks().forEach(track => {
                            this.peerConnection.addTrack(track, this.localStream);
                        });
                        
                        // Uzak stream'i al
                        this.peerConnection.ontrack = (event) => {
                            this.remoteStream = event.streams[0];
                            const remoteVideo = document.getElementById('remoteVideo');
                            if (remoteVideo) {
                                remoteVideo.srcObject = this.remoteStream;
                            }
                        };
                        
                        // ICE candidate'larÄ± gÃ¶nder
                        this.peerConnection.onicecandidate = (event) => {
                            if (event.candidate) {
                                axios.post('/api/calls/signal/ice', {
                                    callId: this.activeCall.callId,
                                    candidate: event.candidate
                                });
                            }
                        };
                        
                        // Offer oluÅŸtur
                        const offer = await this.peerConnection.createOffer();
                        await this.peerConnection.setLocalDescription(offer);
                        
                        // Offer'Ä± gÃ¶nder
                        await axios.post('/api/calls/signal/offer', {
                            callId: this.activeCall.callId,
                            offer: offer
                        });
                        
                    } catch (e) {
                        console.error('WebRTC baÅŸlatma hatasÄ±:', e);
                        this.showToast('Kamera/Mikrofon eriÅŸimi gerekli');
                    }
                },
                
                async acceptIncomingCall() {
                    if (!this.incomingCall) return;
                    
                    try {
                        await axios.post('/api/calls/respond', {
                            callId: this.incomingCall.callId,
                            response: 'accept'
                        });
                        
                        this.showIncomingCallModal = false;
                        this.activeCall = {
                            callId: this.incomingCall.callId,
                            recipient: this.incomingCall.caller,
                            type: 'video'
                        };
                        this.showVideoCallModal = true;
                        this.startCallTimer();
                        
                        // WebRTC yanÄ±t bekle
                        this.waitForWebRTCAnswer();
                        
                    } catch (e) {
                        this.showToast('Arama kabul edilemedi');
                    }
                },
                
                async rejectIncomingCall() {
                    if (!this.incomingCall) return;
                    
                    try {
                        await axios.post('/api/calls/respond', {
                            callId: this.incomingCall.callId,
                            response: 'reject'
                        });
                        
                        this.showIncomingCallModal = false;
                        this.incomingCall = null;
                    } catch (e) {
                        this.showToast('Arama reddedilemedi');
                    }
                },
                
                async waitForWebRTCAnswer() {
                    // Answer'Ä± bekle ve set et
                    // Bu kÄ±sÄ±m socket.io ile gerÃ§ekleÅŸtirilmeli
                },
                
                async endCall() {
                    if (this.activeCall) {
                        try {
                            await axios.post('/api/calls/end', {
                                callId: this.activeCall.callId
                            });
                        } catch (e) {
                            console.error('Arama sonlandÄ±rma hatasÄ±:', e);
                        }
                    }
                    
                    // Stream'leri temizle
                    if (this.localStream) {
                        this.localStream.getTracks().forEach(track => track.stop());
                        this.localStream = null;
                    }
                    
                    if (this.peerConnection) {
                        this.peerConnection.close();
                        this.peerConnection = null;
                    }
                    
                    this.stopCallTimer();
                    this.showVideoCallModal = false;
                    this.activeCall = null;
                    this.remoteStream = null;
                },
                
                toggleMute() {
                    if (this.localStream) {
                        const audioTrack = this.localStream.getAudioTracks()[0];
                        if (audioTrack) {
                            audioTrack.enabled = !audioTrack.enabled;
                            this.isMuted = !audioTrack.enabled;
                        }
                    }
                },
                
                toggleVideo() {
                    if (this.localStream) {
                        const videoTrack = this.localStream.getVideoTracks()[0];
                        if (videoTrack) {
                            videoTrack.enabled = !videoTrack.enabled;
                            this.isVideoOff = !videoTrack.enabled;
                        }
                    }
                },
                
                startCallTimer() {
                    this.callDuration = 0;
                    this.callTimer = setInterval(() => {
                        this.callDuration++;
                    }, 1000);
                },
                
                stopCallTimer() {
                    if (this.callTimer) {
                        clearInterval(this.callTimer);
                        this.callTimer = null;
                    }
                },
                
                formatCallDuration(seconds) {
                    const mins = Math.floor(seconds / 60);
                    const secs = seconds % 60;
                    return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
                },
                
                // ========== KAYDEDÄ°LEN GÃ–NDERÄ°LER DÃœZELTME ==========
                async loadSavedPosts() {
                    try {
                        this.loading = true;
                        const res = await axios.get('/api/posts/saved');
                        this.savedPostsList = res.data.posts || [];
                        console.log('Kaydedilen gÃ¶nderiler yÃ¼klendi:', this.savedPostsList.length);
                    } catch (e) { 
                        console.error('Kaydedilen gÃ¶nderiler yÃ¼klenemedi:', e);
                        this.savedPostsList = [];
                    } finally {
                        this.loading = false;
                    }
                },
                
                // ========== ENGELLENEN KULLANICILAR DÃœZELTME ==========
                async loadBlockedAccounts() {
                    try {
                        this.loading = true;
                        const res = await axios.get('/api/users/blocked');
                        this.blockedAccountsList = res.data.blockedUsers || [];
                        console.log('Engellenen hesaplar yÃ¼klendi:', this.blockedAccountsList.length);
                    } catch (e) {
                        console.error('Engellenen hesaplar yÃ¼klenemedi:', e);
                        this.blockedAccountsList = [];
                    } finally {
                        this.loading = false;
                    }
                },
                
                // ========== PAYLAÅžILAN POST SAYFASI ==========
                async loadSharedPost(postId) {
                    try {
                        this.loading = true;
                        const res = await axios.get(`/api/posts/${postId}`);
                        if (res.data.post) {
                            this.sharedPost = res.data.post;
                            this.sharedPostComments = res.data.comments || [];
                            this.showSharedPostPage = true;
                        }
                    } catch (e) {
                        console.error('PaylaÅŸÄ±lan post yÃ¼klenemedi:', e);
                        this.showToast('GÃ¶nderi bulunamadÄ±');
                    } finally {
                        this.loading = false;
                    }
                },
                
                // ========== PAYLAÅžILAN PROFÄ°L SAYFASI ==========
                async loadSharedProfile(userId) {
                    try {
                        this.loading = true;
                        const res = await axios.get(`/api/users/${userId}`);
                        if (res.data.user) {
                            this.sharedProfile = res.data.user;
                            // KullanÄ±cÄ±nÄ±n gÃ¶nderilerini yÃ¼kle
                            const postsRes = await axios.get(`/api/posts/user/${userId}`);
                            this.sharedProfilePosts = postsRes.data.posts || [];
                            this.showSharedProfilePage = true;
                        }
                    } catch (e) {
                        console.error('PaylaÅŸÄ±lan profil yÃ¼klenemedi:', e);
                        this.showToast('Profil bulunamadÄ±');
                    } finally {
                        this.loading = false;
                    }
                },
                
                // ========== VÄ°DEO/GÃ–RSEL Ä°ÅžLEME HIZLANDIRMA ==========
                async processMediaOptimized(file, options = {}) {
                    const { maxWidth = 1920, maxHeight = 1080, quality = 0.85, maxSizeMB = 10 } = options;
                    
                    // Hemen dÃ¶nÃ¼ÅŸ - kÃ¼Ã§Ã¼k dosyalar iÃ§in
                    if (file.size < 1024 * 1024) { // 1MB'dan kÃ¼Ã§Ã¼k
                        return file;
                    }
                    
                    return new Promise((resolve, reject) => {
                        const isVideo = file.type.startsWith('video/');
                        
                        if (isVideo) {
                            // Video iÃ§in hÄ±zlÄ± iÅŸleme
                            if (file.size > maxSizeMB * 1024 * 1024) {
                                this.showToast('Video sÄ±kÄ±ÅŸtÄ±rÄ±lÄ±yor...');
                                // Video sÄ±kÄ±ÅŸtÄ±rma - basit yaklaÅŸÄ±m
                                const video = document.createElement('video');
                                video.preload = 'metadata';
                                video.onloadedmetadata = () => {
                                    URL.revokeObjectURL(video.src);
                                    // Dosya Ã§ok bÃ¼yÃ¼kse uyarÄ± ver ama gÃ¶nder
                                    if (file.size > 50 * 1024 * 1024) {
                                        this.showToast('Video boyutu Ã§ok bÃ¼yÃ¼k, yÃ¼kleniyor...');
                                    }
                                    resolve(file);
                                };
                                video.onerror = () => resolve(file);
                                video.src = URL.createObjectURL(file);
                            } else {
                                resolve(file);
                            }
                        } else {
                            // GÃ¶rsel iÃ§in hÄ±zlÄ± sÄ±kÄ±ÅŸtÄ±rma
                            const img = new Image();
                            const canvas = document.createElement('canvas');
                            const ctx = canvas.getContext('2d');
                            
                            img.onload = () => {
                                let { width, height } = img;
                                
                                // Boyut sÄ±nÄ±rlama
                                if (width > maxWidth || height > maxHeight) {
                                    const ratio = Math.min(maxWidth / width, maxHeight / height);
                                    width *= ratio;
                                    height *= ratio;
                                }
                                
                                canvas.width = width;
                                canvas.height = height;
                                ctx.drawImage(img, 0, 0, width, height);
                                
                                canvas.toBlob((blob) => {
                                    if (blob) {
                                        const processedFile = new File([blob], file.name, {
                                            type: 'image/jpeg',
                                            lastModified: Date.now()
                                        });
                                        resolve(processedFile);
                                    } else {
                                        resolve(file);
                                    }
                                }, 'image/jpeg', quality);
                            };
                            
                            img.onerror = () => resolve(file);
                            img.src = URL.createObjectURL(file);
                        }
                    });
                },
        
        // ========== ðŸ“— FARMBOOK FONKSÄ°YONLARI ==========
        
        async loadFarmbookRecords() {
            this.farmbookLoading = true;
            try {
                const params = new URLSearchParams();
                if (this.farmbookFilters.season) params.append('season', this.farmbookFilters.season);
                if (this.farmbookFilters.year) params.append('year', this.farmbookFilters.year);
                if (this.farmbookFilters.type) params.append('type', this.farmbookFilters.type);
                
                const res = await axios.get('/api/farmbook/records?' + params.toString());
                this.farmbookRecords = res.data.records || [];
            } catch (e) {
                console.error('Farmbook kayÄ±tlarÄ± yÃ¼klenemedi:', e);
                this.showToast('KayÄ±tlar yÃ¼klenemedi');
            } finally {
                this.farmbookLoading = false;
            }
        },
        
        async loadFarmbookStats() {
            try {
                const params = new URLSearchParams();
                if (this.farmbookFilters.season) params.append('season', this.farmbookFilters.season);
                if (this.farmbookFilters.year) params.append('year', this.farmbookFilters.year);
                
                const res = await axios.get('/api/farmbook/stats?' + params.toString());
                this.farmbookStats = res.data.stats;
            } catch (e) {
                console.error('Farmbook istatistikleri yÃ¼klenemedi:', e);
            }
        },
        
        async loadFarmbookFields() {
            try {
                const res = await axios.get('/api/farmbook/fields');
                this.farmbookFields = res.data.fields || [];
            } catch (e) {
                console.error('Tarlalar yÃ¼klenemedi:', e);
            }
        },
        
        async openFarmbook() {
            this.showFarmbook = true;
            this.farmbookTab = 'records';
            await Promise.all([
                this.loadFarmbookRecords(),
                this.loadFarmbookStats(),
                this.loadFarmbookFields()
            ]);
        },
        
        async saveFarmbookRecord() {
            if (!this.farmbookForm.recordType || !this.farmbookForm.recordDate) {
                this.showToast('KayÄ±t tipi ve tarih zorunludur');
                return;
            }
            
            this.farmbookLoading = true;
            try {
                if (this.farmbookEditMode && this.farmbookEditId) {
                    await axios.put('/api/farmbook/records/' + this.farmbookEditId, this.farmbookForm);
                    this.showToast('KayÄ±t gÃ¼ncellendi');
                } else {
                    await axios.post('/api/farmbook/records', this.farmbookForm);
                    this.showToast('KayÄ±t eklendi');
                }
                
                this.resetFarmbookForm();
                this.farmbookTab = 'records';
                await Promise.all([
                    this.loadFarmbookRecords(),
                    this.loadFarmbookStats()
                ]);
            } catch (e) {
                console.error('KayÄ±t hatasÄ±:', e);
                this.showToast('KayÄ±t eklenemedi');
            } finally {
                this.farmbookLoading = false;
            }
        },
        
        editFarmbookRecord(record) {
            this.farmbookEditMode = true;
            this.farmbookEditId = record.id;
            this.farmbookForm = { ...record };
            this.farmbookTab = 'add';
        },
        
        async deleteFarmbookRecord(id) {
            if (!confirm('Bu kaydÄ± silmek istediÄŸinize emin misiniz?')) return;
            
            try {
                await axios.delete('/api/farmbook/records/' + id);
                this.showToast('KayÄ±t silindi');
                await this.loadFarmbookRecords();
                await this.loadFarmbookStats();
            } catch (e) {
                console.error('Silme hatasÄ±:', e);
                this.showToast('KayÄ±t silinemedi');
            }
        },
        
        resetFarmbookForm() {
            this.farmbookEditMode = false;
            this.farmbookEditId = null;
            this.farmbookForm = {
                recordType: 'ekim',
                productName: '',
                quantity: '',
                unit: 'kg',
                cost: '',
                income: '',
                recordDate: new Date().toISOString().split('T')[0],
                fieldName: '',
                fieldSize: '',
                fieldSizeUnit: 'dekar',
                season: '',
                year: new Date().getFullYear(),
                notes: '',
                harvestAmount: '',
                harvestUnit: 'kg',
                qualityRating: 3,
                weatherCondition: ''
            };
        },
        
        async exportFarmbook(format = 'csv') {
            try {
                const params = new URLSearchParams();
                if (this.farmbookFilters.season) params.append('season', this.farmbookFilters.season);
                if (this.farmbookFilters.year) params.append('year', this.farmbookFilters.year);
                params.append('format', format);
                
                const res = await axios.get('/api/farmbook/export?' + params.toString(), { responseType: 'blob' });
                
                const url = window.URL.createObjectURL(new Blob([res.data]));
                const link = document.createElement('a');
                link.href = url;
                link.setAttribute('download', `farmbook_${this.farmbookFilters.year || 'tum'}.csv`);
                document.body.appendChild(link);
                link.click();
                link.remove();
                window.URL.revokeObjectURL(url);
                
                this.showToast('Dosya indiriliyor...');
            } catch (e) {
                console.error('Export hatasÄ±:', e);
                this.showToast('Dosya indirilemedi');
            }
        },
        
        getRecordTypeInfo(type) {
            return this.farmbookRecordTypes.find(r => r.value === type) || { label: type, icon: 'fa-file', color: 'bg-gray-500' };
        },
        
        getSeasonLabel(season) {
            const s = this.farmbookSeasons.find(s => s.value === season);
            return s ? s.label : season;
        },
        
        formatMoney(val) {
            return parseFloat(val || 0).toLocaleString('tr-TR', { minimumFractionDigits: 2 });
        },
        
        closeFarmbook() {
            this.showFarmbook = false;
            this.resetFarmbookForm();
        }
    }
}
    </script>

    <script>
        // Global mention click function - DÃ¼zeltilmiÅŸ
        window.viewUserByUsername = async function(username) {
            // Alpine.js uyumlu element bul
            let app = null;
            const appEl = document.querySelector('[x-data]');
            
            if (appEl) {
                // Alpine 3.x iÃ§in
                if (appEl._x_dataStack && appEl._x_dataStack[0]) {
                    app = appEl._x_dataStack[0];
                } 
                // Alpine 2.x iÃ§in fallback
                else if (appEl.__x && appEl.__x.$data) {
                    app = appEl.__x.$data;
                }
            }
            
            if (app) {
                try {
                    const res = await axios.get(`api/users/search?q=${encodeURIComponent(username)}`);
                    const users = res.data.users || [];
                    const user = users.find(u => u.username && u.username.toLowerCase() === username.toLowerCase());
                    if (user) {
                        app.viewProfile(user.id);
                    } else {
                        app.showToast('KullanÄ±cÄ± bulunamadÄ±: @' + username);
                    }
                } catch (e) {
                    console.error('KullanÄ±cÄ± arama hatasÄ±:', e);
                    app.showToast('KullanÄ±cÄ± bulunamadÄ±');
                }
            }
        }
        
        // Alpine.js 3.x iÃ§in searchHashtag dÃ¼zeltmesi
        window.searchHashtag = function(tag) {
            const appEl = document.querySelector('[x-data]');
            let app = null;
            
            if (appEl) {
                if (appEl._x_dataStack && appEl._x_dataStack[0]) {
                    app = appEl._x_dataStack[0];
                } else if (appEl.__x && appEl.__x.$data) {
                    app = appEl.__x.$data;
                }
            }
            
            if (app && app.searchByHashtag) {
                app.searchByHashtag(tag);
            }
        }
        
        // URL Routing - Post ve Profil PaylaÅŸÄ±m SayfalarÄ±
        window.handleSharedURL = async function() {
            const path = window.location.pathname;
            const appEl = document.querySelector('[x-data]');
            let app = null;
            
            if (appEl && appEl._x_dataStack && appEl._x_dataStack[0]) {
                app = appEl._x_dataStack[0];
            }
            
            if (!app) return;
            
            // Post URL: /p/:postId
            const postMatch = path.match(/^\/p\/(.+)$/);
            if (postMatch) {
                const postId = postMatch[1];
                app.loadSharedPost(postId);
                return;
            }
            
            // Profil URL: /u/:userId
            const userMatch = path.match(/^\/u\/(.+)$/);
            if (userMatch) {
                const userId = userMatch[1];
                app.loadSharedProfile(userId);
                return;
            }
        };
        
        // Sayfa yÃ¼klendiÄŸinde URL kontrolÃ¼
        document.addEventListener('DOMContentLoaded', handleSharedURL);
    </script>
    
    <!-- ========== ðŸ“— FARMBOOK MODAL ========== -->
    <template x-if="showFarmbook">
        <div class="fixed inset-0 z-[9999] flex flex-col bg-[var(--bg-main)]" x-cloak @keydown.escape="closeFarmbook()">
            <!-- Header -->
            <div class="flex items-center justify-between px-4 py-3 bg-gradient-to-r from-green-600 to-emerald-500 text-white shadow-lg">
                <div class="flex items-center gap-3">
                    <button @click="closeFarmbook()" class="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center hover:bg-white/30 transition">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <div>
                        <h2 class="font-black text-lg">ðŸ“— Farmbook</h2>
                        <p class="text-xs text-white/80">Ã‡iftÃ§i KayÄ±t Defteri</p>
                    </div>
                </div>
                <button @click="exportFarmbook()" class="bg-white/20 hover:bg-white/30 px-3 py-2 rounded-xl text-xs font-bold flex items-center gap-2 transition">
                    <i class="fas fa-download"></i> CSV Ä°ndir
                </button>
            </div>
            
            <!-- Tab Navigation -->
            <div class="flex bg-[var(--bg-card)] border-b border-[var(--border)] overflow-x-auto hide-scrollbar">
                <button @click="farmbookTab = 'records'; loadFarmbookRecords()" 
                        :class="farmbookTab === 'records' ? 'border-b-2 border-emerald-500 text-emerald-600 bg-emerald-50' : 'text-[var(--text-sec)]'"
                        class="flex-1 min-w-[80px] py-3 px-4 text-center font-bold text-sm transition">
                    <i class="fas fa-list-ul mr-1"></i> KayÄ±tlar
                </button>
                <button @click="farmbookTab = 'add'; resetFarmbookForm()" 
                        :class="farmbookTab === 'add' ? 'border-b-2 border-emerald-500 text-emerald-600 bg-emerald-50' : 'text-[var(--text-sec)]'"
                        class="flex-1 min-w-[80px] py-3 px-4 text-center font-bold text-sm transition">
                    <i class="fas fa-plus mr-1"></i> Yeni KayÄ±t
                </button>
                <button @click="farmbookTab = 'stats'; loadFarmbookStats()" 
                        :class="farmbookTab === 'stats' ? 'border-b-2 border-emerald-500 text-emerald-600 bg-emerald-50' : 'text-[var(--text-sec)]'"
                        class="flex-1 min-w-[80px] py-3 px-4 text-center font-bold text-sm transition">
                    <i class="fas fa-chart-bar mr-1"></i> Ä°statistik
                </button>
            </div>
            
            <!-- Content -->
            <div class="flex-1 overflow-y-auto p-4 pb-24">
                
                <!-- Loading -->
                <template x-if="farmbookLoading">
                    <div class="flex items-center justify-center py-12">
                        <div class="w-12 h-12 border-4 border-emerald-200 border-t-emerald-500 rounded-full animate-spin"></div>
                    </div>
                </template>
                
                <!-- KAYITLAR TAB -->
                <template x-if="farmbookTab === 'records' && !farmbookLoading">
                    <div class="space-y-4">
                        <!-- Filtreler -->
                        <div class="bg-[var(--bg-card)] rounded-2xl p-4 border border-[var(--border)]">
                            <h3 class="font-bold text-sm mb-3 flex items-center gap-2">
                                <i class="fas fa-filter text-emerald-500"></i> Filtreler
                            </h3>
                            <div class="grid grid-cols-3 gap-2">
                                <select x-model="farmbookFilters.year" @change="loadFarmbookRecords(); loadFarmbookStats()" 
                                        class="bg-[var(--input-bg)] border border-[var(--border)] rounded-xl px-3 py-2 text-sm">
                                    <option value="">TÃ¼m YÄ±llar</option>
                                    <template x-for="y in [2026, 2025, 2024, 2023, 2022]">
                                        <option :value="y" x-text="y"></option>
                                    </template>
                                </select>
                                <select x-model="farmbookFilters.season" @change="loadFarmbookRecords(); loadFarmbookStats()"
                                        class="bg-[var(--input-bg)] border border-[var(--border)] rounded-xl px-3 py-2 text-sm">
                                    <option value="">TÃ¼m Sezon</option>
                                    <template x-for="s in farmbookSeasons">
                                        <option :value="s.value" x-text="s.label"></option>
                                    </template>
                                </select>
                                <select x-model="farmbookFilters.type" @change="loadFarmbookRecords()"
                                        class="bg-[var(--input-bg)] border border-[var(--border)] rounded-xl px-3 py-2 text-sm">
                                    <option value="">TÃ¼m Tipler</option>
                                    <template x-for="t in farmbookRecordTypes">
                                        <option :value="t.value" x-text="t.label"></option>
                                    </template>
                                </select>
                            </div>
                        </div>
                        
                        <!-- KayÄ±t Listesi -->
                        <template x-if="farmbookRecords.length === 0">
                            <div class="bg-[var(--bg-card)] rounded-2xl p-8 text-center border border-[var(--border)]">
                                <i class="fas fa-book-open text-4xl text-emerald-300 mb-4"></i>
                                <h3 class="font-bold text-lg mb-2">HenÃ¼z kayÄ±t yok</h3>
                                <p class="text-sm text-[var(--text-sec)] mb-4">Ä°lk kaydÄ±nÄ±zÄ± ekleyerek baÅŸlayÄ±n</p>
                                <button @click="farmbookTab = 'add'" class="bg-emerald-500 text-white px-6 py-2 rounded-xl font-bold text-sm">
                                    <i class="fas fa-plus mr-2"></i> KayÄ±t Ekle
                                </button>
                            </div>
                        </template>
                        
                        <div class="space-y-3">
                            <template x-for="record in farmbookRecords" :key="record.id">
                                <div class="bg-[var(--bg-card)] rounded-2xl p-4 border border-[var(--border)] shadow-sm hover:shadow-md transition">
                                    <div class="flex items-start justify-between">
                                        <div class="flex items-center gap-3">
                                            <div :class="getRecordTypeInfo(record.recordType).color" class="w-12 h-12 rounded-xl flex items-center justify-center text-white shadow-lg">
                                                <i class="fas" :class="getRecordTypeInfo(record.recordType).icon"></i>
                                            </div>
                                            <div>
                                                <h4 class="font-bold" x-text="record.productName || getRecordTypeInfo(record.recordType).label"></h4>
                                                <p class="text-xs text-[var(--text-sec)]">
                                                    <i class="far fa-calendar mr-1"></i>
                                                    <span x-text="new Date(record.recordDate).toLocaleDateString('tr-TR')"></span>
                                                    <template x-if="record.fieldName">
                                                        <span class="ml-2">
                                                            <i class="fas fa-map-marker-alt mr-1"></i>
                                                            <span x-text="record.fieldName"></span>
                                                        </span>
                                                    </template>
                                                </p>
                                            </div>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <button @click="editFarmbookRecord(record)" class="w-8 h-8 rounded-full bg-blue-50 text-blue-500 flex items-center justify-center hover:bg-blue-100">
                                                <i class="fas fa-edit text-xs"></i>
                                            </button>
                                            <button @click="deleteFarmbookRecord(record.id)" class="w-8 h-8 rounded-full bg-red-50 text-red-500 flex items-center justify-center hover:bg-red-100">
                                                <i class="fas fa-trash text-xs"></i>
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <!-- Detaylar -->
                                    <div class="mt-3 pt-3 border-t border-[var(--border)] grid grid-cols-2 gap-3 text-sm">
                                        <template x-if="record.quantity">
                                            <div class="flex items-center gap-2">
                                                <i class="fas fa-weight text-[var(--text-sec)]"></i>
                                                <span x-text="record.quantity + ' ' + (record.unit || '')"></span>
                                            </div>
                                        </template>
                                        <template x-if="record.cost > 0">
                                            <div class="flex items-center gap-2 text-red-500">
                                                <i class="fas fa-arrow-down"></i>
                                                <span x-text="formatMoney(record.cost) + ' â‚º'"></span>
                                            </div>
                                        </template>
                                        <template x-if="record.income > 0">
                                            <div class="flex items-center gap-2 text-emerald-500">
                                                <i class="fas fa-arrow-up"></i>
                                                <span x-text="formatMoney(record.income) + ' â‚º'"></span>
                                            </div>
                                        </template>
                                        <template x-if="record.harvestAmount">
                                            <div class="flex items-center gap-2 text-yellow-600">
                                                <i class="fas fa-wheat-alt"></i>
                                                <span x-text="record.harvestAmount + ' ' + (record.harvestUnit || 'kg')"></span>
                                            </div>
                                        </template>
                                    </div>
                                    
                                    <template x-if="record.notes">
                                        <div class="mt-3 p-3 bg-[var(--input-bg)] rounded-xl text-sm text-[var(--text-sec)]">
                                            <i class="fas fa-sticky-note mr-2 text-purple-400"></i>
                                            <span x-text="record.notes"></span>
                                        </div>
                                    </template>
                                </div>
                            </template>
                        </div>
                    </div>
                </template>
                
                <!-- YENÄ° KAYIT TAB -->
                <template x-if="farmbookTab === 'add' && !farmbookLoading">
                    <div class="space-y-4">
                        <div class="bg-[var(--bg-card)] rounded-2xl p-4 border border-[var(--border)]">
                            <h3 class="font-bold text-lg mb-4 flex items-center gap-2">
                                <i class="fas fa-plus-circle text-emerald-500"></i>
                                <span x-text="farmbookEditMode ? 'KaydÄ± DÃ¼zenle' : 'Yeni KayÄ±t'"></span>
                            </h3>
                            
                            <!-- KayÄ±t Tipi -->
                            <div class="mb-4">
                                <label class="block text-sm font-bold mb-2">KayÄ±t Tipi *</label>
                                <div class="grid grid-cols-4 gap-2">
                                    <template x-for="type in farmbookRecordTypes" :key="type.value">
                                        <button @click="farmbookForm.recordType = type.value" type="button"
                                                :class="farmbookForm.recordType === type.value ? type.color + ' text-white shadow-lg scale-105' : 'bg-[var(--input-bg)] text-[var(--text-sec)]'"
                                                class="flex flex-col items-center justify-center p-3 rounded-xl transition-all duration-200">
                                            <i class="fas mb-1" :class="type.icon"></i>
                                            <span class="text-[10px] font-bold" x-text="type.label"></span>
                                        </button>
                                    </template>
                                </div>
                            </div>
                            
                            <!-- Tarih -->
                            <div class="mb-4">
                                <label class="block text-sm font-bold mb-2">Tarih *</label>
                                <input type="date" x-model="farmbookForm.recordDate" 
                                       class="w-full bg-[var(--input-bg)] border border-[var(--border)] rounded-xl px-4 py-3 text-sm">
                            </div>
                            
                            <!-- ÃœrÃ¼n/Ä°ÅŸlem AdÄ± -->
                            <div class="mb-4">
                                <label class="block text-sm font-bold mb-2">ÃœrÃ¼n / Ä°ÅŸlem AdÄ±</label>
                                <input type="text" x-model="farmbookForm.productName" placeholder="Ã¶rn: BuÄŸday, DAP GÃ¼bresi..."
                                       class="w-full bg-[var(--input-bg)] border border-[var(--border)] rounded-xl px-4 py-3 text-sm">
                            </div>
                            
                            <!-- Miktar ve Birim -->
                            <div class="grid grid-cols-2 gap-3 mb-4">
                                <div>
                                    <label class="block text-sm font-bold mb-2">Miktar</label>
                                    <input type="number" x-model="farmbookForm.quantity" placeholder="0" step="0.01"
                                           class="w-full bg-[var(--input-bg)] border border-[var(--border)] rounded-xl px-4 py-3 text-sm">
                                </div>
                                <div>
                                    <label class="block text-sm font-bold mb-2">Birim</label>
                                    <select x-model="farmbookForm.unit" class="w-full bg-[var(--input-bg)] border border-[var(--border)] rounded-xl px-4 py-3 text-sm">
                                        <template x-for="u in farmbookUnits">
                                            <option :value="u" x-text="u"></option>
                                        </template>
                                    </select>
                                </div>
                            </div>
                            
                            <!-- Maliyet ve Gelir -->
                            <div class="grid grid-cols-2 gap-3 mb-4">
                                <div>
                                    <label class="block text-sm font-bold mb-2 text-red-500">
                                        <i class="fas fa-arrow-down mr-1"></i> Maliyet (â‚º)
                                    </label>
                                    <input type="number" x-model="farmbookForm.cost" placeholder="0.00" step="0.01"
                                           class="w-full bg-red-50 border border-red-200 rounded-xl px-4 py-3 text-sm">
                                </div>
                                <div>
                                    <label class="block text-sm font-bold mb-2 text-emerald-500">
                                        <i class="fas fa-arrow-up mr-1"></i> Gelir (â‚º)
                                    </label>
                                    <input type="number" x-model="farmbookForm.income" placeholder="0.00" step="0.01"
                                           class="w-full bg-emerald-50 border border-emerald-200 rounded-xl px-4 py-3 text-sm">
                                </div>
                            </div>
                            
                            <!-- Tarla Bilgisi -->
                            <div class="grid grid-cols-3 gap-3 mb-4">
                                <div class="col-span-2">
                                    <label class="block text-sm font-bold mb-2">Tarla AdÄ±</label>
                                    <input type="text" x-model="farmbookForm.fieldName" placeholder="Ã¶rn: KÃ¶y AltÄ± Tarla" list="fieldList"
                                           class="w-full bg-[var(--input-bg)] border border-[var(--border)] rounded-xl px-4 py-3 text-sm">
                                    <datalist id="fieldList">
                                        <template x-for="f in farmbookFields">
                                            <option :value="f.fieldName"></option>
                                        </template>
                                    </datalist>
                                </div>
                                <div>
                                    <label class="block text-sm font-bold mb-2">Alan</label>
                                    <div class="flex gap-1">
                                        <input type="number" x-model="farmbookForm.fieldSize" placeholder="0" step="0.1"
                                               class="flex-1 bg-[var(--input-bg)] border border-[var(--border)] rounded-l-xl px-3 py-3 text-sm">
                                        <select x-model="farmbookForm.fieldSizeUnit" class="bg-[var(--input-bg)] border border-[var(--border)] rounded-r-xl px-2 py-3 text-xs">
                                            <option value="dekar">Dk</option>
                                            <option value="hektar">Ha</option>
                                            <option value="m2">mÂ²</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Sezon ve YÄ±l -->
                            <div class="grid grid-cols-2 gap-3 mb-4">
                                <div>
                                    <label class="block text-sm font-bold mb-2">Sezon</label>
                                    <select x-model="farmbookForm.season" class="w-full bg-[var(--input-bg)] border border-[var(--border)] rounded-xl px-4 py-3 text-sm">
                                        <option value="">SeÃ§iniz</option>
                                        <template x-for="s in farmbookSeasons">
                                            <option :value="s.value" x-text="s.label"></option>
                                        </template>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-bold mb-2">YÄ±l</label>
                                    <select x-model="farmbookForm.year" class="w-full bg-[var(--input-bg)] border border-[var(--border)] rounded-xl px-4 py-3 text-sm">
                                        <template x-for="y in [2026, 2025, 2024, 2023, 2022]">
                                            <option :value="y" x-text="y"></option>
                                        </template>
                                    </select>
                                </div>
                            </div>
                            
                            <!-- Hasat Bilgileri (sadece hasat tipinde) -->
                            <template x-if="farmbookForm.recordType === 'hasat'">
                                <div class="bg-yellow-50 border border-yellow-200 rounded-xl p-4 mb-4">
                                    <h4 class="font-bold text-sm mb-3 text-yellow-700">
                                        <i class="fas fa-wheat-alt mr-2"></i> Hasat Bilgileri
                                    </h4>
                                    <div class="grid grid-cols-2 gap-3">
                                        <div>
                                            <label class="block text-sm font-bold mb-2">Hasat MiktarÄ±</label>
                                            <div class="flex gap-1">
                                                <input type="number" x-model="farmbookForm.harvestAmount" placeholder="0" step="0.01"
                                                       class="flex-1 bg-white border border-yellow-300 rounded-l-xl px-3 py-2 text-sm">
                                                <select x-model="farmbookForm.harvestUnit" class="bg-white border border-yellow-300 rounded-r-xl px-2 py-2 text-xs">
                                                    <template x-for="u in farmbookUnits">
                                                        <option :value="u" x-text="u"></option>
                                                    </template>
                                                </select>
                                            </div>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-bold mb-2">Kalite (1-5)</label>
                                            <div class="flex gap-1">
                                                <template x-for="i in 5">
                                                    <button @click="farmbookForm.qualityRating = i" type="button"
                                                            :class="farmbookForm.qualityRating >= i ? 'text-yellow-500' : 'text-gray-300'"
                                                            class="text-2xl transition">
                                                        <i class="fas fa-star"></i>
                                                    </button>
                                                </template>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </template>
                            
                            <!-- Hava Durumu -->
                            <div class="mb-4">
                                <label class="block text-sm font-bold mb-2">Hava Durumu</label>
                                <div class="flex flex-wrap gap-2">
                                    <template x-for="w in farmbookWeatherOptions" :key="w.value">
                                        <button @click="farmbookForm.weatherCondition = farmbookForm.weatherCondition === w.value ? '' : w.value" type="button"
                                                :class="farmbookForm.weatherCondition === w.value ? 'bg-blue-500 text-white' : 'bg-[var(--input-bg)] text-[var(--text-sec)]'"
                                                class="flex items-center gap-2 px-4 py-2 rounded-xl text-sm font-bold transition">
                                            <i class="fas" :class="w.icon"></i>
                                            <span x-text="w.label"></span>
                                        </button>
                                    </template>
                                </div>
                            </div>
                            
                            <!-- Notlar -->
                            <div class="mb-4">
                                <label class="block text-sm font-bold mb-2">Notlar</label>
                                <textarea x-model="farmbookForm.notes" rows="3" placeholder="Ek bilgi, gÃ¶zlemler..."
                                          class="w-full bg-[var(--input-bg)] border border-[var(--border)] rounded-xl px-4 py-3 text-sm resize-none"></textarea>
                            </div>
                            
                            <!-- Butonlar -->
                            <div class="flex gap-3">
                                <button @click="resetFarmbookForm(); farmbookTab = 'records'" 
                                        class="flex-1 py-3 bg-[var(--input-bg)] text-[var(--text-sec)] rounded-xl font-bold text-sm">
                                    Ä°ptal
                                </button>
                                <button @click="saveFarmbookRecord()" 
                                        class="flex-1 py-3 bg-gradient-to-r from-green-600 to-emerald-500 text-white rounded-xl font-bold text-sm shadow-lg">
                                    <i class="fas fa-check mr-2"></i>
                                    <span x-text="farmbookEditMode ? 'GÃ¼ncelle' : 'Kaydet'"></span>
                                </button>
                            </div>
                        </div>
                    </div>
                </template>
                
                <!-- Ä°STATÄ°STÄ°K TAB -->
                <template x-if="farmbookTab === 'stats' && !farmbookLoading && farmbookStats">
                    <div class="space-y-4">
                        <!-- Ã–zet Kartlar -->
                        <div class="grid grid-cols-2 gap-3">
                            <div class="bg-gradient-to-br from-red-500 to-rose-600 rounded-2xl p-4 text-white shadow-lg">
                                <div class="flex items-center gap-3 mb-2">
                                    <div class="w-10 h-10 bg-white/20 rounded-xl flex items-center justify-center">
                                        <i class="fas fa-arrow-down"></i>
                                    </div>
                                    <span class="text-sm font-bold text-white/80">Toplam Gider</span>
                                </div>
                                <p class="text-2xl font-black" x-text="formatMoney(farmbookStats.totalCost) + ' â‚º'"></p>
                            </div>
                            
                            <div class="bg-gradient-to-br from-emerald-500 to-green-600 rounded-2xl p-4 text-white shadow-lg">
                                <div class="flex items-center gap-3 mb-2">
                                    <div class="w-10 h-10 bg-white/20 rounded-xl flex items-center justify-center">
                                        <i class="fas fa-arrow-up"></i>
                                    </div>
                                    <span class="text-sm font-bold text-white/80">Toplam Gelir</span>
                                </div>
                                <p class="text-2xl font-black" x-text="formatMoney(farmbookStats.totalIncome) + ' â‚º'"></p>
                            </div>
                        </div>
                        
                        <!-- Kar/Zarar -->
                        <div :class="farmbookStats.profit >= 0 ? 'bg-gradient-to-r from-green-600 to-teal-500' : 'bg-gradient-to-r from-red-600 to-rose-500'"
                             class="rounded-2xl p-5 text-white shadow-xl">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-bold text-white/80 mb-1">Net KÃ¢r / Zarar</p>
                                    <p class="text-3xl font-black" x-text="(farmbookStats.profit >= 0 ? '+' : '') + formatMoney(farmbookStats.profit) + ' â‚º'"></p>
                                </div>
                                <div class="w-16 h-16 bg-white/20 rounded-full flex items-center justify-center">
                                    <i class="fas text-3xl" :class="farmbookStats.profit >= 0 ? 'fa-chart-line' : 'fa-chart-line-down'"></i>
                                </div>
                            </div>
                            <template x-if="farmbookStats.profitMargin">
                                <p class="mt-2 text-sm text-white/70">
                                    Kar MarjÄ±: %<span x-text="farmbookStats.profitMargin"></span>
                                </p>
                            </template>
                        </div>
                        
                        <!-- KayÄ±t SayÄ±larÄ± -->
                        <div class="bg-[var(--bg-card)] rounded-2xl p-4 border border-[var(--border)]">
                            <h3 class="font-bold text-sm mb-3 flex items-center gap-2">
                                <i class="fas fa-chart-pie text-emerald-500"></i> KayÄ±t DaÄŸÄ±lÄ±mÄ±
                            </h3>
                            <div class="grid grid-cols-4 gap-2">
                                <template x-for="type in farmbookRecordTypes" :key="type.value">
                                    <div class="text-center p-3 bg-[var(--input-bg)] rounded-xl">
                                        <div :class="type.color" class="w-10 h-10 rounded-xl flex items-center justify-center text-white mx-auto mb-2 shadow">
                                            <i class="fas" :class="type.icon"></i>
                                        </div>
                                        <p class="text-lg font-black" x-text="farmbookStats.recordCounts[type.value] || 0"></p>
                                        <p class="text-[10px] text-[var(--text-sec)]" x-text="type.label"></p>
                                    </div>
                                </template>
                            </div>
                        </div>
                        
                        <!-- ÃœrÃ¼nler -->
                        <template x-if="farmbookStats.products && farmbookStats.products.length > 0">
                            <div class="bg-[var(--bg-card)] rounded-2xl p-4 border border-[var(--border)]">
                                <h3 class="font-bold text-sm mb-3 flex items-center gap-2">
                                    <i class="fas fa-seedling text-green-500"></i> Ekilen ÃœrÃ¼nler
                                </h3>
                                <div class="space-y-2">
                                    <template x-for="p in farmbookStats.products" :key="p.productName">
                                        <div class="flex items-center justify-between bg-[var(--input-bg)] rounded-xl p-3">
                                            <div class="flex items-center gap-3">
                                                <div class="w-10 h-10 bg-green-100 rounded-xl flex items-center justify-center text-green-600">
                                                    <i class="fas fa-seedling"></i>
                                                </div>
                                                <div>
                                                    <p class="font-bold" x-text="p.productName"></p>
                                                    <p class="text-xs text-[var(--text-sec)]" x-text="p.fieldName || 'Tarla belirtilmedi'"></p>
                                                </div>
                                            </div>
                                            <template x-if="p.fieldSize">
                                                <span class="text-sm font-bold text-emerald-600" x-text="p.fieldSize + ' ' + (p.fieldSizeUnit || 'dk')"></span>
                                            </template>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </template>
                        
                        <!-- Hasat Bilgileri -->
                        <template x-if="farmbookStats.harvests && farmbookStats.harvests.length > 0">
                            <div class="bg-[var(--bg-card)] rounded-2xl p-4 border border-[var(--border)]">
                                <h3 class="font-bold text-sm mb-3 flex items-center gap-2">
                                    <i class="fas fa-wheat-alt text-yellow-500"></i> Hasat SonuÃ§larÄ±
                                </h3>
                                <div class="space-y-2">
                                    <template x-for="h in farmbookStats.harvests" :key="h.productName">
                                        <div class="flex items-center justify-between bg-yellow-50 rounded-xl p-3">
                                            <div class="flex items-center gap-3">
                                                <div class="w-10 h-10 bg-yellow-100 rounded-xl flex items-center justify-center text-yellow-600">
                                                    <i class="fas fa-wheat-alt"></i>
                                                </div>
                                                <div>
                                                    <p class="font-bold" x-text="h.productName"></p>
                                                    <template x-if="h.avgQuality">
                                                        <div class="flex items-center gap-1">
                                                            <template x-for="i in 5">
                                                                <i class="fas fa-star text-xs" :class="i <= Math.round(h.avgQuality) ? 'text-yellow-500' : 'text-gray-300'"></i>
                                                            </template>
                                                        </div>
                                                    </template>
                                                </div>
                                            </div>
                                            <span class="text-lg font-black text-yellow-600" x-text="h.totalHarvest + ' ' + (h.harvestUnit || 'kg')"></span>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </template>
                        
                        <!-- GeÃ§miÅŸ Sezonlar -->
                        <template x-if="farmbookStats.seasons && farmbookStats.seasons.length > 0">
                            <div class="bg-[var(--bg-card)] rounded-2xl p-4 border border-[var(--border)]">
                                <h3 class="font-bold text-sm mb-3 flex items-center gap-2">
                                    <i class="fas fa-history text-purple-500"></i> GeÃ§miÅŸ Sezonlar
                                </h3>
                                <div class="flex flex-wrap gap-2">
                                    <template x-for="s in farmbookStats.seasons" :key="s.season + s.year">
                                        <button @click="farmbookFilters.season = s.season; farmbookFilters.year = s.year; loadFarmbookRecords(); loadFarmbookStats()"
                                                class="px-4 py-2 bg-purple-50 text-purple-600 rounded-xl text-sm font-bold hover:bg-purple-100 transition">
                                            <span x-text="getSeasonLabel(s.season)"></span> <span x-text="s.year"></span>
                                        </button>
                                    </template>
                                </div>
                            </div>
                        </template>
                    </div>
                </template>
            </div>
        </div>
    </template>
    
    <!-- ========== ONBOARDING MODAL ========== -->
    <template x-if="showOnboarding">
        <div class="fixed inset-0 z-[99999]">
            <!-- Overlay -->
            <div class="onboarding-overlay" @click="skipOnboarding()"></div>
            
            <!-- Highlight -->
            <div class="onboarding-highlight" 
                :style="{
                    top: getOnboardingTargetRect().top + 'px',
                    left: getOnboardingTargetRect().left + 'px',
                    width: getOnboardingTargetRect().width + 'px',
                    height: getOnboardingTargetRect().height + 'px'
                }">
            </div>
            
            <!-- Tooltip -->
            <div class="onboarding-tooltip" 
                :class="getOnboardingArrowClass()"
                :style="getOnboardingTooltipStyle()">
                
                <!-- Icon -->
                <div class="onboarding-icon">
                    <i class="fas" :class="onboardingSteps[onboardingStep]?.icon"></i>
                </div>
                
                <!-- Title -->
                <h3 class="onboarding-title" x-text="onboardingSteps[onboardingStep]?.title"></h3>
                
                <!-- Text -->
                <p class="onboarding-text" x-text="onboardingSteps[onboardingStep]?.text"></p>
                
                <!-- Progress -->
                <div class="onboarding-progress">
                    <template x-for="(step, idx) in onboardingSteps" :key="idx">
                        <div class="onboarding-progress-dot" 
                            :class="{
                                'active': idx === onboardingStep,
                                'done': idx < onboardingStep
                            }">
                        </div>
                    </template>
                </div>
                
                <!-- Buttons -->
                <div class="onboarding-buttons">
                    <button class="onboarding-btn onboarding-btn-skip" @click="skipOnboarding()">
                        Atla
                    </button>
                    <button class="onboarding-btn onboarding-btn-next" @click="nextOnboardingStep()">
                        <span x-text="onboardingStep === onboardingSteps.length - 1 ? 'BaÅŸla!' : 'Ä°leri'"></span>
                        <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

</body>
</html>
