<!DOCTYPE html>
<html lang="tr" x-data="agroApp()" :class="darkMode ? 'dark-theme' : ''">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AgroLink | Dijital Tarƒ±m Topluluƒüu</title>
    <meta name="description" content="AgroLink - √áift√ßiler i√ßin dijital tarƒ±m topluluƒüu. Bilgi payla≈ü, √ºr√ºn sat, baƒülantƒ± kur.">
    
    <!-- ========== G√úVENLƒ∞K Sƒ∞STEMƒ∞ v3.0 - ALPINE.JS UYUMLU ========== -->
    <!-- 
      ‚úÖ D√úZELTME v3.0: CSP Alpine.js ile uyumlu hale getirildi
      
      ALPINE.JS GEREKSƒ∞Nƒ∞MLERƒ∞:
      ‚Ä¢ 'unsafe-inline' - x-data, x-on, :class direktifleri i√ßin ZORUNLU
      ‚Ä¢ 'unsafe-eval' - Alpine expression evaluator i√ßin ZORUNLU
      ‚Ä¢ Bu deƒüerler olmadan Alpine.js BA≈ûLATILAMAZ ‚Üí Beyaz ekran/splash takƒ±lmasƒ±
      
      G√úVENLƒ∞K √ñNLEMLERƒ∞:
      ‚Ä¢ Script kaynaklarƒ± sadece g√ºvenilir CDN'lere izin verir
      ‚Ä¢ XSS korumasƒ± i√ßin input sanitization aktif
      ‚Ä¢ Clickjacking korumasƒ± (frame-ancestors: 'none')
      ‚Ä¢ Mixed-content korumasƒ± (upgrade-insecure-requests)
    -->
    
    
    <!-- üîí X-XSS-Protection intentionally removed: deprecated and potentially harmful in modern browsers -->
    <!-- No Sniffing -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <!-- Frame Options - Clickjacking korumasƒ± (DENY = hi√ßbir frame'e izin verme) -->
    <meta http-equiv="X-Frame-Options" content="DENY">
    <!-- Referrer Policy -->
    <meta name="referrer" content="strict-origin-when-cross-origin">
    <!-- Permissions Policy -->
    <!-- üîí Permissions-Policy: Sadece gerekli API'lere izin ver -->
    <meta http-equiv="Permissions-Policy" content="accelerometer=(), ambient-light-sensor=(), autoplay=(self), battery=(), camera=(self), display-capture=(self), document-domain=(), encrypted-media=(), execution-while-not-rendered=(), execution-while-out-of-viewport=(), fullscreen=(self), geolocation=(), gyroscope=(), interest-cohort=(), magnetometer=(), microphone=(self), midi=(), navigation-override=(), payment=(), picture-in-picture=(self), publickey-credentials-get=(), screen-wake-lock=(), sync-xhr=(), usb=(), web-share=(self), xr-spatial-tracking=()">
    <!-- ========== ASKERƒ∞ D√úZEY G√úVENLƒ∞K Bƒ∞Tƒ∞≈û ========== -->
    
    <!-- üîí URL tabanlƒ± XSS / Yansƒ±ma saldƒ±rƒ±sƒ± korumasƒ± - Sayfa y√ºklenmeden √∂nce √ßalƒ±≈üƒ±r -->
    <script>
    (function() {
        'use strict';
        // üîí G√úVENLƒ∞K D√úZELTMESƒ∞: Daha kapsamlƒ± XSS pattern listesi
        var suspicious = [
            /<script/i, /javascript:/i, /vbscript:/i, /on\w+\s*=/i,
            /<iframe/i, /eval\s*\(/i, /document\.cookie/i, /document\.write/i,
            /<object/i, /<embed/i, /data:text\/html/i, /expression\s*\(/i,
            /alert\s*\(/i, /prompt\s*\(/i, /confirm\s*\(/i, /fromcharcode/i,
            /&#\d+;/i, /%3cscript/i, /\u003cscript/i
        ];
        var toCheck = [
            window.location.search,
            window.location.hash,
            window.location.pathname
        ];
        var isThreat = suspicious.some(function(p) {
            return toCheck.some(function(s) {
                try { return p.test(decodeURIComponent(s)); } catch(e) { return p.test(s); }
            });
        });
        if (isThreat) {
            console.warn('[AgroLink Security] URL tabanlƒ± XSS denemesi engellendi');
            // üîí G√úVENLƒ∞K D√úZELTMESƒ∞: document.write YERƒ∞NE g√ºvenli DOM API kullanƒ±yoruz
            // document.write kendisi de XSS a√ßƒ±ƒüƒ± olu≈üturabilir
            document.documentElement.innerHTML = '';
            var body = document.createElement('body');
            body.style.cssText = 'font-family:sans-serif;padding:60px;text-align:center;background:#fff3f3';
            var h2 = document.createElement('h2');
            h2.style.color = '#d32f2f';
            h2.textContent = '\uD83D\uDD12 G√ºvenlik ƒ∞hlali Engellendi';
            var p = document.createElement('p');
            p.textContent = 'Bu istek g√ºvenlik nedeniyle reddedildi.';
            body.appendChild(h2);
            body.appendChild(p);
            document.documentElement.appendChild(body);
            // Sayfayƒ± tarihe eklemeden y√∂nlendir
            history.replaceState(null, '', '/');
        }
    })();
    </script>
    
        <!-- Tailwind CSS CDN (production uyarƒ±sƒ± intentional olarak susturuldu) -->
    <script>
    (function(){var _w=console.warn;console.warn=function(){var m=arguments[0];if(typeof m==='string'&&m.indexOf('cdn.tailwindcss.com')!==-1)return;_w.apply(console,arguments);};})();
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.6.2/axios.min.js"></script>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <!-- üé¨ HLS.js - YouTube ABR Adaptive Bitrate Streaming -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@1.5.13/dist/hls.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap');

        :root {
            --agro-green: #00b894;
            --agro-green-dark: #00916e;
            --agro-teal: #00cec9;
            --bg-main: #f0f4f8;
            --bg-card: #ffffff;
            --text-main: #0f172a;
            --text-sec: #64748b;
            --border: #e8edf3;
            --input-bg: #f1f5f9;
            --radius-sm: 12px;
            --radius-md: 18px;
            --radius-lg: 24px;
            --radius-xl: 32px;
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.06);
            --shadow-md: 0 4px 20px rgba(0,0,0,0.09);
            --shadow-lg: 0 8px 40px rgba(0,0,0,0.12);
            --shadow-green: 0 6px 24px rgba(0,184,148,0.25);
            --glass-bg: rgba(255,255,255,0.88);
            --glass-border: rgba(255,255,255,0.5);
            --transition-bounce: cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .dark-theme {
            --bg-main: #080e1a;
            --bg-card: #111827;
            --text-main: #f1f5f9;
            --text-sec: #94a3b8;
            --border: #1e2d45;
            --input-bg: #0d1526;
            --glass-bg: rgba(11,17,32,0.90);
            --glass-border: rgba(255,255,255,0.07);
        }

        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background-color: var(--bg-main); 
            color: var(--text-main); 
            transition: background-color 0.35s ease, color 0.35s ease; 
            -webkit-user-select: none; 
            -moz-user-select: none; 
            -ms-user-select: none; 
            user-select: none;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        /* ========== GELƒ∞≈ûMƒ∞≈û Y√úKLEME EKRANI ========== */
        .page-loading-overlay {
            position: fixed;
            inset: 0;
            z-index: 99999;
            background: linear-gradient(135deg, #080e1a 0%, #0d2137 35%, #0a1e32 65%, #080e1a 100%);
            background-size: 400% 400%;
            animation: gradientShift 8s ease infinite;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 30px;
        }
        .page-loading-overlay.hidden {
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.5s ease-out, visibility 0.5s ease-out;
        }
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .loading-logo {
            width: 100px;
            height: 100px;
            border-radius: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: logoPulse 2s ease-in-out infinite, logoFloat 3s ease-in-out infinite;
            box-shadow: 0 20px 60px rgba(0, 184, 148, 0.4);
            overflow: hidden;
        }
        .loading-logo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 24px;
        }
        .loading-logo i {
            font-size: 48px;
            color: white;
            animation: leafSway 2s ease-in-out infinite;
        }
        @keyframes logoPulse {
            0%, 100% { transform: scale(1); box-shadow: 0 20px 60px rgba(0, 184, 148, 0.4); }
            50% { transform: scale(1.05); box-shadow: 0 25px 80px rgba(0, 184, 148, 0.6); }
        }
        @keyframes logoFloat {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-10px) scale(1.05); }
        }
        @keyframes leafSway {
            0%, 100% { transform: rotate(-5deg); }
            50% { transform: rotate(5deg); }
        }
        
        .loading-text {
            text-align: center;
        }
        .loading-text h2 {
            font-size: 28px;
            font-weight: 800;
            background: linear-gradient(90deg, #00b894, #00cec9, #0984e3, #00b894);
            background-size: 300% 100%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: textGradient 3s linear infinite;
        }
        .loading-text p {
            color: rgba(255,255,255,0.7);
            font-size: 14px;
            margin-top: 8px;
            animation: textFade 2s ease-in-out infinite;
        }
        @keyframes textGradient {
            0% { background-position: 0% 50%; }
            100% { background-position: 100% 50%; }
        }
        @keyframes textFade {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }
        
        .loading-dots {
            display: flex;
            gap: 8px;
            margin-top: 10px;
            justify-content: center;
        }
        .loading-dots span {
            width: 10px;
            height: 10px;
            background: #00b894;
            border-radius: 50%;
            animation: dotBounce 1.4s ease-in-out infinite;
        }
        .loading-dots span:nth-child(1) { animation-delay: 0s; }
        .loading-dots span:nth-child(2) { animation-delay: 0.2s; }
        .loading-dots span:nth-child(3) { animation-delay: 0.4s; }
        @keyframes dotBounce {
            0%, 80%, 100% { transform: scale(0.6); opacity: 0.5; }
            40% { transform: scale(1); opacity: 1; }
        }
        
        .loading-progress {
            width: 200px;
            height: 4px;
            background: rgba(255,255,255,0.1);
            border-radius: 2px;
            overflow: hidden;
            margin-top: 20px;
        }
        .loading-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #00b894, #00cec9);
            border-radius: 2px;
            animation: progressAnim 2s ease-in-out infinite;
        }
        @keyframes progressAnim {
            0% { width: 0%; transform: translateX(0); }
            50% { width: 70%; }
            100% { width: 100%; transform: translateX(0); }
        }
        
        /* Particles */
        .loading-particles {
            position: absolute;
            width: 100%;
            height: 100%;
            overflow: hidden;
            pointer-events: none;
        }
        .loading-particle {
            position: absolute;
            width: 6px;
            height: 6px;
            background: rgba(0, 184, 148, 0.5);
            border-radius: 50%;
            animation: particleFloat 4s ease-in-out infinite;
        }
        .loading-particle:nth-child(1) { left: 10%; top: 20%; animation-delay: 0s; }
        .loading-particle:nth-child(2) { left: 20%; top: 80%; animation-delay: 0.5s; }
        .loading-particle:nth-child(3) { left: 80%; top: 15%; animation-delay: 1s; }
        .loading-particle:nth-child(4) { left: 70%; top: 70%; animation-delay: 1.5s; }
        .loading-particle:nth-child(5) { left: 50%; top: 50%; animation-delay: 2s; }
        .loading-particle:nth-child(6) { left: 30%; top: 60%; animation-delay: 2.5s; }
        @keyframes particleFloat {
            0%, 100% { transform: translateY(0) scale(1); opacity: 0.5; }
            50% { transform: translateY(-30px) scale(1.2); opacity: 1; }
        }
        
        .page-loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(0, 184, 148, 0.2);
            border-top-color: #00b894;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ========== CAROUSEL / √áOKLU MEDYA ========== */
        .media-carousel {
            position: relative;
            overflow: hidden;
            border-radius: 1.2rem;
        }
        .media-carousel-track {
            display: flex;
            transition: transform 0.35s cubic-bezier(0.4,0,0.2,1);
            will-change: transform;
        }
        .media-carousel-slide {
            flex: 0 0 100%;
            width: 100%;
            position: relative;
        }
        .media-carousel-slide img,
        .media-carousel-slide video {
            width: 100%;
            display: block;
            max-height: 600px;
            min-height: 180px;
            object-fit: contain;
            background: #000;
        }
        .carousel-dots {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 6px;
            z-index: 10;
        }
        .carousel-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: rgba(255,255,255,0.5);
            transition: all 0.25s ease;
        }
        .carousel-dot.active {
            background: #fff;
            width: 18px;
            border-radius: 3px;
        }
        .carousel-nav-btn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            z-index: 10;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: rgba(0,0,0,0.5);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: none;
            backdrop-filter: blur(4px);
            transition: opacity 0.2s;
        }
        .carousel-nav-btn:hover { opacity: 0.9; }
        .carousel-nav-btn.prev { left: 8px; }
        .carousel-nav-btn.next { right: 8px; }
        .carousel-count-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.6);
            color: white;
            font-size: 12px;
            font-weight: 700;
            padding: 3px 9px;
            border-radius: 20px;
            backdrop-filter: blur(4px);
            z-index: 10;
        }

        /* ========== VIDEO LOADING SPINNER ========== */
        .video-loading-overlay {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0,0,0,0.35);
            z-index: 5;
            pointer-events: none;
            transition: opacity 0.2s;
        }
        .video-loading-overlay.hidden { opacity: 0; pointer-events: none; }
        .video-spinner {
            width: 48px;
            height: 48px;
            border: 4px solid rgba(255,255,255,0.25);
            border-top-color: #00b894;
            border-radius: 50%;
            animation: spin 0.85s linear infinite;
        }

        /* ========== √áOKLU MEDYA SE√áƒ∞Mƒ∞ (POST FORM) ========== */
        .multi-media-grid {
            display: grid;
            gap: 4px;
            border-radius: 16px;
            overflow: hidden;
        }
        .multi-media-grid.count-1 { grid-template-columns: 1fr; }
        .multi-media-grid.count-2 { grid-template-columns: 1fr 1fr; }
        .multi-media-grid.count-3 { grid-template-columns: 1fr 1fr; }
        .multi-media-grid.count-3 .media-thumb:first-child { grid-column: 1 / -1; }
        .multi-media-grid.count-4 { grid-template-columns: 1fr 1fr; }
        .multi-media-grid.count-many { grid-template-columns: 1fr 1fr 1fr; }
        .media-thumb {
            position: relative;
            aspect-ratio: 1;
            overflow: hidden;
            background: #000;
        }
        .media-thumb img, .media-thumb video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .media-thumb-remove {
            position: absolute;
            top: 4px;
            right: 4px;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: rgba(0,0,0,0.65);
            color: white;
            border: none;
            font-size: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 5;
        }
        .media-thumb-type {
            position: absolute;
            bottom: 4px;
            left: 4px;
            background: rgba(0,0,0,0.6);
            color: white;
            font-size: 9px;
            padding: 2px 6px;
            border-radius: 8px;
        }
        .add-more-btn {
            aspect-ratio: 1;
            border: 2px dashed var(--border);
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 4px;
            cursor: pointer;
            color: var(--text-sec);
            font-size: 12px;
            background: var(--input-bg);
            transition: border-color 0.2s, color 0.2s;
        }
        .add-more-btn:hover {
            border-color: #00b894;
            color: #00b894;
        }
        .glass { 
            background: var(--glass-bg, rgba(255,255,255,0.92)); 
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            border-bottom: 1px solid var(--glass-border, rgba(0,0,0,0.06));
            box-shadow: 0 1px 8px rgba(0,0,0,0.06);
        }
        .dark-theme .glass {
            --glass-bg: rgba(15,23,42,0.92);
            --glass-border: rgba(255,255,255,0.07);
            box-shadow: 0 1px 8px rgba(0,0,0,0.3);
        }
        .agro-card { 
            background: var(--bg-card);
            border: 1px solid var(--border); 
            border-radius: var(--radius-xl, 32px);
            box-shadow: var(--shadow-sm);
            transition: box-shadow 0.25s ease;
        }
        .agro-card:hover {
            box-shadow: var(--shadow-md);
        }
        .post-card-modern {
            background: var(--bg-card);
            border-radius: var(--radius-xl, 32px);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border);
            transition: box-shadow 0.3s ease, border-color 0.3s ease;
            overflow: hidden;
            position: relative;
            will-change: auto;
        }
        .post-card-modern::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 2px;
            background: linear-gradient(90deg, #00b894, #00cec9, #0984e3, #00b894);
            background-size: 200% 100%;
            opacity: 0;
            transition: opacity 0.4s ease;
            animation: gradientSlide 3s linear infinite;
        }
        @keyframes gradientSlide {
            0% { background-position: 0% 0; }
            100% { background-position: 200% 0; }
        }
        .post-card-modern:hover {
            box-shadow: var(--shadow-md);
        }
        .post-card-modern:hover::before {
            opacity: 1;
        }

        /* ============================================================
         * üé® AGROLINK UI v8 ‚Äî GLOBAL K√ñ≈ûE YUMU≈ûATMA & MODERNLE≈ûME
         * ============================================================ */

        /* === GLOBAL INPUT & BUTTON K√ñ≈ûELERI === */
        input, textarea, select {
            border-radius: var(--radius-md, 18px) !important;
            transition: box-shadow 0.2s ease, border-color 0.2s ease;
        }
        input:focus, textarea:focus {
            box-shadow: 0 0 0 3px rgba(0, 184, 148, 0.18) !important;
            outline: none !important;
        }
        button:not(.no-radius) {
            border-radius: var(--radius-md, 18px);
        }
        
        /* === HEADER LOGO === */
        .header-logo-wrapper {
            width: 36px; height: 36px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,184,148,0.2);
        }

        /* === AVATAR K√ñ≈ûELERI === */
        .rounded-full { border-radius: 9999px; }
        .rounded-xl  { border-radius: 16px !important; }
        .rounded-2xl { border-radius: 20px !important; }
        .rounded-3xl { border-radius: 28px !important; }

        /* === MODAL/SHEET K√ñ≈ûELERƒ∞ === */
        [class*="rounded-t-3xl"] { border-radius: 28px 28px 0 0 !important; }
        [class*="rounded-t-2xl"] { border-radius: 22px 22px 0 0 !important; }
        .fixed.inset-0 > div[class*="rounded"] {
            border-radius: var(--radius-xl, 32px);
        }

        /* === EXPLORE CATEGORY CHIPS ‚Äî Daha pill-shaped === */
        .explore-category-chip {
            border-radius: 999px !important;
            padding: 7px 16px !important;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.25s cubic-bezier(0.34,1.56,0.64,1);
            white-space: nowrap;
        }
        .explore-category-chip.active {
            box-shadow: 0 4px 16px rgba(0,184,148,0.3);
        }

        /* === DARK MODE GLASS RENK UYUMU === */
        .dark-theme nav > div {
            border-color: rgba(255,255,255,0.07) !important;
        }

        /* === BOTTOM NAV DARK MODE === */
        .dark-theme #bottomNav > div {
            background: rgba(11, 17, 32, 0.92) !important;
            box-shadow: 0 8px 32px rgba(0,0,0,0.4), 0 2px 8px rgba(0,0,0,0.2), inset 0 1px 0 rgba(255,255,255,0.06) !important;
            border-color: rgba(255,255,255,0.07) !important;
        }

        /* === SCROLL Hƒ∞ZALAMA (floating nav i√ßin) === */
        main {
            scroll-padding-bottom: 100px;
        }

        /* === G√ñNDERƒ∞ OLU≈ûTUR ALANIN INPUT'LARI === */
        .rounded-2xl input, .rounded-2xl textarea {
            border-radius: 18px !important;
        }

        /* === TAG/CHIP'LER === */
        [class*="rounded-full"][class*="text-xs"],
        [class*="rounded-full"][class*="text-sm"] {
            border-radius: 999px !important;
        }

        /* === Mƒ∞Nƒ∞ PROFILE Pƒ∞CKER AVATARLARI === */
        .story-ring { border-radius: 9999px; }

        /* === BILDIRIM BADGE === */
        .absolute.bg-red-500.rounded-full {
            border-radius: 999px !important;
            box-shadow: 0 2px 6px rgba(239,68,68,0.45);
        }

        /* === POST ACTION BUTONLARI === */
        button[class*="rounded-full"] {
            transition: all 0.25s cubic-bezier(0.34,1.56,0.64,1);
        }
        button[class*="rounded-full"]:active {
            transform: scale(0.88);
        }

        /* === SCROLLBAR GIZLE AMA KAYDIRMAYA ƒ∞Zƒ∞N VER === */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* === GE√áƒ∞≈û ANIMASYONLARI === */
        [x-transition] {
            transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1) !important;
        }

        /* === HEADER BRAND LOGO === */
        header h1 {
            font-size: 1.25rem;
            letter-spacing: -0.04em;
            background: linear-gradient(135deg, #00b894, #059669);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .dark-theme header h1 {
            background: linear-gradient(135deg, #34d399, #00b894);
            -webkit-background-clip: text;
            background-clip: text;
        }

        /* === HEADER AKSƒ∞YON BUTONLARI === */
        header button[class*="rounded-full"] {
            width: 38px; height: 38px;
            border-radius: 14px !important;
            transition: all 0.25s ease;
        }
        header button[class*="rounded-full"]:hover {
            background: rgba(0,184,148,0.12) !important;
            transform: scale(1.05);
        }
        header button[class*="rounded-full"]:active {
            transform: scale(0.93);
        }

        /* === YENƒ∞ DARK MODE ARKA PLAN DOKUSU === */
        .dark-theme body {
            background-image: radial-gradient(ellipse at 20% 50%, rgba(0,184,148,0.04) 0%, transparent 50%),
                              radial-gradient(ellipse at 80% 20%, rgba(9,132,227,0.03) 0%, transparent 50%);
        }

        /* === FLOATING NAV G√úVENLI ALAN (iPhone notch) === */
        @supports (padding-bottom: env(safe-area-inset-bottom)) {
            #bottomNav {
                padding-bottom: calc(16px + env(safe-area-inset-bottom)) !important;
            }
        }

        [x-cloak] { display: none !important; }
        
        /* ========== üèÜ GELƒ∞≈ûMƒ∞≈û ROZET Sƒ∞STEMƒ∞ STƒ∞LLERƒ∞ v2.0 ========== */
        .badge-container {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            margin-left: 6px;
        }
        .user-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 26px;
            height: 26px;
            border-radius: 50%;
            font-size: 13px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.15);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            cursor: pointer;
            z-index: 1;
        }
        .user-badge:hover {
            transform: scale(1.25) rotate(8deg);
            box-shadow: 0 6px 24px rgba(0, 0, 0, 0.3);
            z-index: 10;
        }

        /* ========== Zƒ∞RAAT M√úHENDƒ∞Sƒ∞ ROZETƒ∞ - PREMIUM ========== */
        .badge-agricultural {
            background: linear-gradient(135deg, #1b5e20, #2e7d32, #43a047);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 16px rgba(46, 125, 50, 0.5), inset 0 1px 2px rgba(255, 255, 255, 0.3);
            animation: agriPulse 3s ease-in-out infinite;
            width: 28px;
            height: 28px;
            font-size: 14px;
        }
        .badge-agricultural::after {
            content: '';
            position: absolute;
            inset: -4px;
            border-radius: 50%;
            border: 2px solid transparent;
            border-top-color: #4caf50;
            border-bottom-color: #81c784;
            animation: agriRingSpin 4s linear infinite;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .badge-agricultural:hover::after {
            opacity: 1;
        }
        @keyframes agriPulse {
            0%, 100% { box-shadow: 0 4px 16px rgba(46, 125, 50, 0.5), inset 0 1px 2px rgba(255, 255, 255, 0.3); }
            50% { box-shadow: 0 4px 24px rgba(46, 125, 50, 0.7), inset 0 1px 2px rgba(255, 255, 255, 0.4), 0 0 20px rgba(76, 175, 80, 0.3); }
        }
        @keyframes agriRingSpin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ========== ALTIN ROZET - 1. SIRADA - ULTRA PREMIUM ========== */
        .badge-gold {
            background: linear-gradient(135deg, #f9a825, #ffd54f, #ffb300, #ff8f00);
            background-size: 300% 300%;
            color: white;
            border: 2px solid rgba(255, 215, 0, 0.6);
            box-shadow: 
                0 4px 20px rgba(255, 193, 7, 0.6),
                0 0 40px rgba(255, 215, 0, 0.3),
                inset 0 2px 4px rgba(255, 255, 255, 0.5);
            animation: goldShimmer 3s ease infinite, goldGlow 2s ease-in-out infinite alternate;
            width: 32px;
            height: 32px;
            font-size: 16px;
        }
        .badge-gold::before {
            content: '';
            position: absolute;
            inset: -6px;
            border-radius: 50%;
            background: conic-gradient(from 0deg, #ffd700, #ffb300, #ff8f00, #ffa000, #ffca28, #ffd700);
            z-index: -1;
            animation: goldRingSpin 3s linear infinite;
            opacity: 0.6;
        }
        .badge-gold::after {
            content: '';
            position: absolute;
            top: -2px;
            left: 50%;
            transform: translateX(-50%);
            width: 6px;
            height: 6px;
            background: white;
            border-radius: 50%;
            box-shadow: 0 0 8px rgba(255, 255, 255, 0.8);
            animation: goldSparkle 2s ease-in-out infinite;
        }
        .badge-gold:hover {
            transform: scale(1.35) rotate(0deg);
            box-shadow: 
                0 8px 32px rgba(255, 193, 7, 0.7),
                0 0 60px rgba(255, 215, 0, 0.5),
                inset 0 2px 4px rgba(255, 255, 255, 0.6);
        }
        @keyframes goldShimmer {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        @keyframes goldGlow {
            0% { box-shadow: 0 4px 20px rgba(255, 193, 7, 0.5), 0 0 30px rgba(255, 215, 0, 0.2); }
            100% { box-shadow: 0 4px 30px rgba(255, 193, 7, 0.8), 0 0 50px rgba(255, 215, 0, 0.4); }
        }
        @keyframes goldRingSpin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        @keyframes goldSparkle {
            0%, 100% { opacity: 0.4; transform: translateX(-50%) scale(0.8); }
            50% { opacity: 1; transform: translateX(-50%) scale(1.2); }
        }

        /* ========== G√úM√ú≈û ROZET - 2. SIRADA ========== */
        .badge-silver {
            background: linear-gradient(135deg, #90a4ae, #cfd8dc, #b0bec5, #eceff1);
            background-size: 200% 200%;
            color: #37474f;
            border: 2px solid rgba(176, 190, 197, 0.5);
            box-shadow: 
                0 4px 16px rgba(144, 164, 174, 0.5),
                inset 0 2px 4px rgba(255, 255, 255, 0.6);
            animation: silverShimmer 4s ease infinite;
            width: 28px;
            height: 28px;
            font-size: 14px;
        }
        .badge-silver::before {
            content: '';
            position: absolute;
            inset: -4px;
            border-radius: 50%;
            border: 2px solid transparent;
            border-top-color: #b0bec5;
            border-right-color: #cfd8dc;
            animation: silverRingSpin 5s linear infinite;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .badge-silver:hover::before {
            opacity: 0.7;
        }
        .badge-silver:hover {
            box-shadow: 
                0 6px 24px rgba(144, 164, 174, 0.7),
                0 0 30px rgba(207, 216, 220, 0.4),
                inset 0 2px 4px rgba(255, 255, 255, 0.7);
        }
        @keyframes silverShimmer {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        @keyframes silverRingSpin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ========== BRONZ ROZET - 3. SIRADA ========== */
        .badge-bronze {
            background: linear-gradient(135deg, #8d6e63, #bcaaa4, #a1887f, #d7ccc8);
            background-size: 200% 200%;
            color: white;
            border: 2px solid rgba(161, 136, 127, 0.4);
            box-shadow: 
                0 4px 16px rgba(141, 110, 99, 0.5),
                inset 0 1px 3px rgba(255, 255, 255, 0.3);
            animation: bronzeShimmer 5s ease infinite;
            width: 26px;
            height: 26px;
            font-size: 13px;
        }
        .badge-bronze:hover {
            box-shadow: 
                0 6px 24px rgba(141, 110, 99, 0.7),
                0 0 20px rgba(188, 170, 164, 0.3),
                inset 0 1px 3px rgba(255, 255, 255, 0.4);
        }
        @keyframes bronzeShimmer {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* ========== ROZET TOOLTIP - GELƒ∞≈ûMƒ∞≈û ========== */
        .badge-tooltip {
            position: absolute;
            bottom: calc(100% + 12px);
            left: 50%;
            transform: translateX(-50%) scale(0.9) translateY(4px);
            background: linear-gradient(135deg, rgba(15, 23, 42, 0.95), rgba(30, 41, 59, 0.95));
            color: white;
            padding: 10px 16px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1000;
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.3);
        }
        .badge-tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 8px solid transparent;
            border-top-color: rgba(15, 23, 42, 0.95);
        }
        .user-badge:hover .badge-tooltip {
            opacity: 1;
            transform: translateX(-50%) scale(1) translateY(0);
        }

        /* ========== ROZET Vƒ∞TRƒ∞Nƒ∞ (PROFƒ∞L ƒ∞√áƒ∞N) ========== */
        .badge-showcase {
            display: flex;
            gap: 12px;
            padding: 16px;
            background: var(--input-bg);
            border-radius: 20px;
            border: 1px solid var(--border);
            margin-top: 12px;
            overflow-x: auto;
        }
        .badge-showcase-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            min-width: 80px;
            padding: 12px 8px;
            border-radius: 16px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .badge-showcase-item:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
        }
        .badge-showcase-icon {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
        }
        .badge-showcase-icon.gold-bg {
            background: linear-gradient(135deg, #f9a825, #ffd54f, #ffb300);
            box-shadow: 0 4px 16px rgba(255, 193, 7, 0.5);
            animation: goldGlow 2s ease-in-out infinite alternate;
        }
        .badge-showcase-icon.silver-bg {
            background: linear-gradient(135deg, #90a4ae, #cfd8dc, #b0bec5);
            box-shadow: 0 4px 16px rgba(144, 164, 174, 0.4);
        }
        .badge-showcase-icon.bronze-bg {
            background: linear-gradient(135deg, #8d6e63, #bcaaa4, #a1887f);
            box-shadow: 0 4px 16px rgba(141, 110, 99, 0.4);
        }
        .badge-showcase-icon.agri-bg {
            background: linear-gradient(135deg, #1b5e20, #2e7d32, #43a047);
            box-shadow: 0 4px 16px rgba(46, 125, 50, 0.4);
        }
        .badge-showcase-name {
            font-size: 10px;
            font-weight: 700;
            color: var(--text-sec);
            text-align: center;
            line-height: 1.2;
        }
        
        /* ========== TOP ETKƒ∞LE≈ûƒ∞M Lƒ∞DER TABLOSU ========== */
        .engagement-leaderboard {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 24px;
            padding: 20px;
            margin-top: 16px;
        }
        .engagement-leaderboard-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 16px;
            font-weight: 800;
            color: var(--text-main);
            margin-bottom: 16px;
        }
        .engagement-user-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border-radius: 16px;
            transition: all 0.3s ease;
            cursor: pointer;
            margin-bottom: 8px;
        }
        .engagement-user-item:hover {
            background: var(--input-bg);
        }
        .engagement-rank {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: 800;
            flex-shrink: 0;
        }
        .engagement-rank.rank-1 {
            background: linear-gradient(135deg, #f9a825, #ffd54f);
            color: white;
            box-shadow: 0 4px 16px rgba(255, 193, 7, 0.5);
            animation: goldGlow 2s ease-in-out infinite alternate;
        }
        .engagement-rank.rank-2 {
            background: linear-gradient(135deg, #90a4ae, #cfd8dc);
            color: #37474f;
            box-shadow: 0 4px 12px rgba(144, 164, 174, 0.4);
        }
        .engagement-rank.rank-3 {
            background: linear-gradient(135deg, #8d6e63, #bcaaa4);
            color: white;
            box-shadow: 0 4px 12px rgba(141, 110, 99, 0.4);
        }
        .engagement-user-avatar {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--border);
        }
        .engagement-user-info {
            flex: 1;
            min-width: 0;
        }
        .engagement-user-name {
            font-weight: 700;
            font-size: 14px;
            color: var(--text-main);
        }
        .engagement-user-stats {
            font-size: 12px;
            color: var(--text-sec);
        }
        .engagement-score {
            font-weight: 800;
            font-size: 14px;
            color: var(--agro-green);
        }
        
        /* ========== KE≈ûFET SAYFASI ========== */
        .explore-grid {
            columns: 2;
            column-gap: 8px;
        }
        .explore-card {
            break-inside: avoid;
            margin-bottom: 8px;
            border-radius: 16px;
            overflow: hidden;
            position: relative;
            background: var(--bg-card);
            border: 1px solid var(--border);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .explore-card:active {
            transform: scale(0.97);
        }
        .explore-card img, .explore-card video {
            width: 100%;
            display: block;
            object-fit: cover;
        }
        .explore-card-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.85) 0%, rgba(0,0,0,0.4) 50%, transparent 100%);
            padding: 40px 12px 12px;
            color: white;
        }
        .explore-card-stats {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 12px;
            font-weight: 700;
        }
        .explore-card-stats i {
            margin-right: 3px;
        }
        .explore-trending-badge {
            position: absolute;
            top: 10px;
            left: 10px;
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 10px;
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: 4px;
            box-shadow: 0 4px 12px rgba(238,90,36,0.4);
            z-index: 5;
        }
        .explore-category-chip {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
            flex-shrink: 0;
            background: var(--input-bg);
            color: var(--text-main);
            border: 1px solid var(--border);
        }
        .explore-category-chip.active {
            background: linear-gradient(135deg, #00b894, #00cec9);
            color: white;
            border-color: transparent;
            box-shadow: 0 4px 16px rgba(0,184,148,0.35);
        }
        .explore-category-chip:hover:not(.active) {
            background: var(--border);
        }
        .explore-text-card {
            padding: 16px;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        .explore-text-card.gradient-1 { background: linear-gradient(135deg, #00b894, #00cec9); color: white; }
        .explore-text-card.gradient-2 { background: linear-gradient(135deg, #6c5ce7, #a29bfe); color: white; }
        .explore-text-card.gradient-3 { background: linear-gradient(135deg, #fd79a8, #e17055); color: white; }
        .explore-text-card.gradient-4 { background: linear-gradient(135deg, #0984e3, #74b9ff); color: white; }
        
        /* ========== GELƒ∞≈ûMƒ∞≈û DM TASARIMI ========== */
        .dm-conversation-item {
            display: flex;
            align-items: center;
            gap: 14px;
            padding: 14px 16px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            background: var(--bg-card);
            border: 1px solid transparent;
        }
        .dm-conversation-item:hover {
            background: var(--input-bg);
            border-color: var(--border);
        }
        .dm-conversation-item:active {
            transform: scale(0.98);
        }
        .dm-avatar-wrapper {
            position: relative;
            flex-shrink: 0;
        }
        .dm-avatar {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--border);
        }
        .dm-online-dot {
            position: absolute;
            bottom: 2px;
            right: 2px;
            width: 14px;
            height: 14px;
            background: #00b894;
            border-radius: 50%;
            border: 3px solid var(--bg-card);
        }
        .dm-content {
            flex: 1;
            min-width: 0;
        }
        .dm-name-row {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 3px;
        }
        .dm-name {
            font-weight: 700;
            font-size: 15px;
            color: var(--text-main);
        }
        .dm-time {
            font-size: 11px;
            color: var(--text-sec);
            margin-left: auto;
            flex-shrink: 0;
        }
        .dm-last-message {
            font-size: 13px;
            color: var(--text-sec);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 200px;
        }
        .dm-last-message.unread {
            color: var(--text-main);
            font-weight: 600;
        }
        .dm-unread-badge {
            min-width: 22px;
            height: 22px;
            background: linear-gradient(135deg, #00b894, #00cec9);
            color: white;
            font-size: 11px;
            font-weight: 800;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 6px;
            flex-shrink: 0;
            box-shadow: 0 2px 8px rgba(0,184,148,0.4);
        }
        .dm-meta {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 6px;
            flex-shrink: 0;
        }
        .dm-delete-btn {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            width: 32px;
            height: 32px;
            background: rgba(239,68,68,0.1);
            color: #ef4444;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: all 0.2s;
        }
        .dm-conversation-item:hover .dm-delete-btn {
            opacity: 1;
        }
        .dm-delete-btn:hover {
            background: rgba(239,68,68,0.2);
        }
        
        /* Chat Header Geli≈ümi≈ü */
        .chat-header-pro {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            background: var(--bg-card);
            border-bottom: 1px solid var(--border);
            backdrop-filter: blur(20px);
        }
        .chat-header-info {
            flex: 1;
            min-width: 0;
        }
        .chat-header-name {
            font-weight: 800;
            font-size: 16px;
            color: var(--text-main);
        }
        .chat-header-status {
            font-size: 12px;
            color: #00b894;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        .chat-header-status::before {
            content: '';
            width: 6px;
            height: 6px;
            background: #00b894;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        .chat-action-btn {
            width: 38px;
            height: 38px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            font-size: 16px;
        }
        .chat-action-btn.video-btn {
            background: linear-gradient(135deg, #00b894, #00cec9);
            color: white;
            box-shadow: 0 4px 12px rgba(0,184,148,0.3);
        }
        .chat-action-btn.audio-btn {
            background: var(--input-bg);
            color: var(--text-main);
        }
        .chat-action-btn:active {
            transform: scale(0.9);
        }
        
        /* Chat Input Geli≈ümi≈ü */
        .chat-input-pro {
            padding: 12px 16px;
            background: var(--bg-card);
            border-top: 1px solid var(--border);
        }
        .chat-input-row {
            display: flex;
            align-items: center;
            gap: 8px;
            background: var(--input-bg);
            border-radius: 28px;
            padding: 4px 4px 4px 16px;
            border: 1px solid var(--border);
            transition: border-color 0.2s;
        }
        .chat-input-row:focus-within {
            border-color: var(--agro-green);
            box-shadow: 0 0 0 3px rgba(0,184,148,0.1);
        }
        .chat-input-field {
            flex: 1;
            border: none;
            background: transparent;
            outline: none;
            font-size: 14px;
            color: var(--text-main);
            padding: 8px 0;
        }
        .chat-input-field::placeholder {
            color: var(--text-sec);
        }
        .chat-send-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #00b894, #00cec9);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            flex-shrink: 0;
            box-shadow: 0 4px 12px rgba(0,184,148,0.3);
        }
        .chat-send-btn:active {
            transform: scale(0.9);
        }
        .chat-send-btn:disabled {
            opacity: 0.5;
            box-shadow: none;
        }
        .chat-attach-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-sec);
            transition: all 0.2s;
            flex-shrink: 0;
        }
        .chat-attach-btn:hover {
            color: var(--agro-green);
            background: rgba(0,184,148,0.1);
        }
        
        /* Resim ve medya indirmeyi engelle */
        img, video { 
            pointer-events: auto;
            -webkit-user-drag: none;
            -khtml-user-drag: none;
            -moz-user-drag: none;
            -o-user-drag: none;
            user-drag: none;
        }
        
        /* Saƒü tƒ±k men√ºs√ºn√º engelle */
        .no-context-menu {
            -webkit-touch-callout: none;
        }
        
        .btn-agro { background: var(--agro-green); color: white; border-radius: 16px; font-weight: 700; transition: 0.2s; }
        .btn-agro:active { transform: scale(0.95); }
        
        .nav-icon {
            color: var(--text-sec);
            font-size: 1.15rem;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
            padding: 10px 18px;
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 3px;
            background: transparent;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            min-width: 48px;
        }
        .nav-icon:active {
            transform: scale(0.88);
        }
        .nav-icon.active {
            color: var(--agro-green);
            background: linear-gradient(145deg, rgba(0,184,148,0.15), rgba(0,184,148,0.08));
            box-shadow: 0 2px 12px rgba(0,184,148,0.18), inset 0 1px 0 rgba(255,255,255,0.2);
        }
        .nav-icon.active::after {
            content: '';
            position: absolute;
            bottom: 5px;
            left: 50%;
            transform: translateX(-50%);
            width: 4px;
            height: 4px;
            background: var(--agro-green);
            border-radius: 50%;
            box-shadow: 0 0 6px rgba(0,184,148,0.6);
            animation: navDotPop 0.3s cubic-bezier(0.34,1.56,0.64,1) forwards;
        }
        @keyframes navDotPop {
            from { transform: translateX(-50%) scale(0); opacity: 0; }
            to   { transform: translateX(-50%) scale(1); opacity: 1; }
        }

        /* ‚úÖ Evrensel Nav Buton Press Animasyonu */
        @keyframes navPress {
            0%   { transform: scale(1); }
            30%  { transform: scale(0.78); }
            65%  { transform: scale(1.18); }
            85%  { transform: scale(0.96); }
            100% { transform: scale(1); }
        }

        /* Adƒ±m tamamlandƒ± tik animasyonu */
        @keyframes stepCheckPop {
            0%   { transform: scale(0) rotate(-45deg); opacity: 0; }
            50%  { transform: scale(1.3) rotate(8deg); opacity: 1; }
            75%  { transform: scale(0.9) rotate(-3deg); }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }
        .step-check-anim {
            animation: stepCheckPop 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }
        @keyframes stepCirclePop {
            0%   { transform: scale(1); box-shadow: 0 0 0 0 rgba(16,185,129,0.5); }
            40%  { transform: scale(1.15); box-shadow: 0 0 0 8px rgba(16,185,129,0.0); }
            100% { transform: scale(1); box-shadow: 0 4px 12px rgba(16,185,129,0.3); }
        }
        .step-circle-done {
            animation: stepCirclePop 0.4s ease-out forwards;
        }
        .nav-btn-press {
            animation: navPress 0.38s cubic-bezier(0.34, 1.56, 0.64, 1) !important;
        }

        /* Post butonu press */
        @keyframes postBtnPress {
            0%   { transform: scale(1) rotate(0deg); }
            25%  { transform: scale(0.82) rotate(-8deg); }
            60%  { transform: scale(1.15) rotate(4deg); }
            85%  { transform: scale(0.97) rotate(0deg); }
            100% { transform: scale(1) rotate(0deg); }
        }
        .post-btn-press {
            animation: postBtnPress 0.42s cubic-bezier(0.34, 1.56, 0.64, 1) !important;
        }

        .poll-bar-bg { background: var(--input-bg); border-radius: 12px; height: 40px; position: relative; overflow: hidden; border: 1px solid var(--border); cursor: pointer; }
        .poll-bar-fill { background: var(--agro-green); opacity: 0.3; height: 100%; transition: 1s ease-out; position: absolute; left: 0; top: 0; }
        
        .story-ring { background: linear-gradient(45deg, #00b894, #00cec9, #0984e3); padding: 3px; border-radius: 50%; transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); position: relative; z-index: 1; }
        .story-ring.watched { background: var(--border); }
        .story-ring.story-tap-anim { animation: storyZoomIn 0.7s cubic-bezier(0.34, 1.56, 0.64, 1) forwards; z-index: 100; }
        @keyframes storyZoomIn {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(0, 184, 148, 0); }
            20% { transform: scale(1.6); box-shadow: 0 0 30px 10px rgba(0, 184, 148, 0.4); }
            40% { transform: scale(1.3); box-shadow: 0 0 20px 5px rgba(0, 184, 148, 0.3); }
            60% { transform: scale(1.5); box-shadow: 0 0 25px 8px rgba(0, 184, 148, 0.35); }
            80% { transform: scale(1.4); box-shadow: 0 0 15px 3px rgba(0, 184, 148, 0.2); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(0, 184, 148, 0); }
        }
        @keyframes storyBounce {
            0% { transform: scale(1); }
            30% { transform: scale(1.35); }
            50% { transform: scale(1.1); }
            70% { transform: scale(1.25); }
            100% { transform: scale(1); }
        }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        .animate-fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .animate-slide-up { animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(100px); } to { opacity: 1; transform: translateY(0); } }
        
        /* FEED POST ANƒ∞MASYONLARI - YENƒ∞ */
        .post-card-animate {
            animation: postSlideIn 0.5s cubic-bezier(0.22, 1, 0.36, 1) forwards;
            opacity: 0;
        }
        @keyframes postSlideIn {
            from { 
                opacity: 0; 
                transform: translateY(30px) scale(0.98); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0) scale(1); 
            }
        }
        /* Staggered animasyon i√ßin delay sƒ±nƒ±flarƒ± */
        .post-card-animate:nth-child(1) { animation-delay: 0ms; }
        .post-card-animate:nth-child(2) { animation-delay: 50ms; }
        .post-card-animate:nth-child(3) { animation-delay: 100ms; }
        .post-card-animate:nth-child(4) { animation-delay: 150ms; }
        .post-card-animate:nth-child(5) { animation-delay: 200ms; }
        .post-card-animate:nth-child(n+6) { animation-delay: 250ms; }
        
        .hashtag { color: var(--agro-green); font-weight: 600; cursor: pointer; }
        .hashtag:hover { text-decoration: underline; }
        .mention { color: #0984e3; font-weight: 600; cursor: pointer; }
        .mention:hover { text-decoration: underline; }
        
        .toast { position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%); background: #1e293b; color: white; padding: 12px 24px; border-radius: 12px; z-index: 9999; animation: fadeIn 0.3s; }
        
        /* ========== TIKTOK TARZI KAYDIRMA ========== */
        .tiktok-scroll-container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #0a0a0a;
            z-index: 200;
            overflow: hidden;
            will-change: transform;
            animation: tikTokFadeIn 0.25s ease-out;
        }
        
        @keyframes tikTokFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .tiktok-scroll-wrapper {
            height: 100vh;
            height: 100dvh;
            overflow-y: scroll;
            scroll-snap-type: y mandatory;
            -webkit-overflow-scrolling: touch;
            overscroll-behavior-y: contain;
            /* scroll-behavior: smooth kaldƒ±rƒ±ldƒ± ‚Äî scroll-snap ile √ßakƒ±≈üƒ±p titreme yapƒ±yor */
            will-change: scroll-position;
            transform: translateZ(0);
        }
        
        .tiktok-post {
            height: 100vh;
            height: 100dvh;
            scroll-snap-align: start;
            scroll-snap-stop: always;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            background: black;
            will-change: transform;
            contain: layout style paint;
            touch-action: pan-y;
        }
        
        .tiktok-post img, .tiktok-post video {
            max-height: 100vh;
            max-height: 100dvh;
            max-width: 100%;
            object-fit: contain;
            transform: translateZ(0);
            backface-visibility: hidden;
        }
        
        /* ========== INSTAGRAM TARZI KALP ATMA ANIMasyonu ========== */
        .heart-animation {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 100px;
            color: #ff3040;
            opacity: 0;
            pointer-events: none;
            z-index: 100;
        }
        
        .heart-animation.animate {
            animation: heartPop 0.8s ease-out;
        }
        
        @keyframes heartPop {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0); }
            15% { opacity: 1; transform: translate(-50%, -50%) scale(1.2); }
            30% { transform: translate(-50%, -50%) scale(0.95); }
            45% { transform: translate(-50%, -50%) scale(1.1); }
            80% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(0); }
        }
        
        /* ========== SAƒû TARAF EYLEM BUTONLARI (TikTok/Instagram tarzƒ±) ========== */
        .side-actions {
            position: absolute;
            right: 16px;
            bottom: 120px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            z-index: 50;
        }
        
        .side-action-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            color: white;
            background: rgba(0,0,0,0.3);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            justify-content: center;
            backdrop-filter: blur(4px);
        }
        
        .side-action-btn i {
            font-size: 24px;
        }
        
        .side-action-btn span {
            font-size: 12px;
            font-weight: 700;
        }
        
        /* ========== SES KAYIT BUTONU ========== */
        .voice-record-btn {
            position: relative;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--agro-green);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            transition: all 0.2s;
        }
        
        .voice-record-btn.recording {
            background: #ff3040;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .voice-wave {
            display: flex;
            align-items: center;
            gap: 2px;
            height: 20px;
        }
        
        .voice-wave span {
            width: 3px;
            background: var(--agro-green);
            border-radius: 2px;
            animation: wave 0.5s ease-in-out infinite;
        }
        
        .voice-wave span:nth-child(1) { animation-delay: 0s; height: 8px; }
        .voice-wave span:nth-child(2) { animation-delay: 0.1s; height: 16px; }
        .voice-wave span:nth-child(3) { animation-delay: 0.2s; height: 12px; }
        .voice-wave span:nth-child(4) { animation-delay: 0.3s; height: 20px; }
        .voice-wave span:nth-child(5) { animation-delay: 0.4s; height: 10px; }
        
        @keyframes wave {
            0%, 100% { transform: scaleY(1); }
            50% { transform: scaleY(1.5); }
        }
        
        /* ========== Hƒ∞KAYE G√ñR√úNT√úLEYENLER ========== */
        .story-viewers-btn {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.65);
            color: white;
            padding: 10px 20px;
            border-radius: 24px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            font-weight: 700;
            backdrop-filter: blur(8px);
            z-index: 30;
            white-space: nowrap;
            -webkit-tap-highlight-color: transparent;
            cursor: pointer;
            border: 1px solid rgba(255,255,255,0.15);
        }
        
        /* Profil sayfasƒ± stilleri - Twitter/X benzeri */
        .profile-header {
            position: relative;
        }
        
        .profile-cover-container {
            width: calc(100% - 2rem);
            margin: 0 1rem;
            height: 180px;
            border-radius: 1.5rem;
            overflow: hidden;
            background: linear-gradient(135deg, #00b894 0%, #00cec9 50%, #0984e3 100%);
        }
        
        .profile-cover-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .profile-avatar-container {
            position: absolute;
            bottom: -56px;
            left: 2rem;
            z-index: 20;
        }
        
        .profile-avatar-ring {
            width: 112px;
            height: 112px;
            border-radius: 50%;
            border: 4px solid var(--bg-main);
            overflow: visible;
            background: var(--bg-card);
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            transition: all 0.3s ease;
        }
        
        .profile-avatar-ring.has-story {
            border: none;
            padding: 4px;
            background: linear-gradient(45deg, #f09433, #e6683c, #dc2743, #cc2366, #bc1888, #8a3ab9, #4c68d7, #6b5ce7, #00b894, #00cec9);
            background-size: 400% 400%;
            animation: storyRingRotate 3s linear infinite;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15), 0 0 15px rgba(225, 48, 108, 0.3);
        }
        .profile-avatar-ring.has-story img {
            border: 3px solid var(--bg-card);
        }
        @keyframes storyRingRotate {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        /* Feed post story ring */
        .feed-avatar-story-ring {
            padding: 2.5px;
            border-radius: 50%;
            background: linear-gradient(45deg, #f09433, #e6683c, #dc2743, #cc2366, #bc1888, #8a3ab9, #4c68d7, #00b894);
            background-size: 400% 400%;
            animation: storyRingRotate 3s linear infinite;
        }
        .feed-avatar-story-ring img {
            border: 2px solid var(--bg-card);
        }
        
        /* Profile Pic Options Popup */
        .profile-pic-popup-overlay {
            position: fixed;
            inset: 0;
            z-index: 300;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.2s ease;
        }
        .profile-pic-popup {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 8px;
            min-width: 260px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: popupSlideUp 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        @keyframes popupSlideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .profile-pic-popup-item {
            display: flex;
            align-items: center;
            gap: 14px;
            padding: 14px 18px;
            border-radius: 14px;
            cursor: pointer;
            transition: background 0.2s;
            font-weight: 600;
            font-size: 14px;
            color: var(--text-main);
        }
        .profile-pic-popup-item:hover {
            background: var(--input-bg);
        }
        .profile-pic-popup-item i {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }
        
        .profile-avatar-ring img {
            border-radius: 50%;
        }
        
        .profile-avatar-ring img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .profile-edit-btn {
            position: absolute;
            bottom: -72px;
            right: 1.5rem;
        }
        
        .online-status {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            color: #00b894;
            font-size: 14px;
            font-weight: 500;
        }
        
        .online-status::before {
            content: '';
            width: 8px;
            height: 8px;
            background: #00b894;
            border-radius: 50%;
        }
        
        .profile-tabs {
            display: flex;
            border-bottom: 1px solid var(--border);
        }
        
        .profile-tab {
            flex: 1;
            padding: 1rem 0;
            text-align: center;
            font-weight: 600;
            font-size: 0.875rem;
            color: var(--text-sec);
            position: relative;
            transition: 0.2s;
            cursor: pointer;
        }
        
        .profile-tab:hover {
            background: var(--input-bg);
        }
        
        .profile-tab.active {
            color: var(--text-main);
        }
        
        .profile-tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 4px;
            background: #00b894;
            border-radius: 4px 4px 0 0;
        }
        
        .stat-inline {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            cursor: pointer;
        }
        
        .stat-inline:hover {
            text-decoration: underline;
        }
        
        .stat-inline strong {
            font-weight: 700;
        }
        
        .stat-inline span {
            color: var(--text-sec);
        }
        
        /* Video poster */
        .video-poster {
            position: relative;
            cursor: pointer;
        }
        .video-poster::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(to bottom, transparent 50%, rgba(0,0,0,0.5));
            border-radius: 1.2rem;
            pointer-events: none;
        }
        .video-play-btn {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 60px;
            height: 60px;
            background: rgba(255,255,255,0.9);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }
        .video-play-btn i {
            color: var(--agro-green);
            font-size: 24px;
            margin-left: 4px;
        }
        
        /* Bildirim avatar */
        .notif-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--agro-green);
        }
        
        /* Post a√ßƒ±klama truncate */
        .content-truncated {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        /* Canlƒ± sohbet mesaj balonu */
        /* ========== MEDƒ∞A MODU - GRID FEED ========== */
        .media-grid-feed {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 3px;
            margin: 0 -16px;
        }
        .media-grid-card {
            position: relative;
            aspect-ratio: 1 / 1.15;
            overflow: hidden;
            cursor: pointer;
            background: var(--input-bg);
        }
        .media-grid-card img:not(.media-grid-avatar):not(.media-grid-text-avatar),
        .media-grid-card video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
            transition: transform 0.3s ease;
        }
        .media-grid-card:active img:not(.media-grid-avatar):not(.media-grid-text-avatar),
        .media-grid-card:active video {
            transform: scale(0.97);
        }
        /* Overlay gradient */
        .media-grid-overlay {
            position: absolute;
            inset: 0;
            background: linear-gradient(
                to bottom,
                rgba(0,0,0,0.28) 0%,
                transparent 35%,
                transparent 55%,
                rgba(0,0,0,0.65) 100%
            );
            pointer-events: none;
        }
        /* Top: avatar + name */
        .media-grid-top {
            position: absolute;
            top: 8px;
            left: 8px;
            right: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
            pointer-events: none;
        }
        .media-grid-avatar,
        .media-grid-card .media-grid-avatar {
            width: 28px !important;
            height: 28px !important;
            border-radius: 50%;
            object-fit: cover;
            border: 1.5px solid rgba(255,255,255,0.85);
            flex-shrink: 0;
            display: block;
        }
        .media-grid-username {
            color: white;
            font-size: 11px;
            font-weight: 700;
            text-shadow: 0 1px 4px rgba(0,0,0,0.6);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .media-grid-verified {
            flex-shrink: 0;
        }
        /* Play icon for video */
        .media-grid-play {
            position: absolute;
            top: 50%;
            right: 10px;
            transform: translateY(-50%);
            width: 28px;
            height: 28px;
            background: rgba(255,255,255,0.22);
            backdrop-filter: blur(6px);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 11px;
        }
        /* Bottom: stats */
        .media-grid-bottom {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 8px 10px;
            pointer-events: none;
        }
        .media-grid-caption {
            color: rgba(255,255,255,0.9);
            font-size: 10px;
            font-weight: 600;
            line-height: 1.3;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-shadow: 0 1px 3px rgba(0,0,0,0.5);
            margin-bottom: 4px;
        }
        .media-grid-stats {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .media-grid-stat {
            display: flex;
            align-items: center;
            gap: 3px;
            color: rgba(255,255,255,0.85);
            font-size: 10px;
            font-weight: 700;
            text-shadow: 0 1px 3px rgba(0,0,0,0.5);
        }
        /* Text-only posts in grid */
        .media-grid-text-card {
            position: relative;
            aspect-ratio: 1 / 1.15;
            overflow: hidden;
            cursor: pointer;
            padding: 12px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            background: linear-gradient(135deg, var(--bg-card), var(--input-bg));
            border: 1px solid var(--border);
        }
        .media-grid-text-content {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-main);
            line-height: 1.5;
            display: -webkit-box;
            -webkit-line-clamp: 7;
            -webkit-box-orient: vertical;
            overflow: hidden;
            flex: 1;
        }
        .media-grid-text-footer {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-top: 8px;
        }
        .media-grid-text-avatar {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            object-fit: cover;
        }
        .media-grid-text-name {
            font-size: 10px;
            font-weight: 700;
            color: var(--text-sec);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        /* Mode toggle button */
        .feed-mode-btn {
            width: 36px;
            height: 36px;
            border-radius: 12px;
            background: var(--input-bg);
            border: 1.5px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.25s cubic-bezier(0.34,1.56,0.64,1);
            color: var(--text-sec);
        }
        .feed-mode-btn.active {
            background: linear-gradient(135deg, #00b894, #00cec9);
            border-color: transparent;
            color: white;
            box-shadow: 0 4px 14px rgba(0,184,148,0.35);
        }

        .chat-bubble-sent {
            background: var(--agro-green);
            color: white;
            border-radius: 20px 20px 4px 20px;
        }
        .chat-bubble-received {
            background: var(--input-bg);
            color: var(--text-main);
            border-radius: 20px 20px 20px 4px;
        }

        /* ========== KANAL MESAJ BALONLARI - GELƒ∞≈ûMƒ∞≈û ========== */
        .channel-msg-wrapper {
            display: flex;
            align-items: flex-end;
            gap: 8px;
            margin-bottom: 12px;
        }
        .channel-msg-wrapper.msg-right {
            flex-direction: row-reverse;
        }
        .channel-msg-wrapper.msg-left {
            flex-direction: row;
        }
        .channel-msg-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            object-fit: cover;
            flex-shrink: 0;
            border: 2px solid var(--border);
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        .channel-msg-avatar:active { transform: scale(0.92); }
        .channel-msg-col {
            display: flex;
            flex-direction: column;
            max-width: 72%;
            gap: 2px;
        }
        .channel-admin-badge {
            background: linear-gradient(90deg, #f59e0b, #f97316);
            color: white;
            font-size: 9px;
            font-weight: 800;
            padding: 2px 7px;
            border-radius: 99px;
            letter-spacing: 0.3px;
            text-transform: uppercase;
        }
        .channel-bubble {
            padding: 10px 14px;
            position: relative;
            word-break: break-word;
            cursor: pointer;
            transition: transform 0.15s ease, filter 0.15s ease;
        }
        .channel-bubble:active { transform: scale(0.97); filter: brightness(0.95); }
        .bubble-sent {
            background: linear-gradient(135deg, #00b894 0%, #00cec9 100%);
            color: white;
            border-radius: 18px 18px 4px 18px;
            box-shadow: 0 3px 12px rgba(0, 184, 148, 0.3);
        }
        .bubble-received {
            background: var(--bg-card);
            color: var(--text-main);
            border-radius: 18px 18px 18px 4px;
            border: 1px solid var(--border);
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }
        .dark-theme .bubble-received {
            background: #1a2540;
            border-color: rgba(255,255,255,0.08);
        }
        .bubble-deleted {
            opacity: 0.55;
            background: var(--input-bg) !important;
            color: var(--text-sec) !important;
            border: 1px dashed var(--border) !important;
            box-shadow: none !important;
        }
        .deleted-text { font-style: italic; }
        .channel-bubble-text {
            font-size: 14px;
            line-height: 1.5;
            white-space: pre-wrap;
        }
        .bubble-meta {
            display: flex;
            align-items: center;
            gap: 4px;
            margin-top: 4px;
        }
        .bubble-time {
            font-size: 10px;
            opacity: 0.65;
        }
        .edited-label {
            font-size: 9px;
            opacity: 0.55;
            font-style: italic;
        }
        
        /* Ayarlar men√ºs√º */
        .settings-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px;
            border-radius: 16px;
            cursor: pointer;
            transition: 0.2s;
        }
        .settings-item:hover {
            background: var(--input-bg);
        }
        .settings-item.danger {
            color: #ef4444;
        }
        .settings-item.danger:hover {
            background: #fef2f2;
        }
        
        /* Instagram Verified Badge - Orijinal Tasarƒ±m */
        .verified-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 18px;
            height: 18px;
            min-width: 18px;
            min-height: 18px;
            flex-shrink: 0;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .verified-badge:hover {
            transform: scale(1.1);
        }
        .verified-badge svg {
            width: 100%;
            height: 100%;
        }
        .verified-badge-sm {
            width: 14px;
            height: 14px;
            min-width: 14px;
            min-height: 14px;
        }
        .verified-badge-lg {
            width: 22px;
            height: 22px;
            min-width: 22px;
            min-height: 22px;
        }
        
        /* ========== Zƒ∞RAAT M√úHENDƒ∞Sƒ∞ HESAP Tƒ∞Pƒ∞ ROZETƒ∞ - PREMIUM v2 ========== */
        .farmer-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #1b5e20 0%, #2e7d32 40%, #43a047 70%, #66bb6a 100%);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            min-width: 20px;
            min-height: 20px;
            flex-shrink: 0;
            cursor: pointer;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1), box-shadow 0.3s;
            box-shadow: 0 2px 10px rgba(46, 125, 50, 0.5), inset 0 1px 2px rgba(255, 255, 255, 0.3);
            position: relative;
            overflow: visible;
            border: 1.5px solid rgba(255, 255, 255, 0.25);
        }
        .farmer-badge::before {
            content: 'üéì';
            font-size: 11px;
            filter: drop-shadow(0 1px 2px rgba(0,0,0,0.3));
        }
        .farmer-badge:hover {
            transform: scale(1.2) rotate(5deg);
            box-shadow: 0 6px 24px rgba(46, 125, 50, 0.6), inset 0 1px 2px rgba(255, 255, 255, 0.4);
        }
        .farmer-badge.farmer-badge-sm {
            width: 16px;
            height: 16px;
            min-width: 16px;
            min-height: 16px;
        }
        .farmer-badge.farmer-badge-sm::before {
            font-size: 9px;
        }
        .farmer-badge.farmer-badge-lg {
            width: 26px;
            height: 26px;
            min-width: 26px;
            min-height: 26px;
        }
        .farmer-badge.farmer-badge-lg::before {
            font-size: 15px;
        }
        
        /* Verified Badge Tooltip */
        .verified-tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 12px 16px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            z-index: 100;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: 0.2s;
            margin-bottom: 8px;
        }
        .verified-tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 6px solid transparent;
            border-top-color: var(--bg-card);
        }
        .verified-badge-wrapper:hover .verified-tooltip {
            opacity: 1;
            visibility: visible;
        }
        .verified-badge-wrapper {
            position: relative;
            display: inline-flex;
        }
        
        /* Message read receipts */
        .message-status {
            display: inline-flex;
            align-items: center;
            gap: 2px;
            margin-left: 4px;
        }
        .message-status .check {
            color: rgba(255,255,255,0.5);
            font-size: 10px;
        }
        .message-status .check.read {
            color: #34d399;
        }
        .message-status-received {
            color: var(--text-sec);
        }
        .message-status-received .check.read {
            color: #00b894;
        }
        
        /* ========== Gƒ∞Rƒ∞≈û YAPMADAN ƒ∞√áERƒ∞K Gƒ∞ZLEME ========== */
        /* JavaScript y√ºklenene kadar ana i√ßeriƒüi gizle */
        [x-cloak] { display: none !important; }
        
        /* Giri≈ü yapƒ±lmadan ana uygulama i√ßeriƒüi g√∂r√ºnt√ºlenemez */
        .main-app-content {
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out;
        }
        
        .main-app-content.authenticated {
            opacity: 1;
            visibility: visible;
        }
        
        /* Auth ekranƒ± her zaman en √ºstte */
        .auth-overlay {
            position: fixed;
            inset: 0;
            z-index: 9999;
            background: #0f172a;
        }
        
        /* ========== ORTAK TAKƒ∞P√áƒ∞ B√ñL√úM√ú ========== */
        .mutual-followers {
            display: flex !important;
            align-items: center;
            gap: 8px;
            padding: 12px 16px;
            background: var(--input-bg);
            border-radius: 16px;
            margin-top: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid var(--border);
        }
        .mutual-followers:hover {
            background: var(--border);
            transform: translateX(4px);
        }
        .mutual-followers-avatars {
            display: flex;
            flex-shrink: 0;
        }
        .mutual-followers-avatars > div,
        .mutual-followers-avatars img {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            border: 2px solid var(--bg-card);
            margin-left: -8px;
            object-fit: cover;
            flex-shrink: 0;
        }
        .mutual-followers-avatars > div:first-child,
        .mutual-followers-avatars img:first-child {
            margin-left: 0;
        }
        
        /* ========== PINCH TO ZOOM ========== */
        .pinch-zoom-container {
            position: fixed;
            inset: 0;
            z-index: 300;
            background: rgba(0,0,0,0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            touch-action: none;
        }
        .pinch-zoom-container img {
            max-width: 100%;
            max-height: 100%;
            transition: transform 0.1s ease-out;
        }
        .pinch-zoom-controls {
            position: absolute;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 16px;
            z-index: 10;
        }
        .pinch-zoom-controls button {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            color: white;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(4px);
            transition: 0.2s;
        }
        .pinch-zoom-controls button:hover {
            background: rgba(255,255,255,0.3);
        }
        
        /* ========== ONBOARDING / REHBER Sƒ∞STEMƒ∞ ========== */
        .onboarding-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 99990;
            transition: opacity 0.3s;
        }
        .onboarding-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .onboarding-highlight {
            position: absolute;
            border-radius: 16px;
            box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.75);
            z-index: 99991;
            pointer-events: none;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .onboarding-tooltip {
            position: absolute;
            background: white;
            border-radius: 20px;
            padding: 20px;
            max-width: 300px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            z-index: 99992;
            animation: tooltipBounce 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        @keyframes tooltipBounce {
            0% { opacity: 0; transform: scale(0.8) translateY(20px); }
            100% { opacity: 1; transform: scale(1) translateY(0); }
        }
        
        .onboarding-tooltip::before {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            background: white;
            transform: rotate(45deg);
        }
        .onboarding-tooltip.arrow-top::before {
            top: -8px;
            left: 50%;
            margin-left: -8px;
        }
        .onboarding-tooltip.arrow-bottom::before {
            bottom: -8px;
            left: 50%;
            margin-left: -8px;
        }
        .onboarding-tooltip.arrow-left::before {
            left: -8px;
            top: 50%;
            margin-top: -8px;
        }
        .onboarding-tooltip.arrow-right::before {
            right: -8px;
            top: 50%;
            margin-top: -8px;
        }
        
        .onboarding-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #00b894 0%, #00cec9 100%);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 12px;
        }
        .onboarding-icon i {
            font-size: 24px;
            color: white;
        }
        
        .onboarding-title {
            font-size: 18px;
            font-weight: 800;
            color: #1e293b;
            margin-bottom: 8px;
        }
        
        .onboarding-text {
            font-size: 14px;
            color: #64748b;
            line-height: 1.6;
            margin-bottom: 16px;
        }
        
        .onboarding-progress {
            display: flex;
            gap: 6px;
            margin-bottom: 16px;
        }
        .onboarding-progress-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #e2e8f0;
            transition: 0.3s;
        }
        .onboarding-progress-dot.active {
            background: #00b894;
            width: 24px;
            border-radius: 4px;
        }
        .onboarding-progress-dot.done {
            background: #00b894;
        }
        
        .onboarding-buttons {
            display: flex;
            gap: 10px;
        }
        .onboarding-btn {
            flex: 1;
            padding: 12px 16px;
            border-radius: 12px;
            font-weight: 700;
            font-size: 14px;
            cursor: pointer;
            transition: 0.2s;
        }
        .onboarding-btn-skip {
            background: #f1f5f9;
            color: #64748b;
        }
        .onboarding-btn-skip:hover {
            background: #e2e8f0;
        }
        .onboarding-btn-next {
            background: linear-gradient(135deg, #00b894 0%, #00cec9 100%);
            color: white;
        }
        .onboarding-btn-next:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 184, 148, 0.4);
        }
        
        .onboarding-step-counter {
            font-size: 12px;
            color: #94a3b8;
            text-align: center;
            margin-top: 12px;
        }
    </style>
</head>
<body @scroll.window="handleScroll" @contextmenu.prevent oncontextmenu="return false;" ondragstart="return false;">
    
    <!-- ========== GELƒ∞≈ûMƒ∞≈û Y√úKLEME EKRANI ========== -->
    <div id="pageLoadingOverlay" class="page-loading-overlay">
        <!-- Par√ßacƒ±klar -->
        <div class="loading-particles">
            <div class="loading-particle"></div>
            <div class="loading-particle"></div>
            <div class="loading-particle"></div>
            <div class="loading-particle"></div>
            <div class="loading-particle"></div>
            <div class="loading-particle"></div>
        </div>
        
        <!-- Logo -->
        <div class="loading-logo">
            <img src="agro.png" alt="AgroLink Logo" class="loading-logo-img" onerror="this.style.display='none'; var ic=document.createElement('i'); ic.className='fas fa-leaf'; ic.style.cssText='font-size:48px;color:white;'; this.parentElement.appendChild(ic);">
        </div>
        
        <!-- Metin -->
        <div class="loading-text">
            <h2>AgroLink</h2>
            <p>Dijital Tarƒ±m Topluluƒüu</p>
            <div class="loading-dots">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        
        <!-- ƒ∞lerleme √ßubuƒüu -->
        <div class="loading-progress">
            <div class="loading-progress-bar"></div>
        </div>
    </div>

    <!-- üîí SPLASH SCREEN: √áok Katmanlƒ± G√ºvenli Kapatma Mekanizmasƒ± v3.0 -->
    <script>
    (function() {
        'use strict';

        var overlayClosed = false;
        
        function closeOverlay(reason) {
            if (overlayClosed) return;
            overlayClosed = true;
            
            var overlay = document.getElementById('pageLoadingOverlay');
            if (!overlay) return;
            
            console.log('[AgroLink] Splash kapatƒ±lƒ±yor:', reason);
            overlay.style.transition = 'opacity 0.4s ease-out';
            overlay.style.opacity = '0';
            overlay.style.pointerEvents = 'none';
            overlay.classList.add('hidden');
            
            setTimeout(function() {
                if (overlay && overlay.parentNode) {
                    overlay.parentNode.removeChild(overlay);
                }
            }, 400);
        }

        // Katman 1: Alpine.js init sonrasƒ±nƒ± dinle (en hƒ±zlƒ± yol)
        document.addEventListener('alpine:initialized', function() {
            setTimeout(function() {
                closeOverlay('Alpine.js initialized');
            }, 200);
        });

        // Katman 2: DOM ready ‚Äî 3 saniye i√ßinde Alpine a√ßƒ±lmadƒ±ysa zorla kapat
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                setTimeout(function() {
                    if (!overlayClosed) {
                        console.warn('[AgroLink] Alpine.js zaman a≈üƒ±mƒ± - splash zorla kapatƒ±lƒ±yor');
                        closeOverlay('DOMContentLoaded timeout');
                    }
                }, 3000);
            });
        } else {
            // DOM zaten hazƒ±r
            setTimeout(function() {
                if (!overlayClosed) {
                    closeOverlay('DOM already ready timeout');
                }
            }, 3000);
        }

        // Katman 3: window.load ‚Äî 5 saniye sonra KESƒ∞NLƒ∞KLE kapat (son √ßare)
        window.addEventListener('load', function() {
            setTimeout(function() {
                if (!overlayClosed) {
                    console.error('[AgroLink] Kritik: Splash 5s sonra zorla kapatƒ±ldƒ±');
                    closeOverlay('Window load timeout');
                }
            }, 2000);
        });
        
        // Katman 4: EMERGENCY - 10 saniye sonra mutlaka kapat
        setTimeout(function() {
            if (!overlayClosed) {
                console.error('[AgroLink] EMERGENCY: Splash 10s sonra acil kapatƒ±ldƒ±');
                closeOverlay('Emergency timeout');
            }
        }, 10000);
    })();
    </script>

    <!-- ========== G√úVENLƒ∞K Sƒ∞STEMƒ∞ v3.0 - ALPINE.JS UYUMLU ========== -->
    <!-- 
      ‚úÖ D√úZELTME v3.0:
      ‚Ä¢ DOMProtection Alpine.js'den SONRA ba≈ülatƒ±lƒ±r
      ‚Ä¢ ErrorProtection framework hatalarƒ±nƒ± filtreler
      ‚Ä¢ F12/DevTools engelleme kaldƒ±rƒ±ldƒ±
      ‚Ä¢ Splash kapatma mekanizmasƒ± g√º√ßlendirildi
    -->
    <script>
    (function() {
        'use strict';
        
        // ========== 1. GLOBAL G√úVENLƒ∞K AYARLARI ==========
        const SECURITY_CONFIG = {
            enableAntiDebug: true,
            enableAntiTamper: true,
            enableXSSProtection: true,
            enableDOMProtection: true,
            enableConsoleProtection: true,
            maxErrorsBeforeLock: 500,
            sessionTimeout: 28800000, // 8 saat
            errorResetInterval: 60000 // 1 dakikada hata sayacƒ±nƒ± sƒ±fƒ±rla
        };
        
        let errorCount = 0;
        let isLocked = false;

        // Hata sayacƒ±nƒ± periyodik olarak sƒ±fƒ±rla (normal hatalar birikmesini √∂nler)
        setInterval(function() {
            if (errorCount > 0 && !isLocked) {
                errorCount = Math.max(0, errorCount - 50);
            }
        }, SECURITY_CONFIG.errorResetInterval);
        
        // ========== 2. XSS KORUMA - INPUT SANƒ∞Tƒ∞ZASYONU ==========
        const XSSProtection = {
            // üîí G√úVENLƒ∞K: escapeHTML artƒ±k innerHTML kullanmƒ±yor (kendisi XSS a√ßƒ±ƒüƒ±ydƒ±)
            escapeHTML: function(str) {
                if (typeof str !== 'string') return str;
                return str
                    .replace(/&/g,  '&amp;')
                    .replace(/</g,  '&lt;')
                    .replace(/>/g,  '&gt;')
                    .replace(/"/g,  '&quot;')
                    .replace(/'/g,  '&#x27;')
                    .replace(/\//g, '&#x2F;');
            },
            
            // Tehlikeli karakterleri temizle - üîí G√úVENLƒ∞K D√úZELTMESƒ∞: Daha kapsamlƒ± pattern listesi
            sanitize: function(input) {
                if (typeof input !== 'string') return input;
                return input
                    .replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi, '')
                    .replace(/javascript:/gi, '')
                    .replace(/vbscript:/gi, '')
                    .replace(/on\w+\s*=/gi, '')
                    .replace(/<iframe/gi, '&lt;iframe')
                    .replace(/<object/gi, '&lt;object')
                    .replace(/<embed/gi, '&lt;embed')
                    .replace(/<form/gi, '&lt;form')
                    .replace(/<applet/gi, '&lt;applet')
                    .replace(/<svg\b[^>]*on\w+/gi, '&lt;svg')
                    .replace(/expression\s*\(/gi, '')
                    .replace(/url\s*\(/gi, 'url (')
                    .replace(/<link/gi, '&lt;link')
                    .replace(/<meta/gi, '&lt;meta')
                    .replace(/<base/gi, '&lt;base')
                    .replace(/data:text\/html/gi, '')
                    .replace(/&#\x00*[jJ]/gi, '')  // HTML entity encoded 'j' (javascript: bypass)
                    .replace(/eval\s*\(/gi, '')
                    .replace(/setTimeout\s*\(/gi, '')
                    .replace(/setInterval\s*\(/gi, '')
                    .replace(/Function\s*\(/gi, '');
            },
            
            // URL doƒürulama - data: ve blob: protokolleri XSS riski ta≈üƒ±dƒ±ƒüƒ± i√ßin kaldƒ±rƒ±ldƒ±
            isValidURL: function(url) {
                try {
                    const parsed = new URL(url, window.location.origin);
                    return ['http:', 'https:'].includes(parsed.protocol);
                } catch {
                    return false;
                }
            }
        };
        
        // Global XSS korumasƒ±nƒ± uygula
        window.sanitizeInput = XSSProtection.sanitize;
        window.escapeHTML = XSSProtection.escapeHTML;
        
        // ========== 3. DOM KORUMA (Alpine.js Uyumlu) ==========
        const DOMProtection = {
            observer: null,
            
            init: function() {
                if (!SECURITY_CONFIG.enableDOMProtection) return;
                
                // ‚úÖ D√úZELTME: MutationObserver Alpine.js elementlerini etkilememeli
                // Alpine.js tarafƒ±ndan olu≈üturulan elementleri tespit etme
                const isAlpineElement = function(node) {
                    if (!node || node.nodeType !== 1) return false;
                    // Alpine.js direktiflerini kontrol et
                    const attrs = node.attributes;
                    if (!attrs) return false;
                    for (let i = 0; i < attrs.length; i++) {
                        const name = attrs[i].name;
                        if (name.startsWith('x-') || name.startsWith(':') || name.startsWith('@')) {
                            return true;
                        }
                    }
                    // Parent'ƒ± Alpine elementi mi kontrol et
                    let parent = node.parentElement;
                    while (parent) {
                        const parentAttrs = parent.attributes;
                        if (parentAttrs) {
                            for (let i = 0; i < parentAttrs.length; i++) {
                                if (parentAttrs[i].name.startsWith('x-')) {
                                    return true;
                                }
                            }
                        }
                        parent = parent.parentElement;
                    }
                    return false;
                };
                
                // MutationObserver ile DOM deƒüi≈üikliklerini izle
                this.observer = new MutationObserver(function(mutations) {
                    mutations.forEach(function(mutation) {
                        if (mutation.type === 'childList') {
                            mutation.addedNodes.forEach(function(node) {
                                if (node.nodeType === 1) {
                                    // ‚úÖ D√úZELTME: Alpine.js elementlerini atla
                                    if (isAlpineElement(node)) {
                                        return;
                                    }
                                    
                                    // Script injection kontrol√º - sadece harici scriptler
                                    if (node.tagName === 'SCRIPT' && !node.hasAttribute('data-trusted')) {
                                        // Inline script'leri kontrol et
                                        if (!node.src || node.src === '') {
                                            // Inline script - i√ßeriƒüini kontrol et
                                            const content = node.textContent || '';
                                            const dangerous = /eval\s*\(|Function\s*\(|document\.write|innerHTML\s*=/.test(content);
                                            if (dangerous && !content.includes('Alpine') && !content.includes('agroApp')) {
                                                console.warn('[G√úVENLƒ∞K] ≈û√ºpheli inline script engellendi');
                                                node.remove();
                                            }
                                        }
                                    }
                                }
                            });
                        }
                    });
                });
                
                this.observer.observe(document.documentElement, {
                    childList: true,
                    subtree: true
                });
            },
            
            removeInlineHandlers: function(element) {
                // ‚úÖ D√úZELTME: Alpine.js elementlerini atla
                const attrs = element.attributes;
                if (attrs) {
                    for (let i = 0; i < attrs.length; i++) {
                        if (attrs[i].name.startsWith('x-') || attrs[i].name.startsWith(':') || attrs[i].name.startsWith('@')) {
                            return; // Alpine element - dokunma
                        }
                    }
                }
                
                const dangerousAttrs = ['onclick', 'onerror', 'onload', 'onmouseover', 'onfocus', 'onblur'];
                dangerousAttrs.forEach(function(attr) {
                    if (element.hasAttribute && element.hasAttribute(attr) && !element.hasAttribute('data-trusted')) {
                        const attrValue = element.getAttribute(attr);
                        if (attrValue && (attrValue.includes('eval(') || attrValue.includes('Function('))) {
                            element.removeAttribute(attr);
                        }
                    }
                });
            }
        };
        
        // ========== 4. ANTI-DEBUGGING KORUMA ==========
        const AntiDebug = {
            isDebuggerOpen: false,
            
            init: function() {
                if (!SECURITY_CONFIG.enableAntiDebug) return;
                
                // DevTools a√ßƒ±k mƒ± kontrol√º
                const threshold = 160;
                
                const checkDevTools = function() {
                    const widthThreshold = window.outerWidth - window.innerWidth > threshold;
                    const heightThreshold = window.outerHeight - window.innerHeight > threshold;
                    
                    if (widthThreshold || heightThreshold) {
                        AntiDebug.isDebuggerOpen = true;
                    }
                };
                
                setInterval(checkDevTools, 1000);
                
                // Debugger statement tuzaƒüƒ± (pasif - sadece yava≈ülatƒ±r)
                // setInterval(function() { debugger; }, 100); // Devre dƒ±≈üƒ± - kullanƒ±cƒ± deneyimini etkiler
            }
        };
        
        // ========== 5. CONSOLE KORUMA ==========
        const ConsoleProtection = {
            init: function() {
                if (!SECURITY_CONFIG.enableConsoleProtection) return;
                
                // Console metodlarƒ±nƒ± override et (sadece production'da)
                const noop = function() {};
                const methods = ['log', 'debug', 'info', 'warn', 'error', 'table', 'trace'];
                
                // Geli≈ütirme modunda console'u koru, production'da sƒ±nƒ±rla
                if (window.location.hostname !== 'localhost' && window.location.hostname !== '127.0.0.1') {
                    // Console'u tamamen devre dƒ±≈üƒ± bƒ±rakma - sadece uyarƒ± g√∂ster
                    const originalLog = console.log;
                    console.log = function() {
                        originalLog.apply(console, ['[G√úVENLƒ∞K] Console kullanƒ±mƒ± kaydediliyor...']);
                        originalLog.apply(console, arguments);
                    };
                }
            }
        };
        
        // ========== 6. ANTI-TAMPERING ==========
        const AntiTamper = {
            originalFunctions: new Map(),
            
            init: function() {
                if (!SECURITY_CONFIG.enableAntiTamper) return;
                
                // Kritik fonksiyonlarƒ± koru
                this.protect('fetch', window);
                this.protect('XMLHttpRequest', window);
                this.protect('WebSocket', window);
                
                // localStorage ve sessionStorage'ƒ± koru
                this.protectStorage();
            },
            
            protect: function(fnName, obj) {
                const original = obj[fnName];
                if (original) {
                    this.originalFunctions.set(fnName, original);
                    Object.defineProperty(obj, fnName, {
                        configurable: false,
                        writable: false,
                        value: original
                    });
                }
            },
            
            protectStorage: function() {
                // Storage verilerini ≈üifrele
                const originalSetItem = localStorage.setItem.bind(localStorage);
                const originalGetItem = localStorage.getItem.bind(localStorage);
                
                localStorage.setItem = function(key, value) {
                    // Hassas verileri i≈üaretle
                    if (key.startsWith('_secure_')) {
                        value = btoa(encodeURIComponent(value));
                    }
                    return originalSetItem(key, value);
                };
                
                localStorage.getItem = function(key) {
                    let value = originalGetItem(key);
                    if (key.startsWith('_secure_') && value) {
                        try {
                            value = decodeURIComponent(atob(value));
                        } catch (e) {
                            value = null;
                        }
                    }
                    return value;
                };
            }
        };
        
        // ========== 7. HATA ƒ∞ZLEME VE KORUMA (Alpine.js Uyumlu) ==========
        const ErrorProtection = {
            init: function() {
                // ‚úÖ D√úZELTME: Alpine.js ve framework hatalarƒ±nƒ± filtrele
                var isFrameworkError = function(msg) {
                    var msgStr = String(msg || '').toLowerCase();
                    return msgStr.indexOf('alpine') !== -1 ||
                           msgStr.indexOf('x-data') !== -1 ||
                           msgStr.indexOf('x-') !== -1 ||
                           msgStr.indexOf('mutationobserver') !== -1 ||
                           msgStr.indexOf('proxy') !== -1 ||
                           msgStr.indexOf('reflect') !== -1 ||
                           msgStr.indexOf('cdn.tailwindcss') !== -1;
                };
                
                window.onerror = function(msg, url, lineNo, columnNo, error) {
                    // ‚úÖ D√úZELTME: Alpine.js/framework hatalarƒ±nƒ± sayma
                    if (isFrameworkError(msg)) {
                        return false; // Framework hatasƒ± - normal raporla
                    }
                    
                    // Aƒü, socket ve baƒülantƒ± hatalarƒ±nƒ± g√ºvenlik sayacƒ±ndan hari√ß tut
                    var msgStr = String(msg || '').toLowerCase();
                    var isNetworkError = msgStr.indexOf('network') !== -1 || 
                                         msgStr.indexOf('socket') !== -1 || 
                                         msgStr.indexOf('fetch') !== -1 || 
                                         msgStr.indexOf('xhr') !== -1 || 
                                         msgStr.indexOf('timeout') !== -1 ||
                                         msgStr.indexOf('cors') !== -1 ||
                                         msgStr.indexOf('failed to fetch') !== -1 ||
                                         msgStr.indexOf('websocket') !== -1 ||
                                         msgStr.indexOf('net::') !== -1 ||
                                         msgStr.indexOf('connection') !== -1;
                    
                    if (!isNetworkError) {
                        errorCount++;
                    }
                    
                    // √áok fazla hata = potansiyel saldƒ±rƒ±
                    if (errorCount > SECURITY_CONFIG.maxErrorsBeforeLock) {
                        isLocked = true;
                        SecurityLockout.lockSession('√áok fazla hata tespit edildi');
                        return true;
                    }
                    
                    return false; // Hatanƒ±n normal ≈üekilde raporlanmasƒ±na izin ver
                };
                
                // Promise rejection'larƒ± yakala - ama engelleme
                window.onunhandledrejection = function(event) {
                    var reason = String(event.reason || '').toLowerCase();
                    
                    // ‚úÖ D√úZELTME: Alpine.js/framework promise hatalarƒ±nƒ± sayma
                    if (isFrameworkError(reason)) {
                        return;
                    }
                    
                    // Aƒü/baƒülantƒ± promise hatalarƒ±nƒ± sayma
                    var isNetworkRejection = reason.indexOf('network') !== -1 || 
                                             reason.indexOf('fetch') !== -1 || 
                                             reason.indexOf('timeout') !== -1 ||
                                             reason.indexOf('socket') !== -1 ||
                                             reason.indexOf('abort') !== -1 ||
                                             reason.indexOf('connection') !== -1;
                    
                    if (!isNetworkRejection) {
                        errorCount++;
                    }
                };
            }
        };
        
        // ========== 7.5. G√úVENLƒ∞K LOCKOUT Sƒ∞STEMƒ∞ ==========
        const SecurityLockout = {
            lockSession: function(reason) {
                    reason = reason || 'G√ºvenlik ihlali tespit edildi';
                // XSS korumasƒ±: DOM API ile g√ºvenli render
                document.body.textContent = '';
                document.body.style.cssText = 'margin:0;padding:0;background:#0f172a;';
                
                var wrapper = document.createElement('div');
                wrapper.style.cssText = 'display:flex;align-items:center;justify-content:center;height:100vh;color:white;font-family:\'Plus Jakarta Sans\',sans-serif;';
                
                var inner = document.createElement('div');
                inner.style.cssText = 'text-align:center;max-width:400px;padding:40px;';
                
                var iconDiv = document.createElement('div');
                iconDiv.style.cssText = 'width:80px;height:80px;margin:0 auto 24px;background:rgba(239,68,68,0.1);border-radius:50%;display:flex;align-items:center;justify-content:center;';
                iconDiv.textContent = '‚ö†Ô∏è';
                iconDiv.style.fontSize = '40px';
                
                var h1 = document.createElement('h1');
                h1.style.cssText = 'font-size:24px;font-weight:700;margin-bottom:12px;';
                h1.textContent = 'G√ºvenlik Uyarƒ±sƒ±';
                
                var p1 = document.createElement('p');
                p1.style.cssText = 'color:#94a3b8;margin-bottom:24px;';
                p1.textContent = 'Oturumunuz g√ºvenlik nedeniyle sonlandƒ±rƒ±ldƒ±.';
                
                var p2 = document.createElement('p');
                p2.style.cssText = 'color:#64748b;font-size:14px;margin-bottom:24px;';
                p2.textContent = reason; // textContent - XSS safe!
                
                var btn = document.createElement('button');
                btn.id = 'security-retry-btn';
                btn.style.cssText = 'padding:14px 40px;background:#00b894;color:white;border:none;border-radius:12px;cursor:pointer;font-weight:600;font-size:16px;';
                btn.textContent = 'Yeniden Deneyelim';
                btn.onclick = function() { window.location.reload(); };
                
                inner.appendChild(iconDiv);
                inner.appendChild(h1);
                inner.appendChild(p1);
                inner.appendChild(p2);
                inner.appendChild(btn);
                wrapper.appendChild(inner);
                document.body.appendChild(wrapper);
                
                // Yeniden Deneyelim butonuna tƒ±klandƒ±ƒüƒ±nda
                setTimeout(function() {
                    var retryBtn = document.getElementById('security-retry-btn');
                    if (retryBtn) {
                        retryBtn.addEventListener('click', function() {
                            SecurityLockout.fullCleanupAndRedirect();
                        });
                    }
                }, 100);
            },
            
            fullCleanupAndRedirect: function() {
                try {
                    // 0. Sunucudaki T√úM oturumlarƒ± sonlandƒ±r
                    var token = null;
                    try {
                        // SecureStorage'dan token al
                        var rawToken = localStorage.getItem('_secure_token');
                        if (rawToken) {
                            try { token = decodeURIComponent(atob(rawToken)); } catch(e) { token = rawToken; }
                        }
                        // Eski format
                        if (!token) {
                            token = localStorage.getItem('agrolink_token');
                        }
                    } catch(e) {}

                    var logoutPromise;
                    if (token) {
                        logoutPromise = fetch('/api/auth/logout-all', {
                            method: 'POST',
                            headers: {
                                'Authorization': 'Bearer ' + token,
                                'Content-Type': 'application/json'
                            }
                        }).catch(function() {});
                    } else {
                        logoutPromise = Promise.resolve();
                    }

                    // Sunucu √ßaƒürƒ±sƒ±ndan sonra (veya hata olsa bile) temizle ve y√∂nlendir
                    logoutPromise.then(function() {
                        SecurityLockout._doFullCleanup();
                    }).catch(function() {
                        SecurityLockout._doFullCleanup();
                    });
                } catch(e) {
                    // Hata olursa yine de temizle ve y√∂nlendir
                    SecurityLockout._doFullCleanup();
                }
            },

            _doFullCleanup: function() {
                try {
                    // 1. localStorage'ƒ± tamamen temizle
                    localStorage.clear();
                    
                    // 2. sessionStorage'ƒ± temizle
                    sessionStorage.clear();
                    
                    // 3. T√ºm √ßerezleri sil
                    document.cookie.split(";").forEach(function(c) {
                        document.cookie = c.replace(/^ +/, "").replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/");
                    });
                    
                    // 4. Service Worker cache temizle
                    if ('caches' in window) {
                        caches.keys().then(function(names) {
                            names.forEach(function(name) {
                                caches.delete(name);
                            });
                        });
                    }
                    
                    // 5. IndexedDB temizle (eƒüer varsa)
                    if (window.indexedDB) {
                        try {
                            indexedDB.databases().then(function(dbs) {
                                dbs.forEach(function(db) {
                                    indexedDB.deleteDatabase(db.name);
                                });
                            });
                        } catch(e) {}
                    }
                    
                    // 6. Sayfayƒ± login ekranƒ±na y√∂nlendir (cache'siz)
                    window.location.href = window.location.origin + window.location.pathname + '?_=' + Date.now();
                } catch(e) {
                    window.location.reload(true);
                }
            }
        };
        
        // Global eri≈üim
        window.SecurityLockout = SecurityLockout;
        
        // ========== 7.6. HTTPS ZORUNLULUƒûU ==========
        const HTTPSEnforcement = {
            init: function() {
                // Sadece ger√ßek ortamda kontrol et (localhost hari√ß)
                if (window.location.hostname !== 'localhost' && 
                    window.location.hostname !== '127.0.0.1' && 
                    !window.location.hostname.includes('.lovable.app')) {
                    
                    // HTTP ise HTTPS'e y√∂nlendir
                    if (window.location.protocol === 'http:') {
                        window.location.href = window.location.href.replace('http:', 'https:');
                        return;
                    }
                }
                
                // HTTP baƒülantƒ±larƒ± engelle
                this.blockHTTPRequests();
            },
            
            blockHTTPRequests: function() {
                // üîí D√úZELTMESƒ∞: fetch override NetworkSecurity.init() i√ßinde tek seferde yapƒ±lƒ±yor
                // Burada sadece XHR'ƒ± wrap ediyoruz - √ßift fetch override "read only" hatasƒ±na neden oluyordu
                
                // XMLHttpRequest'i sarmalayarak HTTP isteklerini engelle
                var OriginalXHR = window.XMLHttpRequest;
                window.XMLHttpRequest = function() {
                    var xhr = new OriginalXHR();
                    var originalOpen = xhr.open.bind(xhr);
                    xhr.open = function(method, url) {
                        if (typeof url === 'string' && url.startsWith('http://') && 
                            !url.includes('localhost') && !url.includes('127.0.0.1') &&
                            window.location.protocol === 'https:') {
                            console.warn('[G√úVENLƒ∞K] HTTP XHR isteƒüi engellendi:', url);
                            throw new Error('HTTP istekleri g√ºvenlik nedeniyle engellendi. Sadece HTTPS kullanƒ±n.');
                        }
                        return originalOpen.apply(xhr, arguments);
                    };
                    return xhr;
                };
            }
        };
        
        // ========== 8. SAƒû TIK VE KLAVYE KORUMA (Hafifletilmi≈ü) ==========
        const InputProtection = {
            init: function() {
                // ‚úÖ D√úZELTME: Saƒü tƒ±k engelleme kaldƒ±rƒ±ldƒ± - kullanƒ±cƒ± deneyimini bozuyor
                // document.addEventListener('contextmenu', function(e) {
                //     e.preventDefault();
                //     return false;
                // }, true);
                
                // Resim s√ºr√ºklemeyi engelle (sadece resim/video)
                document.addEventListener('dragstart', function(e) {
                    if (e.target.tagName === 'IMG' || e.target.tagName === 'VIDEO') {
                        e.preventDefault();
                        return false;
                    }
                }, true);
                
                // ‚úÖ D√úZELTME: F12 ve DevTools engelleme KALDIRILDI
                // Bu engellemeler Alpine.js hatalarƒ±nƒ± debug etmeyi imkansƒ±zla≈ütƒ±rƒ±yor
                // ve kullanƒ±cƒ± deneyimini bozuyor
                
                // Sadece Ctrl+S (kaydet) ve Ctrl+P (yazdƒ±r) engelle
                document.addEventListener('keydown', function(e) {
                    // Ctrl+S - Kaydet
                    if (e.ctrlKey && e.key === 's') {
                        e.preventDefault();
                        return false;
                    }
                    // Ctrl+P - Print
                    if (e.ctrlKey && e.key === 'p') {
                        e.preventDefault();
                        return false;
                    }
                }, true);
                
                // Print engelle
                window.addEventListener('beforeprint', function(e) {
                    e.preventDefault();
                }, true);
            }
        };
        
        // ========== 9. CLICKJACKING KORUMA ==========
        const ClickjackingProtection = {
            init: function() {
                // Frame i√ßinde y√ºklenmesini engelle
                if (window.self !== window.top) {
                    try {
                        window.top.location = window.self.location;
                    } catch (e) {
                        // Cross-origin frame - sayfayƒ± gizle
                        document.body.style.display = 'none';
                        alert('Bu sayfa bir iframe i√ßinde g√∂r√ºnt√ºlenemez.');
                    }
                }
            }
        };
        
        // ========== 10. AXIOS G√úVENLƒ∞K ƒ∞NTERCEPTOR ==========
        const AxiosSecurity = {
            init: function() {
                if (typeof axios === 'undefined') return;
                
                // Request interceptor
                axios.interceptors.request.use(function(config) {
                    // XSS korumasƒ± - g√∂nderilen verileri sanitize et
                    // ‚ö†Ô∏è FormData ise DOKUNMA! sanitizeObject FormData'yƒ± d√ºz objeye
                    // √ßevirir, i√ßindeki File/Blob objeleri kaybolur ‚Üí sunucu req.files g√∂remez
                    if (config.data && typeof config.data === 'object' && !(config.data instanceof FormData)) {
                        config.data = AxiosSecurity.sanitizeObject(config.data);
                    }
                    
                    // CSRF token ekle
                    const csrfToken = document.querySelector('meta[name="csrf-token"]');
                    if (csrfToken) {
                        config.headers['X-CSRF-Token'] = csrfToken.content;
                    }
                    
                    // Request ID ekle (izleme i√ßin)
                    config.headers['X-Request-ID'] = AxiosSecurity.generateUUID();
                    
                    return config;
                }, function(error) {
                    return Promise.reject(error);
                });
                
                // Response interceptor
                axios.interceptors.response.use(function(response) {
                    return response;
                }, function(error) {
                    // 401/403 - Oturum sonlandƒ±rƒ±ldƒ±
                    if (error.response && (error.response.status === 401 || error.response.status === 403)) {
                        console.warn('[G√úVENLƒ∞K] Yetkisiz eri≈üim tespit edildi');
                    }
                    return Promise.reject(error);
                });
            },
            
            sanitizeObject: function(obj) {
                if (typeof obj !== 'object' || obj === null) return obj;
                
                const sanitized = Array.isArray(obj) ? [] : {};
                for (const key in obj) {
                    if (obj.hasOwnProperty(key)) {
                        const value = obj[key];
                        if (typeof value === 'string') {
                            sanitized[key] = XSSProtection.sanitize(value);
                        } else if (typeof value === 'object') {
                            sanitized[key] = AxiosSecurity.sanitizeObject(value);
                        } else {
                            sanitized[key] = value;
                        }
                    }
                }
                return sanitized;
            },
            
            generateUUID: function() {
                return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                    const r = Math.random() * 16 | 0;
                    const v = c === 'x' ? r : (r & 0x3 | 0x8);
                    return v.toString(16);
                });
            }
        };
        
        // ========== 11. SESSION G√úVENLƒ∞ƒûƒ∞ ==========
        const SessionSecurity = {
            sessionStart: Date.now(),
            lastActivity: Date.now(),
            
            resetActivity: function() {
                SessionSecurity.lastActivity = Date.now();
            },
            
            init: function() {
                // Kullanƒ±cƒ± aktivitesinde son aktivite zamanƒ±nƒ± g√ºncelle
                ['mousemove', 'keydown', 'click', 'touchstart', 'scroll'].forEach(function(evt) {
                    document.addEventListener(evt, SessionSecurity.resetActivity, { passive: true });
                });
                
                // Session timeout kontrol√º - aktivitesizlik bazlƒ±
                setInterval(function() {
                    var inactiveTime = Date.now() - SessionSecurity.lastActivity;
                    if (inactiveTime > SECURITY_CONFIG.sessionTimeout) {
                        localStorage.removeItem('agrolink_user');
                        sessionStorage.clear();
                        console.warn('[G√úVENLƒ∞K] Uzun s√ºreli aktivitesizlik nedeniyle oturum sonlandƒ±rƒ±ldƒ± (' + Math.round(inactiveTime/60000) + ' dk)');
                    }
                }, 60000);
                
                // Tab visibility - arka planda bƒ±rakƒ±lƒ±nca kontrol
                document.addEventListener('visibilitychange', function() {
                    if (document.visibilityState === 'visible') {
                        SessionSecurity.resetActivity();
                        SessionSecurity.validateSession();
                    }
                });
            },
            
            validateSession: function() {
                // Session'ƒ±n hala ge√ßerli olup olmadƒ±ƒüƒ±nƒ± kontrol et
                const user = localStorage.getItem('agrolink_user');
                if (!user) return;
                
                try {
                    JSON.parse(user);
                } catch (e) {
                    // Bozuk session - temizle
                    localStorage.removeItem('agrolink_user');
                    console.warn('[G√úVENLƒ∞K] Bozuk oturum tespit edildi ve temizlendi');
                }
            }
        };
        
        // ========== 12. SAFE NULL/UNDEFINED KORUMA ==========
        const SafeAccess = {
            init: function() {
                // Global safe access fonksiyonu
                window.safeGet = function(obj, path, defaultValue) {
                    if (obj === null || obj === undefined) return defaultValue;
                    const keys = path.split('.');
                    let result = obj;
                    for (const key of keys) {
                        if (result === null || result === undefined) return defaultValue;
                        result = result[key];
                    }
                    return result !== undefined ? result : defaultValue;
                };
                
                // Safe JSON parse
                window.safeJSONParse = function(str, defaultValue) {
                    if (!str) return defaultValue;
                    try {
                        return JSON.parse(str);
                    } catch (e) {
                        console.warn('[G√úVENLƒ∞K] JSON parse hatasƒ±');
                        return defaultValue;
                    }
                };
                
                // Safe function call
                window.safeCall = function(fn, context, args, defaultValue) {
                    if (typeof fn !== 'function') return defaultValue;
                    try {
                        return fn.apply(context, args);
                    } catch (e) {
                        console.warn('[G√úVENLƒ∞K] Fonksiyon √ßaƒürƒ±sƒ± hatasƒ±:', e.message);
                        return defaultValue;
                    }
                };
            }
        };
        
        // ========== 13. FORM G√úVENLƒ∞ƒûƒ∞ ==========
        const FormSecurity = {
            init: function() {
                // T√ºm formlarƒ± izle
                document.addEventListener('submit', function(e) {
                    const form = e.target;
                    if (form.tagName !== 'FORM') return;
                    
                    // Form verilerini sanitize et
                    const inputs = form.querySelectorAll('input, textarea');
                    inputs.forEach(function(input) {
                        if (input.type !== 'password' && input.type !== 'file') {
                            input.value = XSSProtection.sanitize(input.value);
                        }
                    });
                }, true);
                
                // Autocomplete'i hassas alanlarda kapat
                document.querySelectorAll('input[type="password"]').forEach(function(input) {
                    input.setAttribute('autocomplete', 'new-password');
                });
            }
        };
        
        // ========== 14. NETWORK G√úVENLƒ∞ƒûƒ∞ ==========
        const NetworkSecurity = {
            trustedOrigins: [
                window.location.origin,
                'https://cdn.tailwindcss.com',
                'https://unpkg.com',
                'https://cdnjs.cloudflare.com',
                'https://cdn.socket.io',
                'https://fonts.googleapis.com',
                'https://fonts.gstatic.com',
                'https://ui-avatars.com'
            ],
            
            init: function() {
                // üîí D√úZELTMESƒ∞: fetch TEK SEFERDA burada wrap ediliyor
                // HTTPSEnforcement.blockHTTPRequests() √∂nceden de override yapƒ±yordu - bu "read only" hatasƒ±na yol a√ßƒ±yordu
                // ƒ∞ki kontrol√º (HTTP engel + mixed content) Bƒ∞RLE≈ûTƒ∞RDƒ∞K
                try {
                    const nativeFetch = window.fetch;
                    const isHTTPS = window.location.protocol === 'https:';
                    const origin = window.location.origin;
                    
                    const secureFetch = function(url, options) {
                        try {
                            if (typeof url === 'string') {
                                // HTTP isteƒüi engelle (HTTPS ortamƒ±nda)
                                if (isHTTPS && url.startsWith('http://') &&
                                    !url.includes('localhost') && !url.includes('127.0.0.1')) {
                                    console.warn('[G√úVENLƒ∞K] HTTP/Mixed-content isteƒüi engellendi:', url);
                                    return Promise.reject(new Error('HTTP istekleri g√ºvenlik nedeniyle engellendi.'));
                                }
                            }
                        } catch (e) {
                            // URL parse hatasƒ± - ge√ß
                        }
                        return nativeFetch.apply(window, arguments);
                    };
                    
                    // G√ºvenli ≈üekilde override et - zaten override edilmi≈üse pas ge√ß
                    if (window.fetch === nativeFetch) {
                        try {
                            window.fetch = secureFetch;
                        } catch (assignErr) {
                            // Atama ba≈üarƒ±sƒ±z (read-only) - Object.defineProperty dene
                            try {
                                Object.defineProperty(window, 'fetch', {
                                    value: secureFetch,
                                    writable: true,
                                    configurable: true
                                });
                            } catch (defineErr) {
                                /* fetch wrap edilemedi - CSP zaten koruma saƒülƒ±yor */
                            }
                        }
                    }
                } catch(e) {
                    console.warn('[G√úVENLƒ∞K] NetworkSecurity ba≈ülatma hatasƒ±:', e.message);
                }
            }
        };
        
        // ========== 15. INTEGRITY CHECK ==========
        const IntegrityCheck = {
            checksums: new Map(),
            
            init: function() {
                // Kritik elementlerin hash'ini al
                const criticalElements = document.querySelectorAll('[data-integrity]');
                criticalElements.forEach(function(el) {
                    IntegrityCheck.checksums.set(el.id, IntegrityCheck.hash(el.innerHTML));
                });
                
                // Periyodik kontrol
                setInterval(function() {
                    IntegrityCheck.verify();
                }, 30000);
            },
            
            hash: function(str) {
                let hash = 0;
                for (let i = 0; i < str.length; i++) {
                    const char = str.charCodeAt(i);
                    hash = ((hash << 5) - hash) + char;
                    hash = hash & hash;
                }
                return hash.toString(16);
            },
            
            verify: function() {
                this.checksums.forEach(function(originalHash, elementId) {
                    const element = document.getElementById(elementId);
                    if (element) {
                        const currentHash = IntegrityCheck.hash(element.innerHTML);
                        if (currentHash !== originalHash) {
                            console.warn('[G√úVENLƒ∞K] Deƒüi≈üiklik tespit edildi:', elementId);
                        }
                    }
                });
            }
        };
        
        // ========== T√úM G√úVENLƒ∞K Sƒ∞STEMLERƒ∞Nƒ∞ BA≈ûLAT (Alpine.js Uyumlu) ==========
        function initializeSecurity() {
            // ‚úÖ D√úZELTME v3.0: G√ºvenlik sistemleri Alpine.js'den SONRA ba≈ülatƒ±lƒ±r
            // Bu sayede Alpine.js ba≈ülatƒ±lmasƒ± engellenmez
            
            function safeInit(name, fn) {
                try { fn(); }
                catch(e) { console.warn('[G√úVENLƒ∞K] ' + name + ' ba≈ülatƒ±lamadƒ± (devam ediliyor):', e.message); }
            }
            
            // ‚úÖ D√úZELTME: √ñnce temel g√ºvenlik sistemleri
            safeInit('HTTPSEnforcement', function() { HTTPSEnforcement.init(); });
            safeInit('ClickjackingProtection', function() { ClickjackingProtection.init(); });
            safeInit('SafeAccess',       function() { SafeAccess.init(); });
            
            // ‚úÖ D√úZELTME: Alpine.js ba≈ülatƒ±ldƒ±ktan SONRA DOMProtection ba≈ülat
            // DOMProtection MutationObserver Alpine.js'i engelleyebilir
            document.addEventListener('alpine:initialized', function() {
                setTimeout(function() {
                    safeInit('DOMProtection', function() { DOMProtection.init(); });
                }, 500);
            });
            
            // Diƒüer g√ºvenlik sistemleri
            safeInit('InputProtection',  function() { InputProtection.init(); });
            safeInit('AntiTamper',       function() { AntiTamper.init(); });
            safeInit('SessionSecurity',  function() { SessionSecurity.init(); });
            safeInit('FormSecurity',     function() { FormSecurity.init(); });
            
            // ‚úÖ D√úZELTME: ErrorProtection Alpine.js'den sonra ba≈ülat
            document.addEventListener('alpine:initialized', function() {
                setTimeout(function() {
                    safeInit('ErrorProtection', function() { ErrorProtection.init(); });
                }, 600);
            });
            safeInit('NetworkSecurity',  function() { NetworkSecurity.init(); }); // fetch wrap burada
            safeInit('IntegrityCheck',   function() { IntegrityCheck.init(); });
            
            // Axios y√ºklendikten sonra
            if (typeof axios !== 'undefined') {
                safeInit('AxiosSecurity', function() { AxiosSecurity.init(); });
            } else {
                window.addEventListener('load', function() {
                    if (typeof axios !== 'undefined') {
                        safeInit('AxiosSecurity', function() { AxiosSecurity.init(); });
                    }
                });
            }
            
            console.log('%c[AgroLink G√ºvenlik] Askeri d√ºzey koruma aktif', 'color: #00b894; font-weight: bold; font-size: 14px;');
        }
        
        // DOM hazƒ±r olduƒüunda ba≈ülat
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeSecurity);
        } else {
            initializeSecurity();
        }
        
        // ========== GLOBAL ERƒ∞≈ûƒ∞M ƒ∞√áƒ∞N EXPORT ==========
        window.AgroSecurity = {
            sanitize: XSSProtection.sanitize,
            escapeHTML: XSSProtection.escapeHTML,
            isValidURL: XSSProtection.isValidURL,
            safeGet: window.safeGet,
            safeJSONParse: window.safeJSONParse,
            safeCall: window.safeCall
        };
        
        // ========== CONSOLE KORUMA - SecureStorage Eri≈üimini Engelle ==========
        // Freeze ile deƒüi≈ütirilemez yap
        Object.freeze(window.AgroSecurity);
        
        // Console'dan localStorage eri≈üimini izle
        if (window.location.hostname !== 'localhost' && window.location.hostname !== '127.0.0.1') {
            const originalGetItem = localStorage.getItem.bind(localStorage);
            const originalSetItem = localStorage.setItem.bind(localStorage);
            
            // Sadece g√ºvenli prefix'li verilere izin ver, ham verileri temizle
            setTimeout(function() {
                // Eski ham verileri temizle
                const keysToRemove = ['token', 'user', 'agrolink_user'];
                keysToRemove.forEach(key => {
                    if (localStorage.getItem(key)) {
                        console.warn('[G√úVENLƒ∞K] G√ºvensiz veri tespit edildi ve temizlendi:', key);
                        localStorage.removeItem(key);
                    }
                });
            }, 2000);
        }
        
    })();
    </script>

    <!-- TOAST Bƒ∞LDƒ∞Rƒ∞Mƒ∞ -->
    <div x-show="toast.show" x-transition class="toast" x-text="toast.message"></div>

    <!-- ========== 2FA DOƒûRULAMA MODAL ========== -->
    <template x-if="show2FAModal">
        <div class="fixed inset-0 z-[99999] bg-black/80 backdrop-blur-sm flex items-center justify-center p-4">
            <div class="w-full max-w-md bg-white rounded-[2.5rem] p-8 shadow-2xl animate-slide-up">
                <div class="text-center mb-8">
                    <div class="w-20 h-20 bg-gradient-to-br from-emerald-500 to-teal-600 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg">
                        <i class="fas fa-shield-alt text-white text-3xl"></i>
                    </div>
                    <h2 class="text-2xl font-black text-slate-900">ƒ∞ki Adƒ±mlƒ± Doƒürulama</h2>
                    <p class="text-slate-500 mt-2">G√ºvenliƒüiniz i√ßin e-posta adresinize 6 haneli bir kod g√∂nderdik.</p>
                    <p class="text-emerald-600 font-bold mt-1" x-text="twoFAData.email"></p>
                </div>

                <!-- 2FA Kod Giri≈üi -->
                <form @submit.prevent="verify2FA" class="space-y-6">
                    <!-- 6 Haneli Kod Input -->
                    <div class="flex justify-center gap-2" id="twofa-inputs">
                        <input type="text" maxlength="1" x-model="twoFAInput[0]" @input="handle2FAInput(0, $event)" @keydown="handle2FABackspace(0, $event)" data-2fa="0" class="w-12 h-14 text-center text-2xl font-bold bg-slate-100 rounded-xl border-2 border-transparent focus:border-emerald-500 focus:bg-white outline-none transition" inputmode="numeric" pattern="[0-9]" required>
                        <input type="text" maxlength="1" x-model="twoFAInput[1]" @input="handle2FAInput(1, $event)" @keydown="handle2FABackspace(1, $event)" data-2fa="1" class="w-12 h-14 text-center text-2xl font-bold bg-slate-100 rounded-xl border-2 border-transparent focus:border-emerald-500 focus:bg-white outline-none transition" inputmode="numeric" pattern="[0-9]" required>
                        <input type="text" maxlength="1" x-model="twoFAInput[2]" @input="handle2FAInput(2, $event)" @keydown="handle2FABackspace(2, $event)" data-2fa="2" class="w-12 h-14 text-center text-2xl font-bold bg-slate-100 rounded-xl border-2 border-transparent focus:border-emerald-500 focus:bg-white outline-none transition" inputmode="numeric" pattern="[0-9]" required>
                        <input type="text" maxlength="1" x-model="twoFAInput[3]" @input="handle2FAInput(3, $event)" @keydown="handle2FABackspace(3, $event)" data-2fa="3" class="w-12 h-14 text-center text-2xl font-bold bg-slate-100 rounded-xl border-2 border-transparent focus:border-emerald-500 focus:bg-white outline-none transition" inputmode="numeric" pattern="[0-9]" required>
                        <input type="text" maxlength="1" x-model="twoFAInput[4]" @input="handle2FAInput(4, $event)" @keydown="handle2FABackspace(4, $event)" data-2fa="4" class="w-12 h-14 text-center text-2xl font-bold bg-slate-100 rounded-xl border-2 border-transparent focus:border-emerald-500 focus:bg-white outline-none transition" inputmode="numeric" pattern="[0-9]" required>
                        <input type="text" maxlength="1" x-model="twoFAInput[5]" @input="handle2FAInput(5, $event)" @keydown="handle2FABackspace(5, $event)" data-2fa="5" class="w-12 h-14 text-center text-2xl font-bold bg-slate-100 rounded-xl border-2 border-transparent focus:border-emerald-500 focus:bg-white outline-none transition" inputmode="numeric" pattern="[0-9]" required>
                    </div>

                    <!-- Kalan S√ºre -->
                    <div class="text-center">
                        <p class="text-sm text-slate-500">
                            Kodun ge√ßerlilik s√ºresi: 
                            <span class="font-bold text-emerald-600" x-text="format2FATimer()"></span>
                        </p>
                    </div>

                    <!-- Hata Mesajƒ± -->
                    <div x-show="twoFAError" class="bg-red-50 border border-red-200 rounded-xl p-3 text-center">
                        <p class="text-red-600 text-sm font-medium" x-text="twoFAError"></p>
                    </div>

                    <button type="submit" class="w-full py-4 btn-agro bg-emerald-500 shadow-lg shadow-emerald-200 hover:bg-emerald-600" :disabled="loading || !is2FAComplete()">
                        <span x-show="!loading">Doƒürula ve Giri≈ü Yap</span>
                        <i x-show="loading" class="fas fa-spinner fa-spin"></i>
                    </button>
                </form>

                <!-- Alt Se√ßenekler -->
                <div class="mt-6 text-center space-y-3">
                    <button @click="resend2FACode" :disabled="twoFAResendTimer > 0 || loading" class="text-sm font-bold transition" :class="twoFAResendTimer > 0 ? 'text-slate-400' : 'text-emerald-600 hover:text-emerald-700'">
                        <span x-show="twoFAResendTimer === 0">Kodu Tekrar G√∂nder</span>
                        <span x-show="twoFAResendTimer > 0" x-text="twoFAResendTimer + ' saniye sonra tekrar g√∂nder'"></span>
                    </button>
                    <button @click="cancel2FA" class="text-sm text-slate-500 font-medium block w-full hover:text-slate-700">
                        ƒ∞ptal Et
                    </button>
                </div>
            </div>
        </div>
    </template>

    <!-- ========== E-POSTA DOƒûRULAMA MODAL ========== -->
    <template x-if="showEmailVerifyModal">
        <div class="fixed inset-0 z-[99999] bg-black/80 backdrop-blur-sm flex items-center justify-center p-4">
            <div class="w-full max-w-md bg-white rounded-[2.5rem] p-8 shadow-2xl animate-slide-up">
                <div class="text-center mb-8">
                    <div class="w-20 h-20 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg">
                        <i class="fas fa-envelope-open-text text-white text-3xl"></i>
                    </div>
                    <h2 class="text-2xl font-black text-slate-900">E-Posta Doƒürulama</h2>
                    <p class="text-slate-500 mt-2">Kaydƒ±nƒ±zƒ± tamamlamak i√ßin e-posta adresinize g√∂nderilen 6 haneli kodu girin.</p>
                    <p class="text-blue-600 font-bold mt-1" x-text="emailVerifyData.email"></p>
                </div>

                <!-- Doƒürulama Kod Giri≈üi -->
                <form @submit.prevent="verifyEmailCode" class="space-y-6">
                    <!-- 6 Haneli Kod Input -->
                    <div class="flex justify-center gap-2" id="email-verify-inputs">
                        <input type="text" maxlength="1" x-model="emailVerifyInput[0]" @input="handleEmailVerifyInput(0, $event)" @keydown="handleEmailVerifyBackspace(0, $event)" data-ev="0" class="w-12 h-14 text-center text-2xl font-bold bg-slate-100 rounded-xl border-2 border-transparent focus:border-blue-500 focus:bg-white outline-none transition" inputmode="numeric" pattern="[0-9]" required>
                        <input type="text" maxlength="1" x-model="emailVerifyInput[1]" @input="handleEmailVerifyInput(1, $event)" @keydown="handleEmailVerifyBackspace(1, $event)" data-ev="1" class="w-12 h-14 text-center text-2xl font-bold bg-slate-100 rounded-xl border-2 border-transparent focus:border-blue-500 focus:bg-white outline-none transition" inputmode="numeric" pattern="[0-9]" required>
                        <input type="text" maxlength="1" x-model="emailVerifyInput[2]" @input="handleEmailVerifyInput(2, $event)" @keydown="handleEmailVerifyBackspace(2, $event)" data-ev="2" class="w-12 h-14 text-center text-2xl font-bold bg-slate-100 rounded-xl border-2 border-transparent focus:border-blue-500 focus:bg-white outline-none transition" inputmode="numeric" pattern="[0-9]" required>
                        <input type="text" maxlength="1" x-model="emailVerifyInput[3]" @input="handleEmailVerifyInput(3, $event)" @keydown="handleEmailVerifyBackspace(3, $event)" data-ev="3" class="w-12 h-14 text-center text-2xl font-bold bg-slate-100 rounded-xl border-2 border-transparent focus:border-blue-500 focus:bg-white outline-none transition" inputmode="numeric" pattern="[0-9]" required>
                        <input type="text" maxlength="1" x-model="emailVerifyInput[4]" @input="handleEmailVerifyInput(4, $event)" @keydown="handleEmailVerifyBackspace(4, $event)" data-ev="4" class="w-12 h-14 text-center text-2xl font-bold bg-slate-100 rounded-xl border-2 border-transparent focus:border-blue-500 focus:bg-white outline-none transition" inputmode="numeric" pattern="[0-9]" required>
                        <input type="text" maxlength="1" x-model="emailVerifyInput[5]" @input="handleEmailVerifyInput(5, $event)" @keydown="handleEmailVerifyBackspace(5, $event)" data-ev="5" class="w-12 h-14 text-center text-2xl font-bold bg-slate-100 rounded-xl border-2 border-transparent focus:border-blue-500 focus:bg-white outline-none transition" inputmode="numeric" pattern="[0-9]" required>
                    </div>

                    <!-- Kalan S√ºre -->
                    <div class="text-center">
                        <p class="text-sm text-slate-500">
                            Kodun ge√ßerlilik s√ºresi: 
                            <span class="font-bold text-blue-600" x-text="formatEmailVerifyTimer()"></span>
                        </p>
                    </div>

                    <!-- Hata Mesajƒ± -->
                    <div x-show="emailVerifyError" class="bg-red-50 border border-red-200 rounded-xl p-3 text-center">
                        <p class="text-red-600 text-sm font-medium" x-text="emailVerifyError"></p>
                    </div>

                    <button type="submit" class="w-full py-4 btn-agro bg-blue-500 shadow-lg shadow-blue-200 hover:bg-blue-600" :disabled="loading || !isEmailVerifyComplete()">
                        <span x-show="!loading">Doƒürula ve Kaydƒ± Tamamla</span>
                        <i x-show="loading" class="fas fa-spinner fa-spin"></i>
                    </button>
                </form>

                <!-- Alt Se√ßenekler -->
                <div class="mt-6 text-center space-y-3">
                    <button @click="resendEmailCode" :disabled="emailResendTimer > 0 || loading" class="text-sm font-bold transition" :class="emailResendTimer > 0 ? 'text-slate-400' : 'text-blue-600 hover:text-blue-700'">
                        <span x-show="emailResendTimer === 0">Kodu Tekrar G√∂nder</span>
                        <span x-show="emailResendTimer > 0" x-text="emailResendTimer + ' saniye sonra tekrar g√∂nder'"></span>
                    </button>
                    <button @click="cancelEmailVerify" class="text-sm text-slate-500 font-medium block w-full hover:text-slate-700">
                        ƒ∞ptal Et
                    </button>
                </div>
            </div>
        </div>
    </template>

    <!-- ========== ƒ∞LGƒ∞ ALANLARI ONBOARDING ========== -->
    <template x-if="showInterestsOnboarding">
        <div class="fixed inset-0 z-[99999] bg-gradient-to-br from-emerald-900 via-green-800 to-teal-900 flex flex-col overflow-y-auto">
            <div class="max-w-lg mx-auto w-full px-4 py-8 flex flex-col min-h-full">
                <!-- Header -->
                <div class="text-center mb-6">
                    <div class="w-16 h-16 bg-white/20 rounded-2xl flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-seedling text-white text-3xl"></i>
                    </div>
                    <h2 class="text-2xl font-black text-white">ƒ∞lgi Alanlarƒ±nƒ±zƒ± Se√ßin</h2>
                    <p class="text-emerald-200 mt-1 text-sm">Size √∂zel i√ßerikler g√∂sterelim (en az 3 se√ßin)</p>
                    <div class="flex items-center justify-center gap-2 mt-3">
                        <span class="text-white/80 text-xs font-medium" x-text="selectedInterests.length + ' se√ßildi'"></span>
                        <div class="flex gap-1">
                            <div class="w-8 h-1.5 rounded-full" :class="selectedInterests.length >= 1 ? 'bg-white' : 'bg-white/30'"></div>
                            <div class="w-8 h-1.5 rounded-full" :class="selectedInterests.length >= 3 ? 'bg-white' : 'bg-white/30'"></div>
                            <div class="w-8 h-1.5 rounded-full" :class="selectedInterests.length >= 5 ? 'bg-white' : 'bg-white/30'"></div>
                        </div>
                    </div>
                </div>

                <!-- ƒ∞lgi Alanlarƒ± Grid -->
                <div class="flex flex-wrap gap-2 justify-center mb-8" x-data="{
                    allInterests: [
                        {emoji:'üçÖ', label:'Domates'},{emoji:'ü•¶', label:'Brokoli'},{emoji:'üåΩ', label:'Mƒ±sƒ±r'},
                        {emoji:'ü•ï', label:'Havu√ß'},{emoji:'üßÖ', label:'Soƒüan'},{emoji:'üßÑ', label:'Sarƒ±msak'},
                        {emoji:'üçÜ', label:'Patlƒ±can'},{emoji:'ü•í', label:'Salatalƒ±k'},{emoji:'üå∂Ô∏è', label:'Biber'},
                        {emoji:'ü•¨', label:'Marul'},{emoji:'ü•ë', label:'Avokado'},{emoji:'üçì', label:'√áilek'},
                        {emoji:'üçá', label:'√úz√ºm'},{emoji:'üçé', label:'Elma'},{emoji:'üçã', label:'Limon'},
                        {emoji:'üçä', label:'Portakal'},{emoji:'üçë', label:'≈ûeftali'},{emoji:'üçí', label:'Kiraz'},
                        {emoji:'üçå', label:'Muz'},{emoji:'üçâ', label:'Karpuz'},{emoji:'üçà', label:'Kavun'},
                        {emoji:'üåæ', label:'Buƒüday'},{emoji:'üåø', label:'Organik Tarƒ±m'},{emoji:'üöú', label:'√áift√ßilik'},
                        {emoji:'üå±', label:'Fide Yeti≈ütiriciliƒüi'},{emoji:'ü™¥', label:'Saksƒ± Bah√ßeciliƒüi'},
                        {emoji:'üè°', label:'Bah√ßecilik'},{emoji:'üåª', label:'√ái√ßek Yeti≈ütiriciliƒüi'},
                        {emoji:'üçµ', label:'√áay Tarƒ±mƒ±'},{emoji:'‚òï', label:'Kahve Yeti≈ütiriciliƒüi'},
                        {emoji:'ü´í', label:'Zeytin'},{emoji:'üå∞', label:'Fƒ±ndƒ±k/Ceviz'},
                        {emoji:'üåæ', label:'Pirin√ß'},{emoji:'ü•ú', label:'Fƒ±stƒ±k'},
                        {emoji:'üêÑ', label:'Hayvancƒ±lƒ±k'},{emoji:'üêî', label:'K√ºmes Hayvancƒ±lƒ±ƒüƒ±'},
                        {emoji:'üêù', label:'Arƒ±cƒ±lƒ±k'},{emoji:'üêü', label:'Aquak√ºlt√ºr'},
                        {emoji:'üå°Ô∏è', label:'Sera Yeti≈ütiriciliƒüi'},{emoji:'üíß', label:'Sulama Sistemleri'},
                        {emoji:'üåç', label:'Toprak Bilimi'},{emoji:'üî¨', label:'Tarƒ±m Teknolojisi'},
                        {emoji:'‚òÄÔ∏è', label:'Solar Tarƒ±m'},{emoji:'üåßÔ∏è', label:'Yaƒüƒ±≈ü Suyu Hasadƒ±'},
                        {emoji:'üß™', label:'G√ºbre & Kompost'},{emoji:'üèóÔ∏è', label:'Hidroponik'},
                        {emoji:'ü§ñ', label:'Akƒ±llƒ± Tarƒ±m'},{emoji:'üìä', label:'Tarƒ±m Ekonomisi'},
                        {emoji:'üåø', label:'Tƒ±bbi Bitkiler'},{emoji:'ü´ö', label:'Yaƒülƒ± Tohumlar'}
                    ]
                }">
                    <template x-for="item in allInterests" :key="item.label">
                        <button @click="toggleInterest(item.label)"
                                :class="selectedInterests.includes(item.label) ? 'bg-white text-emerald-700 shadow-lg scale-105 border-2 border-white' : 'bg-white/15 text-white border-2 border-white/30 hover:bg-white/25'"
                                class="px-3 py-2 rounded-2xl text-sm font-bold flex items-center gap-1.5 transition-all duration-200">
                            <span x-text="item.emoji"></span>
                            <span x-text="item.label"></span>
                        </button>
                    </template>
                </div>

                <!-- En √áok Takip√ßili Hesaplar -->
                <div class="mb-8">
                    <h3 class="text-white font-black text-lg mb-1">üèÜ Platform'un En Pop√ºler Hesaplarƒ±</h3>
                    <p class="text-emerald-200 text-xs mb-4">Takip ederek haberdar olun</p>
                    <div class="space-y-3">
                        <template x-for="account in interestTopAccounts" :key="account.id">
                            <div class="bg-white/10 backdrop-blur-sm rounded-2xl p-3 flex items-center gap-3 border border-white/20">
                                <img :src="account.profilePic || 'https://ui-avatars.com/api/?name=' + (account.name || 'User') + '&background=00b894&color=fff'"
                                     class="w-12 h-12 rounded-full object-cover border-2 border-white/30 flex-shrink-0">
                                <div class="flex-1 min-w-0">
                                    <p class="text-white font-bold text-sm truncate" x-text="account.name"></p>
                                    <p class="text-emerald-200 text-xs" x-text="'@' + account.username"></p>
                                    <p class="text-white/60 text-[11px]" x-text="(account.followersCount || 0).toLocaleString() + ' takip√ßi'"></p>
                                </div>
                                <button @click="toggleOnboardingFollow(account)"
                                        :class="account.followed ? 'bg-white/20 text-white border-white/40' : 'bg-white text-emerald-700'"
                                        class="px-4 py-2 rounded-xl text-xs font-black border flex-shrink-0 transition-all">
                                    <i class="fas mr-1" :class="account.followed ? 'fa-user-check' : 'fa-user-plus'"></i>
                                    <span x-text="account.followed ? 'Takip Ediliyor' : 'Takip Et'"></span>
                                </button>
                            </div>
                        </template>
                        <template x-if="interestTopAccounts.length === 0">
                            <div class="text-center py-4 text-white/50 text-sm">Y√ºkleniyor...</div>
                        </template>
                    </div>
                </div>

                <!-- Devam Et Butonu -->
                <div class="pb-8">
                    <button @click="finishInterestsOnboarding()"
                            :disabled="selectedInterests.length < 3"
                            :class="selectedInterests.length >= 3 ? 'bg-white text-emerald-700 shadow-xl' : 'bg-white/30 text-white/50'"
                            class="w-full py-4 rounded-2xl font-black text-lg transition-all duration-300">
                        <span x-show="selectedInterests.length >= 3">Devam Et <i class="fas fa-arrow-right ml-2"></i></span>
                        <span x-show="selectedInterests.length < 3" x-text="'En az 3 se√ßin (' + selectedInterests.length + '/3)'"></span>
                    </button>
                    <button @click="finishInterestsOnboarding()" class="w-full mt-3 text-white/50 text-sm py-2">Atla</button>
                </div>
            </div>
        </div>
    </template>

    <!-- ========== Dƒ∞L SE√áƒ∞Mƒ∞ ONBOARDING ========== -->
    <template x-if="showLangOnboarding">
        <!-- ‚úÖ D√úZELTME: overflow-y-auto + items-start ile scroll √ßalƒ±≈üƒ±r hale getirildi -->
        <div class="fixed inset-0 z-[99999] bg-gradient-to-br from-blue-900 via-indigo-800 to-purple-900 flex flex-col items-center overflow-y-auto" style="-webkit-overflow-scrolling: touch;">
            <div class="w-full max-w-md px-6 py-8 flex-shrink-0">
                <!-- Header -->
                <div class="text-center mb-8">
                    <div class="w-20 h-20 bg-white/20 rounded-3xl flex items-center justify-center mx-auto mb-5 shadow-xl">
                        <i class="fas fa-globe text-white text-4xl"></i>
                    </div>
                    <h2 class="text-3xl font-black text-white">Dilinizi Se√ßin</h2>
                    <p class="text-indigo-200 mt-2">AgroLink'i istediƒüiniz dilde kullanƒ±n</p>
                </div>

                <!-- Dil Se√ßenekleri - ‚úÖ Her dil butonu tam listede g√∂r√ºn√ºr -->
                <div class="space-y-3 mb-8">
                    <template x-for="lang in availableLanguages" :key="lang.code">
                        <button @click="currentLanguage = lang.code; localStorage.setItem('agrolink_lang', lang.code)"
                                :class="currentLanguage === lang.code ? 'bg-white text-indigo-700 shadow-xl scale-[1.02]' : 'bg-white/15 text-white border border-white/30 hover:bg-white/25'"
                                class="w-full py-4 px-5 rounded-2xl flex items-center gap-4 transition-all duration-200 font-bold">
                            <span class="text-3xl" x-text="lang.flag"></span>
                            <div class="flex-1 text-left">
                                <p class="font-black text-lg" x-text="lang.name"></p>
                                <p class="text-xs opacity-70" x-text="lang.code.toUpperCase()"></p>
                            </div>
                            <template x-if="currentLanguage === lang.code">
                                <i class="fas fa-check-circle text-emerald-500 text-xl"></i>
                            </template>
                        </button>
                    </template>
                </div>

                <!-- Tamamla -->
                <button @click="finishLangOnboarding()"
                        class="w-full py-5 bg-white text-indigo-700 rounded-2xl font-black text-xl shadow-2xl hover:shadow-white/20 transition-all active:scale-95 mb-4">
                    AgroLink'e Ba≈üla üå±
                </button>
            </div>
        </div>
    </template>

    <!-- 1. AUTH EKRANI - Giri≈ü yapƒ±lmadan hi√ßbir i√ßerik g√∂r√ºnt√ºlenemez -->
    <template x-if="!isLoggedIn && !show2FAModal && !showEmailVerifyModal && !showInterestsOnboarding && !showLangOnboarding">
        <div class="auth-overlay flex items-start justify-center p-4 overflow-y-auto" style="-webkit-overflow-scrolling: touch; min-height: 100vh; min-height: 100dvh;">
            <div class="w-full max-w-md bg-white text-slate-900 rounded-[2.5rem] p-8 shadow-2xl my-auto" style="-webkit-overflow-scrolling: touch;">
                
                <!-- Logo & Slogan -->
                <div class="text-center mb-8">
                    <div class="w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg shadow-emerald-200 overflow-hidden border-2 border-emerald-500">
                        <img src="agro.png" alt="AgroLink Logo" class="w-full h-full object-cover">
                    </div>
                    <h1 class="text-3xl font-black text-emerald-500">AgroLink</h1>
                    <template x-if="authMode === 'register'">
                        <div class="mt-3 px-2">
                            <p class="text-base font-black text-slate-700">Agrolink'e ho≈ü geldin.</p>
                            <p class="text-xs text-slate-500 mt-1 leading-relaxed italic">"Burada her soru bir tecr√ºbe, her cevap bir bereket demektir. Bilgini payla≈ü, ba≈ükasƒ±nƒ±n topraƒüƒ±na umut ol."</p>
                        </div>
                    </template>
                    <template x-if="authMode !== 'register'">
                        <p class="text-slate-500 font-bold" x-text="authMode === 'login' ? 'Ho≈ügeldiniz' : '≈ûifre Sƒ±fƒ±rla'"></p>
                    </template>
                </div>

                <!-- ========== ADIM ADIM KAYIT ========== -->
                <template x-if="authMode === 'register'">
                    <div>
                        <!-- Adƒ±m g√∂stergesi -->
                        <div class="flex items-center justify-center gap-2 mb-8">
                            <!-- Adƒ±m 1 -->
                            <div class="flex flex-col items-center gap-1">
                                <div class="w-10 h-10 rounded-full flex items-center justify-center font-black text-sm transition-all duration-300"
                                     :class="[registerStep >= 1 ? 'bg-emerald-500 text-white' : 'bg-slate-100 text-slate-400', registerStep > 1 ? 'step-circle-done' : '']">
                                    <template x-if="registerStep > 1">
                                        <i class="fas fa-check text-xs step-check-anim"></i>
                                    </template>
                                    <template x-if="registerStep <= 1"><span>1</span></template>
                                </div>
                                <span class="text-[9px] font-bold" :class="registerStep >= 1 ? 'text-emerald-600' : 'text-slate-400'">Bilgiler</span>
                            </div>
                            <div class="w-8 h-0.5 mb-4 rounded-full transition-all duration-500" :class="registerStep >= 2 ? 'bg-emerald-400' : 'bg-slate-200'"></div>
                            <!-- Adƒ±m 2 -->
                            <div class="flex flex-col items-center gap-1">
                                <div class="w-10 h-10 rounded-full flex items-center justify-center font-black text-sm transition-all duration-300"
                                     :class="[registerStep >= 2 ? 'bg-emerald-500 text-white' : 'bg-slate-100 text-slate-400', registerStep > 2 ? 'step-circle-done' : '']">
                                    <template x-if="registerStep > 2">
                                        <i class="fas fa-check text-xs step-check-anim"></i>
                                    </template>
                                    <template x-if="registerStep <= 2"><span>2</span></template>
                                </div>
                                <span class="text-[9px] font-bold" :class="registerStep >= 2 ? 'text-emerald-600' : 'text-slate-400'">E-posta</span>
                            </div>
                            <div class="w-8 h-0.5 mb-4 rounded-full transition-all duration-500" :class="registerStep >= 3 ? 'bg-emerald-400' : 'bg-slate-200'"></div>
                            <!-- Adƒ±m 3 -->
                            <div class="flex flex-col items-center gap-1">
                                <div class="w-10 h-10 rounded-full flex items-center justify-center font-black text-sm transition-all duration-300"
                                     :class="registerStep >= 3 ? 'bg-emerald-500 text-white' : 'bg-slate-100 text-slate-400'">
                                    <span>3</span>
                                </div>
                                <span class="text-[9px] font-bold" :class="registerStep >= 3 ? 'text-emerald-600' : 'text-slate-400'">Giri≈ü</span>
                            </div>
                        </div>

                        <!-- ADIM 1: Ki≈üisel Bilgiler -->
                        <div x-show="registerStep === 1" class="space-y-4">
                            <div class="text-center mb-2">
                                <p class="text-sm font-bold text-slate-500">ADIM 1</p>
                                <h2 class="text-xl font-black text-slate-800">Hesabƒ±nƒ± Olu≈ütur</h2>
                                <p class="text-xs text-slate-400">Ki≈üisel Bilgiler</p>
                            </div>
                            <!-- Profil Fotoƒürafƒ± -->
                            <div class="flex flex-col items-center gap-2">
                                <label class="relative cursor-pointer group">
                                    <div class="w-24 h-24 rounded-full bg-slate-100 flex items-center justify-center border-3 border-dashed border-emerald-300 overflow-hidden shadow-md group-active:scale-95 transition-transform">
                                        <template x-if="!authForm.avatarPreview">
                                            <div class="flex flex-col items-center">
                                                <i class="fas fa-camera text-emerald-400 text-2xl"></i>
                                                <span class="text-[9px] text-slate-400 mt-1">Fotoƒüraf</span>
                                            </div>
                                        </template>
                                        <template x-if="authForm.avatarPreview">
                                            <img :src="authForm.avatarPreview" class="w-full h-full object-cover">
                                        </template>
                                    </div>
                                    <div class="absolute bottom-0 right-0 w-7 h-7 bg-emerald-500 rounded-full flex items-center justify-center shadow-lg border-2 border-white">
                                        <i class="fas fa-plus text-white text-xs"></i>
                                    </div>
                                    <input type="file" class="hidden" @change="previewAvatar" accept="image/*">
                                </label>
                                <span class="text-[10px] font-bold text-slate-400 uppercase">Profil Fotoƒürafƒ± Se√ß</span>
                            </div>
                            <input type="text" x-model="authForm.name" placeholder="Ad Soyad" class="w-full bg-slate-100 p-4 rounded-2xl border-none focus:ring-2 focus:ring-emerald-500 outline-none" required>
                            <input type="text" x-model="authForm.username" @input="authForm.username = authForm.username.toLowerCase().replace(/[^a-z0-9._]/g, '')" placeholder="Kullanƒ±cƒ± Adƒ± (sadece k√º√ß√ºk harf)" class="w-full bg-slate-100 p-4 rounded-2xl border-none focus:ring-2 focus:ring-emerald-500 outline-none" required>
                            <p class="text-[10px] text-slate-400 -mt-2 ml-2">Sadece k√º√ß√ºk harf, rakam, nokta ve alt √ßizgi kullanƒ±labilir</p>
                            <!-- Hesap Tipi -->
                            <div class="space-y-2">
                                <label class="text-xs font-bold text-slate-500">Hesap Tipiniz</label>
                                <select x-model="authForm.userType" class="w-full bg-slate-100 p-4 rounded-2xl border-none focus:ring-2 focus:ring-emerald-500 outline-none" required>
                                    <option value="">Hesap tipi se√ßin</option>
                                    <option value="tarim_ogretmeni">üåæ Tarƒ±m √ñƒüretmeni</option>
                                    <option value="tarim_ogrencisi">üéì Tarƒ±m √ñƒürencisi</option>
                                    <option value="ogretmen">üìö √ñƒüretmen</option>
                                    <option value="ziraat_muhendisi">üî¨ Ziraat M√ºhendisi</option>
                                    <option value="normal_kullanici">üë§ Normal Kullanƒ±cƒ±</option>
                                    <option value="ciftci_hayvancilik">üêÑ √áift√ßi & Hayvancƒ±lƒ±k</option>
                                </select>
                            </div>
                            <button @click="
                                if(!authForm.name.trim() || !authForm.username.trim() || !authForm.userType) {
                                    showToast('L√ºtfen t√ºm alanlarƒ± doldurun', 'error');
                                    return;
                                }
                                registerStep = 2;
                            " class="w-full py-5 btn-agro bg-emerald-500 shadow-lg shadow-emerald-200 text-lg font-black rounded-2xl flex items-center justify-center gap-2">
                                Devam Et <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>

                        <!-- ADIM 2: E-posta & ≈ûifre -->
                        <div x-show="registerStep === 2" class="space-y-4">
                            <div class="text-center mb-2">
                                <p class="text-sm font-bold text-slate-500">ADIM 2</p>
                                <h2 class="text-xl font-black text-slate-800">E-posta & ≈ûifre</h2>
                                <p class="text-xs text-slate-400">Hesap g√ºvenliƒüin i√ßin</p>
                            </div>
                            <input type="email" x-model="authForm.email" placeholder="E-Posta (@gmail.com)" class="w-full bg-slate-100 p-4 rounded-2xl border-none focus:ring-2 focus:ring-emerald-500 outline-none" required>
                            <div class="relative">
                                <input :type="showPassword ? 'text' : 'password'" x-model="authForm.password" placeholder="≈ûifre" class="w-full bg-slate-100 p-4 pr-12 rounded-2xl border-none focus:ring-2 focus:ring-emerald-500 outline-none" required>
                                <button type="button" @click="showPassword = !showPassword" class="absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600 transition-colors">
                                    <i class="fas" :class="showPassword ? 'fa-eye-slash' : 'fa-eye'"></i>
                                </button>
                            </div>
                            <!-- ≈ûifre Gereksinimleri -->
                            <div class="bg-slate-50 rounded-xl p-3 space-y-1.5 border border-slate-200">
                                <p class="text-[11px] font-bold text-slate-500 mb-1">≈ûifre Gereksinimleri:</p>
                                <div class="flex items-center gap-2 text-[11px]" :class="authForm.password.length >= 8 ? 'text-emerald-600' : 'text-slate-400'">
                                    <i class="fas" :class="authForm.password.length >= 8 ? 'fa-check-circle' : 'fa-circle'"></i>
                                    <span>En az 8 karakter</span>
                                </div>
                                <div class="flex items-center gap-2 text-[11px]" :class="/[a-zA-Z]/.test(authForm.password) ? 'text-emerald-600' : 'text-slate-400'">
                                    <i class="fas" :class="/[a-zA-Z]/.test(authForm.password) ? 'fa-check-circle' : 'fa-circle'"></i>
                                    <span>En az bir harf (a-z, A-Z)</span>
                                </div>
                                <div class="flex items-center gap-2 text-[11px]" :class="/[0-9]/.test(authForm.password) ? 'text-emerald-600' : 'text-slate-400'">
                                    <i class="fas" :class="/[0-9]/.test(authForm.password) ? 'fa-check-circle' : 'fa-circle'"></i>
                                    <span>En az bir rakam (0-9)</span>
                                </div>
                                <div class="flex items-center gap-2 text-[11px]" :class="/[!@#$%^&*()_+\-=\[\]{};':\\|,.<>\/?]/.test(authForm.password) ? 'text-emerald-600' : 'text-slate-400'">
                                    <i class="fas" :class="/[!@#$%^&*()_+\-=\[\]{};':\\|,.<>\/?]/.test(authForm.password) ? 'fa-check-circle' : 'fa-circle'"></i>
                                    <span>En az bir √∂zel karakter (!, @, #, vb.)</span>
                                </div>
                            </div>
                            <!-- KVKK -->
                            <label class="flex items-start gap-2 p-2">
                                <input type="checkbox" x-model="authForm.kvkk" class="mt-1 accent-emerald-500">
                                <span class="text-[10px] text-slate-500 leading-tight">
                                    <a href="https://salih-ozt.github.io/Agrolink-kullan-c-s-zle-mesi-ekran-/" target="_blank" class="text-emerald-600 font-bold underline">Kullanƒ±cƒ± S√∂zle≈ümesini ve KVKK</a> metnini okudum, kabul ediyorum.
                                </span>
                            </label>
                            <div class="flex gap-3">
                                <button @click="registerStep = 1" class="w-12 h-14 bg-slate-100 rounded-2xl flex items-center justify-center text-slate-500 hover:bg-slate-200 transition flex-shrink-0">
                                    <i class="fas fa-arrow-left"></i>
                                </button>
                                <button @click="authAction()" class="flex-1 py-4 btn-agro bg-emerald-500 shadow-lg shadow-emerald-200 text-lg font-black rounded-2xl" :disabled="loading">
                                    <span x-show="!loading" class="flex items-center justify-center gap-2">Kayƒ±t Ol <i class="fas fa-seedling"></i></span>
                                    <i x-show="loading" class="fas fa-spinner fa-spin text-xl"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Giri≈ü Yap Linki -->
                        <div class="mt-6 text-center">
                            <button @click="authMode = 'login'; registerStep = 1" class="text-sm font-bold text-slate-600">
                                Zaten √ºye misin? <span class="text-emerald-600">Giri≈ü Yap</span>
                            </button>
                        </div>
                    </div>
                </template>

                <!-- ========== Gƒ∞Rƒ∞≈û FORMU ========== -->
                <template x-if="authMode === 'login'">
                    <form @submit.prevent="authAction" class="space-y-4">
                        <div>
                            <input type="text" x-model="authForm.identifier" placeholder="E-Posta veya Kullanƒ±cƒ± Adƒ±" class="w-full bg-slate-100 p-4 rounded-2xl border-none focus:ring-2 focus:ring-emerald-500 outline-none" required>
                            <p class="text-[10px] text-slate-400 mt-1 ml-2">E-posta adresiniz veya kullanƒ±cƒ± adƒ±nƒ±zla giri≈ü yapabilirsiniz</p>
                        </div>
                        <div class="relative">
                            <input :type="showPassword ? 'text' : 'password'" x-model="authForm.password" placeholder="≈ûifre" class="w-full bg-slate-100 p-4 pr-12 rounded-2xl border-none focus:ring-2 focus:ring-emerald-500 outline-none" required>
                            <button type="button" @click="showPassword = !showPassword" class="absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600 transition-colors">
                                <i class="fas" :class="showPassword ? 'fa-eye-slash' : 'fa-eye'"></i>
                            </button>
                        </div>
                        <button type="submit" class="w-full py-5 btn-agro bg-emerald-500 shadow-lg shadow-emerald-200 hover:bg-emerald-600 text-lg font-black rounded-2xl" :disabled="loading">
                            <span x-show="!loading">Giri≈ü Yap</span>
                            <i x-show="loading" class="fas fa-spinner fa-spin text-xl"></i>
                        </button>
                        <button type="button" @click="authMode = 'register'; registerStep = 1" class="w-full py-4 bg-white border-2 border-emerald-500 text-emerald-600 font-black rounded-2xl text-lg hover:bg-emerald-50 transition shadow-md">
                            <i class="fas fa-user-plus mr-2"></i>Kayƒ±t Ol
                        </button>
                        <div class="text-center">
                            <button @click="authMode = 'forgot'" class="text-xs text-emerald-600 font-bold">≈ûifremi Unuttum</button>
                        </div>
                    </form>
                </template>

                <!-- ========== ≈ûƒ∞FRE SIFIRLA ========== -->
                <template x-if="authMode === 'forgot'">
                    <form @submit.prevent="forgotPassword" class="space-y-4">
                        <p class="text-sm text-slate-600 text-center">E-posta ve kullanƒ±cƒ± adƒ±nƒ±zƒ± girin, size ≈üifre sƒ±fƒ±rlama baƒülantƒ±sƒ± g√∂nderelim.</p>
                        <input type="text" x-model="authForm.username" placeholder="Kullanƒ±cƒ± Adƒ±nƒ±z" class="w-full bg-slate-100 p-4 rounded-2xl border-none focus:ring-2 focus:ring-emerald-500 outline-none" required>
                        <input type="email" x-model="authForm.email" placeholder="E-Posta Adresiniz" class="w-full bg-slate-100 p-4 rounded-2xl border-none focus:ring-2 focus:ring-emerald-500 outline-none" required>
                        <button type="submit" class="w-full py-4 btn-agro bg-emerald-500 shadow-lg shadow-emerald-200 hover:bg-emerald-600" :disabled="loading">
                            <span x-show="!loading">≈ûifre Sƒ±fƒ±rlama Linki G√∂nder</span>
                            <i x-show="loading" class="fas fa-spinner fa-spin"></i>
                        </button>
                        <div class="text-center">
                            <button @click="authMode = 'login'" class="text-sm font-bold text-slate-600">‚Üê Giri≈ü Yap</button>
                        </div>
                    </form>
                </template>

                <!-- ‚úÖ YENƒ∞: E-POSTA Lƒ∞NKƒ∞NDEN GELEN ≈ûƒ∞FRE SIFIRLAMA FORMU -->
                <template x-if="authMode === 'resetpassword'">
                    <form @submit.prevent="resetPasswordDirect" class="space-y-4">
                        <div class="text-center mb-2">
                            <div class="text-4xl mb-2">üîê</div>
                            <p class="text-sm text-slate-600">Yeni ≈üifrenizi belirleyin</p>
                            <p class="text-xs text-emerald-600 font-bold mt-1" x-text="pendingResetEmail"></p>
                        </div>
                        <input type="password" x-model="resetDirectForm.newPassword" placeholder="Yeni ≈ûifre (min. 6 karakter)" class="w-full bg-slate-100 p-4 rounded-2xl border-none focus:ring-2 focus:ring-emerald-500 outline-none" required minlength="6">
                        <input type="password" x-model="resetDirectForm.confirmPassword" placeholder="Yeni ≈ûifreyi Tekrarlayƒ±n" class="w-full bg-slate-100 p-4 rounded-2xl border-none focus:ring-2 focus:ring-emerald-500 outline-none" required minlength="6">
                        <button type="submit" class="w-full py-4 btn-agro bg-emerald-500 shadow-lg shadow-emerald-200 hover:bg-emerald-600" :disabled="loading">
                            <span x-show="!loading">≈ûifremi Sƒ±fƒ±rla</span>
                            <i x-show="loading" class="fas fa-spinner fa-spin"></i>
                        </button>
                        <div class="text-center">
                            <button type="button" @click="authMode = 'login'; pendingResetToken = ''" class="text-sm font-bold text-slate-600">‚Üê Giri≈ü Yap</button>
                        </div>
                    </form>
                </template>

            </div>
        </div>
    </template>

    <!-- 2. ANA UYGULAMA -->
    <div x-show="isLoggedIn" x-cloak
        
        <!-- √úST BAR -->
        <header class="glass sticky top-0 z-50 flex justify-between items-center" style="padding: 12px 20px; border-bottom: 1px solid var(--glass-border, rgba(0,0,0,0.06));">
            <div class="flex items-center gap-2">
                <div class="header-logo-wrapper flex items-center justify-center">
                    <img src="agro.png" alt="AgroLink" class="w-full h-full object-cover rounded-xl" onerror="this.style.display='none'; this.parentElement.classList.add('bg-emerald-500'); var ic=document.createElement('i'); ic.className='fas fa-leaf text-white text-sm'; this.parentElement.appendChild(ic);">
                </div>
                <h1 class="font-black">AgroLink</h1>
            </div>
            <div class="flex items-center gap-3">
                <!-- Ke≈üfet Butonu -->
                <button @click="showExplore = true; loadExplorePosts()" class="w-9 h-9 rounded-full bg-[var(--input-bg)] flex items-center justify-center transition hover:bg-emerald-100" title="Ke≈üfet">
                    <i class="fas fa-search text-slate-500"></i>
                </button>
                <!-- Ayarlar Men√ºs√º -->
                <button @click="showSettingsMenu = true" class="w-9 h-9 rounded-full bg-[var(--input-bg)] flex items-center justify-center transition">
                    <i class="fas fa-cog text-slate-500"></i>
                </button>
                <button @click="darkMode = !darkMode" class="w-9 h-9 rounded-full bg-[var(--input-bg)] flex items-center justify-center transition">
                    <i class="fas fa-sun text-yellow-400" x-show="darkMode"></i><i class="fas fa-moon text-slate-600" x-show="!darkMode"></i>
                </button>
                <div class="relative cursor-pointer" data-onboarding="notifications" @click="activeTab = 'notifications'; loadNotifications()">
                    <i class="far fa-bell text-2xl" :class="activeTab === 'notifications' ? 'fas text-emerald-500' : 'text-slate-500'"></i>
                    <span x-show="unreadNotifs > 0" class="absolute -top-1 -right-1 bg-red-500 text-white text-[10px] w-4 h-4 rounded-full flex items-center justify-center font-bold" x-text="unreadNotifs > 9 ? '9+' : unreadNotifs"></span>
                </div>
            </div>
        </header>

        <main class="max-w-xl mx-auto px-4 pt-4 pb-32">
            
            <!-- Hƒ∞KAYELER -->
            <div x-show="activeTab === 'home'" class="mb-6 -mx-4 px-4 overflow-x-auto no-scrollbar">
                <div class="flex gap-4">
                    <!-- Hikaye Ekle - Profil Resmi + Plus Butonu -->
                    <div class="flex flex-col items-center gap-1 flex-shrink-0">
                        <div class="relative">
                            <!-- Ana profil resmi - tƒ±klayƒ±nca kendi hikayelerine bak -->
                            <div 
                                @touchstart.passive="$el.classList.add('scale-90'); setTimeout(() => $el.classList.remove('scale-90'), 200)"
                                @click="myStories.length > 0 ? (() => { let el = $el; el.classList.add('story-tap-anim'); setTimeout(() => { el.classList.remove('story-tap-anim'); viewStory(myStories[0]); }, 300); })() : showStoryModal = true"
                                class="w-16 h-16 rounded-full overflow-hidden border-2 transition-transform duration-150 cursor-pointer"
                                :class="myStories.length > 0 ? 'story-ring p-[2px] border-transparent' : 'border-dashed border-emerald-400 border-2'"
                                style="-webkit-tap-highlight-color: transparent;">
                                <template x-if="user && user.profilePic">
                                    <img :src="user.profilePic" class="w-full h-full rounded-full object-cover">
                                </template>
                                <template x-if="!user || !user.profilePic">
                                    <div class="w-full h-full rounded-full bg-[var(--input-bg)] flex items-center justify-center">
                                        <i class="fas fa-user text-slate-400 text-xl"></i>
                                    </div>
                                </template>
                            </div>
                            <!-- Plus butonu - SADECE hikaye ekle modal a√ßar -->
                            <div 
                                @touchstart.passive="$el.classList.add('scale-75'); setTimeout(() => $el.classList.remove('scale-75'), 150)"
                                @click.stop="showStoryModal = true"
                                class="absolute -bottom-1 -right-1 w-6 h-6 bg-emerald-500 flex items-center justify-center border-2 border-[var(--bg-main)] cursor-pointer" style="border-radius:50%; box-shadow: 0 2px 8px rgba(0,184,148,0.5); transition: transform 0.2s cubic-bezier(0.34,1.56,0.64,1);"
                                style="-webkit-tap-highlight-color: transparent;">
                                <i class="fas fa-plus text-white text-[9px] font-black"></i>
                            </div>
                        </div>
                        <span class="text-[10px] font-bold" :class="myStories.length > 0 ? 'text-emerald-600' : 'text-slate-500'">
                            <span x-text="myStories.length > 0 ? 'Hikayem' : 'Hikaye Ekle'"></span>
                        </span>
                    </div>

                    <!-- Kendi Hikayelerim - TEK BALON (sadece hikaye varsa g√∂ster) -->
                    <template x-if="myStories.length > 0">
                        <div @click="
                            $el.querySelector('.story-ring').classList.add('story-tap-anim');
                            setTimeout(() => {
                                $el.querySelector('.story-ring').classList.remove('story-tap-anim');
                                viewStory(myStories[0]);
                            }, 300)
                        " class="flex flex-col items-center gap-1 flex-shrink-0 cursor-pointer">
                            <div class="story-ring">
                                <img :src="user.profilePic || 'https://ui-avatars.com/api/?name='+(user.username || 'Sen')" class="w-14 h-14 rounded-full object-cover">
                            </div>
                            <span class="text-[10px] font-bold truncate w-16 text-center text-emerald-600">Hikayem</span>
                        </div>
                    </template>

                    <!-- Takip Edilen Hikayeler -->
                    <template x-for="storyGroup in stories" :key="storyGroup.userId">
                        <div @click="
                            $el.querySelector('.story-ring').classList.add('story-tap-anim');
                            setTimeout(() => {
                                $el.querySelector('.story-ring').classList.remove('story-tap-anim');
                                viewStoryGroup(storyGroup);
                            }, 300)
                        " class="flex flex-col items-center gap-1 flex-shrink-0 cursor-pointer">
                            <div class="story-ring" :class="!storyGroup.hasUnviewed ? 'watched' : ''">
                                <img :src="storyGroup.profilePic || 'https://ui-avatars.com/api/?name='+(storyGroup.username || 'User')" class="w-14 h-14 rounded-full object-cover">
                            </div>
                            <span class="text-[10px] font-bold truncate w-16 text-center" x-text="storyGroup.username"></span>
                        </div>
                    </template>
                </div>
            </div>

            <!-- ARAMA ALANI - Sadece Ana Sayfada G√∂ster -->
            <div x-show="activeTab === 'home'" class="mb-6 relative" data-onboarding="search">
                <div class="relative">
                    <i class="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"></i>
                    <input type="text" x-model="searchQuery" @input="handleSearch" @focus="showSearchResults = true" @blur="setTimeout(() => showSearchResults = false, 200)" placeholder="√áift√ßi, √ºr√ºn veya #hashtag ara..." class="w-full bg-[var(--bg-card)] border border-[var(--border)] p-4 pl-12 rounded-2xl shadow-sm focus:ring-2 focus:ring-emerald-500 outline-none">
                </div>
                <!-- Arama Sonu√ßlarƒ± -->
                <div x-show="showSearchResults && (searchResults.length > 0 || hashtagResults.length > 0)" class="absolute top-16 w-full z-40 agro-card shadow-xl p-2 space-y-1 max-h-80 overflow-y-auto">
                    <!-- Hashtag Sonu√ßlarƒ± -->
                    <template x-for="tag in hashtagResults" :key="tag.id || tag.tag">
                        <div @click="searchByHashtag(tag.tag)" class="flex items-center gap-3 p-3 hover:bg-emerald-50 dark:hover:bg-emerald-900/20 rounded-xl cursor-pointer">
                            <div class="w-10 h-10 bg-emerald-100 rounded-full flex items-center justify-center">
                                <i class="fas fa-hashtag text-emerald-600"></i>
                            </div>
                            <div>
                                <p class="text-sm font-bold" x-text="'#'+tag.tag"></p>
                                <p class="text-[10px] text-slate-500" x-text="(tag.postCount || 0) + ' g√∂nderi'"></p>
                            </div>
                        </div>
                    </template>
                    <!-- Kullanƒ±cƒ± Sonu√ßlarƒ± -->
                    <template x-for="res in searchResults" :key="res.id">
                        <div @click="viewProfile(res.id)" class="flex items-center gap-3 p-3 hover:bg-emerald-50 dark:hover:bg-emerald-900/20 rounded-xl cursor-pointer">
                            <img :src="res.profilePic || 'agro_pp.jpg'" class="w-10 h-10 rounded-full object-cover flex-shrink-0">
                            <div>
                                <p class="text-sm font-bold" x-text="res.name"></p>
                                <p class="text-[10px] text-slate-500" x-text="'@'+res.username"></p>
                            </div>
                        </div>
                    </template>
                </div>
            </div>

            <!-- üèÜ TOP ETKƒ∞LE≈ûƒ∞M Lƒ∞DER TABLOSU -->
            <template x-if="activeTab === 'home' && topEngagementUsers && topEngagementUsers.length > 0">
                <div class="engagement-leaderboard mb-6">
                    <div class="engagement-leaderboard-title">
                        <span style="font-size:20px;">üèÜ</span> En √áok Etkile≈üim
                    </div>
                    <template x-for="(eu, idx) in topEngagementUsers" :key="eu.id">
                        <div class="engagement-user-item" @click="viewUserProfile(eu.id)">
                            <div class="engagement-rank" :class="'rank-' + (idx + 1)">
                                <span x-text="idx === 0 ? 'ü•á' : idx === 1 ? 'ü•à' : 'ü•â'"></span>
                            </div>
                            <img :src="eu.profileImage || 'https://ui-avatars.com/api/?name=' + eu.name" 
                                 class="engagement-user-avatar" :alt="eu.name">
                            <div class="engagement-user-info">
                                <div class="engagement-user-name flex items-center gap-1">
                                    <span x-text="eu.name"></span>
                                    <template x-if="eu.profileType === 'Ziraat M√ºhendisi'">
                                        <span class="user-badge badge-agricultural" style="width:18px;height:18px;font-size:10px;" title="Ziraat M√ºhendisi">üéì</span>
                                    </template>
                                </div>
                                <div class="engagement-user-stats">
                                    <span x-text="'‚ù§Ô∏è ' + (eu.totalLikes || 0) + '  üîÑ ' + (eu.totalShares || 0)"></span>
                                </div>
                            </div>
                            <div class="engagement-score" x-text="eu.totalEngagement || 0"></div>
                        </div>
                    </template>
                </div>
            </template>

            <!-- FEED (AKI≈û) -->
            <div x-show="activeTab === 'home'" class="space-y-6">
                <!-- Payla≈üƒ±m Ba≈ülatƒ±cƒ± + Mod Toggler -->
                <div class="agro-card p-4 flex items-center gap-3">
                    <img :src="user.profilePic || 'https://ui-avatars.com/api/?name='+user.name" class="w-12 h-12 rounded-full object-cover border-2 border-emerald-500 flex-shrink-0">
                    <button @click="showPostModal = true" class="flex-1 bg-[var(--input-bg)] text-left px-5 py-3 rounded-2xl text-slate-400 font-medium">
                        Bug√ºn hasat nasƒ±l, <span x-text="user.name?.split(' ')[0]"></span>?
                    </button>
                    <!-- Feed Mod Togglers -->
                    <div class="flex items-center gap-1.5 flex-shrink-0">
                        <!-- Normal Mod -->
                        <button @click="feedMode = 'normal'; localStorage.setItem('feedMode','normal')" 
                                :class="feedMode === 'normal' ? 'feed-mode-btn active' : 'feed-mode-btn'"
                                title="Normal G√∂r√ºn√ºm">
                            <i class="fas fa-list text-sm"></i>
                        </button>
                        <!-- Media Grid Mod -->
                        <button @click="feedMode = 'media'; localStorage.setItem('feedMode','media')" 
                                :class="feedMode === 'media' ? 'feed-mode-btn active' : 'feed-mode-btn'"
                                title="Medya Modu">
                            <i class="fas fa-th-large text-sm"></i>
                        </button>
                    </div>
                </div>

                <!-- ===== NORMAL MOD ===== -->
                <template x-if="feedMode === 'normal'">
                    <div class="space-y-6">
                        <template x-for="(post, postIndex) in feed" :key="post.id">
                            <div class="post-card-modern post-card-animate" :style="'animation-delay: ' + (postIndex * 50) + 'ms'">
                                <!-- Header -->
                                <div class="p-4 flex justify-between items-center">
                                    <div class="flex items-center gap-3 cursor-pointer">
                                        <div @click.stop="openProfilePicPopup(post.userProfilePic || 'https://ui-avatars.com/api/?name='+post.userName, post.userId, userHasActiveStory(post.userId), getUserStory(post.userId), post.userId === user.id)"
                                             :class="userHasActiveStory(post.userId) ? 'feed-avatar-story-ring' : ''"
                                             class="rounded-full flex-shrink-0">
                                            <img :src="post.userProfilePic || 'https://ui-avatars.com/api/?name='+post.userName" class="w-10 h-10 rounded-full object-cover shadow-sm">
                                        </div>
                                <div @click="viewProfile(post.userId)">
                                    <div class="flex items-center gap-1.5">
                                        <span class="font-bold text-sm" x-text="post.userName"></span>
                                        <template x-if="post.isVerified || post.userVerified || post.verified">
                                            <span class="verified-badge verified-badge-sm">
                                                <svg viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                    <path d="M17.7508 9.41667C17.7508 8.1 17.0217 6.95833 15.9608 6.41667C16.0892 6.05417 16.1592 5.6625 16.1592 5.25C16.1592 3.40833 14.7342 1.91833 12.9775 1.91833C12.5858 1.91833 12.2108 1.98833 11.8642 2.12667C11.3492 1.0125 10.2592 0.25 9.00083 0.25C7.7425 0.25 6.65417 1.01417 6.13667 2.125C5.79083 1.9875 5.415 1.91667 5.02333 1.91667C3.265 1.91667 1.84167 3.40833 1.84167 5.25C1.84167 5.66167 1.91083 6.05333 2.03917 6.41667C0.979167 6.95833 0.25 8.09833 0.25 9.41667C0.25 10.6625 0.901667 11.7483 1.86833 12.3217C1.85167 12.4633 1.84167 12.605 1.84167 12.75C1.84167 14.5917 3.265 16.0833 5.02333 16.0833C5.415 16.0833 5.79 16.0117 6.13583 15.875C6.6525 16.9867 7.74083 17.75 9 17.75C10.26 17.75 11.3483 16.9867 11.8642 15.875C12.21 16.0108 12.585 16.0817 12.9775 16.0817C14.7358 16.0817 16.1592 14.59 16.1592 12.7483C16.1592 12.6033 16.1492 12.4617 16.1317 12.3208C17.0967 11.7483 17.7508 10.6625 17.7508 9.4175V9.41667ZM12.2375 6.63833L8.62583 12.055C8.505 12.2358 8.3075 12.3333 8.105 12.3333C7.98583 12.3333 7.865 12.3 7.75833 12.2283L7.6625 12.15L5.65 10.1375C5.40583 9.89333 5.40583 9.4975 5.65 9.25417C5.89417 9.01083 6.29 9.00917 6.53333 9.25417L8.00833 10.7267L11.1958 5.94333C11.3875 5.65583 11.7758 5.58 12.0625 5.77083C12.3508 5.9625 12.4292 6.35083 12.2375 6.6375V6.63833Z" fill="#1D9BF0"/>
                                                </svg>
                                            </span>
                                        </template>
                                    </div>
                                    <p class="text-xs text-[var(--text-sec)]" x-text="'@' + (post.userUsername || post.userName?.toLowerCase().replace(' ', ''))"></p>
                                    <div class="flex items-center gap-1.5 flex-wrap mt-0.5">
                                        <span class="text-[10px] text-slate-400 font-bold uppercase" x-text="formatDate(post.createdAt)"></span>
                                        <!-- Kullanƒ±cƒ± Tipi Rozeti -->
                                        <template x-if="post.userType && post.userType !== 'normal_kullanici'">
                                            <span class="inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-[9px] font-bold whitespace-nowrap"
                                                  :style="{
                                                    'tarim_ogretmeni': 'background:#dcfce7;color:#15803d;',
                                                    'tarim_ogrencisi': 'background:#dbeafe;color:#1d4ed8;',
                                                    'ogretmen': 'background:#fef9c3;color:#854d0e;',
                                                    'ziraat_muhendisi': 'background:#fce7f3;color:#9d174d;',
                                                    'ciftci_hayvancilik': 'background:#ffedd5;color:#c2410c;',
                                                    'ciftci': 'background:#d1fae5;color:#065f46;'
                                                  }[post.userType] || 'background:#f1f5f9;color:#475569;'">
                                                <i class="fas" :class="{
                                                    'fa-chalkboard-teacher': post.userType === 'tarim_ogretmeni',
                                                    'fa-graduation-cap': post.userType === 'tarim_ogrencisi',
                                                    'fa-book': post.userType === 'ogretmen',
                                                    'fa-flask': post.userType === 'ziraat_muhendisi',
                                                    'fa-horse': post.userType === 'ciftci_hayvancilik',
                                                    'fa-tractor': post.userType === 'ciftci'
                                                }"></i>
                                                <span x-text="{
                                                    'tarim_ogretmeni': 'Tarƒ±m √ñƒürt.',
                                                    'tarim_ogrencisi': 'Tarƒ±m √ñƒür.',
                                                    'ogretmen': '√ñƒüretmen',
                                                    'ziraat_muhendisi': 'Ziraat M√ºh.',
                                                    'ciftci_hayvancilik': 'Hayvancƒ±lƒ±k',
                                                    'ciftci': '√áift√ßi'
                                                }[post.userType] || post.userType"></span>
                                            </span>
                                        </template>
                                        <template x-if="post.locationName">
                                            <span class="text-[10px] text-emerald-600 whitespace-nowrap"><i class="fas fa-map-marker-alt"></i> <span x-text="post.locationName"></span></span>
                                        </template>
                                    </div>
                                </div>
                            </div>
                            <div class="flex items-center gap-2">
                                <!-- Takip Et Butonu - Zaten takip ediliyorsa veya kendi postuysa g√∂sterme -->
                                <template x-if="post.userId !== user.id && !post.isFollowing && !isFollowing(post.userId)">
                                    <button 
                                        @click.stop="toggleFollow(post.userId); post.isFollowing = true;" 
                                        class="text-xs font-bold px-4 py-2 rounded-full transition-all duration-300 bg-gradient-to-r from-emerald-500 to-teal-500 text-white hover:from-emerald-600 hover:to-teal-600 shadow-lg shadow-emerald-200 hover:scale-105 active:scale-95">
                                        <i class="fas fa-user-plus mr-1" style="font-size:10px;"></i>
                                        <span>Takip Et</span>
                                    </button>
                                </template>
                                <button @click="openPostOptions(post)" class="text-slate-400 p-2"><i class="fas fa-ellipsis-h"></i></button>
                            </div>
                        </div>
                        
                        <!-- Content -->
                        <div class="px-5 pb-3">
                            <div x-show="!post.showFullContent && post.content && post.content.length > 100">
                                <p class="text-sm leading-relaxed" x-html="formatContent(post.content.substring(0, 100)) + '...'"></p>
                                <button @click="post.showFullContent = true" class="text-emerald-600 text-xs font-bold mt-1">daha fazla g√∂ster</button>
                            </div>
                            <div x-show="post.showFullContent || !post.content || post.content.length <= 100">
                                <p class="text-sm leading-relaxed whitespace-pre-wrap" x-html="formatContent(post.content || '')"></p>
                                <button x-show="post.showFullContent && post.content && post.content.length > 100" @click="post.showFullContent = false" class="text-slate-400 text-xs font-bold mt-1">daha az g√∂ster</button>
                            </div>
                        </div>

                        <!-- Anket -->
                        <template x-if="post.isPoll && post.pollOptions">
                            <div class="px-5 pb-4 space-y-2">
                                <p class="font-bold text-sm mb-3" x-text="post.pollQuestion"></p>
                                <template x-for="(option, idx) in JSON.parse(post.pollOptions || '[]')" :key="idx">
                                    <div @click="votePoll(post, idx)" class="poll-bar-bg cursor-pointer relative">
                                        <div class="poll-bar-fill" :style="'width: ' + getPollPercentage(post, idx) + '%'"></div>
                                        <div class="absolute inset-0 flex items-center justify-between px-4">
                                            <span class="text-sm font-bold" x-text="option.text"></span>
                                            <span class="text-xs font-bold text-emerald-600" x-text="getPollPercentage(post, idx) + '%'"></span>
                                        </div>
                                    </div>
                                </template>
                                <p class="text-[10px] text-slate-400 mt-2" x-text="getTotalVotes(post) + ' oy'"></p>
                            </div>
                        </template>

                        <!-- Medya (Resim veya Video) - Carousel + Aspect Ratio Rezerv -->
                        <template x-if="(post.mediaUrl || (post.mediaUrls && post.mediaUrls.length > 0)) && !post.isPoll">
                            <div class="px-2 pb-2 relative group" @dblclick="doubleTapLike(post)"
                                 x-data="{
                                    cIdx: 0,
                                    get cItems() {
                                        if (post.mediaUrls && post.mediaUrls.length > 0) return post.mediaUrls;
                                        if (post.mediaUrl) return [{ url: post.mediaUrl, type: post.mediaType || 'image' }];
                                        return [];
                                    },
                                    get cLen() { return this.cItems.length; },
                                    prev() { this.cIdx = this.cIdx > 0 ? this.cIdx - 1 : this.cLen - 1; },
                                    next() { this.cIdx = this.cIdx < this.cLen - 1 ? this.cIdx + 1 : 0; },
                                    getUrl(item) { return typeof item === 'string' ? item : (item.url || item.mediaUrl || ''); },
                                    getType(item) { return typeof item === 'string' ? 'image' : (item.type || item.mediaType || 'image'); },
                                    getAspect(item) {
                                        const w = item.width, h = item.height;
                                        if (w && h) { const r = h/w; return r > 1.4 ? 'aspect-[4/5]' : r < 0.6 ? 'aspect-[16/9]' : 'aspect-[4/5]'; }
                                        return post.mediaType === 'video' ? 'aspect-[9/16]' : 'aspect-[4/5]';
                                    },
                                    touchStartX: 0,
                                    onTouchStart(e) { this.touchStartX = e.touches[0].clientX; },
                                    onTouchEnd(e) { const dx = e.changedTouches[0].clientX - this.touchStartX; if (Math.abs(dx) > 40) { dx < 0 ? this.next() : this.prev(); } }
                                 }">
                                <!-- Kalp Atma Animasyonu -->
                                <div x-show="showHeartAnimation === post.id" class="heart-animation" :class="showHeartAnimation === post.id ? 'animate' : ''">
                                    <i class="fas fa-heart"></i>
                                </div>
                                
                                <!-- Carousel -->
                                <div class="media-carousel" @touchstart="onTouchStart($event)" @touchend="onTouchEnd($event)">
                                    <div class="media-carousel-track" :style="`transform: translateX(-${cIdx * 100}%)`">
                                        <template x-for="(item, iIdx) in cItems" :key="iIdx">
                                            <div class="media-carousel-slide">
                                                <template x-if="getType(item) === 'image'">
                                                    <!-- Aspect ratio kutusu: y√ºklenene kadar yer tutar, layout kaymaz -->
                                                    <div :class="getAspect(item)" class="w-full overflow-hidden bg-black relative">
                                                        <img :src="getUrl(item)" @click="openTikTokScroll(post)" 
                                                             class="absolute inset-0 w-full h-full object-contain cursor-pointer"
                                                             loading="lazy" @error="$el.style.display='none'">
                                                    </div>
                                                </template>
                                                <template x-if="getType(item) !== 'image'">
                                                    <!-- Video: aspect ratio rezerv + lazy load + sadece pause (src silme) -->
                                                    <div :class="getAspect(item)" class="w-full overflow-hidden bg-black relative video-hover-container"
                                                         x-init="
                                                            const el = $el;
                                                            const getV = () => el.querySelector('video');
                                                            const playIcon = el.querySelector('.feed-play-icon');
                                                            let hlsInited = false;
                                                            const sp = () => el.querySelector('.video-loading-overlay');
                                                            const observer = new IntersectionObserver((entries) => {
                                                                entries.forEach(entry => {
                                                                    const v = getV();
                                                                    if (!v) return;
                                                                    if (entry.isIntersecting) {
                                                                        if (!hlsInited) {
                                                                            hlsInited = true;
                                                                            initAgroHLS(v, getUrl(item));
                                                                        }
                                                                        v.muted = globalMuted;
                                                                        const s = sp(); if(s) s.classList.remove('hidden');
                                                                        v.addEventListener('canplay', () => { const s=sp(); if(s) s.classList.add('hidden'); }, {once:true});
                                                                        v.addEventListener('playing', () => { const s=sp(); if(s) s.classList.add('hidden'); });
                                                                        v.addEventListener('waiting', () => { const s=sp(); if(s) s.classList.remove('hidden'); });
                                                                        v.play().catch(() => { v.muted = true; v.play().catch(()=>{}); });
                                                                        if (playIcon) playIcon.style.display = 'none';
                                                                    } else {
                                                                        // Sadece PAUSE ‚Äî src silme! Scroll geri gelince yeniden y√ºklenmez
                                                                        const v2 = getV();
                                                                        if (v2) { v2.pause(); }
                                                                        if (playIcon) playIcon.style.display = 'flex';
                                                                    }
                                                                });
                                                            }, { threshold: 0.4 });
                                                            observer.observe(el);
                                                            const muteH = (e) => { const v=getV(); if(v&&!v.paused) v.muted=e.detail.muted; };
                                                            window.addEventListener('agrolink:mutechange', muteH);
                                                            el._cleanup = () => { observer.disconnect(); window.removeEventListener('agrolink:mutechange', muteH); const v=getV(); if(v) destroyAgroHLS(v); };
                                                         ">
                                                        <!-- Video Loading Spinner -->
                                                        <div class="video-loading-overlay">
                                                            <div class="video-spinner"></div>
                                                        </div>
                                                        <video class="absolute inset-0 w-full h-full object-contain"
                                                               preload="none" playsinline loop muted :poster="post.thumbnail || ''"
                                                               @click="openTikTokScroll(post)"></video>
                                                        <!-- Oynatma ƒ∞konu -->
                                                        <div class="feed-play-icon absolute inset-0 items-center justify-center pointer-events-none" style="display:flex;z-index:5;">
                                                            <div class="bg-black/50 rounded-full w-16 h-16 flex items-center justify-center">
                                                                <i class="fas fa-play text-white text-xl ml-1"></i>
                                                            </div>
                                                        </div>
                                                        <!-- Ses A√ß/Kapat -->
                                                        <button @click.stop="
                                                            globalMuted = !globalMuted;
                                                            window.dispatchEvent(new CustomEvent('agrolink:mutechange', {detail:{muted:globalMuted}}));
                                                            const v = $el.parentElement.querySelector('video');
                                                            if (v) v.muted = globalMuted;
                                                        " class="absolute bottom-3 right-3 w-10 h-10 bg-black/60 backdrop-blur-sm rounded-full flex items-center justify-center text-white z-20 transition-transform active:scale-90">
                                                            <i class="fas text-sm" :class="globalMuted ? 'fa-volume-xmark' : 'fa-volume-high'"></i>
                                                        </button>
                                                    </div>
                                                </template>
                                            </div>
                                        </template>
                                    </div>
                                    <!-- Carousel Nav (birden fazlaysa) -->
                                    <template x-if="cLen > 1">
                                        <div>
                                            <button class="carousel-nav-btn prev" @click.stop="prev()" x-show="cIdx > 0"><i class="fas fa-chevron-left text-xs"></i></button>
                                            <button class="carousel-nav-btn next" @click.stop="next()" x-show="cIdx < cLen - 1"><i class="fas fa-chevron-right text-xs"></i></button>
                                            <div class="carousel-count-badge" x-text="(cIdx+1)+'/'+cLen"></div>
                                            <div class="carousel-dots">
                                                <template x-for="(_, di) in cItems" :key="di">
                                                    <div class="carousel-dot" :class="di === cIdx ? 'active' : ''"></div>
                                                </template>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </template>

                        <!-- Actions -->
                        <div class="px-4 py-3 flex items-center justify-between border-t border-[var(--border)]">
                            <div class="flex items-center gap-5">
                                <button @click="likePost(post)" 
                                        class="flex items-center gap-2 transition-transform active:scale-110" 
                                        :class="post.isLiked ? 'text-red-500' : 'text-slate-500'">
                                    <i class="text-xl" :class="post.isLiked ? 'fas fa-heart' : 'far fa-heart'"></i>
                                    <span class="text-xs font-black" x-text="post.likeCount || 0"></span>
                                </button>
                                <button x-show="!post.commentsDisabled && post.allowComments !== 0" @click="openComments(post)" class="flex items-center gap-2 text-slate-500 hover:text-slate-700 dark:hover:text-slate-300 transition-colors">
                                    <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                                    </svg>
                                    <span class="text-xs font-black" x-text="post.commentCount || 0"></span>
                                </button>
                                <span x-show="post.commentsDisabled || post.allowComments === 0" class="flex items-center gap-1.5 text-slate-300 cursor-default" title="Yorumlar kapatƒ±lmƒ±≈ü">
                                    <i class="fas fa-comment-slash text-lg"></i>
                                    <span class="text-[10px] font-bold">Kapalƒ±</span>
                                </span>
                                <!-- G√∂r√ºnt√ºlenme -->
                                <span class="flex items-center gap-1.5 text-slate-400">
                                    <i class="far fa-eye text-lg"></i>
                                    <span class="text-xs font-black" x-text="post.viewCount || post.views || 0"></span>
                                </span>
                                <!-- Payla≈ü Butonu (DM + Hikaye + Link men√ºs√º) -->
                                <button @click="openShareMenu(post)"
                                        class="flex items-center gap-1.5 text-slate-500 hover:text-emerald-500 transition-colors"
                                        title="Payla≈ü">
                                    <i class="fas fa-share-nodes text-lg"></i>
                                </button>
                            </div>
                            <button @click="post._saving = true; savePost(post); setTimeout(() => post._saving = false, 600)" class="transition-transform active:scale-110" :class="post.isSaved ? 'text-emerald-500' : 'text-slate-400'">
                                <i :class="post._saving ? 'fas fa-circle-notch fa-spin' : (post.isSaved ? 'fas fa-bookmark' : 'far fa-bookmark')" class="text-xl"></i>
                            </button>
                        </div>
                    </div>
                </template>
                    </div>
                </template>
                <!-- ===== END NORMAL MOD ===== -->

                <!-- ===== MEDƒ∞A MODU ===== -->
                <template x-if="feedMode === 'media'">
                    <div class="media-grid-feed">
                        <template x-for="(post, postIndex) in feed" :key="post.id">
                            <!-- Medyalƒ± Post -->
                            <template x-if="post.mediaUrl">
                                <div class="media-grid-card" @click="openTikTokScroll(post)">
                                    <!-- Resim -->
                                    <template x-if="post.mediaType === 'image'">
                                        <img :src="post.mediaUrl" loading="lazy" @error="$el.style.display='none'">
                                    </template>
                                    <!-- Video thumbnail -->
                                    <template x-if="post.mediaType === 'video'">
                                        <div class="w-full h-full bg-black flex items-center justify-center">
                                            <video :src="post.mediaUrl" class="w-full h-full object-cover" muted playsinline preload="metadata"
                                                   x-init="$el.currentTime = 0.5"></video>
                                        </div>
                                    </template>
                                    <!-- Gradient overlay -->
                                    <div class="media-grid-overlay"></div>
                                    <!-- Top: Avatar + ƒ∞sim + Onay -->
                                    <div class="media-grid-top">
                                        <img :src="post.userProfilePic || 'https://ui-avatars.com/api/?name='+(post.userName||'U')+'&size=32'" 
                                             class="media-grid-avatar">
                                        <span class="media-grid-username" x-text="post.userName"></span>
                                        <template x-if="post.isVerified || post.userVerified || post.verified">
                                            <span class="media-grid-verified">
                                                <svg width="12" height="12" viewBox="0 0 18 18" fill="none"><path d="M17.7508 9.41667C17.7508 8.1 17.0217 6.95833 15.9608 6.41667C16.0892 6.05417 16.1592 5.6625 16.1592 5.25C16.1592 3.40833 14.7342 1.91833 12.9775 1.91833C12.5858 1.91833 12.2108 1.98833 11.8642 2.12667C11.3492 1.0125 10.2592 0.25 9.00083 0.25C7.7425 0.25 6.65417 1.01417 6.13667 2.125C5.79083 1.9875 5.415 1.91667 5.02333 1.91667C3.265 1.91667 1.84167 3.40833 1.84167 5.25C1.84167 5.66167 1.91083 6.05333 2.03917 6.41667C0.979167 6.95833 0.25 8.09833 0.25 9.41667C0.25 10.6625 0.901667 11.7483 1.86833 12.3217C1.85167 12.4633 1.84167 12.605 1.84167 12.75C1.84167 14.5917 3.265 16.0833 5.02333 16.0833C5.415 16.0833 5.79 16.0117 6.13583 15.875C6.6525 16.9867 7.74083 17.75 9 17.75C10.26 17.75 11.3483 16.9867 11.8642 15.875C12.21 16.0108 12.585 16.0817 12.9775 16.0817C14.7358 16.0817 16.1592 14.59 16.1592 12.7483C16.1592 12.6033 16.1492 12.4617 16.1317 12.3208C17.0967 11.7483 17.7508 10.6625 17.7508 9.4175V9.41667Z" fill="#1D9BF0"/></svg>
                                            </span>
                                        </template>
                                    </div>
                                    <!-- Video play icon -->
                                    <template x-if="post.mediaType === 'video'">
                                        <div class="media-grid-play">
                                            <i class="fas fa-play" style="margin-left:2px;"></i>
                                        </div>
                                    </template>
                                    <!-- Bottom: Caption + Stats -->
                                    <div class="media-grid-bottom">
                                        <p class="media-grid-caption" x-text="post.content" x-show="post.content"></p>
                                        <div class="media-grid-stats">
                                            <div class="media-grid-stat">
                                                <i class="fas fa-heart text-[9px]"></i>
                                                <span x-text="(post.likeCount || 0) > 999 ? ((post.likeCount/1000).toFixed(1)+'K') : (post.likeCount || 0)"></span>
                                            </div>
                                            <div class="media-grid-stat">
                                                <i class="fas fa-comment text-[9px]"></i>
                                                <span x-text="post.commentCount || 0"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </template>
                            <!-- Metin Postlar -->
                            <template x-if="!post.mediaUrl">
                                <div class="media-grid-text-card" @click="openTikTokScroll(post)">
                                    <p class="media-grid-text-content" x-text="post.content"></p>
                                    <div class="media-grid-text-footer">
                                        <img :src="post.userProfilePic || 'https://ui-avatars.com/api/?name='+(post.userName||'U')+'&size=32'" class="media-grid-text-avatar">
                                        <span class="media-grid-text-name" x-text="post.userName"></span>
                                    </div>
                                    <!-- Like count overlay -->
                                    <div class="flex items-center gap-3 mt-1">
                                        <span class="media-grid-stat" style="color:var(--text-sec);">
                                            <i class="fas fa-heart text-red-400 text-[9px]"></i>
                                            <span style="font-size:10px;" x-text="post.likeCount || 0"></span>
                                        </span>
                                        <span class="media-grid-stat" style="color:var(--text-sec);">
                                            <i class="fas fa-comment text-blue-400 text-[9px]"></i>
                                            <span style="font-size:10px;" x-text="post.commentCount || 0"></span>
                                        </span>
                                    </div>
                                </div>
                            </template>
                        </template>
                    </div>
                </template>
                <!-- ===== END MEDƒ∞A MODU ===== -->
                
                <div x-show="loadingMore" class="text-center p-4">
                    <i class="fas fa-circle-notch fa-spin text-emerald-500 text-2xl"></i>
                </div>
                
                <div x-show="!hasMore && feed.length > 0" class="text-center p-4 text-slate-400 text-sm">
                    T√ºm g√∂nderiler y√ºklendi üåæ
                </div>
            </div>

            <!-- Bƒ∞LDƒ∞Rƒ∞MLER TAB -->
            <div x-show="activeTab === 'notifications'" class="space-y-4">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-black" x-text="t('notifications')">Bildirimler</h2>
                    <button @click="markAllNotificationsRead" x-show="unreadNotifs > 0" class="text-xs text-emerald-600 font-bold">T√ºm√ºn√º Okundu Yap</button>
                </div>
                
                <template x-if="notifications.length === 0">
                    <div class="agro-card p-8 text-center">
                        <i class="far fa-bell text-4xl text-slate-300 mb-4"></i>
                        <p class="text-slate-500">Hen√ºz bildirim yok</p>
                    </div>
                </template>
                
                <template x-for="notif in notifications" :key="notif.id">
                    <div class="agro-card p-4 flex items-start gap-3" :class="notif.read ? 'opacity-60' : ''">
                        <!-- Takip bildirimi i√ßin profil resmi -->
                        <template x-if="(notif.type === 'follow' || notif.type === 'follow_request') && notif.data?.followerId || notif.data?.requesterId">
                            <img :src="notif.data?.requesterPic || notif.data?.followerPic || 'https://ui-avatars.com/api/?name='+(notif.data?.requesterName||notif.data?.followerUsername||'U')" class="notif-avatar flex-shrink-0 cursor-pointer" @click="viewProfile(notif.data?.requesterId || notif.data?.followerId)">
                        </template>
                        <template x-if="notif.type !== 'follow' && notif.type !== 'follow_request' || (!notif.data?.followerId && !notif.data?.requesterId)">
                            <div class="w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0" :class="getNotifIcon(notif.type).bg">
                                <i :class="getNotifIcon(notif.type).icon" class="text-white"></i>
                            </div>
                        </template>
                        <div class="flex-1" @click="notif.type !== 'follow_request' && handleNotificationClick(notif)">
                            <p class="text-sm font-medium" x-text="notif.message"></p>
                            <p class="text-[10px] text-slate-400 mt-1" x-text="formatDate(notif.createdAt)"></p>
                            <!-- Takip isteƒüi onay/red butonlarƒ± -->
                            <template x-if="notif.type === 'follow_request' && !notif.followRequestHandled">
                                <div class="flex gap-2 mt-3">
                                    <button @click.stop="handleFollowRequest(notif, 'accept')" 
                                            class="flex-1 py-2 bg-emerald-500 text-white rounded-xl text-xs font-bold hover:bg-emerald-600 transition active:scale-95">
                                        <i class="fas fa-check mr-1"></i>Onayla
                                    </button>
                                    <button @click.stop="handleFollowRequest(notif, 'reject')" 
                                            class="flex-1 py-2 bg-[var(--input-bg)] text-[var(--text-main)] rounded-xl text-xs font-bold hover:bg-[var(--border)] transition active:scale-95">
                                        <i class="fas fa-times mr-1"></i>Reddet
                                    </button>
                                </div>
                            </template>
                            <template x-if="notif.type === 'follow_request' && notif.followRequestHandled">
                                <p class="text-xs mt-2 font-bold" :class="notif.followRequestHandled === 'accept' ? 'text-emerald-500' : 'text-slate-400'" x-text="notif.followRequestHandled === 'accept' ? '‚úÖ Onaylandƒ±' : '‚ùå Reddedildi'"></p>
                            </template>
                        </div>
                        <div x-show="!notif.read" class="w-2 h-2 bg-emerald-500 rounded-full flex-shrink-0 mt-1"></div>
                    </div>
                </template>
            </div>

            <!-- MAƒûAZA TAB -->
            <div x-show="activeTab === 'store'" class="space-y-6">
                <div class="flex justify-between items-center">
                    <h2 class="text-2xl font-black" x-text="t('store')">Tarƒ±m Pazarƒ±</h2>
                    <div class="flex items-center gap-2">
                        </button>
                        </button>
                        <button @click="showAddProduct = true" class="bg-emerald-500 text-white px-4 py-2 rounded-xl font-bold text-xs flex items-center gap-2">
                            <i class="fas fa-plus"></i> <span x-text="t('addProduct')">ƒ∞lan Ver</span>
                        </button>
                    </div>
                </div>
                
                <template x-if="products.length === 0">
                    <div class="agro-card p-8 text-center">
                        <i class="fas fa-store text-4xl text-slate-300 mb-4"></i>
                        <p class="text-slate-500">Hen√ºz √ºr√ºn yok</p>
                    </div>
                </template>
                
                <div class="grid grid-cols-2 gap-4">
                    <template x-for="item in products" :key="item.id">
                        <div @click="openProductDetail(item)" class="agro-card p-3 space-y-3 group cursor-pointer">
                            <div class="h-32 bg-slate-100 rounded-2xl overflow-hidden relative">
                                <img :src="item.image || (item.images && item.images[0]) || 'https://via.placeholder.com/200x200?text=√úr√ºn'" class="w-full h-full object-cover group-hover:scale-110 transition duration-500">
                                <div class="absolute top-2 right-2 bg-emerald-500 text-white px-2 py-1 rounded-lg text-[10px] font-black" x-text="item.price + ' ‚Ç∫'"></div>
                                <!-- √áoklu g√∂rsel g√∂stergesi -->
                                <div x-show="item.images && item.images.length > 1" class="absolute top-2 left-2 bg-black/50 text-white px-2 py-1 rounded-lg text-[10px]">
                                    <i class="fas fa-images"></i> <span x-text="item.images.length"></span>
                                </div>
                            </div>
                            <h4 class="font-bold text-sm truncate" x-text="item.name"></h4>
                            <p class="text-[10px] text-slate-400 truncate" x-text="item.sellerName"></p>
                            <button @click.stop="startChatWithSeller(item)" class="w-full py-2 bg-emerald-50 text-emerald-600 rounded-xl text-xs font-bold border border-emerald-100 hover:bg-emerald-100 transition">
                                <i class="fas fa-comment-dots mr-1"></i> Mesaj G√∂nder
                            </button>
                        </div>
                    </template>
                </div>
            </div>

            <!-- MESAJLAR TAB -->
            <div x-show="activeTab === 'messages'" class="space-y-2">
                <!-- DM Header -->
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-2xl font-black" x-text="t('messages')">Mesajlar</h2>
                    <div class="flex items-center gap-2">
                        <button @click="showCreateChannelModal = true" class="flex items-center gap-1.5 px-3 py-1.5 bg-emerald-500 text-white rounded-full text-xs font-bold hover:bg-emerald-600 transition-all active:scale-95">
                            <i class="fas fa-users"></i> Kanal Olu≈ütur
                        </button>
                        <span class="text-xs font-bold text-[var(--text-sec)] bg-[var(--input-bg)] px-3 py-1.5 rounded-full" x-text="conversations.length + ' sohbet'"></span>
                    </div>
                </div>
                
                <!-- Arama √áubuƒüu -->
                <div class="relative mb-3">
                    <i class="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 text-sm"></i>
                    <input type="text" :placeholder="t('searchChats')" class="w-full bg-[var(--input-bg)] border border-[var(--border)] p-3 pl-11 text-sm outline-none focus:ring-2 focus:ring-emerald-400 transition-all duration-200" style="border-radius: 18px;">
                </div>
                
                <!-- Kanallar B√∂l√ºm√º -->
                <template x-if="channels.length > 0">
                    <div class="mb-4">
                        <h3 class="text-sm font-bold text-[var(--text-sec)] mb-2 px-1"><i class="fas fa-layer-group mr-1"></i> Kanallar</h3>
                        <div class="space-y-2">
                            <template x-for="ch in channels" :key="ch.id">
                                <div class="dm-conversation-item group" @click="openChannelChat(ch)">
                                    <div class="dm-avatar-wrapper">
                                        <div class="w-12 h-12 rounded-full bg-gradient-to-br from-emerald-400 to-teal-500 flex items-center justify-center text-white font-bold text-lg shadow-md">
                                            <template x-if="ch.profilePic">
                                                <img :src="ch.profilePic" class="w-12 h-12 rounded-full object-cover">
                                            </template>
                                            <template x-if="!ch.profilePic">
                                                <span x-text="ch.name ? ch.name.charAt(0).toUpperCase() : '#'"></span>
                                            </template>
                                        </div>
                                    </div>
                                    <div class="dm-content">
                                        <div class="dm-name-row">
                                            <span class="dm-name" x-text="ch.name"></span>
                                        </div>
                                        <!-- √úye avatarlarƒ± -->
                                        <div class="flex items-center gap-1 mt-0.5">
                                            <template x-if="ch.members && ch.members.length > 0">
                                                <div class="flex items-center gap-1">
                                                    <div class="flex -space-x-1">
                                                        <template x-for="(m, idx) in (ch.members || []).slice(0,3)" :key="m.id || idx">
                                                            <img :src="m.profilePic || 'https://ui-avatars.com/api/?name='+(m.name||'U')+'&size=24'" 
                                                                 class="w-4 h-4 rounded-full border border-white object-cover"
                                                                 :title="m.name">
                                                        </template>
                                                    </div>
                                                    <span class="text-[10px] text-[var(--text-sec)]" x-text="(ch.memberCount || ch.members.length) + ' √ºye'"></span>
                                                </div>
                                            </template>
                                            <template x-if="!ch.members || ch.members.length === 0">
                                                <p class="dm-last-message" x-text="ch.lastMessage || (ch.memberCount ? ch.memberCount + ' √ºye' : 'Kanal')"></p>
                                            </template>
                                        </div>
                                    </div>
                                    <div class="dm-meta">
                                        <span class="dm-time" x-text="formatDate(ch.lastMessageAt)"></span>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                </template>
                
                <!-- DM Sohbetler -->
                <template x-if="conversations.length > 0">
                    <h3 class="text-sm font-bold text-[var(--text-sec)] mb-2 px-1"><i class="fas fa-comment mr-1"></i> Direkt Mesajlar</h3>
                </template>
                
                <template x-if="conversations.length === 0 && channels.length === 0">
                    <div class="agro-card p-12 text-center">
                        <div class="w-20 h-20 bg-emerald-50 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="far fa-comments text-3xl text-emerald-400"></i>
                        </div>
                        <h3 class="font-bold text-lg mb-1">Hen√ºz mesaj yok</h3>
                        <p class="text-sm text-[var(--text-sec)]">Birinin profiline gidip mesaj g√∂ndermeye ba≈ülayƒ±n veya kanal olu≈üturun</p>
                    </div>
                </template>
                
                <div class="space-y-2">
                    <template x-for="conv in conversations" :key="conv.oderId || conv.recipientId || conv.userId">
                        <div class="dm-conversation-item group" @click="openChat(conv)">
                            <!-- Avatar -->
                            <div class="dm-avatar-wrapper">
                                <img :src="conv.profilePic || 'https://ui-avatars.com/api/?name='+conv.name" class="dm-avatar">
                                <div x-show="conv.isOnline || conv.online" class="dm-online-dot"></div>
                            </div>
                            <!-- ƒ∞√ßerik -->
                            <div class="dm-content">
                                <div class="dm-name-row">
                                    <span class="dm-name" x-text="conv.name"></span>
                                    <template x-if="conv.isVerified">
                                        <span class="verified-badge verified-badge-sm">
                                            <svg viewBox="0 0 18 18" fill="none"><path d="M17.7508 9.41667C17.7508 8.1 17.0217 6.95833 15.9608 6.41667C16.0892 6.05417 16.1592 5.6625 16.1592 5.25C16.1592 3.40833 14.7342 1.91833 12.9775 1.91833C12.5858 1.91833 12.2108 1.98833 11.8642 2.12667C11.3492 1.0125 10.2592 0.25 9.00083 0.25C7.7425 0.25 6.65417 1.01417 6.13667 2.125C5.79083 1.9875 5.415 1.91667 5.02333 1.91667C3.265 1.91667 1.84167 3.40833 1.84167 5.25C1.84167 5.66167 1.91083 6.05333 2.03917 6.41667C0.979167 6.95833 0.25 8.09833 0.25 9.41667C0.25 10.6625 0.901667 11.7483 1.86833 12.3217C1.85167 12.4633 1.84167 12.605 1.84167 12.75C1.84167 14.5917 3.265 16.0833 5.02333 16.0833C5.415 16.0833 5.79 16.0117 6.13583 15.875C6.6525 16.9867 7.74083 17.75 9 17.75C10.26 17.75 11.3483 16.9867 11.8642 15.875C12.21 16.0108 12.585 16.0817 12.9775 16.0817C14.7358 16.0817 16.1592 14.59 16.1592 12.7483C16.1592 12.6033 16.1492 12.4617 16.1317 12.3208C17.0967 11.7483 17.7508 10.6625 17.7508 9.4175V9.41667ZM12.2375 6.63833L8.62583 12.055C8.505 12.2358 8.3075 12.3333 8.105 12.3333C7.98583 12.3333 7.865 12.3 7.75833 12.2283L7.6625 12.15L5.65 10.1375C5.40583 9.89333 5.40583 9.4975 5.65 9.25417C5.89417 9.01083 6.29 9.00917 6.53333 9.25417L8.00833 10.7267L11.1958 5.94333C11.3875 5.65583 11.7758 5.58 12.0625 5.77083C12.3508 5.9625 12.4292 6.35083 12.2375 6.6375V6.63833Z" fill="#1D9BF0"/></svg>
                                        </span>
                                    </template>
                                </div>
                                <p class="dm-last-message" :class="conv.unreadCount > 0 ? 'unread' : ''" x-text="conv.lastMessage || 'Hen√ºz mesaj yok'"></p>
                            </div>
                            <!-- Meta -->
                            <div class="dm-meta">
                                <span class="dm-time" x-text="formatDate(conv.lastMessageAt || conv.lastMessageTime)"></span>
                                <div x-show="conv.unreadCount > 0" class="dm-unread-badge" x-text="conv.unreadCount"></div>
                            </div>
                            <!-- Silme Butonu -->
                            <button @click.stop="deleteConversation(conv)" class="dm-delete-btn" title="Konu≈ümayƒ± Sil">
                                <i class="fas fa-trash-alt text-xs"></i>
                            </button>
                        </div>
                    </template>
                </div>
            </div>

            <!-- PROFƒ∞L TAB - YENƒ∞ TASARIM -->
            <div x-show="activeTab === 'profile'" class="-mx-4" x-data="{ profileTab: 'posts' }">
                
                <!-- Header Bar -->
                <div class="px-4 py-3 flex items-center gap-4 bg-[var(--bg-main)]">
                    <button @click="activeTab = 'home'" class="text-[var(--text-main)]">
                        <i class="fas fa-arrow-left text-lg"></i>
                    </button>
                    <div>
                        <h2 class="font-bold text-lg leading-tight" x-text="user.name"></h2>
                        <p class="text-xs text-[var(--text-sec)]" x-text="(userStats.postCount || userStats.postsCount || 0) + ' g√∂nderi'"></p>
                    </div>
                </div>
                
                <!-- Kapak ve Profil Fotoƒürafƒ± -->
                <div class="profile-header">
                    <!-- Kapak Fotoƒürafƒ± -->
                    <div class="profile-cover-container">
                        <template x-if="user.coverPic">
                            <img :src="user.coverPic" alt="Kapak">
                        </template>
                        <template x-if="!user.coverPic">
                            <img src="https://images.unsplash.com/photo-1500382017468-9049fed747ef?w=800&q=80" alt="Kapak">
                        </template>
                    </div>
                    
                    <!-- Profil Fotoƒürafƒ± -->
                    <div class="profile-avatar-container">
                        <div class="profile-avatar-ring relative cursor-pointer" 
                             :class="myStories.length > 0 ? 'has-story' : ''"
                             @click.stop="openProfilePicPopup(user.profilePic || 'https://ui-avatars.com/api/?name='+user.name, user.id, myStories.length > 0, myStories[0] || null, true)">
                            <img :src="user.profilePic || 'https://ui-avatars.com/api/?name='+user.name" alt="Profil">
                            <!-- Hikaye Ekle Butonu (+) -->
                            <button @click.stop="showStoryModal = true" 
                                    class="absolute -bottom-1 -right-1 w-8 h-8 bg-gradient-to-br from-emerald-500 to-teal-500 rounded-full flex items-center justify-center text-white shadow-lg shadow-emerald-300 border-3 border-white hover:scale-110 transition-transform active:scale-95 z-10"
                                    style="border: 3px solid var(--bg-card);">
                                <i class="fas fa-plus text-xs font-bold"></i>
                            </button>
                        </div>
                    </div>
                    
                </div>
                
                <!-- Profil Bilgileri -->
                <div class="px-6 pt-20 pb-4 relative">
                    <!-- Profilini Deƒüi≈ütir ve Payla≈ü Butonlarƒ± - Saƒü √ústte - MODERN -->
                    <div class="absolute top-4 right-4 flex gap-2">
                        <button @click="shareProfile()" 
                                class="px-4 py-2.5 rounded-full font-bold text-sm bg-[var(--bg-card)] border-2 border-[var(--border)] hover:bg-[var(--input-bg)] transition-all duration-300 hover:scale-105 active:scale-95 shadow-sm">
                            <i class="fas fa-share-alt mr-1.5"></i>Payla≈ü
                        </button>
                        <button @click="initEditForm(); showEditModal = true" 
                                class="px-4 py-2.5 rounded-full font-bold text-sm bg-gradient-to-r from-emerald-500 to-teal-500 text-white hover:from-emerald-600 hover:to-teal-600 transition-all duration-300 hover:scale-105 active:scale-95 shadow-lg shadow-emerald-200">
                            <i class="fas fa-edit mr-1.5"></i>D√ºzenle
                        </button>
                    </div>
                    <!-- ƒ∞sim, Onay, Rozetler, √áevrimi√ßi Durumu -->
                    <div class="flex items-center gap-2 flex-wrap">
                        <h1 class="text-2xl font-bold" x-text="user.name"></h1>
                        <template x-if="user.isVerified || user.verified">
                            <span class="verified-badge">
                                <svg viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M17.7508 9.41667C17.7508 8.1 17.0217 6.95833 15.9608 6.41667C16.0892 6.05417 16.1592 5.6625 16.1592 5.25C16.1592 3.40833 14.7342 1.91833 12.9775 1.91833C12.5858 1.91833 12.2108 1.98833 11.8642 2.12667C11.3492 1.0125 10.2592 0.25 9.00083 0.25C7.7425 0.25 6.65417 1.01417 6.13667 2.125C5.79083 1.9875 5.415 1.91667 5.02333 1.91667C3.265 1.91667 1.84167 3.40833 1.84167 5.25C1.84167 5.66167 1.91083 6.05333 2.03917 6.41667C0.979167 6.95833 0.25 8.09833 0.25 9.41667C0.25 10.6625 0.901667 11.7483 1.86833 12.3217C1.85167 12.4633 1.84167 12.605 1.84167 12.75C1.84167 14.5917 3.265 16.0833 5.02333 16.0833C5.415 16.0833 5.79 16.0117 6.13583 15.875C6.6525 16.9867 7.74083 17.75 9 17.75C10.26 17.75 11.3483 16.9867 11.8642 15.875C12.21 16.0108 12.585 16.0817 12.9775 16.0817C14.7358 16.0817 16.1592 14.59 16.1592 12.7483C16.1592 12.6033 16.1492 12.4617 16.1317 12.3208C17.0967 11.7483 17.7508 10.6625 17.7508 9.4175V9.41667ZM12.2375 6.63833L8.62583 12.055C8.505 12.2358 8.3075 12.3333 8.105 12.3333C7.98583 12.3333 7.865 12.3 7.75833 12.2283L7.6625 12.15L5.65 10.1375C5.40583 9.89333 5.40583 9.4975 5.65 9.25417C5.89417 9.01083 6.29 9.00917 6.53333 9.25417L8.00833 10.7267L11.1958 5.94333C11.3875 5.65583 11.7758 5.58 12.0625 5.77083C12.3508 5.9625 12.4292 6.35083 12.2375 6.6375V6.63833Z" fill="#1D9BF0"/>
                                </svg>
                            </span>
                        </template>
                        <!-- ROZETLER - GELƒ∞≈ûMƒ∞≈û v2 -->
                        <div class="badge-container">
                            <template x-if="userBadges && userBadges.length > 0">
                                <template x-for="badge in userBadges" :key="badge.type + (badge.level || '')">
                                    <span class="user-badge" 
                                          :class="getBadgeClass(badge)"
                                          :title="badge.name">
                                        <span x-text="badge.icon"></span>
                                        <span class="badge-tooltip" x-text="badge.description || badge.name"></span>
                                    </span>
                                </template>
                            </template>
                        </div>
                        <span class="online-status">√áevrimi√ßi</span>
                    </div>
                    
                    <!-- @username -->
                    <p class="text-[var(--text-sec)] mt-1" x-text="'@' + user.username"></p>
                    
                    <!-- Kullanƒ±cƒ± Tipi Rozeti -->
                    <div class="mt-2">
                        <span class="inline-flex items-center gap-1 px-3 py-1 bg-emerald-100 text-emerald-700 rounded-full text-xs font-semibold">
                            <i class="fas" :class="{
                                'fa-chalkboard-teacher': user.userType === 'tarim_ogretmeni',
                                'fa-graduation-cap': user.userType === 'tarim_ogrencisi',
                                'fa-book': user.userType === 'ogretmen',
                                'fa-flask': user.userType === 'ziraat_muhendisi',
                                'fa-user': user.userType === 'normal_kullanici',
                                'fa-horse': user.userType === 'ciftci_hayvancilik'
                            }"></i>
                            <span x-text="{
                                'tarim_ogretmeni': 'Tarƒ±m √ñƒüretmeni',
                                'tarim_ogrencisi': 'Tarƒ±m √ñƒürencisi',
                                'ogretmen': '√ñƒüretmen',
                                'ziraat_muhendisi': 'Ziraat M√ºhendisi',
                                'normal_kullanici': 'Normal Kullanƒ±cƒ±',
                                'ciftci_hayvancilik': '√áift√ßi & Hayvancƒ±lƒ±k'
                            }[user.userType] || 'Normal Kullanƒ±cƒ±'"></span>
                        </span>
                    </div>
                    
                    <!-- Bio -->
                    <div class="mt-3">
                        <p class="text-[var(--text-main)] leading-relaxed" x-text="user.bio ? (bioExpanded ? user.bio : (user.bio.length > 100 ? user.bio.slice(0,100) + '...' : user.bio)) : 'Hen√ºz bir biyografi eklenmedi üå±'"></p>
                        <template x-if="user.bio && user.bio.length > 100">
                            <button @click="bioExpanded = !bioExpanded" class="text-emerald-500 text-xs font-bold mt-1" x-text="bioExpanded ? 'Daha az g√∂ster' : 'Daha fazla g√∂ster'"></button>
                        </template>
                    </div>
                    
                    <!-- Website Linki -->
                    <template x-if="user.website">
                        <a :href="user.website.startsWith('http') ? user.website : 'https://' + user.website" 
                           target="_blank" 
                           class="mt-2 inline-flex items-center gap-1 text-blue-500 hover:text-blue-600 text-sm font-medium">
                            <i class="fas fa-link"></i>
                            <span x-text="user.website.replace(/^https?:\/\//, '')"></span>
                        </a>
                    </template>
                    
                    <!-- Konum ve Katƒ±lƒ±m Tarihi -->
                    <div class="flex items-center gap-4 mt-3 text-[var(--text-sec)] text-sm flex-wrap">
                        <template x-if="user.location">
                            <span class="flex items-center gap-1">
                                <i class="fas fa-map-marker-alt"></i>
                                <span x-text="user.location"></span>
                            </span>
                        </template>
                        <span class="flex items-center gap-1">
                            <i class="far fa-calendar-alt"></i>
                            <span x-text="formatJoinDate(user.createdAt)"></span>
                        </span>
                    </div>
                    
                    <!-- Takip ƒ∞statistikleri -->
                    <div class="flex items-center gap-6 mt-4">
                        <div @click="showConnections('following')" class="stat-inline">
                            <strong x-text="formatCount(userStats.followingCount || userStats.following || 0)"></strong>
                            <span>Takip</span>
                        </div>
                        <div @click="showConnections('followers')" class="stat-inline">
                            <strong x-text="formatCount(userStats.followerCount || userStats.followers || 0)"></strong>
                            <span>Takip√ßi</span>
                        </div>
                    </div>
                    
                    <!-- üèÜ ROZET Vƒ∞TRƒ∞Nƒ∞ -->
                    <template x-if="userBadges && userBadges.length > 0">
                        <div class="badge-showcase">
                            <template x-for="badge in userBadges" :key="'showcase-' + badge.type + (badge.level || '')">
                                <div class="badge-showcase-item">
                                    <div class="badge-showcase-icon" :class="getBadgeShowcaseIcon(badge)">
                                        <span x-text="badge.icon" style="filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));"></span>
                                    </div>
                                    <span class="badge-showcase-name" x-text="badge.name"></span>
                                </div>
                            </template>
                        </div>
                    </template>
                </div>
                
                <!-- Sekmeler -->
                <div class="profile-tabs">
                    <div @click="profileTab = 'posts'" class="profile-tab" :class="profileTab === 'posts' ? 'active' : ''">
                        G√∂nderiler
                    </div>
                    <div @click="profileTab = 'photos'" class="profile-tab" :class="profileTab === 'photos' ? 'active' : ''">
                        Fotoƒüraf
                    </div>
                    <div @click="profileTab = 'videos'" class="profile-tab" :class="profileTab === 'videos' ? 'active' : ''">
                        Video
                    </div>
                    <div @click="profileTab = 'saved'; loadSavedPosts()" class="profile-tab" :class="profileTab === 'saved' ? 'active' : ''">
                        Kaydedilenler
                    </div>
                </div>
                
                <!-- Sekme ƒ∞√ßerikleri -->
                <div class="px-4 py-4">
                    
                    <!-- G√∂nderiler Sekmesi -->
                    <div x-show="profileTab === 'posts'" class="space-y-4">
                        <template x-if="myPosts.length === 0">
                            <div class="text-center py-12 text-[var(--text-sec)]">
                                <i class="fas fa-seedling text-4xl mb-3 opacity-50"></i>
                                <p class="font-medium">Hen√ºz g√∂nderi yok</p>
                            </div>
                        </template>
                        <template x-for="post in myPosts" :key="post.id">
                            <div class="agro-card p-4" x-data="{ postExpanded: false }">
                                <div class="flex items-start gap-3">
                                    <img :src="user.profilePic || 'https://ui-avatars.com/api/?name='+user.name" class="w-10 h-10 rounded-full object-cover flex-shrink-0">
                                    <div class="flex-1 min-w-0">
                                        <div class="flex items-center gap-1.5 flex-wrap">
                                            <span class="font-bold text-sm" x-text="user.name"></span>
                                            <template x-if="user.isVerified">
                                                <span class="verified-badge verified-badge-sm"></span>
                                            </template>
                                            <span class="text-[var(--text-sec)] text-xs" x-text="'@' + user.username"></span>
                                            <span class="text-[var(--text-sec)] text-xs">¬∑</span>
                                            <span class="text-[var(--text-sec)] text-xs" x-text="formatDate(post.createdAt)"></span>
                                        </div>
                                        <p class="mt-2 text-sm" x-html="postExpanded ? formatContent(post.content) : formatContent((post.content||'').length > 200 ? (post.content.slice(0,200) + '‚Ä¶') : post.content)"></p>
                                        <template x-if="(post.content||'').length > 200">
                                            <button @click="postExpanded = !postExpanded" class="text-emerald-500 text-xs font-bold mt-1 hover:text-emerald-600 transition" x-text="postExpanded ? '‚ñ≤ Daha az g√∂ster' : '‚ñº Devamƒ±nƒ± g√∂ster'"></button>
                                        </template>
                                        <template x-if="post.mediaUrl || (post.mediaUrls && post.mediaUrls.length > 0)">
                                            <div class="mt-3"
                                                 x-data="{
                                                    cIdx: 0,
                                                    get cItems() { if(post.mediaUrls&&post.mediaUrls.length>0) return post.mediaUrls; if(post.mediaUrl) return [{url:post.mediaUrl,type:post.mediaType||'image'}]; return []; },
                                                    get cLen() { return this.cItems.length; },
                                                    getUrl(item) { return typeof item==='string'?item:(item.url||item.mediaUrl||''); },
                                                    getType(item) { return typeof item==='string'?'image':(item.type||item.mediaType||'image'); },
                                                    touchSX: 0
                                                 }">
                                                <div class="media-carousel"
                                                     @touchstart="touchSX=$event.touches[0].clientX"
                                                     @touchend="const dx=$event.changedTouches[0].clientX-touchSX;if(Math.abs(dx)>40){dx<0?(cIdx<cLen-1?cIdx++:null):(cIdx>0?cIdx--:null)}">
                                                    <div class="media-carousel-track" :style="`transform:translateX(-${cIdx*100}%)`">
                                                        <template x-for="(item,ii) in cItems" :key="ii">
                                                            <div class="media-carousel-slide">
                                                                <template x-if="getType(item)==='video'">
                                                                    <div class="relative" style="max-height:320px;overflow:hidden;">
                                                                        <div class="video-loading-overlay"><div class="video-spinner"></div></div>
                                                                        <video x-init="$nextTick(()=>{$el.addEventListener('canplay',()=>$el.parentElement.querySelector('.video-loading-overlay').classList.add('hidden'));initAgroHLS($el,getUrl(item));})"
                                                                               class="w-full rounded-2xl max-h-80 object-cover" controls preload="none" playsinline></video>
                                                                    </div>
                                                                </template>
                                                                <template x-if="getType(item)!=='video'">
                                                                    <img :src="getUrl(item)" @click="openTikTokScroll(post)" class="w-full rounded-2xl max-h-80 object-cover cursor-pointer" loading="lazy">
                                                                </template>
                                                            </div>
                                                        </template>
                                                    </div>
                                                    <template x-if="cLen>1">
                                                        <div>
                                                            <button x-show="cIdx>0" @click.stop="cIdx--" class="carousel-nav-btn prev"><i class="fas fa-chevron-left text-xs"></i></button>
                                                            <button x-show="cIdx<cLen-1" @click.stop="cIdx++" class="carousel-nav-btn next"><i class="fas fa-chevron-right text-xs"></i></button>
                                                            <div class="carousel-count-badge" x-text="(cIdx+1)+'/'+cLen"></div>
                                                            <div class="carousel-dots">
                                                                <template x-for="(_,di) in cItems" :key="di"><div class="carousel-dot" :class="di===cIdx?'active':''"></div></template>
                                                            </div>
                                                        </div>
                                                    </template>
                                                </div>
                                            </div>
                                        </template>
                                        <div class="flex items-center gap-6 mt-3 text-[var(--text-sec)] text-sm">
                                            <span class="flex items-center gap-1"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg><span x-text="post.commentCount || 0"></span></span>
                                            <span class="flex items-center gap-1"><i class="far fa-heart"></i><span x-text="post.likeCount || 0"></span></span>
                                            <span class="flex items-center gap-1"><i class="fas fa-chart-bar"></i><span x-text="post.viewCount || post.views || 0"></span></span>
                                            <button @click="deleteMyPost(post)" class="ml-auto text-red-400 hover:text-red-600 transition">
                                                <i class="fas fa-trash text-xs"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </template>
                        <!-- Daha Fazla Y√ºkle - Kendi Profil -->
                        <div x-show="myPostsHasMore" class="text-center py-4">
                            <button @click="loadMoreMyPosts()" 
                                    :disabled="myPostsLoading"
                                    class="px-6 py-3 bg-emerald-500 text-white rounded-full font-bold text-sm hover:bg-emerald-600 transition disabled:opacity-50">
                                <span x-show="!myPostsLoading">Daha Fazla G√∂ster</span>
                                <span x-show="myPostsLoading"><i class="fas fa-spinner fa-spin mr-1"></i>Y√ºkleniyor...</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Medya Sekmesi -->
                    <!-- Fotoƒüraf Sekmesi (sadece resimler) -->
                    <div x-show="profileTab === 'photos'" class="grid grid-cols-3 gap-1">
                        <template x-for="post in myPosts.filter(p => p.mediaType !== 'video' && (p.mediaUrl || (p.mediaUrls && p.mediaUrls.length > 0)))" :key="'photo-'+post.id">
                            <div class="aspect-square overflow-hidden rounded-lg cursor-pointer hover:opacity-80 transition relative" @click="openTikTokScroll(post)">
                                <img :src="post.mediaUrl || (post.mediaUrls && post.mediaUrls[0] && (typeof post.mediaUrls[0]==='string'?post.mediaUrls[0]:post.mediaUrls[0].url))" class="w-full h-full object-cover" loading="lazy">
                                <template x-if="post.mediaUrls && post.mediaUrls.length > 1">
                                    <div class="absolute top-1.5 right-1.5 bg-black/60 rounded-md px-1.5 py-0.5 text-white text-[10px] font-bold flex items-center gap-1">
                                        <i class="fas fa-clone text-[8px]"></i><span x-text="post.mediaUrls.length"></span>
                                    </div>
                                </template>
                            </div>
                        </template>
                        <template x-if="myPosts.filter(p => p.mediaType !== 'video' && (p.mediaUrl || (p.mediaUrls && p.mediaUrls.length > 0))).length === 0">
                            <div class="col-span-3 text-center py-12 text-[var(--text-sec)]">
                                <i class="fas fa-image text-4xl mb-3 opacity-50"></i>
                                <p class="font-medium">Hen√ºz fotoƒüraf yok</p>
                            </div>
                        </template>
                    </div>

                    <!-- Video Sekmesi (sadece videolar) -->
                    <div x-show="profileTab === 'videos'" class="grid grid-cols-3 gap-1">
                        <template x-for="post in myPosts.filter(p => p.mediaType === 'video' && (p.mediaUrl || (p.mediaUrls && p.mediaUrls.length > 0)))" :key="'video-'+post.id">
                            <div class="aspect-square overflow-hidden rounded-lg cursor-pointer hover:opacity-80 transition relative" @click="openTikTokScroll(post)">
                                <div class="w-full h-full bg-slate-800 flex items-center justify-center relative">
                                    <img :src="post.thumbnail || ''" class="w-full h-full object-cover" @error="$el.style.display='none'">
                                    <div class="absolute inset-0 flex items-center justify-center">
                                        <div class="w-10 h-10 rounded-full bg-black/50 flex items-center justify-center">
                                            <i class="fas fa-play text-white text-sm ml-0.5"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </template>
                        <template x-if="myPosts.filter(p => p.mediaType === 'video' && (p.mediaUrl || (p.mediaUrls && p.mediaUrls.length > 0))).length === 0">
                            <div class="col-span-3 text-center py-12 text-[var(--text-sec)]">
                                <i class="fas fa-video text-4xl mb-3 opacity-50"></i>
                                <p class="font-medium">Hen√ºz video yok</p>
                            </div>
                        </template>
                    </div>
                    
                    <!-- Kaydedilenler Sekmesi -->
                    <div x-show="profileTab === 'saved'" class="space-y-4">
                        <template x-if="savedPostsList.length === 0">
                            <div class="text-center py-12 text-[var(--text-sec)]">
                                <i class="fas fa-bookmark text-4xl mb-3 opacity-50"></i>
                                <p class="font-medium">Hen√ºz kaydedilen g√∂nderi yok</p>
                            </div>
                        </template>
                        <template x-for="post in savedPostsList" :key="'saved-'+post.id">
                            <div class="agro-card p-4">
                                <div class="flex items-start gap-3">
                                    <img :src="post.userProfilePic || 'https://ui-avatars.com/api/?name='+(post.userName || 'User')" class="w-10 h-10 rounded-full object-cover flex-shrink-0">
                                    <div class="flex-1 min-w-0">
                                        <div class="flex items-center gap-1 flex-wrap">
                                            <span class="font-bold text-sm" x-text="post.userName || 'Kullanƒ±cƒ±'"></span>
                                            <span class="text-[var(--text-sec)] text-xs" x-text="'@' + (post.userUsername || 'user')"></span>
                                        </div>
                                        <p class="mt-2 text-sm" x-text="post.content?.substring(0, 150) + (post.content?.length > 150 ? '...' : '')"></p>
                                        <template x-if="post.mediaUrl">
                                            <div class="mt-2">
                                                <template x-if="post.mediaType === 'video'">
                                                    <video x-init="$nextTick(()=>initAgroHLS($el,post.mediaUrl))" class="rounded-xl w-full max-h-48 object-cover" controls></video>
                                                </template>
                                                <template x-if="post.mediaType !== 'video'">
                                                    <img :src="post.mediaUrl" @click="openFullScreen(post.mediaUrl, 'image')" class="rounded-xl w-full max-h-48 object-cover cursor-pointer">
                                                </template>
                                            </div>
                                        </template>
                                        <div class="flex items-center gap-4 mt-2 text-[var(--text-sec)] text-xs">
                                            <span class="flex items-center gap-1"><i class="far fa-heart"></i><span x-text="post.likeCount || 0"></span></span>
                                            <span class="flex items-center gap-1"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg><span x-text="post.commentCount || 0"></span></span>
                                            <span class="flex items-center gap-1"><i class="far fa-eye"></i><span x-text="post.viewCount || post.views || 0"></span></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>
                
                <!-- Alt Men√º Butonlarƒ± -->
                <div class="px-4 pb-6 space-y-2">
                    <button @click="loadSavedPosts" class="w-full p-4 agro-card flex items-center gap-3 text-left hover:bg-[var(--input-bg)] transition">
                        <i class="fas fa-bookmark text-emerald-500"></i>
                        <span class="font-medium">Kayƒ±tlƒ± G√∂nderiler</span>
                        <i class="fas fa-chevron-right text-[var(--text-sec)] ml-auto"></i>
                    </button>
                    <button @click="showSettingsMenu = true" class="w-full p-4 agro-card flex items-center gap-3 text-left hover:bg-[var(--input-bg)] transition">
                        <i class="fas fa-cog text-[var(--text-sec)]"></i>
                        <span class="font-medium">Ayarlar</span>
                        <i class="fas fa-chevron-right text-[var(--text-sec)] ml-auto"></i>
                    </button>
                </div>
            </div>
        </main>

        <!-- ALT NAVƒ∞GASYON -->
        <nav id="bottomNav" class="fixed bottom-0 left-0 right-0 flex justify-center z-50" style="transition: transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.4s ease; padding: 0 16px 16px; pointer-events: none;">
            <div class="flex justify-around items-center w-full max-w-sm" style="
                pointer-events: all;
                background: var(--glass-bg, rgba(255,255,255,0.92));
                backdrop-filter: blur(24px) saturate(200%);
                -webkit-backdrop-filter: blur(24px) saturate(200%);
                border-radius: 28px;
                border: 1px solid var(--glass-border, rgba(255,255,255,0.4));
                box-shadow: 0 8px 32px rgba(0,0,0,0.12), 0 2px 8px rgba(0,0,0,0.06), inset 0 1px 0 rgba(255,255,255,0.5);
                padding: 6px 8px;
            ">
            <button 
                @touchstart.passive="$el.classList.add('nav-btn-press'); $el.addEventListener('animationend', () => $el.classList.remove('nav-btn-press'), {once:true})"
                @click="switchTab('home')" 
                data-onboarding="home" :class="activeTab === 'home' ? 'nav-icon active' : 'nav-icon'">
                <i class="fas fa-home"></i>
            </button>
            <button 
                @touchstart.passive="$el.classList.add('nav-btn-press'); $el.addEventListener('animationend', () => $el.classList.remove('nav-btn-press'), {once:true})"
                @click="switchTab('store')" 
                data-onboarding="store" :class="activeTab === 'store' ? 'nav-icon active' : 'nav-icon'">
                <i class="fas fa-shopping-basket"></i>
            </button>
            <button 
                @touchstart.passive="$el.classList.add('post-btn-press'); $el.addEventListener('animationend', () => $el.classList.remove('post-btn-press'), {once:true})"
                @click="showPostModal = true" 
                data-onboarding="create-post" 
                class="flex items-center justify-center border-4 border-[var(--bg-main)]" 
                style="
                    width: 58px; height: 58px;
                    border-radius: 22px;
                    background: linear-gradient(145deg, #00d4aa, #00b894 40%, #059669);
                    box-shadow: 0 8px 28px rgba(0,184,148,0.45), 0 2px 8px rgba(0,184,148,0.25), inset 0 1px 0 rgba(255,255,255,0.3);
                    margin-top: -18px;
                    transition: all 0.3s cubic-bezier(0.34,1.56,0.64,1);
                    -webkit-tap-highlight-color: transparent;
                " 
                @mouseenter="$el.style.transform='scale(1.08) rotate(8deg)'"
                @mouseleave="$el.style.transform='scale(1) rotate(0deg)'"
                @touchstart.passive="$el.style.transform='scale(0.92)'"
                @touchend.passive="setTimeout(() => $el.style.transform='scale(1)',200)">
                <i class="fas fa-plus text-white" style="font-size: 1.2rem; font-weight: 900;"></i>
            </button>
            <button 
                @touchstart.passive="$el.classList.add('nav-btn-press'); $el.addEventListener('animationend', () => $el.classList.remove('nav-btn-press'), {once:true})"
                @click="switchTab('messages')" 
                data-onboarding="messages" :class="activeTab === 'messages' ? 'nav-icon active' : 'nav-icon'" class="relative">
                <i class="fas fa-comment-dots"></i>
                <span x-show="totalUnreadMessages > 0" 
                      class="absolute -top-1 -right-1 min-w-[18px] h-[18px] bg-red-500 text-white text-[10px] font-bold rounded-full flex items-center justify-center px-1 shadow-lg"
                      x-text="totalUnreadMessages > 99 ? '99+' : totalUnreadMessages"
                      style="line-height: 1;"></span>
            </button>
            <button 
                @touchstart.passive="$el.classList.add('nav-btn-press'); $el.addEventListener('animationend', () => $el.classList.remove('nav-btn-press'), {once:true})"
                @click="switchTab('profile')" 
                data-onboarding="profile" :class="activeTab === 'profile' ? 'nav-icon active' : 'nav-icon'">
                <template x-if="user && user.profilePic">
                    <img :src="user.profilePic" class="w-7 h-7 rounded-full object-cover" :style="activeTab === 'profile' ? 'border: 2px solid #10b981; box-shadow: 0 0 8px rgba(16,185,129,0.4);' : 'border: 2px solid var(--border);'">
                </template>
                <template x-if="!user || !user.profilePic">
                    <i class="fas fa-user"></i>
                </template>
            </button>
            </div>
        </nav>
    </div>

    <!-- ============ MODALLAR ============ -->
    
    <!-- ========== KE≈ûFET SAYFASI MODAL ========== -->
    <div x-show="showExplore" x-transition x-cloak class="fixed inset-0 z-[100] flex flex-col bg-[var(--bg-main)]">
        <!-- Ke≈üfet Header -->
        <div class="glass px-4 py-3 flex items-center gap-4">
            <button @click="showExplore = false" class="w-10 h-10 rounded-full bg-[var(--input-bg)] flex items-center justify-center text-[var(--text-main)] hover:bg-[var(--border)] transition">
                <i class="fas fa-arrow-left"></i>
            </button>
            <div class="flex-1">
                <h3 class="text-xl font-black flex items-center gap-2">
                    <i class="fas fa-compass text-emerald-500"></i> <span x-text="t('explore')">Ke≈üfet</span>
                </h3>
                <p class="text-[10px] text-[var(--text-sec)] mt-0.5">‚Üê ‚Üí kaydƒ±rarak sekmeler arasƒ± ge√ßi≈ü yapƒ±n</p>
            </div>
            <button @click="loadExplorePosts()" class="w-10 h-10 rounded-full bg-[var(--input-bg)] flex items-center justify-center hover:bg-[var(--border)] transition">
                <i class="fas fa-sync-alt text-sm" :class="exploreLoading ? 'fa-spin' : ''"></i>
            </button>
        </div>
        
        <!-- Arama √áubuƒüu -->
        <div class="px-4 py-2">
            <div class="relative">
                <i class="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 text-sm"></i>
                <input type="text" x-model="exploreSearchQuery" 
                       @input="filterExplorePosts()" 
                       placeholder="ƒ∞√ßerik, ki≈üi veya #hashtag ara..." 
                       class="w-full bg-[var(--input-bg)] border border-[var(--border)] p-3 pl-11 text-sm outline-none focus:ring-2 focus:ring-emerald-400 transition-all duration-200" style="border-radius: 18px;">
            </div>
        </div>
        
        <!-- Kategori Filtreleri -->
        <div class="px-4 py-2 overflow-x-auto no-scrollbar"
             @touchstart.passive="exploreTouchStartX = $event.touches[0].clientX; exploreTouchStartY = $event.touches[0].clientY"
             @touchend.passive="handleExploreSwipe($event)">
            <div class="flex gap-2">
                <button @click="exploreCategory = 'all'; loadExplorePosts()" class="explore-category-chip" :class="exploreCategory === 'all' ? 'active' : ''">
                    <i class="fas fa-fire"></i> <span x-text="t('trend')">Trend</span>
                </button>
                <button @click="exploreCategory = 'liked'; loadExplorePosts()" class="explore-category-chip" :class="exploreCategory === 'liked' ? 'active' : ''">
                    <i class="fas fa-heart"></i> <span x-text="t('mostLiked')">Beƒüenilen</span>
                </button>
                <button @click="exploreCategory = 'commented'; loadExplorePosts()" class="explore-category-chip" :class="exploreCategory === 'commented' ? 'active' : ''">
                    <i class="fas fa-comment"></i> <span x-text="t('mostCommented')">Yorumlanan</span>
                </button>
                <button @click="exploreCategory = 'media'; loadExplorePosts()" class="explore-category-chip" :class="exploreCategory === 'media' ? 'active' : ''">
                    <i class="fas fa-images"></i> Medya
                </button>
                <button @click="exploreCategory = 'recent'; loadExplorePosts()" class="explore-category-chip" :class="exploreCategory === 'recent' ? 'active' : ''">
                    <i class="fas fa-clock"></i> Yeni
                </button>
                <button @click="exploreCategory = 'hashtags'; loadPopularHashtags()" class="explore-category-chip" :class="exploreCategory === 'hashtags' ? 'active' : ''">
                    <i class="fas fa-hashtag"></i> Pop√ºler Hashtagler
                </button>
            </div>
        </div>
        
        <!-- Ke≈üfet ƒ∞√ßerik -->
        <div class="flex-1 overflow-y-auto px-3 pb-4 no-scrollbar"
             @touchstart.passive="exploreTouchStartX = $event.touches[0].clientX; exploreTouchStartY = $event.touches[0].clientY"
             @touchend.passive="handleExploreSwipe($event)">
            <!-- Y√ºkleniyor -->
            <div x-show="exploreLoading" class="flex items-center justify-center py-12">
                <div class="text-center">
                    <i class="fas fa-spinner fa-spin text-3xl text-emerald-500 mb-3"></i>
                    <p class="text-sm text-[var(--text-sec)] font-medium">Trend g√∂nderiler y√ºkleniyor...</p>
                </div>
            </div>
            
            <!-- Bo≈ü State -->
            <div x-show="!exploreLoading && explorePosts.length === 0" class="flex items-center justify-center py-12">
                <div class="text-center">
                    <div class="w-20 h-20 bg-emerald-50 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-seedling text-3xl text-emerald-400"></i>
                    </div>
                    <h3 class="font-bold text-lg mb-1">Hen√ºz ke≈üfedilecek i√ßerik yok</h3>
                    <p class="text-sm text-[var(--text-sec)]">Yeni g√∂nderiler payla≈üƒ±ldƒ±ƒüƒ±nda burada g√∂r√ºnecek</p>
                </div>
            </div>
            
            <!-- Pop√ºler Hashtagler G√∂r√ºn√ºm√º -->
            <div x-show="!exploreLoading && exploreCategory === 'hashtags' && popularHashtags.length > 0" class="space-y-2">
                <template x-for="(tag, idx) in popularHashtags" :key="tag.name">
                    <div class="agro-card p-4 flex items-center gap-4 cursor-pointer hover:bg-[var(--input-bg)] transition" @click="exploreSearchQuery = '#' + tag.name; exploreCategory = 'all'; filterExplorePosts()">
                        <div class="w-12 h-12 rounded-full flex items-center justify-center text-white font-black text-lg" :style="'background: linear-gradient(135deg, ' + ['#00b894,#00cec9','#6c5ce7,#a29bfe','#fd79a8,#e17055','#0984e3,#74b9ff','#e17055,#fdcb6e'][idx % 5] + ')'">
                            <i class="fas fa-hashtag"></i>
                        </div>
                        <div class="flex-1">
                            <h4 class="font-black text-[var(--text-main)]" x-text="'#' + tag.name"></h4>
                            <p class="text-xs text-[var(--text-sec)]" x-text="tag.count + ' g√∂nderi'"></p>
                        </div>
                        <i class="fas fa-chevron-right text-[var(--text-sec)]"></i>
                    </div>
                </template>
            </div>

            <!-- Hashtag Bo≈ü State -->
            <div x-show="!exploreLoading && exploreCategory === 'hashtags' && popularHashtags.length === 0" class="flex items-center justify-center py-12">
                <div class="text-center">
                    <div class="w-20 h-20 bg-emerald-50 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-hashtag text-3xl text-emerald-400"></i>
                    </div>
                    <h3 class="font-bold text-lg mb-1">Hen√ºz pop√ºler hashtag yok</h3>
                    <p class="text-sm text-[var(--text-sec)]">G√∂nderilerde #hashtag kullanƒ±ldƒ±ƒüƒ±nda burada g√∂r√ºnecek</p>
                </div>
            </div>

            <!-- Masonry Grid -->
            <div x-show="!exploreLoading && explorePosts.length > 0 && exploreCategory !== 'hashtags'" class="explore-grid">
                <template x-for="(post, idx) in explorePosts" :key="post.id">
                    <div class="explore-card" @click="openTikTokScroll(post)">
                        <!-- Trend Rozeti -->
                        <div x-show="idx < 3" class="explore-trending-badge">
                            <i class="fas fa-fire"></i>
                            <span x-text="'#' + (idx + 1)"></span>
                        </div>
                        
                        <!-- Medyalƒ± Post -->
                        <template x-if="post.mediaUrl">
                            <div class="relative">
                                <template x-if="post.mediaType === 'video'">
                                    <div class="relative">
                                        <img :src="post.thumbnail || post.mediaUrl" class="w-full" style="min-height: 140px; max-height: 280px;" onerror="this.style.display='none'">
                                        <div class="absolute top-10 right-10 bg-black/50 rounded-full w-10 h-10 flex items-center justify-center text-white backdrop-blur-sm">
                                            <i class="fas fa-play ml-0.5"></i>
                                        </div>
                                    </div>
                                </template>
                                <template x-if="post.mediaType !== 'video'">
                                    <img :src="post.mediaUrl" class="w-full" style="min-height: 140px; max-height: 280px;" loading="lazy">
                                </template>
                                <!-- Overlay -->
                                <div class="explore-card-overlay">
                                    <!-- Kullanƒ±cƒ± Bilgisi -->
                                    <div class="flex items-center gap-2 mb-2">
                                        <img :src="post.userProfilePic || 'https://ui-avatars.com/api/?name='+post.userName" class="w-6 h-6 rounded-full object-cover border border-white/30">
                                        <span class="text-xs font-bold truncate" x-text="post.userName"></span>
                                        <!-- Verified Rozet -->
                                        <template x-if="post.userIsVerified || post.isVerified">
                                            <span class="verified-badge verified-badge-sm flex-shrink-0">
                                                <svg viewBox="0 0 18 18" fill="none"><path d="M17.7508 9.41667C17.7508 8.1 17.0217 6.95833 15.9608 6.41667C16.0892 6.05417 16.1592 5.6625 16.1592 5.25C16.1592 3.40833 14.7342 1.91833 12.9775 1.91833C12.5858 1.91833 12.2108 1.98833 11.8642 2.12667C11.3492 1.0125 10.2592 0.25 9.00083 0.25C7.7425 0.25 6.65417 1.01417 6.13667 2.125C5.79083 1.9875 5.415 1.91667 5.02333 1.91667C3.265 1.91667 1.84167 3.40833 1.84167 5.25C1.84167 5.66167 1.91083 6.05333 2.03917 6.41667C0.979167 6.95833 0.25 8.09833 0.25 9.41667C0.25 10.6625 0.901667 11.7483 1.86833 12.3217C1.85167 12.4633 1.84167 12.605 1.84167 12.75C1.84167 14.5917 3.265 16.0833 5.02333 16.0833C5.415 16.0833 5.79 16.0117 6.13583 15.875C6.6525 16.9867 7.74083 17.75 9 17.75C10.26 17.75 11.3483 16.9867 11.8642 15.875C12.21 16.0108 12.585 16.0817 12.9775 16.0817C14.7358 16.0817 16.1592 14.59 16.1592 12.7483C16.1592 12.6033 16.1492 12.4617 16.1317 12.3208C17.0967 11.7483 17.7508 10.6625 17.7508 9.4175V9.41667ZM12.2375 6.63833L8.62583 12.055C8.505 12.2358 8.3075 12.3333 8.105 12.3333C7.98583 12.3333 7.865 12.3 7.75833 12.2283L7.6625 12.15L5.65 10.1375C5.40583 9.89333 5.40583 9.4975 5.65 9.25417C5.89417 9.01083 6.29 9.00917 6.53333 9.25417L8.00833 10.7267L11.1958 5.94333C11.3875 5.65583 11.7758 5.58 12.0625 5.77083C12.3508 5.9625 12.4292 6.35083 12.2375 6.6375V6.63833Z" fill="#1D9BF0"/></svg>
                                            </span>
                                        </template>
                                        <!-- Farmer Rozet -->
                                        <template x-if="post.userHasFarmerBadge">
                                            <span class="farmer-badge farmer-badge-sm flex-shrink-0"></span>
                                        </template>
                                    </div>
                                    <!-- ƒ∞statistikler -->
                                    <div class="explore-card-stats">
                                        <span><i class="fas fa-heart"></i> <span x-text="post.likeCount || 0"></span></span>
                                        <span><i class="fas fa-comment"></i> <span x-text="post.commentCount || 0"></span></span>
                                        <span><i class="fas fa-eye"></i> <span x-text="post.viewCount || post.views || 0"></span></span>
                                    </div>
                                </div>
                            </div>
                        </template>
                        
                        <!-- Metin Post (medyasƒ±z) -->
                        <template x-if="!post.mediaUrl">
                            <div class="explore-text-card" :class="'gradient-' + ((idx % 4) + 1)">
                                <!-- Kullanƒ±cƒ± Bilgisi -->
                                <div class="flex items-center gap-2 mb-3">
                                    <img :src="post.userProfilePic || 'https://ui-avatars.com/api/?name='+post.userName" class="w-7 h-7 rounded-full object-cover border border-white/30">
                                    <span class="text-xs font-bold" x-text="post.userName"></span>
                                    <template x-if="post.userIsVerified || post.isVerified">
                                        <span class="verified-badge verified-badge-sm flex-shrink-0">
                                            <svg viewBox="0 0 18 18" fill="none"><path d="M17.7508 9.41667C17.7508 8.1 17.0217 6.95833 15.9608 6.41667C16.0892 6.05417 16.1592 5.6625 16.1592 5.25C16.1592 3.40833 14.7342 1.91833 12.9775 1.91833C12.5858 1.91833 12.2108 1.98833 11.8642 2.12667C11.3492 1.0125 10.2592 0.25 9.00083 0.25C7.7425 0.25 6.65417 1.01417 6.13667 2.125C5.79083 1.9875 5.415 1.91667 5.02333 1.91667C3.265 1.91667 1.84167 3.40833 1.84167 5.25C1.84167 5.66167 1.91083 6.05333 2.03917 6.41667C0.979167 6.95833 0.25 8.09833 0.25 9.41667C0.25 10.6625 0.901667 11.7483 1.86833 12.3217C1.85167 12.4633 1.84167 12.605 1.84167 12.75C1.84167 14.5917 3.265 16.0833 5.02333 16.0833C5.415 16.0833 5.79 16.0117 6.13583 15.875C6.6525 16.9867 7.74083 17.75 9 17.75C10.26 17.75 11.3483 16.9867 11.8642 15.875C12.21 16.0108 12.585 16.0817 12.9775 16.0817C14.7358 16.0817 16.1592 14.59 16.1592 12.7483C16.1592 12.6033 16.1492 12.4617 16.1317 12.3208C17.0967 11.7483 17.7508 10.6625 17.7508 9.4175V9.41667ZM12.2375 6.63833L8.62583 12.055C8.505 12.2358 8.3075 12.3333 8.105 12.3333C7.98583 12.3333 7.865 12.3 7.75833 12.2283L7.6625 12.15L5.65 10.1375C5.40583 9.89333 5.40583 9.4975 5.65 9.25417C5.89417 9.01083 6.29 9.00917 6.53333 9.25417L8.00833 10.7267L11.1958 5.94333C11.3875 5.65583 11.7758 5.58 12.0625 5.77083C12.3508 5.9625 12.4292 6.35083 12.2375 6.6375V6.63833Z" fill="#1D9BF0"/></svg>
                                        </span>
                                    </template>
                                </div>
                                <!-- ƒ∞√ßerik -->
                                <p class="text-sm font-medium leading-relaxed mb-3 line-clamp-4" x-text="post.content?.substring(0, 120) + (post.content?.length > 120 ? '...' : '')"></p>
                                <!-- ƒ∞statistikler -->
                                <div class="explore-card-stats" style="color: rgba(255,255,255,0.85);">
                                    <span><i class="fas fa-heart"></i> <span x-text="post.likeCount || 0"></span></span>
                                    <span><i class="fas fa-comment"></i> <span x-text="post.commentCount || 0"></span></span>
                                </div>
                            </div>
                        </template>
                    </div>
                </template>
            </div>
        </div>
    </div>
    
    <!-- Ayarlar Men√ºs√º Modal - TAM EKRAN -->
    <div x-show="showSettingsMenu" x-transition x-cloak class="fixed inset-0 z-[100] flex flex-col bg-[var(--bg-main)]">
        <!-- Ayarlar Header -->
        <div class="glass px-4 py-4 flex items-center justify-between">
            <button @click="showSettingsMenu = false" class="text-slate-500"><i class="fas fa-arrow-left text-xl"></i></button>
            <h3 class="text-xl font-black" x-text="t('settings')">Ayarlar</h3>
            <div class="w-8"></div>
        </div>
        
        <!-- Ayarlar ƒ∞√ßeriƒüi -->
        <div class="flex-1 overflow-y-auto p-4 space-y-3">
            <!-- Hesap B√∂l√ºm√º -->
            <div class="agro-card p-4">
                <h4 class="text-sm font-bold text-[var(--text-sec)] mb-3 uppercase tracking-wide" x-text="t('account')">Hesap</h4>
                <div class="space-y-1">
                    <div class="settings-item" @click="showChangePassword = true; showSettingsMenu = false">
                        <i class="fas fa-key text-emerald-500 w-6"></i>
                        <span class="font-bold flex-1" x-text="t('changePassword')">≈ûifre Deƒüi≈ütir</span>
                        <i class="fas fa-chevron-right text-[var(--text-sec)]"></i>
                    </div>
                    <div class="settings-item" @click="initEditForm(); showEditModal = true; showSettingsMenu = false">
                        <i class="fas fa-user-edit text-blue-500 w-6"></i>
                        <span class="font-bold flex-1" x-text="t('editProfile')">Profili D√ºzenle</span>
                        <i class="fas fa-chevron-right text-[var(--text-sec)]"></i>
                    </div>
                    <div class="settings-item" @click="showBlockedAccounts = true; showSettingsMenu = false; loadBlockedAccounts()">
                        <i class="fas fa-ban text-red-500 w-6"></i>
                        <span class="font-bold flex-1" x-text="t('blockedAccounts')">Engellenen Hesaplar</span>
                        <i class="fas fa-chevron-right text-[var(--text-sec)]"></i>
                    </div>
                    <div class="settings-item" @click="showSavedPosts = true; showSettingsMenu = false; loadSavedPosts()">
                        <i class="fas fa-bookmark text-yellow-500 w-6"></i>
                        <span class="font-bold flex-1" x-text="t('savedPosts')">Kaydedilen G√∂nderiler</span>
                        <i class="fas fa-chevron-right text-[var(--text-sec)]"></i>
                    </div>
                </div>
            </div>
            
            <!-- √áoklu Hesap B√∂l√ºm√º -->
            <div class="agro-card p-4">
                <h4 class="text-sm font-bold text-[var(--text-sec)] mb-3 uppercase tracking-wide">Hesap Y√∂netimi</h4>
                <div class="space-y-2">
                    <!-- Mevcut hesap -->
                    <div class="flex items-center gap-3 p-3 rounded-2xl bg-emerald-50 dark:bg-emerald-900/20 border-2 border-emerald-500">
                        <img :src="user.avatar || 'agro.png'" class="w-10 h-10 rounded-full object-cover" onerror="this.src='agro.png'">
                        <div class="flex-1">
                            <p class="font-black text-sm text-[var(--text-main)]" x-text="user.displayName || user.username"></p>
                            <p class="text-xs text-emerald-600">Aktif hesap</p>
                        </div>
                        <i class="fas fa-check-circle text-emerald-500"></i>
                    </div>
                    
                    <!-- Kayƒ±tlƒ± hesaplar -->
                    <template x-for="account in savedAccounts.filter(a => a.username !== user.username)" :key="account.username">
                        <div class="flex items-center gap-3 p-3 rounded-2xl bg-[var(--input-bg)] hover:bg-[var(--border)] transition cursor-pointer" @click="switchAccount(account)">
                            <img :src="account.avatar || 'agro.png'" class="w-10 h-10 rounded-full object-cover" onerror="this.src='agro.png'">
                            <div class="flex-1">
                                <p class="font-bold text-sm text-[var(--text-main)]" x-text="account.displayName || account.username"></p>
                                <p class="text-xs text-[var(--text-sec)]">Ge√ßi≈ü yapmak i√ßin tƒ±kla</p>
                            </div>
                            <button @click.stop="removeAccount(account.username)" class="w-8 h-8 rounded-full bg-red-100 flex items-center justify-center hover:bg-red-200 transition">
                                <i class="fas fa-times text-red-500 text-xs"></i>
                            </button>
                        </div>
                    </template>
                    
                    <!-- Hesap Ekle butonu -->
                    <button @click="saveCurrentAccount(); showAddAccountModal = true; showSettingsMenu = false" class="w-full p-3 rounded-2xl border-2 border-dashed border-[var(--border)] flex items-center justify-center gap-2 text-[var(--text-sec)] hover:border-emerald-500 hover:text-emerald-500 transition font-bold">
                        <i class="fas fa-plus-circle"></i>
                        Hesap Ekle
                    </button>
                </div>
            </div>
            
            <!-- G√∂r√ºn√ºm B√∂l√ºm√º -->
            <div class="agro-card p-4">
                <h4 class="text-sm font-bold text-[var(--text-sec)] mb-3 uppercase tracking-wide" x-text="t('appearance')">G√∂r√ºn√ºm</h4>
                <div class="space-y-1">
                    <div class="settings-item" @click="darkMode = !darkMode">
                        <i class="fas fa-sun text-yellow-400 dark-sun-icon" x-show="darkMode"></i><i class="fas fa-moon text-slate-600 dark-moon-icon" x-show="!darkMode"></i>
                        <span class="font-bold flex-1" x-text="darkMode ? t('lightMode') : t('darkMode')"></span>
                        <div class="w-12 h-7 rounded-full p-1 transition-all" :class="darkMode ? 'bg-emerald-500' : 'bg-slate-300'">
                            <div class="w-5 h-5 bg-white rounded-full shadow transition-transform" :class="darkMode ? 'translate-x-5' : ''"></div>
                        </div>
                    </div>
                    <!-- Feed Modu Se√ßici -->
                    <div class="settings-item flex-col items-start gap-3">
                        <div class="flex items-center gap-3 w-full">
                            <i class="fas fa-th-large text-purple-500 w-6"></i>
                            <div class="flex-1">
                                <span class="font-bold text-sm">Feed G√∂r√ºn√ºm√º</span>
                                <p class="text-xs text-[var(--text-sec)]">Ana sayfadaki g√∂nderi d√ºzeni</p>
                            </div>
                        </div>
                        <div class="flex gap-3 w-full mt-1 pl-9">
                            <!-- Normal Mod Se√ßeneƒüi -->
                            <button @click="feedMode = 'normal'; localStorage.setItem('feedMode','normal')"
                                    class="flex-1 flex flex-col items-center gap-2 p-3 rounded-2xl border-2 transition-all"
                                    :class="feedMode === 'normal' ? 'border-emerald-500 bg-emerald-50 dark:bg-emerald-900/20' : 'border-[var(--border)] bg-[var(--input-bg)]'">
                                <div class="w-full h-12 rounded-lg overflow-hidden flex flex-col gap-1 justify-center px-1">
                                    <div class="h-2 bg-slate-300 rounded-full w-full"></div>
                                    <div class="h-2 bg-slate-300 rounded-full w-3/4"></div>
                                    <div class="h-2 bg-slate-300 rounded-full w-5/6"></div>
                                </div>
                                <div class="flex items-center gap-1.5">
                                    <div class="w-3 h-3 rounded-full border-2 transition-all" :class="feedMode === 'normal' ? 'border-emerald-500 bg-emerald-500' : 'border-slate-400'"></div>
                                    <span class="text-xs font-bold" :class="feedMode === 'normal' ? 'text-emerald-600' : 'text-[var(--text-sec)]'">Normal</span>
                                </div>
                            </button>
                            <!-- Media Grid Mod Se√ßeneƒüi -->
                            <button @click="feedMode = 'media'; localStorage.setItem('feedMode','media')"
                                    class="flex-1 flex flex-col items-center gap-2 p-3 rounded-2xl border-2 transition-all"
                                    :class="feedMode === 'media' ? 'border-emerald-500 bg-emerald-50 dark:bg-emerald-900/20' : 'border-[var(--border)] bg-[var(--input-bg)]'">
                                <div class="w-full h-12 rounded-lg overflow-hidden grid grid-cols-2 gap-0.5">
                                    <div class="bg-slate-300 rounded-sm"></div>
                                    <div class="bg-slate-300 rounded-sm"></div>
                                    <div class="bg-slate-300 rounded-sm"></div>
                                    <div class="bg-slate-300 rounded-sm"></div>
                                </div>
                                <div class="flex items-center gap-1.5">
                                    <div class="w-3 h-3 rounded-full border-2 transition-all" :class="feedMode === 'media' ? 'border-emerald-500 bg-emerald-500' : 'border-slate-400'"></div>
                                    <span class="text-xs font-bold" :class="feedMode === 'media' ? 'text-emerald-600' : 'text-[var(--text-sec)]'">Medya</span>
                                </div>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Dil B√∂l√ºm√º -->
            <div class="agro-card p-4">
                <h4 class="text-sm font-bold text-[var(--text-sec)] mb-3 uppercase tracking-wide" x-text="t('language')">Dil</h4>
                <div class="space-y-1">
                    <div class="settings-item" @click="showLanguageModal = true">
                        <i class="fas fa-globe text-blue-500 w-6"></i>
                        <span class="font-bold flex-1" x-text="t('selectLanguage')">Dil Se√ßimi</span>
                        <div class="flex items-center gap-2">
                            <span class="text-sm text-[var(--text-sec)]" x-text="getLanguageName(currentLanguage)"></span>
                            <i class="fas fa-chevron-right text-[var(--text-sec)]"></i>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Bildirimler B√∂l√ºm√º -->
            <div class="agro-card p-4">
                <h4 class="text-sm font-bold text-[var(--text-sec)] mb-3 uppercase tracking-wide" x-text="t('notificationsTitle')">Bildirimler</h4>
                <div class="space-y-1">
                    <div class="settings-item">
                        <i class="fas fa-bell text-purple-500 w-6"></i>
                        <span class="font-bold flex-1" x-text="t('pushNotifications')">Push Bildirimleri</span>
                        <div 
                            @click="togglePushNotifications()" 
                            class="w-12 h-7 rounded-full p-1 cursor-pointer transition-colors"
                            :class="pushNotificationsEnabled ? 'bg-emerald-500' : 'bg-gray-300'"
                        >
                            <div 
                                class="w-5 h-5 bg-white rounded-full shadow transition-transform"
                                :class="pushNotificationsEnabled ? 'translate-x-5' : 'translate-x-0'"
                            ></div>
                        </div>
                    </div>
                    <div class="settings-item">
                        <i class="fas fa-envelope text-pink-500 w-6"></i>
                        <span class="font-bold flex-1" x-text="t('emailNotifications')">E-posta Bildirimleri</span>
                        <div class="w-12 h-7 bg-emerald-500 rounded-full p-1">
                            <div class="w-5 h-5 bg-white rounded-full shadow translate-x-5"></div>
                        </div>
                    </div>
                    
                    <!-- üß™ Test Bildirimi Butonu -->
                    <div x-show="pushNotificationsEnabled" class="mt-3">
                        <button 
                            @click="sendTestNotification()" 
                            class="w-full px-4 py-2 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-lg font-semibold hover:shadow-lg transition-all flex items-center justify-center gap-2"
                        >
                            <i class="fas fa-bell"></i>
                            <span x-text="t('sendTestNotification') || 'Test Bildirimi G√∂nder'">Test Bildirimi G√∂nder</span>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Gizlilik B√∂l√ºm√º -->
            <div class="agro-card p-4">
                <h4 class="text-sm font-bold text-[var(--text-sec)] mb-3 uppercase tracking-wide">Gizlilik & Bildirimler</h4>
                <div class="space-y-1">
                    <div class="settings-item" @click="showPrivacySettings = true; showSettingsMenu = false">
                        <i class="fas fa-user-shield text-emerald-500 w-6"></i>
                        <span class="font-bold flex-1">Gizlilik Ayarlarƒ±</span>
                        <i class="fas fa-chevron-right text-[var(--text-sec)]"></i>
                    </div>
                    <div class="settings-item" @click="showNotificationSettings = true; showSettingsMenu = false">
                        <i class="fas fa-bell text-purple-500 w-6"></i>
                        <span class="font-bold flex-1">Bildirim Ayarlarƒ±</span>
                        <i class="fas fa-chevron-right text-[var(--text-sec)]"></i>
                    </div>
                </div>
            </div>
            
            <!-- G√ºvenlik B√∂l√ºm√º - 2FA Kapatma -->
            <div class="agro-card p-4">
                <h4 class="text-sm font-bold text-[var(--text-sec)] mb-3 uppercase tracking-wide" x-text="t('security')">G√ºvenlik</h4>
                <div class="space-y-1">
                    <div class="settings-item" @click="toggle2FA()">
                        <i class="fas fa-shield-alt text-indigo-500 w-6"></i>
                        <span class="font-bold flex-1" x-text="t('twoFactorAuth')">2FA E-posta Doƒürulama</span>
                        <div class="w-12 h-7 rounded-full p-1 transition-all" :class="user.twoFactorEnabled !== false ? 'bg-emerald-500' : 'bg-slate-300'">
                            <div class="w-5 h-5 bg-white rounded-full shadow transition-transform" :class="user.twoFactorEnabled !== false ? 'translate-x-5' : ''"></div>
                        </div>
                    </div>
                    <p class="text-xs text-[var(--text-sec)] px-4">Kapalƒ±ysa giri≈ü yaparken e-posta doƒürulamasƒ± istenmez.</p>
                </div>
            </div>
            
            <!-- Hakkƒ±nda B√∂l√ºm√º -->
            <div class="agro-card p-4">
                <h4 class="text-sm font-bold text-[var(--text-sec)] mb-3 uppercase tracking-wide" x-text="t('about')">Hakkƒ±nda</h4>
                <div class="space-y-1">
                    <div class="settings-item">
                    <i class="fas fa-info-circle text-blue-400 w-6"></i>
                        <span class="font-bold flex-1" x-text="t('appVersion')">Uygulama Versiyonu</span>
                        <span class="text-[var(--text-sec)] text-sm font-bold">v5.3.9</span>
                    </div>
                    <div class="settings-item" @click="showReleaseNotes = true; showSettingsMenu = false">
                        <i class="fas fa-file-alt text-purple-500 w-6"></i>
                        <span class="font-bold flex-1" x-text="t('releaseNotes')">S√ºr√ºm Notlarƒ±</span>
                        <i class="fas fa-chevron-right text-[var(--text-sec)]"></i>
                    </div>
                    <a href="https://salih-ozt.github.io/Agrolink-kullan-c-s-zle-mesi-ekran-/" target="_blank" class="settings-item">
                        <i class="fas fa-file-contract text-slate-500 w-6"></i>
                        <span class="font-bold flex-1" x-text="t('termsOfService')">Kullanƒ±m Ko≈üullarƒ±</span>
                        <i class="fas fa-external-link-alt text-[var(--text-sec)]"></i>
                    </a>
                    <a href="https://salih-ozt.github.io/Agrolink-kullan-c-s-zle-mesi-ekran-/" target="_blank" class="settings-item">
                        <i class="fas fa-shield-alt text-slate-500 w-6"></i>
                        <span class="font-bold flex-1" x-text="t('privacyPolicy')">Gizlilik Politikasƒ±</span>
                        <i class="fas fa-external-link-alt text-[var(--text-sec)]"></i>
                    </a>
                </div>
            </div>
            
            <!-- Doƒürulama B√∂l√ºm√º -->
            <div class="agro-card p-4">
                <h4 class="text-sm font-bold text-[var(--text-sec)] mb-3 uppercase tracking-wide" x-text="t('verification')">Doƒürulama</h4>
                <div class="space-y-1">
                    <div class="settings-item" @click="showVerificationModal = true; showSettingsMenu = false">
                        <div class="verified-badge w-6 h-6 flex items-center justify-center"></div>
                        <span class="font-bold flex-1" x-text="t('getVerified')">Doƒürulanmƒ±≈ü Rozet Al</span>
                        <template x-if="user.isVerified">
                            <span class="text-emerald-500 text-xs font-bold" x-text="t('verified') + ' ‚úì'">Doƒürulanmƒ±≈ü ‚úì</span>
                        </template>
                        <template x-if="!user.isVerified">
                            <i class="fas fa-chevron-right text-[var(--text-sec)]"></i>
                        </template>
                    </div>
                </div>
            </div>
            
            <!-- Oturum ve Tehlikeli B√∂l√ºm√º -->
            <div class="agro-card p-4">
                <h4 class="text-sm font-bold text-[var(--text-sec)] mb-3 uppercase tracking-wide" x-text="t('session')">Oturum</h4>
                <div class="space-y-1">
                    <div class="settings-item" @click="logout()">
                        <i class="fas fa-sign-out-alt text-orange-500 w-6"></i>
                        <span class="font-bold flex-1" x-text="t('logout')">√áƒ±kƒ±≈ü Yap</span>
                        <i class="fas fa-chevron-right text-[var(--text-sec)]"></i>
                    </div>
                    <div class="settings-item danger" @click="showDeleteAccount = true; showSettingsMenu = false">
                        <i class="fas fa-trash-alt w-6"></i>
                        <span class="font-bold flex-1" x-text="t('deleteAccount')">Hesabƒ± Sil</span>
                        <i class="fas fa-chevron-right"></i>
                    </div>
                </div>
            </div>
            
            <!-- Bilgiler B√∂l√ºm√º -->
            <div class="agro-card p-4">
                <h4 class="text-sm font-bold text-[var(--text-sec)] mb-3 uppercase tracking-wide" x-text="t('info')">Bilgiler</h4>
                <div class="space-y-1">
                    <div class="settings-item">
                        <i class="fas fa-copyright text-emerald-500 w-6"></i>
                        <span class="font-bold flex-1" x-text="t('allRightsReserved')">2026 T√ºm Haklarƒ± Saklƒ±dƒ±r</span>
                    </div>
                    <div class="settings-item">
                        <i class="fas fa-code text-blue-500 w-6"></i>
                        <span class="text-sm text-[var(--text-sec)] flex-1">Salih √ñzt√ºrk'√ºn √úr√ºn√ºd√ºr</span>
                    </div>
                </div>
            </div>
            
            <!-- Alt bo≈üluk -->
            <div class="h-8"></div>
        </div>
    </div>
    
    <!-- Hesap Ekle Modal -->
    <div x-show="showAddAccountModal" x-transition x-cloak class="fixed inset-0 z-[110] flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/60" @click="showAddAccountModal = false"></div>
        <div class="bg-[var(--bg-card)] w-full max-w-md rounded-[2.5rem] p-6 relative animate-slide-up">
            <div class="text-center mb-6">
                <div class="w-16 h-16 bg-emerald-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-user-plus text-emerald-500 text-2xl"></i>
                </div>
                <h3 class="text-xl font-black text-[var(--text-main)]">Hesap Ekle</h3>
                <p class="text-sm text-[var(--text-sec)] mt-2">Ba≈üka bir AgroLink hesabƒ±nƒ±zla giri≈ü yapƒ±n</p>
            </div>
            <div class="space-y-4">
                <div>
                    <label class="text-xs font-bold text-[var(--text-sec)] mb-1 block">Kullanƒ±cƒ± Adƒ± veya E-posta</label>
                    <input type="text" x-model="addAccountForm.username" class="w-full bg-[var(--input-bg)] border border-[var(--border)] p-4 rounded-2xl text-sm outline-none focus:ring-2 focus:ring-emerald-500 text-[var(--text-main)]" placeholder="Kullanƒ±cƒ± adƒ± veya e-posta">
                </div>
                <div>
                    <label class="text-xs font-bold text-[var(--text-sec)] mb-1 block">≈ûifre</label>
                    <input type="password" x-model="addAccountForm.password" class="w-full bg-[var(--input-bg)] border border-[var(--border)] p-4 rounded-2xl text-sm outline-none focus:ring-2 focus:ring-emerald-500 text-[var(--text-main)]" placeholder="≈ûifre">
                </div>
                <p x-show="addAccountError" class="text-red-500 text-xs font-bold text-center" x-text="addAccountError"></p>
                <button @click="addNewAccount()" :disabled="addAccountLoading || !addAccountForm.username || !addAccountForm.password" class="w-full py-4 bg-gradient-to-r from-emerald-500 to-teal-500 text-white font-black rounded-2xl text-lg disabled:opacity-50 transition hover:shadow-lg">
                    <span x-show="!addAccountLoading">Giri≈ü Yap & Ekle</span>
                    <span x-show="addAccountLoading"><i class="fas fa-spinner fa-spin mr-2"></i>Giri≈ü yapƒ±lƒ±yor...</span>
                </button>
                <button @click="showAddAccountModal = false" class="w-full py-3 text-[var(--text-sec)] font-bold">ƒ∞ptal</button>
            </div>
        </div>
    </div>

    <!-- Hesap Sil Modal - TAM EKRAN -->
    <!-- ========== Gƒ∞ZLƒ∞Lƒ∞K AYARLARI SAYFASI ========== -->
    <div x-show="showPrivacySettings" x-transition x-cloak class="fixed inset-0 z-[105] flex flex-col bg-[var(--bg-main)]" style="overflow-y:auto;">
        <div class="glass px-4 py-4 flex items-center gap-3 sticky top-0 z-10">
            <button @click="showPrivacySettings = false" class="w-10 h-10 rounded-full bg-[var(--input-bg)] flex items-center justify-center hover:bg-[var(--border)] transition">
                <i class="fas fa-arrow-left text-[var(--text-main)]"></i>
            </button>
            <div>
                <h3 class="text-lg font-black">Gizlilik Ayarlarƒ±</h3>
                <p class="text-xs text-[var(--text-sec)]">Profilini ve i√ßeriklerini kim g√∂rebilir?</p>
            </div>
        </div>
        <div class="p-4 space-y-4">
            <!-- Hesap Gizliliƒüi -->
            <div class="agro-card p-4">
                <h4 class="text-sm font-bold text-[var(--text-sec)] mb-3 uppercase tracking-wide"><i class="fas fa-lock mr-2 text-emerald-500"></i>Hesap Gizliliƒüi</h4>
                <div class="space-y-3">
                    <div class="flex items-start gap-3 p-3 rounded-2xl hover:bg-[var(--input-bg)] transition">
                        <div class="flex-1">
                            <p class="font-bold text-sm">Gizli Hesap</p>
                            <p class="text-xs text-[var(--text-sec)] mt-0.5">A√ßƒ±kken sadece onayladƒ±ƒüƒ±n ki≈üiler profilini ve g√∂nderilerini g√∂rebilir</p>
                        </div>
                        <div @click="privacySettings.privateAccount = !privacySettings.privateAccount; savePrivacySettings()" 
                             class="w-12 h-7 rounded-full p-1 cursor-pointer transition-colors flex-shrink-0 mt-0.5"
                             :class="privacySettings.privateAccount ? 'bg-emerald-500' : 'bg-slate-300'">
                            <div class="w-5 h-5 bg-white rounded-full shadow transition-transform" :class="privacySettings.privateAccount ? 'translate-x-5' : ''"></div>
                        </div>
                    </div>
                    <div class="flex items-start gap-3 p-3 rounded-2xl hover:bg-[var(--input-bg)] transition">
                        <div class="flex-1">
                            <p class="font-bold text-sm">Etkinlik Durumunu G√∂ster</p>
                            <p class="text-xs text-[var(--text-sec)] mt-0.5">Diƒüer kullanƒ±cƒ±lar √ßevrimi√ßi olduƒüunu g√∂rebilir</p>
                        </div>
                        <div @click="privacySettings.showActivity = !privacySettings.showActivity; savePrivacySettings()" 
                             class="w-12 h-7 rounded-full p-1 cursor-pointer transition-colors flex-shrink-0 mt-0.5"
                             :class="privacySettings.showActivity ? 'bg-emerald-500' : 'bg-slate-300'">
                            <div class="w-5 h-5 bg-white rounded-full shadow transition-transform" :class="privacySettings.showActivity ? 'translate-x-5' : ''"></div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Mesaj Ayarlarƒ± -->
            <div class="agro-card p-4">
                <h4 class="text-sm font-bold text-[var(--text-sec)] mb-3 uppercase tracking-wide"><i class="fas fa-comment-dots mr-2 text-blue-500"></i>Mesaj Gizliliƒüi</h4>
                <div class="space-y-2">
                    <p class="text-xs text-[var(--text-sec)] mb-2">Sana mesaj g√∂nderebilecekler</p>
                    <template x-for="opt in [{val:'everyone',label:'Herkes',icon:'fa-globe'},{val:'following',label:'Takip ettiklerim',icon:'fa-user-check'},{val:'none',label:'Kimse',icon:'fa-ban'}]" :key="opt.val">
                        <div @click="privacySettings.allowMessagesFrom = opt.val; savePrivacySettings()" 
                             class="flex items-center gap-3 p-3 rounded-2xl cursor-pointer transition hover:bg-[var(--input-bg)]"
                             :class="privacySettings.allowMessagesFrom === opt.val ? 'bg-emerald-50 border border-emerald-200' : ''">
                            <i class="fas w-5 text-center" :class="opt.icon + (privacySettings.allowMessagesFrom === opt.val ? ' text-emerald-500' : ' text-[var(--text-sec)]')"></i>
                            <span class="flex-1 font-medium text-sm" x-text="opt.label"></span>
                            <div x-show="privacySettings.allowMessagesFrom === opt.val" class="w-5 h-5 bg-emerald-500 rounded-full flex items-center justify-center">
                                <i class="fas fa-check text-white text-xs"></i>
                            </div>
                        </div>
                    </template>
                </div>
            </div>
            <!-- Etiket Ayarlarƒ± -->
            <div class="agro-card p-4">
                <h4 class="text-sm font-bold text-[var(--text-sec)] mb-3 uppercase tracking-wide"><i class="fas fa-tag mr-2 text-orange-500"></i>Etiket Gizliliƒüi</h4>
                <div class="space-y-2">
                    <p class="text-xs text-[var(--text-sec)] mb-2">Seni etiketleyebilecekler</p>
                    <template x-for="opt in [{val:'everyone',label:'Herkes',icon:'fa-globe'},{val:'following',label:'Takip ettiklerim',icon:'fa-user-check'},{val:'none',label:'Kimse',icon:'fa-ban'}]" :key="'tag_'+opt.val">
                        <div @click="privacySettings.allowTagsFrom = opt.val; savePrivacySettings()" 
                             class="flex items-center gap-3 p-3 rounded-2xl cursor-pointer transition hover:bg-[var(--input-bg)]"
                             :class="privacySettings.allowTagsFrom === opt.val ? 'bg-emerald-50 border border-emerald-200' : ''">
                            <i class="fas w-5 text-center" :class="opt.icon + (privacySettings.allowTagsFrom === opt.val ? ' text-emerald-500' : ' text-[var(--text-sec)]')"></i>
                            <span class="flex-1 font-medium text-sm" x-text="opt.label"></span>
                            <div x-show="privacySettings.allowTagsFrom === opt.val" class="w-5 h-5 bg-emerald-500 rounded-full flex items-center justify-center">
                                <i class="fas fa-check text-white text-xs"></i>
                            </div>
                        </div>
                    </template>
                </div>
            </div>
            <button @click="savePrivacySettings()" class="w-full py-4 bg-gradient-to-r from-emerald-500 to-teal-500 text-white rounded-2xl font-black text-base shadow-lg hover:shadow-xl transition-all">
                <i class="fas fa-save mr-2"></i>Kaydet
            </button>
        </div>
    </div>

    <!-- ========== Bƒ∞LDƒ∞Rƒ∞M AYARLARI SAYFASI ========== -->
    <div x-show="showNotificationSettings" x-transition x-cloak class="fixed inset-0 z-[105] flex flex-col bg-[var(--bg-main)]" style="overflow-y:auto;">
        <div class="glass px-4 py-4 flex items-center gap-3 sticky top-0 z-10">
            <button @click="showNotificationSettings = false" class="w-10 h-10 rounded-full bg-[var(--input-bg)] flex items-center justify-center hover:bg-[var(--border)] transition">
                <i class="fas fa-arrow-left text-[var(--text-main)]"></i>
            </button>
            <div>
                <h3 class="text-lg font-black">Bildirim Ayarlarƒ±</h3>
                <p class="text-xs text-[var(--text-sec)]">Hangi bildirimler g√∂nderilsin?</p>
            </div>
        </div>
        <div class="p-4 space-y-4">
            <!-- Genel Etkinlikler -->
            <div class="agro-card p-4">
                <h4 class="text-sm font-bold text-[var(--text-sec)] mb-3 uppercase tracking-wide"><i class="fas fa-bell mr-2 text-purple-500"></i>Genel Etkinlikler</h4>
                <div class="space-y-1">
                    <template x-for="item in [
                        {key:'likes', label:'Biri g√∂nderini beƒüendi', icon:'fa-heart', color:'text-red-500'},
                        {key:'replies', label:'Biri g√∂nderine yanƒ±t verdi', icon:'fa-reply', color:'text-blue-500'},
                        {key:'mentions', label:'Biri senden bahsetti', icon:'fa-at', color:'text-purple-500'},
                        {key:'quotes', label:'Biri g√∂nderini alƒ±ntƒ±ladƒ±', icon:'fa-quote-right', color:'text-orange-500'},
                        {key:'reposts', label:'Biri g√∂nderini yeniden payla≈ütƒ±', icon:'fa-retweet', color:'text-emerald-500'},
                        {key:'newFollower', label:'Biri seni takip etti', icon:'fa-user-plus', color:'text-teal-500'},
                        {key:'followRequest', label:'Yeni takip√ßi isteƒüi', icon:'fa-user-clock', color:'text-yellow-500'},
                        {key:'messages', label:'Biri sana mesaj g√∂nderdi', icon:'fa-envelope', color:'text-pink-500'}
                    ]" :key="item.key">
                        <div class="flex items-center gap-3 p-3 rounded-2xl hover:bg-[var(--input-bg)] transition">
                            <i class="fas w-5 text-center" :class="item.icon + ' ' + item.color"></i>
                            <span class="flex-1 text-sm font-medium" x-text="item.label"></span>
                            <div @click="notificationSettings[item.key] = !notificationSettings[item.key]; saveNotificationSettings()" 
                                 class="w-11 h-6 rounded-full p-0.5 cursor-pointer transition-colors"
                                 :class="notificationSettings[item.key] ? 'bg-emerald-500' : 'bg-slate-300'">
                                <div class="w-5 h-5 bg-white rounded-full shadow transition-transform" :class="notificationSettings[item.key] ? 'translate-x-5' : ''"></div>
                            </div>
                        </div>
                    </template>
                </div>
            </div>
            <!-- Kimden Bildirim Gelsin -->
            <div class="agro-card p-4">
                <h4 class="text-sm font-bold text-[var(--text-sec)] mb-3 uppercase tracking-wide"><i class="fas fa-users mr-2 text-blue-500"></i>≈ûu Ki≈üilerden Gelen Bildirimler</h4>
                <div class="space-y-1">
                    <div class="flex items-start gap-3 p-3 rounded-2xl hover:bg-[var(--input-bg)] transition">
                        <div class="flex-1">
                            <p class="font-medium text-sm">Takip etmediƒüin ki≈üiler</p>
                            <p class="text-xs text-[var(--text-sec)] mt-0.5">Takip etmediƒüin ki≈üilerden bildirim al</p>
                        </div>
                        <div @click="notificationSettings.fromNonFollowing = !notificationSettings.fromNonFollowing; saveNotificationSettings()" 
                             class="w-11 h-6 rounded-full p-0.5 cursor-pointer transition-colors flex-shrink-0 mt-0.5"
                             :class="notificationSettings.fromNonFollowing ? 'bg-emerald-500' : 'bg-slate-300'">
                            <div class="w-5 h-5 bg-white rounded-full shadow transition-transform" :class="notificationSettings.fromNonFollowing ? 'translate-x-5' : ''"></div>
                        </div>
                    </div>
                    <div class="flex items-start gap-3 p-3 rounded-2xl hover:bg-[var(--input-bg)] transition">
                        <div class="flex-1">
                            <p class="font-medium text-sm">Seni takip etmeyen ki≈üiler</p>
                            <p class="text-xs text-[var(--text-sec)] mt-0.5">Seni takip etmeyen ki≈üilerden bildirim al</p>
                        </div>
                        <div @click="notificationSettings.fromNonFollowers = !notificationSettings.fromNonFollowers; saveNotificationSettings()" 
                             class="w-11 h-6 rounded-full p-0.5 cursor-pointer transition-colors flex-shrink-0 mt-0.5"
                             :class="notificationSettings.fromNonFollowers ? 'bg-emerald-500' : 'bg-slate-300'">
                            <div class="w-5 h-5 bg-white rounded-full shadow transition-transform" :class="notificationSettings.fromNonFollowers ? 'translate-x-5' : ''"></div>
                        </div>
                    </div>
                </div>
            </div>
            <button @click="saveNotificationSettings()" class="w-full py-4 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-2xl font-black text-base shadow-lg hover:shadow-xl transition-all">
                <i class="fas fa-save mr-2"></i>Kaydet
            </button>
        </div>
    </div>

    <div x-show="showDeleteAccount" x-transition x-cloak class="fixed inset-0 z-[70] flex flex-col bg-[var(--bg-main)]" style="overflow-y:auto;">
        <!-- √úst Bar -->
        <div class="flex items-center justify-between px-5 py-4 border-b border-[var(--border)]">
            <button @click="showDeleteAccount = false; deleteConfirmText = ''; deleteDataConsent = false; deleteAccountPassword = ''" class="w-10 h-10 rounded-full bg-[var(--input-bg)] flex items-center justify-center">
                <i class="fas fa-arrow-left text-[var(--text-main)]"></i>
            </button>
            <h3 class="font-black text-lg text-red-600">Hesabƒ± Sil</h3>
            <div class="w-10"></div>
        </div>

        <div class="flex-1 flex flex-col items-center justify-center px-6 py-8 max-w-md mx-auto w-full">
            <!-- Logo -->
            <img src="agro.png" alt="AgroLink" class="w-24 h-24 object-cover mb-6" style="border-radius: 20px;">

            <!-- Uyarƒ± -->
            <div class="text-center mb-8">
                <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-exclamation-triangle text-red-500 text-2xl"></i>
                </div>
                <h3 class="text-2xl font-black text-red-600 mb-2">Hesabƒ±nƒ±zƒ± Silmek √úzeresiniz</h3>
                <p class="text-sm text-[var(--text-sec)]">Bu i≈ülem geri alƒ±namaz. T√ºm verileriniz, g√∂nderileriniz, mesajlarƒ±nƒ±z ve baƒülantƒ±larƒ±nƒ±z kalƒ±cƒ± olarak silinecektir.</p>
            </div>
            
            <div class="space-y-4 w-full">
                <!-- ≈ûifre -->
                <div>
                    <label class="text-xs font-bold text-[var(--text-sec)] uppercase mb-1 block">≈ûifrenizi Onaylayƒ±n</label>
                    <div class="relative">
                        <input :type="showDeletePassword ? 'text' : 'password'" x-model="deleteAccountPassword" placeholder="≈ûifrenizi girin" class="w-full bg-[var(--input-bg)] p-4 pr-12 rounded-2xl border border-[var(--border)] outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500 transition">
                        <button type="button" @click="showDeletePassword = !showDeletePassword" class="absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600 transition-colors">
                            <i class="fas" :class="showDeletePassword ? 'fa-eye-slash' : 'fa-eye'"></i>
                        </button>
                    </div>
                </div>

                <!-- DELETE yazma alanƒ± -->
                <div>
                    <label class="text-xs font-bold text-[var(--text-sec)] uppercase mb-1 block">Onaylamak i√ßin <span class="text-red-500 font-black">DELETE</span> yazƒ±n</label>
                    <input type="text" x-model="deleteConfirmText" placeholder="DELETE" class="w-full bg-[var(--input-bg)] p-4 rounded-2xl border border-[var(--border)] outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500 transition font-mono tracking-widest text-center text-lg" autocomplete="off">
                    <p x-show="deleteConfirmText && deleteConfirmText !== 'DELETE'" class="text-xs text-red-500 mt-1 font-bold"><i class="fas fa-times-circle mr-1"></i>L√ºtfen b√ºy√ºk harflerle DELETE yazƒ±n</p>
                    <p x-show="deleteConfirmText === 'DELETE'" class="text-xs text-emerald-500 mt-1 font-bold"><i class="fas fa-check-circle mr-1"></i>Onaylandƒ±</p>
                </div>

                <!-- Onay Checkbox -->
                <label class="flex items-start gap-3 p-4 rounded-2xl border border-[var(--border)] bg-red-50 dark:bg-red-900/10 cursor-pointer select-none" :class="deleteDataConsent ? 'border-red-400 bg-red-100 dark:bg-red-900/20' : ''">
                    <input type="checkbox" x-model="deleteDataConsent" class="mt-0.5 w-5 h-5 rounded accent-red-500 flex-shrink-0">
                    <span class="text-sm text-[var(--text-main)] leading-relaxed">
                        <span class="font-bold text-red-600">T√ºm verilerimin kalƒ±cƒ± olarak silineceƒüini</span> anlƒ±yor ve onaylƒ±yorum. Bu i≈ülem geri alƒ±namaz.
                    </span>
                </label>
            </div>
            
            <div class="flex gap-3 mt-8 w-full">
                <button @click="showDeleteAccount = false; deleteConfirmText = ''; deleteDataConsent = false; deleteAccountPassword = ''" class="flex-1 py-4 bg-[var(--input-bg)] rounded-2xl font-bold text-[var(--text-main)] hover:bg-[var(--border)] transition">
                    ƒ∞ptal
                </button>
                <button @click="deleteAccount" 
                        class="flex-1 py-4 bg-red-500 text-white rounded-2xl font-bold transition-all duration-300 disabled:opacity-40 disabled:cursor-not-allowed hover:bg-red-600" 
                        :disabled="loading || deleteConfirmText !== 'DELETE' || !deleteDataConsent || !deleteAccountPassword">
                    <span x-show="!loading">Hesabƒ± Kalƒ±cƒ± Olarak Sil</span>
                    <i x-show="loading" class="fas fa-spinner fa-spin"></i>
                </button>
            </div>
        </div>
    </div>
    
    <!-- Dil Se√ßim Modal -->
    <div x-show="showLanguageModal" x-transition x-cloak class="fixed inset-0 z-[70] flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/60" @click="showLanguageModal = false"></div>
        <div class="bg-[var(--bg-card)] w-full max-w-md rounded-[2.5rem] p-6 relative animate-slide-up max-h-[80vh] overflow-hidden flex flex-col">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-black" x-text="t('selectLanguage')">Dil Se√ßimi</h3>
                <button @click="showLanguageModal = false" class="text-slate-400"><i class="fas fa-times text-xl"></i></button>
            </div>
            
            <div class="flex-1 overflow-y-auto space-y-2">
                <template x-for="lang in availableLanguages" :key="lang.code">
                    <div class="settings-item" @click="setLanguage(lang.code)" :class="currentLanguage === lang.code ? 'bg-emerald-50 dark:bg-emerald-900/20 border-emerald-200' : ''">
                        <span class="text-2xl w-8" x-text="lang.flag"></span>
                        <span class="font-bold flex-1" x-text="lang.name"></span>
                        <template x-if="currentLanguage === lang.code">
                            <i class="fas fa-check text-emerald-500"></i>
                        </template>
                    </div>
                </template>
            </div>
        </div>
    </div>
    
    <!-- ≈ûifre Deƒüi≈ütir Modal -->
    <div x-show="showChangePassword" x-transition x-cloak class="fixed inset-0 z-[70] flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/60" @click="showChangePassword = false"></div>
        <div class="bg-[var(--bg-card)] w-full max-w-md rounded-[2.5rem] p-6 relative animate-slide-up">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-black">≈ûifre Deƒüi≈ütir</h3>
                <button @click="showChangePassword = false" class="text-slate-400"><i class="fas fa-times text-xl"></i></button>
            </div>
            
            <div class="space-y-4">
                <div class="relative">
                    <input :type="showCurrentPassword ? 'text' : 'password'" x-model="passwordForm.currentPassword" placeholder="Mevcut ≈ûifre" class="w-full bg-[var(--input-bg)] p-4 pr-12 rounded-2xl border-none outline-none focus:ring-2 focus:ring-emerald-500">
                    <button type="button" @click="showCurrentPassword = !showCurrentPassword" class="absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600 transition-colors">
                        <i class="fas" :class="showCurrentPassword ? 'fa-eye-slash' : 'fa-eye'"></i>
                    </button>
                </div>
                <div class="relative">
                    <input :type="showNewPassword ? 'text' : 'password'" x-model="passwordForm.newPassword" placeholder="Yeni ≈ûifre (en az 6 karakter)" class="w-full bg-[var(--input-bg)] p-4 pr-12 rounded-2xl border-none outline-none focus:ring-2 focus:ring-emerald-500">
                    <button type="button" @click="showNewPassword = !showNewPassword" class="absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600 transition-colors">
                        <i class="fas" :class="showNewPassword ? 'fa-eye-slash' : 'fa-eye'"></i>
                    </button>
                </div>
                <div class="relative">
                    <input :type="showConfirmPassword ? 'text' : 'password'" x-model="passwordForm.confirmPassword" placeholder="Yeni ≈ûifre Tekrar" class="w-full bg-[var(--input-bg)] p-4 pr-12 rounded-2xl border-none outline-none focus:ring-2 focus:ring-emerald-500">
                    <button type="button" @click="showConfirmPassword = !showConfirmPassword" class="absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600 transition-colors">
                        <i class="fas" :class="showConfirmPassword ? 'fa-eye-slash' : 'fa-eye'"></i>
                    </button>
                </div>
            </div>
            
            <button @click="changePassword" class="w-full mt-6 py-4 btn-agro" :disabled="loading">
                <span x-show="!loading">≈ûifreyi Deƒüi≈ütir</span>
                <i x-show="loading" class="fas fa-spinner fa-spin"></i>
            </button>
        </div>
    </div>

    <!-- G√∂nderi Payla≈ü Modal - TAM EKRAN (Screenshot referansƒ±na g√∂re) -->
    <div x-show="showPostModal" x-transition x-cloak class="fixed inset-0 z-[100] flex flex-col bg-[var(--bg-main)]">
        <!-- Post Header -->
        <div class="glass px-4 py-3 flex items-center justify-between border-b border-[var(--border)]">
            <button @click="showPostModal = false" class="text-slate-500 p-2"><i class="fas fa-times text-xl"></i></button>
            <h3 class="text-lg font-black">Yeni G√∂nderi</h3>
            <button @click="submitPost" class="btn-agro px-5 py-2.5 text-sm" :disabled="loading || isUploading">
                <span x-show="!loading && !isUploading">Payla≈ü</span>
                <i x-show="loading || isUploading" class="fas fa-spinner fa-spin"></i>
            </button>
        </div>
        
        <!-- Post ƒ∞√ßerik - Scrollable -->
        <div class="flex-1 overflow-y-auto no-scrollbar">
            <!-- Kullanƒ±cƒ± Bilgisi -->
            <div class="p-4 flex items-center gap-3">
                <img :src="user.profilePic || 'https://ui-avatars.com/api/?name='+user.name" class="w-12 h-12 rounded-full object-cover border-2 border-emerald-200">
                <div>
                    <p class="font-bold text-sm" x-text="user.username || user.name"></p>
                </div>
            </div>
            
            <!-- Post Tipi Se√ßimi -->
            <div class="px-4 mb-4">
                <div class="flex gap-2">
                    <button @click="postForm.type = 'normal'" class="flex-1 py-2.5 rounded-xl font-bold text-sm transition" :class="postForm.type === 'normal' ? 'bg-emerald-500 text-white' : 'bg-[var(--input-bg)]'">
                        <i class="fas fa-pen mr-2"></i>G√∂nderi
                    </button>
                    <button @click="postForm.type = 'poll'" class="flex-1 py-2.5 rounded-xl font-bold text-sm transition" :class="postForm.type === 'poll' ? 'bg-emerald-500 text-white' : 'bg-[var(--input-bg)]'">
                        <i class="fas fa-poll mr-2"></i>Anket
                    </button>
                </div>
            </div>

            <!-- Normal G√∂nderi -->
            <template x-if="postForm.type === 'normal'">
                <div class="px-4 space-y-4">
                    <!-- Yazƒ± Alanƒ± -->
                    <textarea 
                        x-model="postForm.content" 
                        placeholder="Aklƒ±ndan neler ge√ßiyor? #hashtag @etiket kullanabilirsin..." 
                        rows="6" 
                        class="w-full bg-transparent text-lg placeholder:text-[var(--text-sec)] border-none outline-none resize-none"
                    ></textarea>
                    
                    <!-- √áoklu Medya √ñnizleme Grid -->
                    <div x-show="postForm.mediaFiles.length > 0" class="relative">
                        <div class="multi-media-grid"
                             :class="postForm.mediaFiles.length === 1 ? 'count-1' : postForm.mediaFiles.length === 2 ? 'count-2' : postForm.mediaFiles.length === 3 ? 'count-3' : postForm.mediaFiles.length === 4 ? 'count-4' : 'count-many'">
                            <template x-for="(m, idx) in postForm.mediaFiles" :key="idx">
                                <div class="media-thumb" style="position:relative;">
                                    <template x-if="m.mediaType === 'image'">
                                        <img :src="m.preview" :style="postForm.mediaFiles.length === 1 ? `filter: brightness(${postEditForm.brightness}%) contrast(${postEditForm.contrast}%) saturate(${postEditForm.saturation}%)` : ''">
                                    </template>
                                    <template x-if="m.mediaType === 'video'">
                                        <video :src="m.preview" muted playsinline preload="metadata" class="w-full h-full object-cover"></video>
                                    </template>
                                    <span class="media-thumb-type" x-text="m.mediaType === 'video' ? 'üé¨ Video' : 'üñºÔ∏è Foto'"></span>
                                    <!-- Dosya bazlƒ± y√ºkleme ilerleme g√∂stergesi -->
                                    <template x-if="isUploading && fileProgresses[idx] !== undefined">
                                        <div style="position:absolute;bottom:0;left:0;right:0;background:rgba(0,0,0,0.6);padding:4px 6px;border-radius:0 0 8px 8px;">
                                            <div style="display:flex;align-items:center;gap:4px;">
                                                <div style="flex:1;height:4px;background:rgba(255,255,255,0.3);border-radius:2px;overflow:hidden;">
                                                    <div :style="'width:' + (fileProgresses[idx] || 0) + '%;height:100%;background:' + ((fileProgresses[idx] || 0) >= 100 ? '#10b981' : '#34d399') + ';border-radius:2px;transition:width 0.2s;'"></div>
                                                </div>
                                                <span style="font-size:9px;font-weight:700;color:white;min-width:28px;" x-text="(fileProgresses[idx] || 0) >= 100 ? '‚úì' : (fileProgresses[idx] || 0) + '%'"></span>
                                            </div>
                                        </div>
                                    </template>
                                    <button class="media-thumb-remove" @click.stop="
                                        URL.revokeObjectURL(postForm.mediaFiles[idx].preview);
                                        postForm.mediaFiles.splice(idx, 1);
                                        postForm.previews.splice(idx, 1);
                                        if (postForm.mediaFiles.length > 0) {
                                            postForm.media = postForm.mediaFiles[0].file;
                                            postForm.preview = postForm.mediaFiles[0].preview;
                                            postForm.mediaType = postForm.mediaFiles[0].mediaType;
                                        } else {
                                            postForm.media = null; postForm.preview = ''; postForm.mediaType = null;
                                        }
                                    "><i class="fas fa-times" style="font-size:9px;"></i></button>
                                </div>
                            </template>
                            <!-- Daha fazla ekle -->
                            <label x-show="postForm.mediaFiles.length > 0 && postForm.mediaFiles.length < 10" class="add-more-btn">
                                <i class="fas fa-plus text-xl"></i>
                                <span>Ekle</span>
                                <input type="file" class="hidden" @change="handlePostMedia" accept="image/*,video/*" multiple>
                            </label>
                        </div>
                        <!-- Filtreler (tek resim ise) -->
                        <template x-if="postForm.mediaFiles.length === 1 && postForm.mediaFiles[0]?.mediaType === 'image'">
                            <div class="absolute bottom-0 left-0 right-0 bg-black/70 backdrop-blur p-3 rounded-b-2xl">
                                <div class="flex items-center justify-around">
                                    <button @click="postEditForm.filter='none';postEditForm.brightness=100;postEditForm.contrast=100;postEditForm.saturation=100" class="flex flex-col items-center gap-1" :class="postEditForm.filter==='none'?'text-emerald-400':'text-white'"><i class="fas fa-sun"></i><span class="text-[10px]">Orijinal</span></button>
                                    <button @click="postEditForm.filter='vintage';postEditForm.brightness=110;postEditForm.contrast=90;postEditForm.saturation=80" class="flex flex-col items-center gap-1" :class="postEditForm.filter==='vintage'?'text-emerald-400':'text-white'"><i class="fas fa-history"></i><span class="text-[10px]">Vintage</span></button>
                                    <button @click="postEditForm.filter='bright';postEditForm.brightness=130;postEditForm.contrast=110;postEditForm.saturation=120" class="flex flex-col items-center gap-1" :class="postEditForm.filter==='bright'?'text-emerald-400':'text-white'"><i class="fas fa-lightbulb"></i><span class="text-[10px]">Parlak</span></button>
                                    <button @click="postEditForm.filter='dark';postEditForm.brightness=70;postEditForm.contrast=120;postEditForm.saturation=90" class="flex flex-col items-center gap-1" :class="postEditForm.filter==='dark'?'text-emerald-400':'text-white'"><i class="fas fa-moon"></i><span class="text-[10px]">Karanlƒ±k</span></button>
                                    <button @click="postEditForm.filter='bw';postEditForm.saturation=0" class="flex flex-col items-center gap-1" :class="postEditForm.filter==='bw'?'text-emerald-400':'text-white'"><i class="fas fa-tint-slash"></i><span class="text-[10px]">S/B</span></button>
                                </div>
                                <div class="mt-3 space-y-2">
                                    <div class="flex items-center gap-2"><i class="fas fa-sun text-white text-xs w-4"></i><input type="range" min="50" max="150" x-model="postEditForm.brightness" class="flex-1 h-1 bg-white/30 rounded-lg appearance-none"></div>
                                    <div class="flex items-center gap-2"><i class="fas fa-adjust text-white text-xs w-4"></i><input type="range" min="50" max="150" x-model="postEditForm.contrast" class="flex-1 h-1 bg-white/30 rounded-lg appearance-none"></div>
                                </div>
                            </div>
                        </template>
                    </div>
                    
                    <!-- Tekli medya (eski uyumluluk - mediaFiles bo≈üsa) -->
                    <div x-show="postForm.preview && postForm.mediaFiles.length === 0" class="relative">
                        <template x-if="postForm.mediaType === 'image'">
                            <div class="relative">
                                <img :src="postForm.preview" class="w-full max-h-80 object-cover rounded-2xl" :style="`filter: brightness(${postEditForm.brightness}%) contrast(${postEditForm.contrast}%) saturate(${postEditForm.saturation}%)`">
                                <button @click="postForm.media=null;postForm.preview='';postForm.mediaType=null" class="absolute top-3 right-3 w-10 h-10 bg-black/60 text-white rounded-full flex items-center justify-center z-10"><i class="fas fa-times"></i></button>
                            </div>
                        </template>
                        <template x-if="postForm.mediaType === 'video'">
                            <div class="relative">
                                <video :src="postForm.preview" class="w-full max-h-80 object-cover rounded-2xl" controls playsinline preload="metadata"></video>
                                <button @click="postForm.media=null;postForm.preview='';postForm.mediaType=null" class="absolute top-3 right-3 w-10 h-10 bg-black/60 text-white rounded-full flex items-center justify-center z-10"><i class="fas fa-times"></i></button>
                            </div>
                        </template>
                    </div>
                    
                    <!-- Konum Ekleme -->
                    <div class="agro-card p-4" @click="postForm.showLocation = !postForm.showLocation">
                        <div class="flex items-center gap-3">
                            <i class="fas fa-map-marker-alt text-[var(--text-sec)]"></i>
                            <input 
                                x-show="postForm.showLocation" 
                                x-model="postForm.locationName" 
                                type="text" 
                                placeholder="Konum ekle..." 
                                @click.stop
                                class="flex-1 bg-transparent outline-none text-sm"
                            >
                            <span x-show="!postForm.showLocation" class="flex-1 text-sm text-[var(--text-sec)]">Konum ekle...</span>
                        </div>
                    </div>
                </div>
            </template>

            <!-- Anket - Media EKLENEMEZ (Sadece soru ve ≈üƒ±klar) -->
            <template x-if="postForm.type === 'poll'">
                <div class="px-4 space-y-4">
                    <div class="bg-emerald-50 p-4 rounded-2xl mb-4">
                        <p class="text-emerald-700 text-sm font-medium">
                            <i class="fas fa-info-circle mr-2"></i>
                            Anketlerde sadece soru ve ≈üƒ±klar olur, media eklenemez.
                        </p>
                    </div>
                    
                    <input type="text" x-model="postForm.pollQuestion" placeholder="Anket sorunuz nedir?" class="w-full bg-[var(--input-bg)] p-4 rounded-2xl border-none outline-none focus:ring-2 focus:ring-emerald-500 font-bold text-lg">
                    
                    <template x-for="(opt, idx) in postForm.pollOptions" :key="idx">
                        <div class="flex gap-2">
                            <input type="text" x-model="postForm.pollOptions[idx]" :placeholder="'Se√ßenek ' + (idx + 1)" class="flex-1 bg-[var(--input-bg)] border-none rounded-xl p-4 outline-none focus:ring-2 focus:ring-emerald-500">
                            <button x-show="postForm.pollOptions.length > 2" @click="postForm.pollOptions.splice(idx, 1)" class="text-red-500 px-4">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </template>
                    
                    <button x-show="postForm.pollOptions.length < 4" @click="postForm.pollOptions.push('')" class="w-full py-3 border-2 border-dashed border-emerald-300 rounded-xl text-emerald-600 font-bold">
                        <i class="fas fa-plus mr-2"></i>Se√ßenek Ekle
                    </button>
                </div>
            </template>
            
            <!-- Y√ºkleme Progress Bar -->
            <div x-show="isUploading" class="px-4 py-6">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-sm font-bold text-emerald-600">Y√ºkleniyor...</span>
                    <span class="text-sm font-black text-emerald-600" x-text="uploadProgress + '%'"></span>
                </div>
                <div class="w-full h-3 bg-[var(--input-bg)] rounded-full overflow-hidden">
                    <div class="h-full bg-gradient-to-r from-emerald-400 to-emerald-600 rounded-full transition-all duration-300 ease-out" :style="'width: ' + uploadProgress + '%'"></div>
                </div>
                <p class="text-xs text-center text-slate-400 mt-2" x-show="uploadProgress < 100">L√ºtfen bekleyin, dosyanƒ±z i≈üleniyor...</p>
                <p class="text-xs text-center text-emerald-500 mt-2" x-show="uploadProgress === 100"><i class="fas fa-check-circle mr-1"></i>Tamamlandƒ±!</p>
            </div>
        </div>
        
        <!-- Yorumlara Kapatma Toggle -->
        <div class="px-4 py-3 border-t border-[var(--border)]" x-show="postForm.type === 'normal'">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <i class="fas fa-comment-slash text-[var(--text-sec)]"></i>
                    <span class="text-sm font-bold text-[var(--text-main)]">Yorumlarƒ± Kapat</span>
                </div>
                <div @click="postForm.commentsDisabled = !postForm.commentsDisabled" 
                     class="w-12 h-7 rounded-full p-1 cursor-pointer transition-all duration-300"
                     :class="postForm.commentsDisabled ? 'bg-red-500' : 'bg-slate-300'">
                    <div class="w-5 h-5 bg-white rounded-full shadow-lg transition-transform duration-300" 
                         :class="postForm.commentsDisabled ? 'translate-x-5' : 'translate-x-0'"></div>
                </div>
            </div>
            <p class="text-[10px] text-[var(--text-sec)] mt-1" x-show="postForm.commentsDisabled">
                <i class="fas fa-info-circle mr-1"></i>Bu g√∂nderiye kimse yorum yapamayacak
            </p>
        </div>
        
        <!-- Alt Toolbar - Sabit (Anket modunda gizli) -->
        <div class="glass border-t border-[var(--border)] px-4 py-4" x-show="postForm.type === 'normal'">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <label class="flex items-center gap-2 px-3 py-2.5 text-emerald-600 cursor-pointer rounded-xl hover:bg-emerald-50 transition">
                        <i class="fas fa-image text-lg"></i>
                        <span class="text-xs font-bold">Galeri</span>
                        <input type="file" class="hidden" @change="handlePostMedia" accept="image/*,video/*" multiple>
                    </label>
                    <label class="flex items-center gap-2 px-3 py-2.5 text-emerald-600 cursor-pointer rounded-xl hover:bg-emerald-50 transition">
                        <i class="fas fa-video text-lg"></i>
                        <span class="text-xs font-bold">Video</span>
                        <input type="file" class="hidden" @change="handlePostMedia" accept="video/*" multiple>
                    </label>
                    <button @click="openCameraCapture()" class="flex items-center gap-2 px-3 py-2.5 text-blue-600 rounded-xl hover:bg-blue-50 transition">
                        <i class="fas fa-camera text-lg"></i>
                        <span class="text-xs font-bold">Kamera</span>
                    </button>
                </div>
                <div class="flex items-center gap-3">
                    <button class="text-[var(--text-sec)]"><i class="fas fa-hashtag text-lg"></i></button>
                    <button class="text-[var(--text-sec)]"><i class="fas fa-at text-lg"></i></button>
                    <button class="text-[var(--text-sec)]"><i class="far fa-smile text-lg"></i></button>
                </div>
            </div>
        </div>
    </div>

    <!-- Yorumlar Modal -->
    <div x-show="showCommentModal"
         x-transition:enter="transition ease-out duration-250"
         x-transition:enter-start="opacity-0 translate-y-full"
         x-transition:enter-end="opacity-100 translate-y-0"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="opacity-100 translate-y-0"
         x-transition:leave-end="opacity-0 translate-y-full"
         x-cloak class="fixed inset-0 z-[300] flex flex-col bg-[var(--bg-main)]">
        <!-- Header -->
        <div class="flex items-center gap-3 px-4 py-4 flex-shrink-0 border-b border-[var(--border)]" style="background:var(--bg-card);">
            <button @click="showCommentModal = false" class="w-9 h-9 flex items-center justify-center rounded-xl hover:bg-[var(--input-bg)] transition text-[var(--text-sec)]">
                <i class="fas fa-arrow-left text-lg"></i>
            </button>
            <div class="flex-1">
                <h3 class="font-black text-base">Yorumlar</h3>
                <p class="text-xs text-[var(--text-sec)]" x-text="activeComments.length + ' yorum'"></p>
            </div>
        </div>
        <div class="bg-[var(--bg-card)] flex-1 flex flex-col overflow-hidden">
            <div class="flex-1 overflow-y-auto space-y-4 no-scrollbar p-4">
                <template x-if="activeComments.length === 0">
                    <div class="text-center text-slate-400 py-8">
                        <i class="far fa-comment text-4xl mb-2"></i>
                        <p>Hen√ºz yorum yok</p>
                    </div>
                </template>
                
                <template x-for="c in activeComments" :key="c.id">
                    <div class="flex gap-3 group" @dblclick="likeComment(c)">
                        <img :src="c.profilePic || c.userProfilePic || 'https://ui-avatars.com/api/?name='+(c.name || c.userName)" class="w-9 h-9 rounded-full flex-shrink-0 object-cover cursor-pointer border-2 border-[var(--border)] shadow-sm" @click="viewProfile(c.userId)">
                        <div class="bg-[var(--bg-card)] border border-[var(--border)] p-3.5 rounded-2xl rounded-tl-sm flex-1 relative shadow-sm">
                            <!-- Kalp Atma Animasyonu -->
                            <div x-show="showHeartAnimation === c.id" 
                                 class="heart-animation"
                                 style="font-size: 50px;"
                                 :class="showHeartAnimation === c.id ? 'animate' : ''">
                                <i class="fas fa-heart"></i>
                            </div>
                            
                            <div class="flex items-center gap-2">
                                <p class="text-xs font-black text-emerald-600 cursor-pointer hover:underline" @click="viewProfile(c.userId)" x-text="c.name || c.userName"></p>
                                <span class="text-[9px] text-slate-400" x-text="formatDate(c.createdAt)"></span>
                            </div>
                            <p class="text-sm font-medium mt-1" x-text="c.content"></p>
                            
                            <!-- Yorum Beƒüenme -->
                            <div class="flex items-center gap-3 mt-2">
                                <button @click="likeComment(c)" 
                                        class="flex items-center gap-1 text-xs"
                                        :class="c.isLiked ? 'text-red-500' : 'text-slate-400'">
                                    <i :class="c.isLiked ? 'fas fa-heart' : 'far fa-heart'"></i>
                                    <span x-text="c.likeCount || 0"></span>
                                </button>
                            </div>
                            
                            <!-- Yorum Silme (sadece kendi yorumlarƒ±) -->
                            <button x-show="c.userId === user.id" @click="deleteComment(c)" class="absolute top-2 right-2 text-red-400 opacity-0 group-hover:opacity-100 transition">
                                <i class="fas fa-trash text-xs"></i>
                            </button>
                        </div>
                    </div>
                </template>
            </div>

            <div class="pt-3 px-4 pb-4 border-t border-[var(--border)] flex-shrink-0" style="background:var(--bg-card);">
                <!-- Yanƒ±tlanan yorum bilgisi -->
                <div x-show="replyingToComment" class="mb-2 p-2 bg-emerald-50 dark:bg-emerald-900/20 rounded-xl flex items-center gap-2">
                    <div class="flex-1">
                        <span class="text-xs text-emerald-600 font-medium">
                            <i class="fas fa-reply mr-1"></i>
                            <span x-text="replyingToComment?.name || replyingToComment?.userName"></span> yanƒ±tlanƒ±yor
                        </span>
                    </div>
                    <button @click="cancelReply()" class="text-slate-400 hover:text-red-500">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="flex gap-2">
                    <input type="text"
                           x-model="commentInput"
                           @keyup.enter="submitComment"
                           :placeholder="replyingToComment ? 'Yanƒ±tƒ±nƒ± yaz...' : 'Yorum ekle...'"
                           class="flex-1 bg-[var(--input-bg)] text-[var(--text-main)] border border-[var(--border)] rounded-2xl px-4 py-3 text-sm font-medium outline-none focus:ring-2 focus:ring-emerald-500 placeholder:text-[var(--text-sec)]">
                    <button @click="submitComment" class="w-12 h-12 rounded-2xl flex items-center justify-center flex-shrink-0 transition active:scale-90 disabled:opacity-40"
                            style="background:linear-gradient(135deg,#00b894,#0984e3);"
                            :disabled="!commentInput.trim()">
                        <i class="fas fa-paper-plane text-white"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Profil D√ºzenle Modal -->
    <!-- Profili D√ºzenle Modal - Tam Ekran -->
    <div x-show="showEditModal" x-transition x-cloak class="fixed inset-0 z-[100] flex flex-col bg-[var(--bg-main)]">
        <div class="glass px-4 py-4 flex items-center justify-between border-b border-[var(--border)]">
            <button @click="showEditModal = false" class="text-slate-500 p-2"><i class="fas fa-arrow-left text-xl"></i></button>
            <h3 class="text-lg font-black">Profili D√ºzenle</h3>
            <button @click="updateProfile" class="btn-agro px-5 py-2 text-sm" :disabled="loading">
                <span x-show="!loading">Kaydet</span>
                <i x-show="loading" class="fas fa-spinner fa-spin"></i>
            </button>
        </div>
        
        <div class="flex-1 overflow-y-auto no-scrollbar p-4">
            
            <!-- Arka Plan Resmi -->
            <div class="relative mb-6">
                <label class="cursor-pointer block">
                    <div class="w-full h-24 bg-gradient-to-r from-emerald-400 to-teal-500 rounded-2xl overflow-hidden relative">
                        <template x-if="editForm.coverPicPreview || user.coverPic">
                            <img :src="editForm.coverPicPreview || user.coverPic" class="w-full h-full object-cover">
                        </template>
                        <div class="absolute inset-0 bg-black/30 flex items-center justify-center opacity-0 hover:opacity-100 transition">
                            <i class="fas fa-camera text-white text-xl"></i>
                        </div>
                    </div>
                    <input type="file" class="hidden" @change="previewEditCover" accept="image/*">
                </label>
                <p class="text-[10px] text-center text-slate-400 mt-1">Arka plan resmi</p>
            </div>
            
            <!-- Profil Fotoƒürafƒ± -->
            <div class="flex flex-col items-center gap-2 mb-6">
                <label class="relative cursor-pointer group">
                    <img :src="editForm.profilePic || user.profilePic || 'https://ui-avatars.com/api/?name='+user.name" class="w-24 h-24 rounded-[2rem] object-cover border-4 border-emerald-200">
                    <div class="absolute inset-0 bg-black/40 rounded-[2rem] flex items-center justify-center opacity-0 group-hover:opacity-100 transition">
                        <i class="fas fa-camera text-white text-xl"></i>
                    </div>
                    <input type="file" class="hidden" @change="previewEditAvatar" accept="image/*">
                </label>
                <!-- Profil Resmini Kaldƒ±r Butonu -->
                <button x-show="user.profilePic || editForm.profilePic" 
                        @click="removeProfilePic()" 
                        class="mt-2 px-4 py-2 bg-red-50 text-red-600 rounded-full text-xs font-bold hover:bg-red-100 transition flex items-center gap-2">
                    <i class="fas fa-trash-alt"></i>
                    Profil Resmini Kaldƒ±r
                </button>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="text-xs font-bold text-slate-500 mb-1 block">Ad Soyad</label>
                    <input type="text" x-model="editForm.name" class="w-full bg-[var(--input-bg)] p-4 rounded-2xl border-none outline-none focus:ring-2 focus:ring-emerald-500">
                </div>
                <div>
                    <label class="text-xs font-bold text-slate-500 mb-1 block">E-posta</label>
                    <input type="email" x-model="editForm.email" placeholder="E-posta adresiniz" class="w-full bg-[var(--input-bg)] p-4 rounded-2xl border-none outline-none focus:ring-2 focus:ring-emerald-500">
                </div>
                <div>
                    <label class="text-xs font-bold text-slate-500 mb-1 block">Hesap Tipi</label>
                    <select x-model="editForm.userType" class="w-full bg-[var(--input-bg)] p-4 rounded-2xl border-none outline-none focus:ring-2 focus:ring-emerald-500">
                        <option value="">Hesap tipi se√ßin</option>
                        <option value="tarim_ogretmeni">üåæ Tarƒ±m √ñƒüretmeni</option>
                        <option value="tarim_ogrencisi">üéì Tarƒ±m √ñƒürencisi</option>
                        <option value="ogretmen">üìö √ñƒüretmen</option>
                        <option value="ziraat_muhendisi">üî¨ Ziraat M√ºhendisi</option>
                        <option value="normal_kullanici">üë§ Normal Kullanƒ±cƒ±</option>
                        <option value="ciftci_hayvancilik">üêÑ √áift√ßi & Hayvancƒ±lƒ±k</option>
                    </select>
                </div>
                <div>
                    <label class="text-xs font-bold text-slate-500 mb-1 block">Biyografi</label>
                    <textarea x-model="editForm.bio" rows="3" maxlength="200" @input="if(editForm.bio.length > 200) editForm.bio = editForm.bio.slice(0,200)" class="w-full bg-[var(--input-bg)] p-4 rounded-2xl border-none outline-none focus:ring-2 focus:ring-emerald-500 resize-none"></textarea>
                    <p class="text-xs text-right mt-1" :class="(editForm.bio||'').length >= 190 ? 'text-red-500' : 'text-[var(--text-sec)]'" x-text="(editForm.bio||'').length + '/200 karakter'"></p>
                </div>
                <div>
                    <label class="text-xs font-bold text-slate-500 mb-1 block">Konum</label>
                    <input type="text" x-model="editForm.location" placeholder="≈ûehir, √úlke" class="w-full bg-[var(--input-bg)] p-4 rounded-2xl border-none outline-none focus:ring-2 focus:ring-emerald-500">
                </div>
                <div>
                    <label class="text-xs font-bold text-slate-500 mb-1 block">Website</label>
                    <input type="url" x-model="editForm.website" placeholder="https://" class="w-full bg-[var(--input-bg)] p-4 rounded-2xl border-none outline-none focus:ring-2 focus:ring-emerald-500">
                </div>
            </div>
            
            <button @click="updateProfile" class="w-full mt-6 py-4 btn-agro" :disabled="loading">
                <span x-show="!loading">Kaydet</span>
                <i x-show="loading" class="fas fa-spinner fa-spin"></i>
            </button>
        </div>
    </div>

    <!-- √úr√ºn Ekle Modal -->
    <div x-show="showAddProduct" x-transition x-cloak class="fixed inset-0 z-[60] flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/60" @click="showAddProduct = false"></div>
        <div class="bg-[var(--bg-card)] w-full max-w-md rounded-[2.5rem] p-6 relative animate-slide-up max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-black">√úr√ºn Ekle</h3>
                <button @click="showAddProduct = false" class="text-slate-400"><i class="fas fa-times text-xl"></i></button>
            </div>
            
            <!-- √úr√ºn Fotoƒüraflarƒ± (√áoklu) -->
            <div class="mb-6">
                <label class="text-xs font-bold text-slate-500 mb-2 block">√úr√ºn Fotoƒüraflarƒ± (En fazla 5)</label>
                <div class="grid grid-cols-3 gap-2">
                    <!-- Mevcut Fotoƒüraflar -->
                    <template x-for="(img, index) in productForm.images" :key="index">
                        <div class="relative aspect-square bg-[var(--input-bg)] rounded-xl overflow-hidden">
                            <img :src="img.preview" class="w-full h-full object-cover">
                            <button @click="removeProductImage(index)" class="absolute top-1 right-1 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center text-xs">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </template>
                    <!-- Yeni Fotoƒüraf Ekle Butonu -->
                    <label x-show="productForm.images.length < 5" class="cursor-pointer aspect-square bg-[var(--input-bg)] rounded-xl flex flex-col items-center justify-center border-2 border-dashed border-slate-300 hover:border-emerald-500 transition">
                        <i class="fas fa-plus text-2xl text-slate-400"></i>
                        <span class="text-[10px] text-slate-400 mt-1">Ekle</span>
                        <input type="file" class="hidden" @change="handleProductImage" accept="image/*" multiple>
                    </label>
                </div>
            </div>
            
            <div class="space-y-4">
                <input type="text" x-model="productForm.name" placeholder="√úr√ºn Adƒ±" class="w-full bg-[var(--input-bg)] p-4 rounded-2xl border-none outline-none focus:ring-2 focus:ring-emerald-500">
                <input type="number" x-model="productForm.price" placeholder="Fiyat (‚Ç∫)" class="w-full bg-[var(--input-bg)] p-4 rounded-2xl border-none outline-none focus:ring-2 focus:ring-emerald-500">
                <textarea x-model="productForm.description" placeholder="A√ßƒ±klama" rows="3" class="w-full bg-[var(--input-bg)] p-4 rounded-2xl border-none outline-none focus:ring-2 focus:ring-emerald-500 resize-none"></textarea>
            </div>
            
            <button @click="addProduct" class="w-full mt-6 py-4 btn-agro" :disabled="loading">
                <span x-show="!loading">ƒ∞lan Ver</span>
                <i x-show="loading" class="fas fa-spinner fa-spin"></i>
            </button>
        </div>
    </div>

    <!-- Chat Modal (Canlƒ± Sohbet) -->
    <div x-show="showChatModal" x-transition x-cloak class="fixed inset-0 z-[80] flex flex-col bg-[var(--bg-main)]">
        <!-- Chat Header - Profesyonel Tasarƒ±m -->
        <div class="chat-header-pro">
            <button @click="showChatModal = false" class="w-10 h-10 rounded-full bg-[var(--input-bg)] flex items-center justify-center text-[var(--text-main)] hover:bg-[var(--border)] transition">
                <i class="fas fa-arrow-left"></i>
            </button>
            <div class="relative cursor-pointer" @click="viewProfile(activeChat.otherId)">
                <img :src="activeChat.profilePic || 'https://ui-avatars.com/api/?name='+activeChat.name" class="w-11 h-11 rounded-full object-cover border-2 border-emerald-200">
                <div x-show="activeChat.isOnline" class="absolute bottom-0 right-0 w-3.5 h-3.5 bg-emerald-500 rounded-full border-2 border-[var(--bg-card)]"></div>
            </div>
            <div class="chat-header-info">
                <h4 class="chat-header-name" x-text="activeChat.name"></h4>
                <div x-show="activeChat.isOnline" class="chat-header-status">√áevrimi√ßi</div>
                <p x-show="!activeChat.isOnline" class="text-xs text-[var(--text-sec)]">√áevrimdƒ±≈üƒ±</p>
            </div>
            <button @click="initiateAudioCall(activeChat.otherId)" class="chat-action-btn audio-btn" title="Sesli Ara">
                <i class="fas fa-phone"></i>
            </button>
            <button @click="initiateVideoCall(activeChat.otherId)" class="chat-action-btn video-btn" title="G√∂r√ºnt√ºl√º Ara">
                <i class="fas fa-video"></i>
            </button>
        </div>
        
        <!-- Chat Messages - WhatsApp Tarzƒ± -->
        <div class="flex-1 overflow-y-auto p-4 space-y-4 no-scrollbar" id="chatMessages" x-init="markMessagesAsRead(activeChat.otherId)">
            <template x-for="msg in chatMessages" :key="msg.id">
                <div class="flex flex-col" :class="msg.senderId === user.id ? 'items-end' : 'items-start'">
                    <!-- WhatsApp Tarzƒ±: G√∂nderen Bilgisi ve Profil Resmi - D√ºzeltilmi≈ü -->
                    <div class="flex items-center gap-2 mb-1" :class="msg.senderId === user.id ? 'flex-row-reverse' : 'flex-row'">
                        <img :src="msg.senderId === user.id 
                                    ? (user.profilePic || 'https://ui-avatars.com/api/?name='+encodeURIComponent(user.name || 'User')) 
                                    : (msg.senderProfilePic || activeChat.profilePic || 'https://ui-avatars.com/api/?name='+encodeURIComponent(msg.senderName || activeChat.name || 'User'))" 
                             class="w-6 h-6 rounded-full object-cover border border-[var(--border)]">
                        <span class="text-xs text-[var(--text-sec)] font-medium" 
                              x-text="msg.senderId === user.id ? 'Sen' : (msg.senderName || activeChat.name || 'Kullanƒ±cƒ±')"></span>
                    </div>
                    
                    <div class="flex" :class="msg.senderId === user.id ? 'justify-end' : 'justify-start'">
                        <!-- Silinmi≈ü Mesaj -->
                        <template x-if="msg.isDeleted">
                            <div class="max-w-[75%] p-3 rounded-2xl bg-[var(--input-bg)] italic text-[var(--text-sec)] text-sm">
                                <i class="fas fa-ban mr-1"></i> Bu mesaj silindi
                            </div>
                        </template>
                        <!-- Normal Mesaj -->
                        <template x-if="!msg.isDeleted">
                            <div class="max-w-[75%] p-3 relative group" :class="msg.senderId === user.id ? 'chat-bubble-sent' : 'chat-bubble-received'">
                                <!-- Payla≈üƒ±lan Post - √áer√ßeveli ve Tƒ±klanabilir -->
                                <template x-if="msg.messageType === 'shared_post' && msg.sharedPost">
                                    <div @click="openSharedPost(msg.sharedPost.id)" 
                                         class="mb-2 rounded-xl overflow-hidden border border-white/20 bg-gradient-to-br from-emerald-500/20 to-teal-500/20 cursor-pointer hover:scale-[1.02] transition-transform">
                                        <!-- Post Ba≈ülƒ±ƒüƒ± -->
                                        <div class="p-2 flex items-center gap-2 border-b border-white/10">
                                            <img :src="msg.sharedPost.profilePic || 'https://ui-avatars.com/api/?name='+(msg.sharedPost.userName || 'User')" 
                                                 class="w-6 h-6 rounded-full object-cover">
                                            <p class="text-xs font-bold" x-text="msg.sharedPost.userName || 'Kullanƒ±cƒ±'"></p>
                                            <i class="fas fa-external-link-alt ml-auto text-xs opacity-60"></i>
                                        </div>
                                        <!-- Post ƒ∞√ßeriƒüi -->
                                        <div class="p-2">
                                            <template x-if="msg.sharedPost.mediaUrl">
                                                <img :src="msg.sharedPost.mediaUrl" 
                                                     class="w-full h-32 object-cover rounded-lg mb-2">
                                            </template>
                                            <p class="text-xs opacity-90 line-clamp-2" x-text="msg.sharedPost.content?.substring(0, 100) || 'G√∂nderiyi g√∂r√ºnt√ºlemek i√ßin tƒ±klayƒ±n'"></p>
                                        </div>
                                        <!-- Post Footer -->
                                        <div class="px-2 pb-2 flex items-center gap-3 text-[10px] opacity-70">
                                            <span><i class="fas fa-heart mr-1"></i><span x-text="msg.sharedPost.likeCount || 0"></span></span>
                                            <span><i class="fas fa-comment mr-1"></i><span x-text="msg.sharedPost.commentCount || 0"></span></span>
                                        </div>
                                    </div>
                                </template>
                                <!-- Sesli Mesaj -->
                                <template x-if="msg.type === 'voice'">
                                    <div class="flex items-center gap-2">
                                        <button @click="playVoiceMessage(msg)" class="w-8 h-8 rounded-full bg-white/20 flex items-center justify-center">
                                            <i class="fas" :class="msg.isPlaying ? 'fa-pause' : 'fa-play'"></i>
                                        </button>
                                        <div class="flex-1 h-1 bg-white/30 rounded-full">
                                            <div class="h-1 bg-white rounded-full" style="width: 0%"></div>
                                        </div>
                                        <span class="text-xs" x-text="msg.duration || '0:00'"></span>
                                    </div>
                                </template>
                                <!-- G√∂rsel Mesaj - D√ºzeltilmi≈ü URL Kontrol√º -->
                                <template x-if="msg.type === 'image' || (msg.content && (msg.content.startsWith('/uploads/') || msg.content.startsWith('http')))">
                                    <div class="relative">
                                        <img :src="getMessageImageUrl(msg)" 
                                             class="max-w-full max-h-64 rounded-lg cursor-pointer object-cover" 
                                             @click="openFullScreen(getMessageImageUrl(msg), 'image')"
                                             @error="handleMessageImageError($event, msg)"
                                             loading="lazy">
                                        <template x-if="msg.isUploading">
                                            <div class="absolute inset-0 bg-black/50 flex items-center justify-center rounded-lg">
                                                <i class="fas fa-spinner fa-spin text-white"></i>
                                            </div>
                                        </template>
                                    </div>
                                </template>
                                <!-- Video Mesaj -->
                                <template x-if="msg.type === 'video' || (msg.mediaType === 'video' && msg.mediaUrl)">
                                    <div class="relative">
                                        <video x-init="$nextTick(()=>initAgroHLS($el, msg.mediaUrl || msg.content))"
                                               class="max-w-full max-h-64 rounded-lg" 
                                               controls 
                                               preload="none"
                                               @error="console.log('Video y√ºklenemedi:', msg.mediaUrl || msg.content)">
                                        </video>
                                    </div>
                                </template>
                                <!-- Normal Mesaj (medya deƒüilse ve URL deƒüilse) -->
                                <template x-if="msg.type !== 'voice' && msg.type !== 'image' && msg.type !== 'video' && !msg.mediaUrl && msg.messageType !== 'shared_post' && !isImageUrl(msg.content)">
                                    <p class="text-sm whitespace-pre-wrap" x-html="formatMessageContent(msg.content)"></p>
                                </template>
                                <template x-if="msg.messageType === 'shared_post' && msg.content">
                                    <p class="text-sm" x-html="formatMessageContent(msg.content)"></p>
                                </template>
                                <!-- Saat ve Okundu Durumu -->
                                <div class="flex items-center justify-end gap-1 mt-1">
                                    <span class="text-[9px] opacity-70" x-text="formatTime(msg.createdAt)"></span>
                                    <!-- WhatsApp tarzƒ± okundu bilgisi (sadece g√∂nderen i√ßin) -->
                                    <template x-if="msg.senderId === user.id">
                                        <span class="message-status">
                                            <i class="fas fa-check check" :class="msg.readAt ? 'read' : ''"></i>
                                            <i class="fas fa-check check" :class="msg.readAt ? 'read' : ''" style="margin-left: -6px;"></i>
                                        </span>
                                    </template>
                                </div>
                                <!-- Mesaj Silme Butonu (sadece g√∂nderen i√ßin) -->
                                <button x-show="msg.senderId === user.id" @click="deleteMessage(msg)" class="absolute -top-2 -right-2 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition text-xs">
                                    <i class="fas fa-trash text-[10px]"></i>
                                </button>
                            </div>
                        </template>
                    </div>
                </div>
            </template>
        </div>
        
        <!-- Chat Input - Profesyonel -->
        <div class="chat-input-pro">
            <!-- Ses Kayƒ±t √ñnizleme -->
            <div x-show="voicePreview" class="mb-3 p-3 bg-[var(--input-bg)] rounded-2xl flex items-center gap-3">
                <div class="voice-wave">
                    <span></span><span></span><span></span><span></span><span></span>
                </div>
                <span class="text-sm font-medium" x-text="voiceDuration + ' sn'"></span>
                <button @click="sendVoiceMessage()" class="ml-auto w-8 h-8 rounded-full bg-emerald-500 text-white flex items-center justify-center">
                    <i class="fas fa-paper-plane text-xs"></i>
                </button>
                <button @click="cancelVoiceRecord()" class="w-8 h-8 rounded-full bg-red-500 text-white flex items-center justify-center">
                    <i class="fas fa-times text-xs"></i>
                </button>
            </div>
            <!-- Kayƒ±t ediliyor g√∂stergesi -->
            <div x-show="isRecording && !voicePreview" class="mb-2 px-3 py-1.5 bg-red-50 rounded-xl flex items-center gap-2">
                <span class="w-2 h-2 bg-red-500 rounded-full animate-pulse"></span>
                <span class="text-xs text-red-600 font-bold">Ses kaydediliyor... Durdurmak i√ßin tekrar tƒ±klayƒ±n</span>
            </div>
            
            <div class="chat-input-row" x-show="!voicePreview">
                <!-- Ses Kayƒ±t Butonu - Basƒ±lƒ± tut ya da tƒ±kla -->
                <button @click="startVoiceRecord()" 
                        class="chat-attach-btn transition-all duration-200"
                        :class="isRecording ? 'text-red-500 scale-125 animate-pulse' : 'text-[var(--text-sec)]'">
                    <i class="fas" :class="isRecording ? 'fa-stop-circle' : 'fa-microphone'"></i>
                </button>
                
                <!-- Galeriden G√∂rsel -->
                <label class="chat-attach-btn cursor-pointer">
                    <i class="fas fa-image"></i>
                    <input type="file" class="hidden" @change="sendImageMessage($event)" accept="image/*">
                </label>
                
                <input type="text" x-model="messageInput" @keyup.enter="sendMessage" :placeholder="t('typeMessage')" class="chat-input-field">
                
                <button @click="sendMessage" class="chat-send-btn" :disabled="!messageInput.trim() && !messageImagePreview">
                    <i class="fas fa-paper-plane text-sm"></i>
                </button>
            </div>
            
            <!-- G√∂rsel √ñnizleme -->
            <div x-show="messageImagePreview" class="mt-3 relative inline-block">
                <img :src="messageImagePreview" class="w-24 h-24 object-cover rounded-xl border-2 border-emerald-200">
                <button @click="messageImagePreview = null; messageImageFile = null" class="absolute -top-2 -right-2 w-6 h-6 bg-red-500 text-white rounded-full text-xs flex items-center justify-center shadow-lg">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Kanal Olu≈üturma Modal -->
    <div x-show="showCreateChannelModal" x-transition x-cloak class="fixed inset-0 z-[85] flex items-center justify-center bg-black/60 backdrop-blur-sm p-4">
        <div class="bg-[var(--bg-card)] rounded-3xl w-full max-w-lg max-h-[85vh] flex flex-col shadow-2xl overflow-hidden">
            <!-- Header -->
            <div class="p-5 border-b border-[var(--border)] flex items-center justify-between bg-gradient-to-r from-emerald-500 to-teal-500 text-white">
                <div>
                    <h3 class="text-lg font-bold">Kanal Olu≈ütur</h3>
                    <p class="text-xs text-white/70">En fazla 20 ki≈üi ekleyebilirsiniz</p>
                </div>
                <button @click="showCreateChannelModal = false; channelForm = { name: '', selectedUsers: [], searchQuery: '', searchResults: [], profilePicFile: null, profilePicPreview: null }" class="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center hover:bg-white/30 transition">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <!-- Kanal Profil Resmi + Adƒ± -->
            <div class="p-4 border-b border-[var(--border)] flex items-center gap-4">
                <!-- Profil Resmi Y√ºkleme -->
                <label class="relative cursor-pointer flex-shrink-0">
                    <div class="w-16 h-16 rounded-full bg-gradient-to-br from-emerald-400 to-teal-500 flex items-center justify-center text-white font-bold text-2xl overflow-hidden border-2 border-emerald-300">
                        <template x-if="channelForm.profilePicPreview">
                            <img :src="channelForm.profilePicPreview" class="w-full h-full object-cover">
                        </template>
                        <template x-if="!channelForm.profilePicPreview">
                            <span x-text="channelForm.name ? channelForm.name.charAt(0).toUpperCase() : '#'"></span>
                        </template>
                    </div>
                    <div class="absolute bottom-0 right-0 w-6 h-6 bg-white rounded-full flex items-center justify-center shadow-md border border-emerald-200">
                        <i class="fas fa-camera text-emerald-600 text-xs"></i>
                    </div>
                    <input type="file" class="hidden" accept="image/*" @change="
                        const file = $event.target.files[0];
                        if (file) {
                            channelForm.profilePicFile = file;
                            const reader = new FileReader();
                            reader.onload = e => channelForm.profilePicPreview = e.target.result;
                            reader.readAsDataURL(file);
                        }
                    ">
                </label>
                <div class="flex-1">
                    <label class="text-xs font-bold text-[var(--text-sec)] mb-1 block">Kanal Adƒ±</label>
                    <input type="text" x-model="channelForm.name" placeholder="Kanal adƒ± girin..." maxlength="50" class="w-full bg-[var(--input-bg)] border border-[var(--border)] p-3 rounded-xl text-sm outline-none focus:ring-2 focus:ring-emerald-500">
                </div>
            </div>
            
            <!-- Se√ßilen Kullanƒ±cƒ±lar -->
            <div x-show="channelForm.selectedUsers.length > 0" class="p-3 border-b border-[var(--border)]">
                <div class="flex flex-wrap gap-2">
                    <template x-for="su in channelForm.selectedUsers" :key="su.id">
                        <div class="flex items-center gap-1.5 bg-emerald-100 text-emerald-800 px-3 py-1.5 rounded-full text-xs font-medium">
                            <img :src="su.profilePic || 'https://ui-avatars.com/api/?name='+su.name" class="w-5 h-5 rounded-full object-cover">
                            <span x-text="su.name"></span>
                            <button @click="channelForm.selectedUsers = channelForm.selectedUsers.filter(u => u.id !== su.id)" class="ml-1 text-emerald-600 hover:text-red-500">
                                <i class="fas fa-times text-[10px]"></i>
                            </button>
                        </div>
                    </template>
                </div>
                <p class="text-xs text-[var(--text-sec)] mt-2" x-text="channelForm.selectedUsers.length + '/20 ki≈üi se√ßildi'"></p>
            </div>
            
            <!-- Kullanƒ±cƒ± Arama -->
            <div class="p-4 border-b border-[var(--border)]">
                <div class="relative">
                    <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 text-sm"></i>
                    <input type="text" x-model="channelForm.searchQuery" @input="searchUsersForChannel()" placeholder="Kullanƒ±cƒ± ara..." class="w-full bg-[var(--input-bg)] border border-[var(--border)] p-3 pl-10 rounded-xl text-sm outline-none focus:ring-2 focus:ring-emerald-500">
                </div>
            </div>
            
            <!-- Arama Sonu√ßlarƒ± -->
            <div class="flex-1 overflow-y-auto p-2">
                <template x-for="u in channelForm.searchResults" :key="u.id">
                    <div class="flex items-center gap-3 p-3 rounded-xl hover:bg-[var(--input-bg)] cursor-pointer transition" 
                         @click="toggleChannelUser(u)"
                         :class="channelForm.selectedUsers.some(su => su.id === u.id) ? 'bg-emerald-50 dark:bg-emerald-900/20' : ''">
                        <img :src="u.profilePic || 'https://ui-avatars.com/api/?name='+u.name" class="w-10 h-10 rounded-full object-cover">
                        <div class="flex-1">
                            <p class="font-bold text-sm" x-text="u.name"></p>
                            <p class="text-xs text-[var(--text-sec)]" x-text="'@' + u.username"></p>
                        </div>
                        <div class="w-6 h-6 rounded-full border-2 flex items-center justify-center" 
                             :class="channelForm.selectedUsers.some(su => su.id === u.id) ? 'bg-emerald-500 border-emerald-500' : 'border-gray-300'">
                            <i x-show="channelForm.selectedUsers.some(su => su.id === u.id)" class="fas fa-check text-white text-xs"></i>
                        </div>
                    </div>
                </template>
                <template x-if="channelForm.searchResults.length === 0 && channelForm.searchQuery.length > 0">
                    <p class="text-center text-sm text-[var(--text-sec)] py-8">Kullanƒ±cƒ± bulunamadƒ±</p>
                </template>
                <template x-if="channelForm.searchQuery.length === 0">
                    <p class="text-center text-sm text-[var(--text-sec)] py-8"><i class="fas fa-search mr-1"></i> Eklemek istediƒüiniz kullanƒ±cƒ±larƒ± arayƒ±n</p>
                </template>
            </div>
            
            <!-- Olu≈ütur Butonu -->
            <div class="p-4 border-t border-[var(--border)]">
                <button @click="createChannel()" 
                        :disabled="!channelForm.name.trim() || channelForm.selectedUsers.length < 1"
                        class="w-full py-3 bg-gradient-to-r from-emerald-500 to-teal-500 text-white rounded-xl font-bold text-sm transition-all hover:shadow-lg disabled:opacity-40 disabled:cursor-not-allowed active:scale-[0.98]">
                    <i class="fas fa-layer-group mr-2"></i> Kanal Olu≈ütur (<span x-text="channelForm.selectedUsers.length"></span> ki≈üi)
                </button>
            </div>
        </div>
    </div>

    <!-- Kanal Sohbet Modal -->
    <div x-show="showChannelChat" x-transition x-cloak class="fixed inset-0 z-[80] flex flex-col" style="background: var(--bg-main);">
        <!-- Channel Chat Header - Geli≈ümi≈ü -->
        <div class="chat-header-pro" style="background: var(--bg-card); border-bottom: 1px solid var(--border);">
            <button @click="showChannelChat = false" class="w-10 h-10 rounded-full bg-[var(--input-bg)] flex items-center justify-center text-[var(--text-main)] hover:bg-[var(--border)] transition">
                <i class="fas fa-arrow-left"></i>
            </button>
            <!-- Kanal Avatar - tƒ±klanabilir (√ºyeler) -->
            <div @click="openChannelMembers()" class="cursor-pointer relative" style="flex-shrink:0;">
                <div class="w-11 h-11 rounded-full bg-gradient-to-br from-emerald-400 to-teal-500 flex items-center justify-center text-white font-bold text-lg shadow-md overflow-hidden">
                    <template x-if="activeChannel && activeChannel.profilePic">
                        <img :src="activeChannel.profilePic" class="w-11 h-11 rounded-full object-cover">
                    </template>
                    <template x-if="!activeChannel || !activeChannel.profilePic">
                        <span x-text="activeChannel ? activeChannel.name.charAt(0).toUpperCase() : '#'"></span>
                    </template>
                </div>
            </div>
            <div class="chat-header-info flex-1" @click="openChannelMembers()" style="cursor:pointer;">
                <h4 class="chat-header-name" x-text="activeChannel ? activeChannel.name : ''"></h4>
                <div class="flex items-center gap-1 mt-0.5">
                    <template x-if="activeChannel && activeChannel.members && activeChannel.members.length > 0">
                        <div class="flex items-center">
                            <div class="flex -space-x-1.5">
                                <template x-for="(member, idx) in (activeChannel.members || []).slice(0,4)" :key="member.id || idx">
                                    <img :src="member.profilePic || 'https://ui-avatars.com/api/?name='+(member.name||'U')+'&size=32'" 
                                         class="w-4 h-4 rounded-full border border-[var(--bg-card)] object-cover">
                                </template>
                            </div>
                            <span class="text-[10px] text-[var(--text-sec)] ml-1.5" x-text="(activeChannel.memberCount || activeChannel.members.length) + ' √ºye ‚Ä¢ G√∂rmek i√ßin tƒ±kla'"></span>
                        </div>
                    </template>
                    <template x-if="!activeChannel || !activeChannel.members || activeChannel.members.length === 0">
                        <p class="text-xs text-[var(--text-sec)]" x-text="activeChannel ? (activeChannel.memberCount || 0) + ' √ºye' : ''"></p>
                    </template>
                </div>
            </div>
            <!-- Saƒü: Ayarlar men√ºs√º -->
            <div class="relative" x-data="{ showChannelMenu: false }">
                <button @click="showChannelMenu = !showChannelMenu" class="w-10 h-10 rounded-full bg-[var(--input-bg)] flex items-center justify-center text-[var(--text-main)] hover:bg-[var(--border)] transition">
                    <i class="fas fa-ellipsis-v"></i>
                </button>
                <div x-show="showChannelMenu" @click.outside="showChannelMenu = false" 
                     class="absolute right-0 top-12 bg-[var(--bg-card)] border border-[var(--border)] rounded-2xl shadow-xl z-50 w-48 py-1 overflow-hidden">
                    <button @click="openChannelMembers(); showChannelMenu=false" class="w-full px-4 py-3 text-left text-sm font-medium hover:bg-[var(--input-bg)] flex items-center gap-3 transition">
                        <i class="fas fa-users text-emerald-500 w-4"></i> √úyeleri G√∂r
                    </button>
                    <template x-if="activeChannel && activeChannel.creatorId === user.id">
                        <button @click="triggerChannelPicUpload(); showChannelMenu=false" class="w-full px-4 py-3 text-left text-sm font-medium hover:bg-[var(--input-bg)] flex items-center gap-3 transition">
                            <i class="fas fa-camera text-blue-500 w-4"></i> Kanal Resmi
                        </button>
                    </template>
                    <button @click="leaveOrDeleteChannel(); showChannelMenu=false" class="w-full px-4 py-3 text-left text-sm font-medium hover:bg-red-50 flex items-center gap-3 transition text-red-500">
                        <template x-if="activeChannel && activeChannel.creatorId === user.id">
                            <span><i class="fas fa-trash-alt w-4"></i> Kanalƒ± Sil</span>
                        </template>
                        <template x-if="!activeChannel || activeChannel.creatorId !== user.id">
                            <span><i class="fas fa-sign-out-alt w-4"></i> Kanaldan Ayrƒ±l</span>
                        </template>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Kanal resmi y√ºkleme input (gizli) -->
        <input type="file" id="channelPicInput" class="hidden" accept="image/*" @change="uploadChannelPic($event)">
        
        <!-- Channel Messages - Geli≈ümi≈ü Balonlar -->
        <div class="flex-1 overflow-y-auto no-scrollbar" id="channelMessages" style="padding: 16px; background: var(--bg-main);">
            <template x-for="msg in channelMessages" :key="msg.id">
                <div class="channel-msg-wrapper" :class="msg.senderId === user.id ? 'msg-right' : 'msg-left'">
                    <!-- Sol: avatar (ba≈ükasƒ±nƒ±n mesajƒ±) -->
                    <template x-if="msg.senderId !== user.id">
                        <img :src="msg.senderProfilePic || 'https://ui-avatars.com/api/?name='+encodeURIComponent(msg.senderName||'U')" 
                             class="channel-msg-avatar" @click="viewProfile(msg.senderId)">
                    </template>
                    
                    <div class="channel-msg-col" :class="msg.senderId === user.id ? 'items-end' : 'items-start'">
                        <!-- ƒ∞sim + Y√∂netici etiketi -->
                        <template x-if="msg.senderId !== user.id">
                            <div class="flex items-center gap-1.5 mb-1">
                                <span class="text-xs font-bold" x-text="msg.senderName || 'Kullanƒ±cƒ±'" style="color: var(--text-sec);"></span>
                                <template x-if="activeChannel && msg.senderId === activeChannel.creatorId">
                                    <span class="channel-admin-badge">Y√∂netici</span>
                                </template>
                            </div>
                        </template>
                        
                        <!-- Mesaj balonu -->
                        <div class="channel-bubble" 
                             :class="[msg.senderId === user.id ? 'bubble-sent' : 'bubble-received', msg.isDeleted ? 'bubble-deleted' : '']"
                             @contextmenu.prevent="openChannelMsgMenu(msg, $event)"
                             @touchstart.passive="startChannelLongPress(msg, $event)" 
                             @touchend.passive="cancelLongPress()" 
                             @touchmove.passive="cancelLongPress()">
                            
                            <!-- Mesaj i√ßeriƒüi -->
                            <p x-html="msg.isDeleted ? 'üóëÔ∏è <em>Bu mesaj silindi</em>' : formatMessageContent(msg.content)" 
                               class="channel-bubble-text" :class="msg.isDeleted ? 'deleted-text' : ''"></p>
                            
                            <!-- Zaman + D√ºzenlendi -->
                            <div class="bubble-meta" :class="msg.senderId === user.id ? 'justify-end' : 'justify-start'">
                                <span x-show="msg.isEdited && !msg.isDeleted" class="edited-label">d√ºzenlendi</span>
                                <span class="bubble-time" x-text="formatTime(msg.createdAt)"></span>
                                <template x-if="msg.senderId === user.id">
                                    <i class="fas fa-check-double text-[9px] opacity-60"></i>
                                </template>
                            </div>
                        </div>
                    </div>
                </div>
            </template>
            <div id="channelBottom"></div>
        </div>
        
        <!-- Kanal Mesaj D√ºzenleme Banner -->
        <div x-show="editingChannelMsg" class="px-4 py-2 flex items-center gap-3 border-t border-[var(--border)]" style="background: var(--bg-card);">
            <i class="fas fa-pencil-alt text-emerald-500 text-sm"></i>
            <span class="text-sm flex-1 truncate" x-text="'D√ºzenle: ' + (editingChannelMsg ? editingChannelMsg.content : '')"></span>
            <button @click="editingChannelMsg = null; channelMessageInput = ''" class="text-slate-400 hover:text-red-500 transition">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <!-- Channel Input -->
        <div class="chat-input-pro" style="background: var(--bg-card);">
            <div class="chat-input-row">
                <input type="text" x-model="channelMessageInput" 
                       @keyup.enter="sendChannelMessage()" 
                       :placeholder="editingChannelMsg ? 'Mesajƒ± d√ºzenle...' : 'Mesaj yaz...'" 
                       class="chat-input-field">
                <button @click="sendChannelMessage()" class="chat-send-btn" :disabled="!channelMessageInput.trim()">
                    <i class="fas fa-paper-plane text-sm"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Kanal Mesaj Context Menu -->
    <div x-show="showChannelMsgMenu" x-cloak @click.self="showChannelMsgMenu = false"
         class="fixed inset-0 z-[200] flex items-end justify-center" style="background: rgba(0,0,0,0.3);">
        <div class="bg-[var(--bg-card)] rounded-t-3xl w-full max-w-lg shadow-2xl pb-safe">
            <div class="w-10 h-1 bg-slate-300 rounded-full mx-auto mt-3 mb-4"></div>
            <!-- Mesaj √∂nizleme -->
            <div class="px-4 pb-3 border-b border-[var(--border)] mb-1">
                <p class="text-xs text-[var(--text-sec)] truncate" x-text="selectedChannelMsg ? selectedChannelMsg.content : ''"></p>
            </div>
            <!-- Aksiyonlar -->
            <template x-if="selectedChannelMsg && selectedChannelMsg.senderId === user.id && !selectedChannelMsg.isDeleted">
                <button @click="startEditChannelMsg(selectedChannelMsg); showChannelMsgMenu=false" 
                        class="w-full px-5 py-4 text-left flex items-center gap-3 hover:bg-[var(--input-bg)] transition font-medium">
                    <i class="fas fa-pencil-alt text-blue-500 w-5"></i> D√ºzenle
                </button>
            </template>
            <template x-if="selectedChannelMsg && (selectedChannelMsg.senderId === user.id || (activeChannel && activeChannel.creatorId === user.id)) && !selectedChannelMsg.isDeleted">
                <button @click="deleteChannelMsg(selectedChannelMsg); showChannelMsgMenu=false"
                        class="w-full px-5 py-4 text-left flex items-center gap-3 hover:bg-red-50 transition font-medium text-red-500">
                    <i class="fas fa-trash-alt w-5"></i> Sil
                </button>
            </template>
            <button @click="showChannelMsgMenu = false" 
                    class="w-full px-5 py-4 text-left flex items-center gap-3 hover:bg-[var(--input-bg)] transition font-medium text-[var(--text-sec)]">
                <i class="fas fa-times w-5"></i> ƒ∞ptal
            </button>
        </div>
    </div>

    <!-- Kanal √úyeleri Modal -->
    <div x-show="showChannelMembersModal" x-transition x-cloak class="fixed inset-0 z-[110] flex items-end justify-center bg-black/50">
        <div class="bg-[var(--bg-card)] rounded-t-3xl w-full max-w-lg max-h-[75vh] flex flex-col shadow-2xl" @click.stop>
            <div class="p-4 border-b border-[var(--border)] flex items-center gap-3">
                <div class="w-10 h-10 rounded-full bg-gradient-to-br from-emerald-400 to-teal-500 flex items-center justify-center text-white font-bold overflow-hidden">
                    <template x-if="activeChannel && activeChannel.profilePic">
                        <img :src="activeChannel.profilePic" class="w-10 h-10 object-cover">
                    </template>
                    <template x-if="!activeChannel || !activeChannel.profilePic">
                        <span x-text="activeChannel ? activeChannel.name.charAt(0) : '#'"></span>
                    </template>
                </div>
                <div class="flex-1">
                    <h3 class="font-black text-base" x-text="activeChannel ? activeChannel.name : 'Kanal'"></h3>
                    <p class="text-xs text-[var(--text-sec)]" x-text="channelMembersList.length + ' √ºye'"></p>
                </div>
                <button @click="showChannelMembersModal = false" class="w-9 h-9 rounded-full bg-[var(--input-bg)] flex items-center justify-center">
                    <i class="fas fa-times text-sm"></i>
                </button>
            </div>
            <div class="flex-1 overflow-y-auto p-3 space-y-1">
                <template x-for="m in channelMembersList" :key="m.id">
                    <div class="flex items-center gap-3 p-3 rounded-2xl hover:bg-[var(--input-bg)] transition cursor-pointer" @click="viewProfile(m.id); showChannelMembersModal=false">
                        <img :src="m.profilePic || 'https://ui-avatars.com/api/?name='+(m.name||'U')" class="w-11 h-11 rounded-full object-cover border border-[var(--border)]">
                        <div class="flex-1">
                            <div class="flex items-center gap-2">
                                <span class="font-bold text-sm" x-text="m.name"></span>
                                <template x-if="m.isAdmin || (activeChannel && m.id === activeChannel.creatorId)">
                                    <span class="channel-admin-badge">Y√∂netici</span>
                                </template>
                            </div>
                            <p class="text-xs text-[var(--text-sec)]" x-text="'@' + m.username"></p>
                        </div>
                        <i class="fas fa-chevron-right text-[var(--text-sec)] text-xs"></i>
                    </div>
                </template>
            </div>
        </div>
    </div>

    <!-- Kim G√∂rm√º≈ü Modal -->
    <div x-show="showSeenByModal" x-transition x-cloak class="fixed inset-0 z-[95] flex items-end justify-center bg-black/50 backdrop-blur-sm" @click.self="showSeenByModal = false">
        <div class="bg-[var(--bg-card)] rounded-t-3xl w-full max-w-lg max-h-[70vh] flex flex-col shadow-2xl" @click.stop>
            <div class="p-4 border-b border-[var(--border)] flex items-center justify-between">
                <h3 class="font-bold text-lg"><i class="fas fa-eye mr-2 text-emerald-500"></i>Mesajƒ± G√∂renler</h3>
                <button @click="showSeenByModal = false" class="w-8 h-8 rounded-full bg-[var(--input-bg)] flex items-center justify-center">
                    <i class="fas fa-times text-sm"></i>
                </button>
            </div>
            <div class="flex-1 overflow-y-auto p-3">
                <template x-if="seenByUsers.length === 0">
                    <p class="text-center text-sm text-[var(--text-sec)] py-8">Hen√ºz kimse g√∂rmemi≈ü</p>
                </template>
                <template x-for="u in seenByUsers" :key="u.id">
                    <div class="flex items-center gap-3 p-3 rounded-xl hover:bg-[var(--input-bg)] transition">
                        <img :src="u.profilePic || 'https://ui-avatars.com/api/?name='+u.name" class="w-10 h-10 rounded-full object-cover">
                        <div class="flex-1">
                            <p class="font-bold text-sm" x-text="u.name"></p>
                            <p class="text-xs text-[var(--text-sec)]" x-text="'@' + u.username"></p>
                        </div>
                        <span class="text-xs text-[var(--text-sec)]" x-text="formatDate(u.seenAt)"></span>
                    </div>
                </template>
            </div>
        </div>
    </div>

    <!-- Hikaye G√∂r√ºnt√ºleme Modal - ESKƒ∞ STƒ∞L (tam ekran deƒüil) -->
    <div x-show="showStoryViewer" x-transition x-cloak class="fixed inset-0 z-[90] bg-black flex flex-col">
        <!-- Progress Bar - √áoklu Hikaye ƒ∞√ßin -->
        <div class="absolute top-0 left-0 right-0 z-20 flex gap-1 p-2" x-show="currentStoryGroup && currentStoryGroup.stories && currentStoryGroup.stories.length > 1">
            <template x-for="(story, index) in currentStoryGroup.stories" :key="story.id">
                <div class="flex-1 h-1 bg-white/30 rounded-full overflow-hidden">
                    <div class="h-full bg-white transition-all duration-300" 
                         :style="`width: ${index < currentStoryIndex ? '100%' : (index === currentStoryIndex ? '50%' : '0%')}`"></div>
                </div>
            </template>
        </div>
        
        <div class="absolute top-4 left-4 right-4 z-10 flex items-center gap-3">
            <img :src="activeStory.userProfilePic || activeStory.profilePic || 'https://ui-avatars.com/api/?name='+(activeStory.username || 'User')" class="w-10 h-10 rounded-full object-cover border-2 border-white">
            <div class="flex-1">
                <p class="text-white font-bold text-sm" x-text="activeStory.username"></p>
                <p class="text-white/60 text-xs" x-text="formatDate(activeStory.createdAt)"></p>
            </div>
            <!-- Hikaye Sil Butonu -->
            <button x-show="activeStory.userId === user.id" 
                    @click="deleteStory(activeStory)" 
                    class="text-white w-10 h-10 rounded-full bg-red-500/80 backdrop-blur flex items-center justify-center active:scale-90 transition shadow-lg mr-2"
                    title="Hikayeyi Sil">
                <i class="fas fa-trash-alt text-sm"></i>
            </button>
            <button @click="showStoryViewer = false; stopStoryProgress()" class="text-white w-10 h-10 rounded-full bg-white/20 flex items-center justify-center active:scale-90 transition">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>
        
        <!-- ƒ∞leri/Geri Butonlarƒ± -->
        <div class="absolute inset-y-0 left-0 w-1/3 z-10 flex items-center justify-start pl-4" 
             x-show="currentStoryGroup && currentStoryGroup.stories && currentStoryGroup.stories.length > 1 && currentStoryIndex > 0"
             @click="prevStory()">
            <button class="w-12 h-12 rounded-full bg-white/20 backdrop-blur flex items-center justify-center text-white hover:bg-white/30 transition">
                <i class="fas fa-chevron-left text-xl"></i>
            </button>
        </div>
        
        <div class="absolute inset-y-0 right-0 w-1/3 z-10 flex items-center justify-end pr-4"
             x-show="currentStoryGroup && currentStoryGroup.stories && currentStoryGroup.stories.length > 1"
             @click="nextStory()">
            <button class="w-12 h-12 rounded-full bg-white/20 backdrop-blur flex items-center justify-center text-white hover:bg-white/30 transition">
                <i class="fas fa-chevron-right text-xl"></i>
            </button>
        </div>
        
        <!-- Medya - Ortalanmƒ±≈ü, tam ekran deƒüil -->
        <div class="flex-1 flex items-center justify-center p-4">
            <template x-if="activeStory.mediaType === 'image'">
                <img :src="activeStory.mediaUrl" class="max-w-full max-h-full object-contain rounded-2xl">
            </template>
            <template x-if="activeStory.mediaType === 'video'">
                <video x-init="$nextTick(()=>initAgroHLS($el, activeStory.mediaUrl))" class="max-w-full max-h-full rounded-2xl" autoplay controls playsinline></video>
            </template>
        </div>
        
        <!-- Kimler G√∂rd√º Butonu -->
        <button x-show="activeStory.userId === user.id" 
                @click="loadStoryViewers(activeStory.id)"
                class="story-viewers-btn">
            <i class="fas fa-eye"></i>
            <span>Kimler G√∂rd√º</span>
        </button>
        
        <template x-if="activeStory.text">
            <div class="absolute bottom-20 left-4 right-4 text-center">
                <p class="text-white text-lg font-bold bg-black/50 p-4 rounded-2xl" x-text="activeStory.text"></p>
            </div>
        </template>
    </div>

    <!-- Hikaye G√∂r√ºnt√ºleyenler Modal -->
    <div x-show="showStoryViewers" x-transition x-cloak class="fixed inset-0 z-[95] flex items-end justify-center">
        <div class="absolute inset-0 bg-black/60" @click="showStoryViewers = false"></div>
        <div class="bg-[var(--bg-card)] w-full max-w-xl h-[70vh] rounded-t-[2.5rem] relative flex flex-col p-6 overflow-hidden animate-slide-up">
            <div class="w-12 h-1.5 bg-slate-300 rounded-full mx-auto mb-4"></div>
            <h3 class="text-center font-black text-lg mb-4">Hikayeni Kimler G√∂rd√º</h3>
            
            <div class="flex-1 overflow-y-auto space-y-3 no-scrollbar">
                <template x-if="storyViewersList.length === 0">
                    <div class="text-center py-12 text-[var(--text-sec)]">
                        <i class="fas fa-eye-slash text-4xl mb-3 opacity-50"></i>
                        <p class="font-medium">Hen√ºz kimse g√∂rmedi</p>
                    </div>
                </template>
                
                <template x-for="viewer in storyViewersList" :key="viewer.id">
                    <div class="flex items-center gap-3 p-3 rounded-xl hover:bg-[var(--input-bg)]">
                        <img :src="viewer.profilePic || 'https://ui-avatars.com/api/?name='+viewer.name" 
                             @click="viewProfile(viewer.id)"
                             class="w-12 h-12 rounded-full object-cover cursor-pointer">
                        <div class="flex-1" @click="viewProfile(viewer.id)">
                            <p class="font-bold text-sm" x-text="viewer.name"></p>
                            <p class="text-xs text-slate-500" x-text="'@'+viewer.username"></p>
                        </div>
                        <span class="text-xs text-[var(--text-sec)]" x-text="formatDate(viewer.viewedAt)"></span>
                    </div>
                </template>
            </div>
        </div>
    </div>

    <!-- √úr√ºn Detay Modal (Trendyol Tarzƒ±) -->
    <div x-show="showProductDetail" x-transition x-cloak class="fixed inset-0 z-[85] flex flex-col bg-[var(--bg-main)]">
        <div class="glass px-4 py-3 flex items-center justify-between border-b border-[var(--border)]">
            <button @click="showProductDetail = false" class="text-slate-500 p-2"><i class="fas fa-arrow-left text-xl"></i></button>
            <h3 class="text-lg font-black">√úr√ºn Detayƒ±</h3>
            <div class="flex gap-2">
                <!-- √úr√ºn Sahibi ƒ∞√ßin Silme Butonu -->
                <template x-if="selectedProduct && selectedProduct.sellerId === user.id">
                    <button @click="deleteProduct(selectedProduct.id)" class="w-10 h-10 rounded-full bg-red-100 text-red-500 flex items-center justify-center hover:bg-red-200 transition" title="√úr√ºn√º Sil">
                        <i class="fas fa-trash"></i>
                    </button>
                </template>
                <button @click="shareProduct(selectedProduct)" class="w-10 h-10 rounded-full bg-slate-100 text-slate-600 flex items-center justify-center hover:bg-slate-200 transition" title="Payla≈ü">
                    <i class="fas fa-share-alt"></i>
                </button>
            </div>
        </div>
        
        <div class="flex-1 overflow-y-auto no-scrollbar" x-show="selectedProduct">
            <!-- √úr√ºn G√∂rselleri Galerisi -->
            <div class="relative bg-slate-100">
                <div class="aspect-square flex items-center justify-center overflow-hidden">
                    <img :src="selectedProductImages[currentProductImageIndex] || selectedProduct?.image || 'https://via.placeholder.com/400x400?text=√úr√ºn'" 
                         class="w-full h-full object-cover">
                </div>
                <!-- G√∂rsel Sayacƒ± -->
                <div x-show="selectedProductImages.length > 1" class="absolute bottom-4 left-1/2 -translate-x-1/2 bg-black/60 text-white px-3 py-1 rounded-full text-sm">
                    <span x-text="currentProductImageIndex + 1"></span> / <span x-text="selectedProductImages.length"></span>
                </div>
                <!-- G√∂rsel Navigasyon Butonlarƒ± -->
                <button x-show="selectedProductImages.length > 1 && currentProductImageIndex > 0" 
                        @click="currentProductImageIndex--" 
                        class="absolute left-4 top-1/2 -translate-y-1/2 w-10 h-10 bg-white/80 rounded-full flex items-center justify-center shadow-lg">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <button x-show="selectedProductImages.length > 1 && currentProductImageIndex < selectedProductImages.length - 1" 
                        @click="currentProductImageIndex++" 
                        class="absolute right-4 top-1/2 -translate-y-1/2 w-10 h-10 bg-white/80 rounded-full flex items-center justify-center shadow-lg">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
            
            <!-- K√º√ß√ºk G√∂rsel √ñnizlemeleri -->
            <div x-show="selectedProductImages.length > 1" class="flex gap-2 p-4 overflow-x-auto no-scrollbar">
                <template x-for="(img, index) in selectedProductImages" :key="index">
                    <button @click="currentProductImageIndex = index" 
                            :class="currentProductImageIndex === index ? 'ring-2 ring-emerald-500' : ''"
                            class="w-16 h-16 rounded-xl overflow-hidden flex-shrink-0">
                        <img :src="img" class="w-full h-full object-cover">
                    </button>
                </template>
            </div>
            
            <!-- √úr√ºn Bilgileri -->
            <div class="p-4 space-y-4">
                <!-- Fiyat ve ƒ∞sim -->
                <div>
                    <h2 class="text-2xl font-black text-emerald-600" x-text="selectedProduct?.price + ' ‚Ç∫'"></h2>
                    <h1 class="text-xl font-bold mt-1" x-text="selectedProduct?.name"></h1>
                </div>
                
                <!-- Satƒ±cƒ± Bilgisi -->
                <div class="flex items-center gap-3 p-3 bg-[var(--input-bg)] rounded-2xl" @click="viewProfile(selectedProduct?.sellerId)">
                    <img :src="selectedProduct?.sellerProfilePic || 'https://ui-avatars.com/api/?name='+selectedProduct?.sellerName" class="w-12 h-12 rounded-full object-cover">
                    <div class="flex-1">
                        <p class="font-bold text-sm" x-text="selectedProduct?.sellerName"></p>
                        <p class="text-xs text-slate-500">Satƒ±cƒ±</p>
                    </div>
                    <i class="fas fa-chevron-right text-slate-400"></i>
                </div>
                
                <!-- A√ßƒ±klama -->
                <div>
                    <h3 class="font-bold text-sm text-slate-500 mb-2">A√ßƒ±klama</h3>
                    <p class="text-sm leading-relaxed" x-text="selectedProduct?.description || 'A√ßƒ±klama bulunmuyor'"></p>
                </div>
                
                <!-- Kategori ve Stok -->
                <div class="flex gap-4">
                    <div x-show="selectedProduct?.category" class="flex-1 p-3 bg-[var(--input-bg)] rounded-xl">
                        <p class="text-xs text-slate-500">Kategori</p>
                        <p class="font-semibold text-sm" x-text="selectedProduct?.category"></p>
                    </div>
                    <div class="flex-1 p-3 bg-[var(--input-bg)] rounded-xl">
                        <p class="text-xs text-slate-500">Stok</p>
                        <p class="font-semibold text-sm" x-text="(selectedProduct?.stock || 1) + ' adet'"></p>
                    </div>
                </div>
                
                <!-- Payla≈üƒ±m Tarihi -->
                <div class="flex items-center gap-2 text-xs text-slate-400">
                    <i class="far fa-clock"></i>
                    <span x-text="'ƒ∞lan tarihi: ' + formatDate(selectedProduct?.createdAt)"></span>
                </div>
            </div>
        </div>
        
        <!-- Alt Butonlar -->
        <div class="p-4 border-t border-[var(--border)] bg-[var(--bg-card)]">
            <button @click="startChatWithSeller(selectedProduct)" class="w-full py-4 btn-agro flex items-center justify-center gap-2">
                <i class="fas fa-comment-dots"></i>
                <span>Satƒ±cƒ±yla Mesajla≈ü</span>
            </button>
        </div>
    </div>

    <!-- Hikaye Olu≈ütur Modal -->
    <div x-show="showStoryModal" x-transition x-cloak class="fixed inset-0 z-[60] flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/60" @click="showStoryModal = false"></div>
        <div class="bg-[var(--bg-card)] w-full max-w-md rounded-[2.5rem] p-6 relative animate-slide-up">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-black">Hikaye Payla≈ü</h3>
                <button @click="showStoryModal = false" class="text-slate-400"><i class="fas fa-times text-xl"></i></button>
            </div>
            
            <div class="flex flex-col items-center gap-4">
                <label class="w-full cursor-pointer">
                    <div class="w-full h-64 bg-[var(--input-bg)] rounded-2xl flex items-center justify-center border-2 border-dashed border-slate-300 overflow-hidden">
                        <template x-if="!storyForm.preview">
                            <div class="text-center">
                                <i class="fas fa-camera text-4xl text-slate-300 mb-2"></i>
                                <p class="text-sm text-slate-400">Fotoƒüraf veya Video Se√ß</p>
                            </div>
                        </template>
                        <template x-if="storyForm.preview && storyForm.mediaType === 'image'">
                            <img :src="storyForm.preview" class="w-full h-full object-cover">
                        </template>
                        <template x-if="storyForm.preview && storyForm.mediaType === 'video'">
                            <video :src="storyForm.preview" class="w-full h-full object-cover" controls></video>
                        </template>
                    </div>
                    <input type="file" class="hidden" @change="handleStoryMedia" accept="image/*,video/*">
                </label>
                
                <input type="text" x-model="storyForm.text" placeholder="Bir ≈üeyler yaz... (opsiyonel)" class="w-full bg-[var(--input-bg)] p-4 rounded-2xl border-none outline-none focus:ring-2 focus:ring-emerald-500">
            </div>
            
            <button @click="submitStory" class="w-full mt-6 py-4 btn-agro" :disabled="loading || !storyForm.media">
                <span x-show="!loading">Hikaye Payla≈ü</span>
                <i x-show="loading" class="fas fa-spinner fa-spin"></i>
            </button>
        </div>
    </div>

    <!-- Takip√ßi/Takip Listesi Modal -->
    <div x-show="showConnectionsModal" x-transition x-cloak class="fixed inset-0 z-[90] flex flex-col bg-[var(--bg-main)]"
         x-data="{ connSearch: '' }">
        <!-- Header -->
        <div class="sticky top-0 z-10 px-4 py-3 flex items-center gap-4 bg-[var(--bg-main)] border-b border-[var(--border)]">
            <button @click="showConnectionsModal = false" class="text-[var(--text-main)]">
                <i class="fas fa-arrow-left text-lg"></i>
            </button>
            <h2 class="font-bold text-lg" x-text="connectionsType === 'followers' ? 'Takip√ßiler' : 'Takip Edilenler'"></h2>
            <span class="ml-auto text-sm text-[var(--text-sec)]" x-text="connectionsList.length + ' ki≈üi'"></span>
        </div>
        
        <!-- Arama -->
        <div class="px-4 py-3">
            <div class="relative">
                <i class="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 text-sm"></i>
                <input type="text" x-model="connSearch" placeholder="Kullanƒ±cƒ± ara..." class="w-full bg-[var(--input-bg)] border border-[var(--border)] p-3 pl-11 text-sm outline-none focus:ring-2 focus:ring-emerald-400 transition-all duration-200" style="border-radius: 18px;">
            </div>
        </div>
        
        <!-- Liste - Infinite Scroll -->
        <div class="flex-1 overflow-y-auto px-4 pb-8 space-y-2 no-scrollbar"
             @scroll.passive="
                const el = $event.target;
                if (!connSearch && connectionsHasMore && !connectionsLoading && el.scrollTop + el.clientHeight >= el.scrollHeight - 80) {
                    loadMoreConnections();
                }
             ">

            <!-- Bo≈ü durum -->
            <template x-if="connectionsList.length === 0 && !connectionsLoading">
                <div class="flex flex-col items-center justify-center py-16 text-[var(--text-sec)]">
                    <i class="fas fa-users text-5xl mb-4 opacity-30"></i>
                    <p class="font-semibold" x-text="connectionsType === 'followers' ? 'Hen√ºz takip√ßi yok' : 'Hen√ºz takip edilen yok'"></p>
                </div>
            </template>

            <template x-for="conn in connectionsList.filter(c => !connSearch || (c.name && c.name.toLowerCase().includes(connSearch.toLowerCase())) || (c.username && c.username.toLowerCase().includes(connSearch.toLowerCase())))" :key="conn.id">
                <div class="flex items-center gap-3 p-3 rounded-xl hover:bg-[var(--input-bg)] transition">
                    <img :src="conn.profilePic || 'agro_pp.jpg'" @click="viewProfile(conn.id); showConnectionsModal = false;" class="w-12 h-12 rounded-full object-cover cursor-pointer border border-[var(--border)]">
                    <div class="flex-1 min-w-0 cursor-pointer" @click="viewProfile(conn.id); showConnectionsModal = false;">
                        <div class="flex items-center gap-1.5">
                            <p class="font-bold text-sm truncate" x-text="conn.name"></p>
                            <template x-if="conn.isVerified || conn.verified">
                                <span class="verified-badge verified-badge-sm flex-shrink-0">
                                    <svg viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-4 h-4">
                                        <path d="M17.7508 9.41667C17.7508 8.1 17.0217 6.95833 15.9608 6.41667C16.0892 6.05417 16.1592 5.6625 16.1592 5.25C16.1592 3.40833 14.7342 1.91833 12.9775 1.91833C12.5858 1.91833 12.2108 1.98833 11.8642 2.12667C11.3492 1.0125 10.2592 0.25 9.00083 0.25C7.7425 0.25 6.65417 1.01417 6.13667 2.125C5.79083 1.9875 5.415 1.91667 5.02333 1.91667C3.265 1.91667 1.84167 3.40833 1.84167 5.25C1.84167 5.66167 1.91083 6.05333 2.03917 6.41667C0.979167 6.95833 0.25 8.09833 0.25 9.41667C0.25 10.6625 0.901667 11.7483 1.86833 12.3217C1.85167 12.4633 1.84167 12.605 1.84167 12.75C1.84167 14.5917 3.265 16.0833 5.02333 16.0833C5.415 16.0833 5.79 16.0117 6.13583 15.875C6.6525 16.9867 7.74083 17.75 9 17.75C10.26 17.75 11.3483 16.9867 11.8642 15.875C12.21 16.0108 12.585 16.0817 12.9775 16.0817C14.7358 16.0817 16.1592 14.59 16.1592 12.7483C16.1592 12.6033 16.1492 12.4617 16.1317 12.3208C17.0967 11.7483 17.7508 10.6625 17.7508 9.4175V9.41667ZM12.2375 6.63833L8.62583 12.055C8.505 12.2358 8.3075 12.3333 8.105 12.3333C7.98583 12.3333 7.865 12.3 7.75833 12.2283L7.6625 12.15L5.65 10.1375C5.40583 9.89333 5.40583 9.4975 5.65 9.25417C5.89417 9.01083 6.29 9.00917 6.53333 9.25417L8.00833 10.7267L11.1958 5.94333C11.3875 5.65583 11.7758 5.58 12.0625 5.77083C12.3508 5.9625 12.4292 6.35083 12.2375 6.6375V6.63833Z" fill="#1D9BF0"/>
                                    </svg>
                                </span>
                            </template>
                        </div>
                        <p class="text-xs text-slate-500" x-text="'@'+conn.username"></p>
                    </div>
                    <button @click="toggleFollow(conn)" 
                            x-show="conn.id !== user.id"
                            class="px-4 py-2.5 rounded-full text-xs font-bold transition-all duration-300 hover:scale-105 active:scale-95 shadow-sm flex-shrink-0" 
                            :class="followingIds.includes(conn.id)
                                ? 'bg-[var(--input-bg)] border border-[var(--border)] hover:border-red-400 hover:text-red-500 hover:bg-red-50' 
                                : 'bg-gradient-to-r from-emerald-500 to-teal-500 text-white shadow-emerald-200 hover:shadow-emerald-300 shadow-lg'">
                        <i class="fas mr-1" :class="followingIds.includes(conn.id) ? 'fa-user-check' : 'fa-user-plus'" style="font-size:10px;"></i>
                        <span x-text="followingIds.includes(conn.id) ? 'Takipten √áƒ±k' : 'Takip Et'"></span>
                    </button>
                </div>
            </template>

            <!-- Y√ºkleniyor -->
            <div x-show="connectionsLoading" class="flex justify-center py-4">
                <i class="fas fa-circle-notch fa-spin text-emerald-500 text-xl"></i>
            </div>
            <!-- Hepsi y√ºklendi -->
            <div x-show="!connectionsHasMore && connectionsList.length > 0 && !connSearch" class="text-center py-4 text-xs text-[var(--text-sec)]">
                T√ºm kullanƒ±cƒ±lar g√∂sterildi
            </div>
        </div>
    </div>

    <!-- Diƒüer Kullanƒ±cƒ± Profili - TAM SAYFA TASARIM -->
    <div x-show="showUserProfile" x-transition x-cloak class="fixed inset-0 z-[70] bg-[var(--bg-main)] overflow-y-auto" x-data="{ userProfileTab: 'posts' }">
        
        <!-- Header Bar -->
        <div class="sticky top-0 z-10 px-4 py-3 flex items-center gap-4 bg-[var(--bg-main)] border-b border-[var(--border)]">
            <button @click="showUserProfile = false" class="text-[var(--text-main)]">
                <i class="fas fa-arrow-left text-lg"></i>
            </button>
            <div>
                <h2 class="font-bold text-lg leading-tight" x-text="viewedUser.name"></h2>
                <p class="text-xs text-[var(--text-sec)]" x-text="(viewedUser.postCount || viewedUser.postsCount || 0) + ' g√∂nderi'"></p>
            </div>
        </div>
        
        <!-- Kapak ve Profil Fotoƒürafƒ± -->
        <div class="profile-header">
            <!-- Kapak Fotoƒürafƒ± - Tƒ±klanabilir Yakƒ±nla≈ütƒ±rma -->
            <div class="profile-cover-container cursor-pointer" @click="openCoverZoom(viewedUser.coverPic || 'https://images.unsplash.com/photo-1500382017468-9049fed747ef?w=800&q=80')">
                <template x-if="viewedUser.coverPic">
                    <img :src="viewedUser.coverPic" alt="Kapak">
                </template>
                <template x-if="!viewedUser.coverPic">
                    <img src="https://images.unsplash.com/photo-1500382017468-9049fed747ef?w=800&q=80" alt="Kapak">
                </template>
                <div class="absolute inset-0 bg-black/0 hover:bg-black/20 transition flex items-center justify-center opacity-0 hover:opacity-100">
                    <i class="fas fa-search-plus text-white text-2xl"></i>
                </div>
            </div>
            
            <!-- Profil Fotoƒürafƒ± - Tƒ±klanabilir -->
            <div class="profile-avatar-container cursor-pointer" @click="openProfilePicPopup(viewedUser.profilePic || 'agro_pp.jpg', viewedUser.id, userHasActiveStory(viewedUser.id), getUserStory(viewedUser.id), false)">
                <div class="profile-avatar-ring relative group"
                     :class="userHasActiveStory(viewedUser.id) ? 'has-story' : ''">
                    <img :src="viewedUser.profilePic || 'agro_pp.jpg'" alt="Profil">
                    <div class="absolute inset-0 bg-black/0 group-hover:bg-black/20 transition rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100">
                        <i class="fas fa-expand text-white text-lg"></i>
                    </div>
                </div>
            </div>
            
        </div>
        
        <!-- Takip Et / Mesaj / Payla≈ü / Engelle Butonlarƒ± - Avatar Altƒ±nda -->
        <div class="flex justify-end gap-2 px-6 mt-3" x-data="{ showProfileMore: false }">
            <button @click="toggleFollowUser(viewedUser)" 
                    class="px-6 py-2.5 rounded-full font-bold text-sm transition-all duration-300 transform hover:scale-105 active:scale-95 shadow-lg"
                    :class="viewedUser.isFollowing 
                        ? 'bg-[var(--bg-card)] text-[var(--text-main)] border-2 border-[var(--border)] hover:border-red-400 hover:text-red-500 hover:bg-red-50 shadow-sm' 
                        : 'bg-gradient-to-r from-emerald-500 to-teal-500 text-white hover:from-emerald-600 hover:to-teal-600 shadow-emerald-300'">
                <i class="fas mr-1.5" :class="viewedUser.isFollowing ? 'fa-user-check' : 'fa-user-plus'" style="font-size:12px;"></i>
                <span x-text="viewedUser.isFollowing ? 'Takip Ediliyor' : 'Takip Et'"></span>
            </button>
            <button @click="startChatWithUser(viewedUser)" 
                    class="w-11 h-11 flex items-center justify-center rounded-full bg-gradient-to-br from-blue-500 to-indigo-500 text-white shadow-lg shadow-blue-200 hover:shadow-blue-300 transition-all duration-300 hover:scale-110 active:scale-95">
                <i class="fas fa-comment-dots"></i>
            </button>
            <button @click="shareProfile(viewedUser)" 
                    class="w-11 h-11 flex items-center justify-center rounded-full bg-[var(--bg-card)] border-2 border-[var(--border)] hover:bg-[var(--input-bg)] transition-all duration-300 hover:scale-110 active:scale-95 shadow-sm">
                <i class="fas fa-share-alt"></i>
            </button>
            <!-- ‚ãØ Daha Fazla (Engelle / ≈ûikayet) -->
            <div class="relative">
                <button @click="showProfileMore = !showProfileMore"
                        class="w-11 h-11 flex items-center justify-center rounded-full bg-[var(--bg-card)] border-2 border-[var(--border)] hover:bg-[var(--input-bg)] transition-all duration-300 hover:scale-110 active:scale-95 shadow-sm">
                    <i class="fas fa-ellipsis text-lg"></i>
                </button>
                <!-- Dropdown -->
                <div x-show="showProfileMore" @click.outside="showProfileMore = false"
                     x-transition:enter="transition ease-out duration-100"
                     x-transition:enter-start="opacity-0 scale-95"
                     x-transition:enter-end="opacity-100 scale-100"
                     x-transition:leave="transition ease-in duration-75"
                     x-transition:leave-start="opacity-100 scale-100"
                     x-transition:leave-end="opacity-0 scale-95"
                     class="absolute right-0 top-14 w-52 bg-[var(--bg-card)] border border-[var(--border)] rounded-2xl shadow-2xl z-50 overflow-hidden">
                    <!-- Engelle / Engeli Kaldƒ±r -->
                    <button @click="blockUser(viewedUser.id); showProfileMore = false;"
                            class="w-full flex items-center gap-3 px-4 py-3.5 text-sm font-semibold transition hover:bg-[var(--input-bg)]"
                            :class="(blockedAccountsList||[]).find(b=>b.id===viewedUser.id) ? 'text-emerald-500' : 'text-red-500'">
                        <i class="fas w-5 text-center" :class="(blockedAccountsList||[]).find(b=>b.id===viewedUser.id) ? 'fa-user-check' : 'fa-ban'"></i>
                        <span x-text="(blockedAccountsList||[]).find(b=>b.id===viewedUser.id) ? 'Engeli Kaldƒ±r' : 'Engelle'"></span>
                    </button>
                    <!-- ≈ûikayet Et -->
                    <button @click="reportUser(viewedUser.id); showProfileMore = false;"
                            class="w-full flex items-center gap-3 px-4 py-3.5 text-sm font-semibold text-orange-500 hover:bg-[var(--input-bg)] transition border-t border-[var(--border)]">
                        <i class="fas fa-flag w-5 text-center"></i>
                        <span>≈ûikayet Et</span>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Profil Bilgileri -->
        <div class="px-6 pt-4 pb-4">
            <!-- ƒ∞sim, Onay, Rozet, √áevrimi√ßi Durumu -->
            <div class="flex items-center gap-2 flex-wrap">
                <h1 class="text-2xl font-bold" x-text="viewedUser.name"></h1>
                <template x-if="viewedUser.isVerified || viewedUser.verified">
                    <span class="verified-badge">
                        <svg viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M17.7508 9.41667C17.7508 8.1 17.0217 6.95833 15.9608 6.41667C16.0892 6.05417 16.1592 5.6625 16.1592 5.25C16.1592 3.40833 14.7342 1.91833 12.9775 1.91833C12.5858 1.91833 12.2108 1.98833 11.8642 2.12667C11.3492 1.0125 10.2592 0.25 9.00083 0.25C7.7425 0.25 6.65417 1.01417 6.13667 2.125C5.79083 1.9875 5.415 1.91667 5.02333 1.91667C3.265 1.91667 1.84167 3.40833 1.84167 5.25C1.84167 5.66167 1.91083 6.05333 2.03917 6.41667C0.979167 6.95833 0.25 8.09833 0.25 9.41667C0.25 10.6625 0.901667 11.7483 1.86833 12.3217C1.85167 12.4633 1.84167 12.605 1.84167 12.75C1.84167 14.5917 3.265 16.0833 5.02333 16.0833C5.415 16.0833 5.79 16.0117 6.13583 15.875C6.6525 16.9867 7.74083 17.75 9 17.75C10.26 17.75 11.3483 16.9867 11.8642 15.875C12.21 16.0108 12.585 16.0817 12.9775 16.0817C14.7358 16.0817 16.1592 14.59 16.1592 12.7483C16.1592 12.6033 16.1492 12.4617 16.1317 12.3208C17.0967 11.7483 17.7508 10.6625 17.7508 9.4175V9.41667ZM12.2375 6.63833L8.62583 12.055C8.505 12.2358 8.3075 12.3333 8.105 12.3333C7.98583 12.3333 7.865 12.3 7.75833 12.2283L7.6625 12.15L5.65 10.1375C5.40583 9.89333 5.40583 9.4975 5.65 9.25417C5.89417 9.01083 6.29 9.00917 6.53333 9.25417L8.00833 10.7267L11.1958 5.94333C11.3875 5.65583 11.7758 5.58 12.0625 5.77083C12.3508 5.9625 12.4292 6.35083 12.2375 6.6375V6.63833Z" fill="#1D9BF0"/>
                        </svg>
                    </span>
                </template>
                <!-- ROZETLER - GELƒ∞≈ûMƒ∞≈û v2 -->
                <div class="badge-container">
                    <template x-if="viewedUser.badges && viewedUser.badges.length > 0">
                        <template x-for="badge in viewedUser.badges" :key="badge.type + (badge.level || '')">
                            <span class="user-badge" 
                                  :class="getBadgeClass(badge)"
                                  :title="badge.name">
                                <span x-text="badge.icon"></span>
                                <span class="badge-tooltip" x-text="badge.description || badge.name"></span>
                            </span>
                        </template>
                    </template>
                </div>
                <span x-show="viewedUser.isOnline" class="online-status">√áevrimi√ßi</span>
            </div>
            
            <!-- @username -->
            <p class="text-[var(--text-sec)] mt-1" x-text="'@' + viewedUser.username"></p>
            
            <!-- Bio -->
            <div class="mt-3">
                <p class="text-[var(--text-main)] leading-relaxed" x-text="viewedUser.bio ? (viewedBioExpanded ? viewedUser.bio : (viewedUser.bio.length > 100 ? viewedUser.bio.slice(0,100) + '...' : viewedUser.bio)) : 'Hen√ºz bir biyografi eklenmedi üå±'"></p>
                <template x-if="viewedUser.bio && viewedUser.bio.length > 100">
                    <button @click="viewedBioExpanded = !viewedBioExpanded" class="text-emerald-500 text-xs font-bold mt-1" x-text="viewedBioExpanded ? 'Daha az g√∂ster' : 'Daha fazla g√∂ster'"></button>
                </template>
            </div>
            
            <!-- Konum, Website ve Katƒ±lƒ±m Tarihi -->
            <div class="flex items-center gap-4 mt-3 text-[var(--text-sec)] text-sm flex-wrap">
                <template x-if="viewedUser.location">
                    <span class="flex items-center gap-1">
                        <i class="fas fa-map-marker-alt"></i>
                        <span x-text="viewedUser.location"></span>
                    </span>
                </template>
                <!-- WEB Sƒ∞TESƒ∞ EKLENDƒ∞ -->
                <template x-if="viewedUser.website">
                    <a :href="viewedUser.website.startsWith('http') ? viewedUser.website : 'https://' + viewedUser.website" 
                       target="_blank" 
                       rel="noopener noreferrer"
                       class="flex items-center gap-1 text-blue-500 hover:underline">
                        <i class="fas fa-link"></i>
                        <span x-text="viewedUser.website.replace(/^https?:\/\//, '').split('/')[0]"></span>
                    </a>
                </template>
                <span class="flex items-center gap-1">
                    <i class="far fa-calendar-alt"></i>
                    <span x-text="formatJoinDate(viewedUser.createdAt)"></span>
                </span>
            </div>
            
            <!-- Takip ƒ∞statistikleri - TIKLANABƒ∞Lƒ∞R -->
            <div class="flex items-center gap-6 mt-4">
                <div class="stat-inline cursor-pointer hover:underline" @click="showUserConnections('following')">
                    <strong x-text="formatCount(viewedUser.followingCount || viewedUser.following || 0)"></strong>
                    <span>Takip</span>
                </div>
                <div class="stat-inline cursor-pointer hover:underline" @click="showUserConnections('followers')">
                    <strong x-text="formatCount(viewedUser.followerCount || viewedUser.followers || 0)"></strong>
                    <span>Takip√ßi</span>
                </div>
            </div>
            
            <!-- Ortak Arkada≈ülar Butonu -->
            <button @click="showMutualFollowersModal = true" 
                    class="mt-4 w-full flex items-center gap-3 p-3 rounded-2xl border border-[var(--border)] bg-[var(--input-bg)] hover:bg-[var(--border)] transition cursor-pointer">
                <div class="flex -space-x-2" x-show="mutualFollowers && mutualFollowers.length > 0">
                    <template x-for="(mf, idx) in (mutualFollowers || []).slice(0, 3)" :key="mf.id || idx">
                        <div class="w-8 h-8 rounded-full overflow-hidden border-2 border-white bg-gradient-to-br from-emerald-400 to-teal-500">
                            <template x-if="mf.profilePic">
                                <img :src="mf.profilePic" :alt="mf.name" class="w-full h-full object-cover">
                            </template>
                            <template x-if="!mf.profilePic">
                                <div class="w-full h-full flex items-center justify-center text-white text-xs font-bold" x-text="(mf.name || 'K').charAt(0).toUpperCase()"></div>
                            </template>
                        </div>
                    </template>
                </div>
                <div x-show="!mutualFollowers || mutualFollowers.length === 0" class="w-10 h-10 rounded-full bg-emerald-100 flex items-center justify-center flex-shrink-0">
                    <i class="fas fa-user-friends text-emerald-500"></i>
                </div>
                <div class="flex-1 text-left">
                    <p class="text-sm font-bold"><i class="fas fa-users text-emerald-500 mr-1"></i> Ortak Arkada≈ülar</p>
                    <p class="text-xs text-[var(--text-sec)]" x-text="(mutualFollowers && mutualFollowers.length > 0) ? mutualFollowers.length + ' ortak arkada≈ü' : 'Ortak arkada≈ülarƒ± g√∂r√ºnt√ºle'"></p>
                </div>
                <i class="fas fa-chevron-right text-[var(--text-sec)]"></i>
            </button>
            
            <!-- Ortak Takip√ßiler Eski B√∂l√ºm (gizlendi) -->
            <div x-show="false"
                 class="mutual-followers mt-4" 
                 @click="showMutualFollowersModal = true"
                 style="display: flex !important;">
                <div class="mutual-followers-avatars">
                    <template x-for="(mf, idx) in mutualFollowers.slice(0, 3)" :key="mf.id || idx">
                        <div class="w-7 h-7 rounded-full overflow-hidden border-2 border-white -ml-2 first:ml-0 bg-gradient-to-br from-emerald-400 to-teal-500">
                            <template x-if="mf.profilePic">
                                <img :src="mf.profilePic" :alt="mf.name" class="w-full h-full object-cover">
                            </template>
                            <template x-if="!mf.profilePic">
                                <div class="w-full h-full flex items-center justify-center text-white text-xs font-bold" x-text="(mf.name || 'K').charAt(0).toUpperCase()"></div>
                            </template>
                        </div>
                    </template>
                </div>
                <div class="flex-1 ml-2">
                    <p class="text-sm">
                        <span class="font-bold" x-text="mutualFollowers[0]?.name || 'Arkada≈üƒ±n'"></span>
                        <template x-if="mutualFollowers.length === 1">
                            <span class="text-[var(--text-sec)]"> da bu ki≈üiyi takip ediyor</span>
                        </template>
                        <template x-if="mutualFollowers.length > 1">
                            <span class="text-[var(--text-sec)]"> ve <strong x-text="mutualFollowers.length - 1"></strong> ki≈üi daha takip ediyor</span>
                        </template>
                    </p>
                </div>
                <i class="fas fa-chevron-right text-[var(--text-sec)]"></i>
            </div>
        </div>
        
        <!-- Sekmeler -->
        <div class="profile-tabs">
            <div @click="userProfileTab = 'posts'" class="profile-tab" :class="userProfileTab === 'posts' ? 'active' : ''">
                G√∂nderiler
            </div>
            <div @click="userProfileTab = 'media'" class="profile-tab" :class="userProfileTab === 'media' ? 'active' : ''">
                Medya
            </div>
        </div>
        
        <!-- Sekme ƒ∞√ßerikleri -->
        <div class="px-4 py-4 pb-24">
            
            <!-- G√∂nderiler Sekmesi -->
            <div x-show="userProfileTab === 'posts'" class="space-y-4">
                <template x-if="viewedUserPosts.length === 0">
                    <div class="text-center py-12 text-[var(--text-sec)]">
                        <i class="fas fa-seedling text-4xl mb-3 opacity-50"></i>
                        <p class="font-medium">Hen√ºz g√∂nderi yok</p>
                    </div>
                </template>
                <template x-for="post in viewedUserPosts" :key="post.id">
                    <div class="agro-card p-4">
                        <div class="flex items-start gap-3">
                            <img :src="viewedUser.profilePic || 'https://ui-avatars.com/api/?name='+viewedUser.name" class="w-10 h-10 rounded-full object-cover flex-shrink-0">
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-1.5 flex-wrap">
                                    <span class="font-bold text-sm" x-text="viewedUser.name"></span>
                                    <template x-if="viewedUser.isVerified">
                                        <span class="verified-badge verified-badge-sm"></span>
                                    </template>
                                    <span class="text-[var(--text-sec)] text-xs" x-text="'@' + viewedUser.username"></span>
                                    <span class="text-[var(--text-sec)] text-xs">¬∑</span>
                                    <span class="text-[var(--text-sec)] text-xs" x-text="formatDate(post.createdAt)"></span>
                                </div>
                                <p class="mt-2 text-sm" x-html="formatContent(post.content)"></p>
                                <template x-if="post.mediaUrl || (post.mediaUrls && post.mediaUrls.length > 0)">
                                    <div class="mt-3"
                                         x-data="{
                                            cIdx: 0,
                                            get cItems() { if(post.mediaUrls&&post.mediaUrls.length>0) return post.mediaUrls; if(post.mediaUrl) return [{url:post.mediaUrl,type:post.mediaType||'image'}]; return []; },
                                            get cLen() { return this.cItems.length; },
                                            getUrl(item) { return typeof item==='string'?item:(item.url||item.mediaUrl||''); },
                                            getType(item) { return typeof item==='string'?'image':(item.type||item.mediaType||'image'); },
                                            touchSX: 0
                                         }">
                                        <div class="media-carousel"
                                             @touchstart="touchSX=$event.touches[0].clientX"
                                             @touchend="const dx=$event.changedTouches[0].clientX-touchSX;if(Math.abs(dx)>40){dx<0?(cIdx<cLen-1?cIdx++:null):(cIdx>0?cIdx--:null)}">
                                            <div class="media-carousel-track" :style="`transform:translateX(-${cIdx*100}%)`">
                                                <template x-for="(item,ii) in cItems" :key="ii">
                                                    <div class="media-carousel-slide">
                                                        <template x-if="getType(item)==='video'">
                                                            <div class="relative">
                                                                <div class="video-loading-overlay"><div class="video-spinner"></div></div>
                                                                <video x-init="$nextTick(()=>{$el.addEventListener('canplay',()=>$el.parentElement.querySelector('.video-loading-overlay').classList.add('hidden'));initAgroHLS($el,getUrl(item));})"
                                                                       class="w-full max-h-80 object-cover" controls preload="none" playsinline></video>
                                                            </div>
                                                        </template>
                                                        <template x-if="getType(item)!=='video'">
                                                            <img :src="getUrl(item)" @click="openTikTokScroll(post)" class="w-full max-h-80 object-cover cursor-pointer" loading="lazy">
                                                        </template>
                                                    </div>
                                                </template>
                                            </div>
                                            <template x-if="cLen>1">
                                                <div>
                                                    <button x-show="cIdx>0" @click.stop="cIdx--" class="carousel-nav-btn prev"><i class="fas fa-chevron-left text-xs"></i></button>
                                                    <button x-show="cIdx<cLen-1" @click.stop="cIdx++" class="carousel-nav-btn next"><i class="fas fa-chevron-right text-xs"></i></button>
                                                    <div class="carousel-count-badge" x-text="(cIdx+1)+'/'+cLen"></div>
                                                    <div class="carousel-dots">
                                                        <template x-for="(_,di) in cItems" :key="di"><div class="carousel-dot" :class="di===cIdx?'active':''"></div></template>
                                                    </div>
                                                </div>
                                            </template>
                                        </div>
                                    </div>
                                </template>
                                <div class="flex items-center gap-6 mt-3 text-[var(--text-sec)] text-sm">
                                    <span class="flex items-center gap-1"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg><span x-text="post.commentCount || 0"></span></span>
                                    <span class="flex items-center gap-1"><i class="far fa-heart"></i><span x-text="post.likeCount || 0"></span></span>
                                    <span class="flex items-center gap-1"><i class="fas fa-chart-bar"></i><span x-text="post.viewCount || post.views || 0"></span></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </template>
                <!-- Daha Fazla Y√ºkle - Ba≈üka Kullanƒ±cƒ± Profili -->
                <div x-show="viewedUserPostsHasMore" class="text-center py-4">
                    <button @click="loadMoreViewedUserPosts()" 
                            :disabled="viewedUserPostsLoading"
                            class="px-6 py-3 bg-emerald-500 text-white rounded-full font-bold text-sm hover:bg-emerald-600 transition disabled:opacity-50">
                        <span x-show="!viewedUserPostsLoading">Daha Fazla G√∂ster</span>
                        <span x-show="viewedUserPostsLoading"><i class="fas fa-spinner fa-spin mr-1"></i>Y√ºkleniyor...</span>
                    </button>
                </div>
            </div>
            
            <!-- Medya Sekmesi -->
            <div x-show="userProfileTab === 'media'" class="grid grid-cols-3 gap-1">
                <template x-for="post in viewedUserPosts.filter(p => p.mediaUrl || (p.mediaUrls && p.mediaUrls.length > 0))" :key="'user-media-'+post.id">
                    <div class="aspect-square overflow-hidden rounded-lg cursor-pointer hover:opacity-80 transition relative" @click="openTikTokScroll(post)">
                        <template x-if="post.mediaType === 'video'">
                            <div class="w-full h-full bg-slate-800 flex items-center justify-center relative">
                                <img :src="post.thumbnail || ''" class="w-full h-full object-cover" @error="$el.style.display='none'">
                                <i class="fas fa-play absolute text-white text-xl drop-shadow"></i>
                            </div>
                        </template>
                        <template x-if="post.mediaType !== 'video'">
                            <img :src="post.mediaUrl || (post.mediaUrls && post.mediaUrls[0] && (typeof post.mediaUrls[0]==='string'?post.mediaUrls[0]:post.mediaUrls[0].url))" class="w-full h-full object-cover" loading="lazy">
                        </template>
                        <template x-if="post.mediaUrls && post.mediaUrls.length > 1">
                            <div class="absolute top-1.5 right-1.5 bg-black/60 rounded-md px-1.5 py-0.5 text-white text-[10px] font-bold flex items-center gap-1">
                                <i class="fas fa-clone text-[8px]"></i><span x-text="post.mediaUrls.length"></span>
                            </div>
                        </template>
                    </div>
                </template>
                <template x-if="viewedUserPosts.filter(p => p.mediaUrl || (p.mediaUrls && p.mediaUrls.length > 0)).length === 0">
                    <div class="col-span-3 text-center py-12 text-[var(--text-sec)]">
                        <i class="fas fa-images text-4xl mb-3 opacity-50"></i>
                        <p class="font-medium">Hen√ºz medya yok</p>
                    </div>
                </template>
            </div>
        </div>
    </div>

    <!-- Post Se√ßenekleri Modal - TAM EKRAN -->
    <div x-show="showPostOptions" x-transition x-cloak class="fixed inset-0 z-[200] flex flex-col bg-[var(--bg-main)]">
        <!-- Header -->
        <div class="glass px-4 py-4 flex items-center justify-between">
            <button @click="showPostOptions = false" class="text-slate-500">
                <i class="fas fa-arrow-left text-xl"></i>
            </button>
            <h3 class="text-lg font-black">G√∂nderi Se√ßenekleri</h3>
            <div class="w-8"></div>
        </div>
        
        <!-- ƒ∞√ßerik -->
        <div class="flex-1 overflow-y-auto p-4">
            <!-- Se√ßilen Post √ñnizleme -->
            <div class="agro-card p-4 mb-6" x-show="selectedPost">
                <div class="flex items-center gap-3">
                    <img :src="selectedPost?.userProfilePic || 'https://ui-avatars.com/api/?name='+(selectedPost?.userName || 'User')" class="w-12 h-12 rounded-full object-cover">
                    <div>
                        <p class="font-bold" x-text="selectedPost?.userName"></p>
                        <p class="text-sm text-[var(--text-sec)]" x-text="selectedPost?.content?.substring(0, 50) + '...'"></p>
                    </div>
                </div>
            </div>
            
            <div class="space-y-3">
                <!-- Kendi postum ise -->
                <template x-if="selectedPost?.userId === user.id">
                    <div class="agro-card overflow-hidden">
                        <button @click="deletePost(selectedPost)" class="w-full p-5 text-left hover:bg-red-50 text-red-600 font-bold flex items-center gap-4 border-b border-[var(--border)]">
                            <i class="fas fa-trash text-xl"></i> 
                            <div>
                                <p class="font-bold">G√∂nderiyi Sil</p>
                                <p class="text-sm font-normal text-slate-500">Bu g√∂nderi kalƒ±cƒ± olarak silinecek</p>
                            </div>
                        </button>
                    </div>
                </template>
                
                <!-- Ba≈ükasƒ±nƒ±n postu ise -->
                <template x-if="selectedPost?.userId !== user.id">
                    <div class="agro-card overflow-hidden">
                        <button @click="showReportModal = true; showPostOptions = false" class="w-full p-5 text-left hover:bg-orange-50 font-bold flex items-center gap-4 border-b border-[var(--border)]">
                            <i class="fas fa-flag text-orange-500 text-xl"></i>
                            <div>
                                <p class="font-bold text-orange-600">≈ûikayet Et</p>
                                <p class="text-sm font-normal text-slate-500">Bu g√∂nderiyi uygunsuz olarak bildir</p>
                            </div>
                        </button>
                        <button @click="blockUserFromPost(selectedPost.userId)" class="w-full p-5 text-left hover:bg-red-50 text-red-600 font-bold flex items-center gap-4">
                            <i class="fas fa-ban text-xl"></i>
                            <div>
                                <p class="font-bold">Kullanƒ±cƒ±yƒ± Engelle</p>
                                <p class="text-sm font-normal text-slate-500">Bu kullanƒ±cƒ±nƒ±n g√∂nderilerini g√∂rmeyeceksiniz</p>
                            </div>
                        </button>
                    </div>
                </template>
            </div>
        </div>
    </div>
    
    <!-- ≈ûƒ∞KAYET MODAL - TAM EKRAN -->
    <div x-show="showReportModal" x-transition x-cloak class="fixed inset-0 z-[250] flex flex-col bg-[var(--bg-main)]">
        <div class="glass px-4 py-4 flex items-center justify-between">
            <button @click="showReportModal = false" class="text-slate-500">
                <i class="fas fa-arrow-left text-xl"></i>
            </button>
            <h3 class="text-lg font-black">G√∂nderiyi ≈ûikayet Et</h3>
            <div class="w-8"></div>
        </div>
        
        <div class="flex-1 overflow-y-auto p-4">
            <div class="agro-card p-6 mb-4">
                <div class="flex items-center gap-3 mb-4">
                    <div class="w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center">
                        <i class="fas fa-flag text-orange-500 text-xl"></i>
                    </div>
                    <div>
                        <h4 class="font-bold">≈ûikayet Nedeni</h4>
                        <p class="text-sm text-[var(--text-sec)]">Neden ≈üikayet ediyorsunuz?</p>
                    </div>
                </div>
                
                <div class="space-y-2">
                    <button @click="reportReason = 'spam'" class="w-full p-4 text-left rounded-2xl border-2 transition" :class="reportReason === 'spam' ? 'border-orange-500 bg-orange-50' : 'border-[var(--border)]'">
                        <p class="font-bold">Spam veya ƒ∞stenmeyen ƒ∞√ßerik</p>
                    </button>
                    <button @click="reportReason = 'harassment'" class="w-full p-4 text-left rounded-2xl border-2 transition" :class="reportReason === 'harassment' ? 'border-orange-500 bg-orange-50' : 'border-[var(--border)]'">
                        <p class="font-bold">Taciz veya Zorbalƒ±k</p>
                    </button>
                    <button @click="reportReason = 'violence'" class="w-full p-4 text-left rounded-2xl border-2 transition" :class="reportReason === 'violence' ? 'border-orange-500 bg-orange-50' : 'border-[var(--border)]'">
                        <p class="font-bold">≈ûiddet veya Tehdit</p>
                    </button>
                    <button @click="reportReason = 'inappropriate'" class="w-full p-4 text-left rounded-2xl border-2 transition" :class="reportReason === 'inappropriate' ? 'border-orange-500 bg-orange-50' : 'border-[var(--border)]'">
                        <p class="font-bold">Uygunsuz ƒ∞√ßerik</p>
                    </button>
                    <button @click="reportReason = 'other'" class="w-full p-4 text-left rounded-2xl border-2 transition" :class="reportReason === 'other' ? 'border-orange-500 bg-orange-50' : 'border-[var(--border)]'">
                        <p class="font-bold">Diƒüer</p>
                    </button>
                </div>
                
                <textarea x-model="reportDescription" placeholder="Ek a√ßƒ±klama (opsiyonel)..." class="w-full mt-4 bg-[var(--input-bg)] p-4 rounded-2xl border-none outline-none resize-none h-24"></textarea>
            </div>
            
            <button @click="submitReport()" class="w-full py-4 btn-agro bg-orange-500" :disabled="!reportReason || loading">
                <span x-show="!loading">≈ûikayeti G√∂nder</span>
                <i x-show="loading" class="fas fa-spinner fa-spin"></i>
            </button>
            
            <p class="text-center text-xs text-[var(--text-sec)] mt-4">
                ≈ûikayetiniz <strong><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="c3a4aca8b7a6b3a6a5a2b7aea2f583a4aea2aaafeda0acae">[email&#160;protected]</a></strong> adresine iletilecektir.
            </p>
        </div>
    </div>

    <!-- ========== ORTAK TAKƒ∞P√áƒ∞LER MODAL ========== -->
    <div x-show="showMutualFollowersModal" x-transition x-cloak class="fixed inset-0 z-[100] flex items-end justify-center">
        <div class="absolute inset-0 bg-black/40" @click="showMutualFollowersModal = false"></div>
        <div class="bg-[var(--bg-card)] w-full max-w-md rounded-t-[2.5rem] p-6 animate-slide-up max-h-[70vh] overflow-hidden flex flex-col">
            <div class="w-12 h-1.5 bg-slate-300 rounded-full mx-auto mb-4"></div>
            <h3 class="text-center font-black text-lg mb-4">Ortak Takip Edenler</h3>
            
            <div class="flex-1 overflow-y-auto space-y-2">
                <template x-for="mf in mutualFollowers" :key="mf.id || mf.username">
                    <div class="flex items-center gap-3 p-3 rounded-xl hover:bg-[var(--input-bg)] cursor-pointer" @click="viewProfile(mf.id); showMutualFollowersModal = false">
                        <!-- Profil resmi yoksa varsayƒ±lan avatar -->
                        <div class="w-12 h-12 rounded-full overflow-hidden bg-gradient-to-br from-emerald-400 to-teal-500 flex-shrink-0">
                            <template x-if="mf.profilePic">
                                <img :src="mf.profilePic" class="w-full h-full object-cover">
                            </template>
                            <template x-if="!mf.profilePic">
                                <div class="w-full h-full flex items-center justify-center text-white font-bold text-xl" x-text="(mf.name || 'K').charAt(0).toUpperCase()"></div>
                            </template>
                        </div>
                        <div class="flex-1">
                            <p class="font-bold text-sm" x-text="mf.name"></p>
                            <p class="text-xs text-[var(--text-sec)]" x-text="'@'+mf.username"></p>
                        </div>
                        <i class="fas fa-chevron-right text-[var(--text-sec)]"></i>
                    </div>
                </template>
                <template x-if="!mutualFollowers || mutualFollowers.length === 0">
                    <div class="text-center py-8 text-[var(--text-sec)]">
                        <i class="fas fa-users text-4xl mb-3 opacity-50"></i>
                        <p>Ortak takip√ßi bulunamadƒ±</p>
                    </div>
                </template>
            </div>
        </div>
    </div>
    
    <!-- ========== KAPAK FOTOƒûRAFI ZOOM MODAL ========== -->
    <div x-show="showCoverZoom" x-transition x-cloak class="pinch-zoom-container" @click.self="showCoverZoom = false">
        <button @click="showCoverZoom = false" class="absolute top-4 left-4 z-10 w-10 h-10 rounded-full bg-black/50 text-white flex items-center justify-center">
            <i class="fas fa-times text-xl"></i>
        </button>
        
        <img :src="coverZoomUrl" 
             id="zoomableImage" 
             class="pinch-zoom-image"
             :style="`transform: scale(${zoomLevel})`"
             @wheel="handleZoomWheel($event)"
             @touchstart="handleTouchZoomStart($event)"
             @touchmove="handleTouchZoomMove($event)"
             @touchend="handleTouchZoomEnd($event)">
        
        <div class="pinch-zoom-controls">
            <button @click="zoomOut()"><i class="fas fa-search-minus"></i></button>
            <button @click="zoomReset()"><i class="fas fa-redo"></i></button>
            <button @click="zoomIn()"><i class="fas fa-search-plus"></i></button>
        </div>
    </div>

    <!-- ========== TIKTOK TARZI KAYDIRMA MODAL ========== -->
    <div x-show="showTikTokScroll" x-transition x-cloak class="tiktok-scroll-container">
        <button @click="closeTikTokScroll" class="absolute top-4 left-4 z-50 text-white p-2">
            <i class="fas fa-arrow-left text-2xl"></i>
        </button>
        <!-- Ses Butonu - √ºst saƒü k√∂≈üe (tek tƒ±k = t√ºm vidolarda ses) -->
        <button @click.stop="
            globalMuted = !globalMuted;
            window.dispatchEvent(new CustomEvent('agrolink:mutechange', {detail:{muted:globalMuted}}));
            const activeV = document.querySelectorAll('.tiktok-scroll-wrapper video')[currentTikTokIndex];
            if (activeV) activeV.muted = globalMuted;
        " class="absolute top-4 right-4 z-50 w-11 h-11 bg-black/50 backdrop-blur-sm rounded-full flex items-center justify-center text-white border border-white/20 transition active:scale-90">
            <i class="fas text-lg" :class="globalMuted ? 'fa-volume-xmark' : 'fa-volume-high'"></i>
        </button>
        
        <div class="tiktok-scroll-wrapper" @scroll="handleTikTokScroll">
            <template x-for="(post, index) in tikTokPosts" :key="post.id">
                <div class="tiktok-post" 
                     @dblclick="doubleTapLike(post)">
                    
                    <!-- Kalp Atma Animasyonu -->
                    <div x-show="showHeartAnimation === post.id" 
                         x-transition
                         class="heart-animation"
                         :class="showHeartAnimation === post.id ? 'animate' : ''">
                        <i class="fas fa-heart"></i>
                    </div>
                    
                    <!-- Medya -->
                    <template x-if="post.mediaType === 'video'">
                        <div class="relative w-full h-full flex items-center justify-center"
                             x-data="{ isPlaying: true, videoLoading: true }"
                             x-init="
                                const muteH = (e) => {
                                    const v = $el.querySelector('video');
                                    if (v) v.muted = e.detail.muted;
                                };
                                window.addEventListener('agrolink:mutechange', muteH);
                                $watch('currentTikTokIndex', (newIndex) => {
                                    const thisIndex = tikTokPosts.indexOf(post);
                                    const video = $el.querySelector('video');
                                    if (!video) return;
                                    if (thisIndex === newIndex) {
                                        if (!video._agroInitialized) initAgroHLS(video, post.mediaUrl);
                                        video.muted = globalMuted;
                                        isPlaying = true;
                                        video.play().catch(() => { video.muted = true; });
                                    } else {
                                        video.pause(); isPlaying = false;
                                    }
                                });
                             "
                             @click="
                                const video = $el.querySelector('video');
                                if (!video) return;
                                if (video.paused) { video.play(); isPlaying = true; }
                                else { video.pause(); isPlaying = false; }
                             ">
                            <!-- Video Loading Spinner -->
                            <div x-show="videoLoading" class="absolute inset-0 flex items-center justify-center z-20 pointer-events-none">
                                <div class="video-spinner" style="width:56px;height:56px;border-width:5px;"></div>
                            </div>
                            <!-- Duraklat g√∂stergesi -->
                            <div x-show="!isPlaying" class="absolute inset-0 flex items-center justify-center z-10 pointer-events-none">
                                <div class="bg-black/50 rounded-full w-20 h-20 flex items-center justify-center">
                                    <i class="fas fa-play text-white text-3xl ml-1"></i>
                                </div>
                            </div>
                            <video :poster="post.thumbnail || ''"
                                   x-init="$nextTick(() => {
                                       const v = $el;
                                       v.addEventListener('loadstart', () => videoLoading = true);
                                       v.addEventListener('waiting', () => videoLoading = true);
                                       v.addEventListener('canplay', () => videoLoading = false);
                                       v.addEventListener('playing', () => { videoLoading = false; isPlaying = true; });
                                       v.addEventListener('pause', () => isPlaying = false);
                                       v.addEventListener('error', () => videoLoading = false);
                                       const thisIdx = tikTokPosts.indexOf(post);
                                       if (Math.abs(thisIdx - currentTikTokIndex) <= 1) initAgroHLS(v, post.mediaUrl);
                                   })"
                                   autoplay loop muted playsinline preload="none"
                                   class="max-h-screen max-w-full"
                                   x-ref="tiktokvideo"></video>
                        </div>
                    </template>
                    <!-- Resim - Carousel (birden fazla varsa) -->
                    <template x-if="post.mediaType !== 'video'">
                        <div class="w-full h-full flex items-center justify-center"
                             x-data="{
                                cIdx: 0,
                                get cItems() {
                                    if (post.mediaUrls && post.mediaUrls.length > 0) return post.mediaUrls;
                                    if (post.mediaUrl) return [post.mediaUrl];
                                    return [];
                                },
                                get cLen() { return this.cItems.length; },
                                getUrl(item) { return typeof item === 'string' ? item : (item.url || item.mediaUrl || ''); },
                                touchSX: 0,
                                onTS(e) { this.touchSX = e.touches[0].clientX; },
                                onTE(e) { const dx = e.changedTouches[0].clientX - this.touchSX; if (Math.abs(dx) > 40) { dx < 0 ? (this.cIdx < this.cLen-1 ? this.cIdx++ : null) : (this.cIdx > 0 ? this.cIdx-- : null); } }
                             }"
                             style="position:relative;overflow:hidden;"
                             @touchstart="onTS($event)" @touchend="onTE($event)">
                            <div style="display:flex;width:100%;height:100%;transition:transform 0.35s cubic-bezier(.4,0,.2,1);" :style="`transform:translateX(-${cIdx*100}%)`">
                                <template x-for="(item, ii) in cItems" :key="ii">
                                    <div style="flex:0 0 100%;width:100%;height:100%;display:flex;align-items:center;justify-content:center;">
                                        <img :src="getUrl(item)" class="max-h-screen max-w-full object-contain" loading="lazy">
                                    </div>
                                </template>
                            </div>
                            <template x-if="cLen > 1">
                                <div>
                                    <button x-show="cIdx > 0" @click.stop="cIdx--" class="carousel-nav-btn prev" style="top:50%;"><i class="fas fa-chevron-left text-xs"></i></button>
                                    <button x-show="cIdx < cLen-1" @click.stop="cIdx++" class="carousel-nav-btn next" style="top:50%;"><i class="fas fa-chevron-right text-xs"></i></button>
                                    <div class="carousel-count-badge" x-text="(cIdx+1)+'/'+cLen"></div>
                                    <div class="carousel-dots" style="bottom:100px;">
                                        <template x-for="(_, di) in cItems" :key="di">
                                            <div class="carousel-dot" :class="di===cIdx?'active':''"></div>
                                        </template>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </template>
                    
                    <!-- ƒ∞√ßerik (metin g√∂nderisi) -->
                    <template x-if="!post.mediaUrl">
                        <div class="text-white text-center p-8 max-w-md">
                            <p class="text-xl" x-text="post.content"></p>
                        </div>
                    </template>
                    
                    <!-- Sol Alt - Kullanƒ±cƒ± Bilgisi -->
                    <div class="absolute bottom-20 left-4 right-24 text-white z-10">
                        <div class="flex items-center gap-2 mb-2">
                            <img :src="post.userProfilePic || 'https://ui-avatars.com/api/?name='+post.userName" 
                                 class="w-10 h-10 rounded-full border-2 border-white cursor-pointer" @click.stop="closeTikTokScroll(); viewProfile(post.userId)">
                            <span class="font-bold cursor-pointer hover:underline" x-text="post.userName" @click.stop="closeTikTokScroll(); viewProfile(post.userId)"></span>
                            <template x-if="post.userVerified">
                                <i class="fas fa-check-circle text-blue-400"></i>
                            </template>
                        </div>
                        <p class="text-sm opacity-90 line-clamp-3" x-text="post.content"></p>
                        <p class="text-xs opacity-60 mt-1" x-text="formatDate(post.createdAt)"></p>
                    </div>
                    
                    <!-- Saƒü Taraf - Eylem Butonlarƒ± -->
                    <div class="side-actions">
                        <!-- Profil -->
                        <div class="side-action-btn" @click="viewProfile(post.userId)">
                            <img :src="post.userProfilePic || 'https://ui-avatars.com/api/?name='+post.userName" 
                                 class="w-10 h-10 rounded-full border-2 border-white">
                        </div>
                        
                        <!-- Beƒüen -->
                        <button class="side-action-btn" @click="likePost(post)">
                            <i class="fas fa-heart" :class="post.isLiked ? 'text-red-500' : ''"></i>
                            <span x-text="post.likeCount || 0"></span>
                        </button>
                        
                        <!-- Yorum -->
                        <button class="side-action-btn" @click="openComments(post)" x-show="!post.commentsDisabled && post.allowComments !== 0">
                            <i class="fas fa-comment"></i>
                            <span x-text="post.commentCount || 0"></span>
                        </button>
                        <div class="side-action-btn" x-show="post.commentsDisabled || post.allowComments === 0" title="Yorumlar kapatƒ±lmƒ±≈ü" style="opacity:0.4;cursor:default;">
                            <i class="fas fa-comment-slash"></i>
                        </div>
                        
                        <!-- G√∂r√ºnt√ºlenme -->
                        <div class="side-action-btn">
                            <i class="fas fa-eye"></i>
                            <span x-text="post.viewCount || post.views || 0"></span>
                        </div>
                        
                        <!-- Payla≈ü -->
                        <button class="side-action-btn" @click="sharePost(post)">
                            <i class="fas fa-share"></i>
                            <span>Payla≈ü</span>
                        </button>
                    </div>
                </div>
            </template>
        </div>
    </div>

    <!-- ========== PROFƒ∞L RESMƒ∞ SE√áENEK POPUP ========== -->
    <div x-show="showProfilePicPopup" x-transition x-cloak class="profile-pic-popup-overlay" @click.self="showProfilePicPopup = false">
        <div class="profile-pic-popup" @click.stop>
            <!-- Profil resmi √∂nizleme -->
            <div class="flex justify-center py-4">
                <img :src="profilePicPopupData.profilePic" class="w-20 h-20 rounded-full object-cover shadow-lg" 
                     :class="profilePicPopupData.hasStory ? 'ring-4 ring-gradient' : ''"
                     style="border: 3px solid var(--agro-green);">
            </div>
            <!-- Profil Resmine Bak -->
            <div class="profile-pic-popup-item" @click="showProfilePicPopup = false; openFullScreen(profilePicPopupData.profilePic, 'image')">
                <i class="fas fa-user-circle bg-gradient-to-br from-blue-500 to-blue-600 text-white"></i>
                <span>Profil Resmine Bak</span>
            </div>
            <!-- Hikayeye Bak - sadece hikaye varsa -->
            <template x-if="profilePicPopupData.hasStory">
                <div class="profile-pic-popup-item" @click="showProfilePicPopup = false; handleViewStoryFromPopup()">
                    <i class="fas fa-circle-play bg-gradient-to-br from-pink-500 to-orange-500 text-white"></i>
                    <span>Hikayeye Bak</span>
                </div>
            </template>
            <!-- Hikaye yok mesajƒ± -->
            <template x-if="!profilePicPopupData.hasStory">
                <div class="profile-pic-popup-item opacity-50 cursor-not-allowed" style="pointer-events:none;">
                    <i class="fas fa-circle-play bg-slate-400 text-white"></i>
                    <span>Hikaye Yok</span>
                </div>
            </template>
            <!-- ƒ∞ptal -->
            <div class="profile-pic-popup-item text-red-500" @click="showProfilePicPopup = false" style="justify-content:center; color: var(--text-sec);">
                <span>ƒ∞ptal</span>
            </div>
        </div>
    </div>

    <!-- ========== AGROBOT AI SOHBET PANELƒ∞ - TAM EKRAN v6.0 ========== -->

    <style>
    /* ===== AGROBOT TAM EKRAN STƒ∞LLERƒ∞ ===== */
    .agrobot-fullscreen {
        position: fixed;
        inset: 0;
        z-index: 500;
        display: flex;
        flex-direction: column;
        background: var(--bg-main);
        font-family: 'Plus Jakarta Sans', sans-serif;
    }

    /* Koyu Tema Zorunlu (AgroBot kendi temasƒ±nda) */
    .agrobot-dark {
        --ab-bg: #0a0f0d;
        --ab-surface: #111a14;
        --ab-surface2: #172019;
        --ab-border: #1e2e22;
        --ab-accent: #00b894;
        --ab-accent2: #0984e3;
        --ab-text: #e8f2eb;
        --ab-text2: #8fa897;
        --ab-user-bubble: #00b89422;
        --ab-bot-bubble: #141c17;
        --ab-input-bg: #141c17;
        --ab-glow: rgba(0,184,148,0.25);
    }
    .agrobot-light {
        --ab-bg: #f0faf5;
        --ab-surface: #ffffff;
        --ab-surface2: #e8f5ee;
        --ab-border: #c8e6d4;
        --ab-accent: #00b894;
        --ab-accent2: #0984e3;
        --ab-text: #1e3028;
        --ab-text2: #4a7060;
        --ab-user-bubble: #00b89415;
        --ab-bot-bubble: #f7fdf9;
        --ab-input-bg: #edf7f2;
        --ab-glow: rgba(0,184,148,0.15);
    }

    .agrobot-fullscreen {
        background: var(--ab-bg);
        color: var(--ab-text);
    }

    /* ‚îÄ‚îÄ Header ‚îÄ‚îÄ */
    .ab-header {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 14px 18px;
        background: var(--ab-surface);
        border-bottom: 1px solid var(--ab-border);
        flex-shrink: 0;
        position: relative;
    }
    .ab-header::after {
        content: '';
        position: absolute;
        bottom: 0; left: 0; right: 0;
        height: 1px;
        background: linear-gradient(90deg, transparent, var(--ab-accent), transparent);
        opacity: 0.5;
    }

    .ab-logo {
        width: 42px; height: 42px;
        border-radius: 14px;
        background: linear-gradient(135deg, #00b894, #0984e3);
        display: flex; align-items: center; justify-content: center;
        font-size: 20px;
        box-shadow: 0 0 20px var(--ab-glow);
        flex-shrink: 0;
        animation: abLogoPulse 3s ease-in-out infinite;
    }
    @keyframes abLogoPulse {
        0%,100% { box-shadow: 0 0 15px var(--ab-glow); }
        50% { box-shadow: 0 0 30px var(--ab-glow); }
    }

    .ab-title { font-size: 16px; font-weight: 800; color: var(--ab-text); }
    .ab-status { font-size: 11px; color: var(--ab-text2); }

    .ab-header-btn {
        width: 36px; height: 36px;
        border-radius: 10px;
        background: var(--ab-surface2);
        border: 1px solid var(--ab-border);
        display: flex; align-items: center; justify-content: center;
        color: var(--ab-text2);
        cursor: pointer;
        transition: all 0.2s;
        font-size: 14px;
        flex-shrink: 0;
    }
    .ab-header-btn:hover { background: var(--ab-border); color: var(--ab-text); }
    .ab-header-btn.active { background: var(--ab-accent); color: white; border-color: var(--ab-accent); }

    /* ‚îÄ‚îÄ AGROLIVE Mod Banner ‚îÄ‚îÄ */
    .agrolive-banner {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 10px 18px;
        background: linear-gradient(135deg, rgba(255,59,92,0.15), rgba(255,59,92,0.05));
        border-bottom: 1px solid rgba(255,59,92,0.2);
        flex-shrink: 0;
    }
    .agrolive-dot {
        width: 10px; height: 10px;
        border-radius: 50%;
        background: #ff3b5c;
        animation: livePulse 1s ease-in-out infinite;
        flex-shrink: 0;
    }
    @keyframes livePulse {
        0%,100% { box-shadow: 0 0 0 0 rgba(255,59,92,0.5); }
        50% { box-shadow: 0 0 0 6px rgba(255,59,92,0); }
    }
    .agrolive-label {
        font-size: 12px; font-weight: 700;
        color: #ff3b5c;
        letter-spacing: 0.05em;
        text-transform: uppercase;
    }
    .agrolive-desc { font-size: 11px; color: var(--ab-text2); flex: 1; }

    /* ‚îÄ‚îÄ Mesaj Alanƒ± ‚îÄ‚îÄ */
    .ab-messages {
        flex: 1;
        overflow-y: auto;
        padding: 16px;
        display: flex;
        flex-direction: column;
        gap: 12px;
        scroll-behavior: smooth;
    }
    .ab-messages::-webkit-scrollbar { width: 4px; }
    .ab-messages::-webkit-scrollbar-track { background: transparent; }
    .ab-messages::-webkit-scrollbar-thumb { background: var(--ab-border); border-radius: 4px; }

    /* ‚îÄ‚îÄ Mesaj Bubble ‚îÄ‚îÄ */
    .ab-msg-wrap { display: flex; align-items: flex-end; gap: 8px; }
    .ab-msg-wrap.user { flex-direction: row-reverse; }

    .ab-avatar {
        width: 30px; height: 30px;
        border-radius: 10px;
        display: flex; align-items: center; justify-content: center;
        font-size: 14px;
        flex-shrink: 0;
    }
    .ab-avatar.bot {
        background: linear-gradient(135deg, #00b894, #0984e3);
        color: white;
    }
    .ab-avatar.user {
        background: var(--ab-surface2);
        color: var(--ab-text2);
    }

    .ab-bubble {
        max-width: 80%;
        padding: 10px 14px;
        border-radius: 18px;
        font-size: 14px;
        line-height: 1.5;
        position: relative;
    }
    .ab-bubble.bot {
        background: var(--ab-bot-bubble);
        border: 1px solid var(--ab-border);
        border-bottom-left-radius: 4px;
        color: var(--ab-text);
    }
    .ab-bubble.user {
        background: linear-gradient(135deg, #00b894, #00a07d);
        color: white;
        border-bottom-right-radius: 4px;
        box-shadow: 0 4px 15px rgba(0,184,148,0.25);
    }

    /* Cevap sonrasƒ± ara√ßlar */
    .ab-msg-actions {
        display: flex;
        gap: 4px;
        margin-top: 6px;
        opacity: 0;
        transition: opacity 0.2s;
    }
    .ab-msg-wrap:hover .ab-msg-actions { opacity: 1; }
    .ab-msg-wrap.user .ab-msg-actions { justify-content: flex-end; }

    .ab-action-btn {
        padding: 4px 10px;
        border-radius: 20px;
        font-size: 11px;
        font-weight: 600;
        cursor: pointer;
        border: 1px solid var(--ab-border);
        background: var(--ab-surface);
        color: var(--ab-text2);
        display: flex; align-items: center; gap: 4px;
        transition: all 0.2s;
    }
    .ab-action-btn:hover { background: var(--ab-accent); color: white; border-color: var(--ab-accent); }

    /* ‚îÄ‚îÄ D√º≈ü√ºnme animasyonu (yansƒ±malƒ±) ‚îÄ‚îÄ */
    .ab-thinking {
        display: flex;
        align-items: flex-end;
        gap: 8px;
        padding: 4px 0;
    }
    .ab-think-bubble {
        background: var(--ab-bot-bubble);
        border: 1px solid var(--ab-border);
        border-bottom-left-radius: 4px;
        border-radius: 18px;
        padding: 12px 16px;
        display: flex;
        flex-direction: column;
        gap: 6px;
        min-width: 140px;
    }
    .ab-think-label {
        font-size: 10px;
        color: var(--ab-text2);
        font-weight: 600;
        letter-spacing: 0.05em;
        text-transform: uppercase;
        display: flex;
        align-items: center;
        gap: 6px;
    }
    .ab-think-label::before {
        content: '';
        width: 6px; height: 6px;
        border-radius: 50%;
        background: var(--ab-accent);
        animation: thinkBlink 1s ease-in-out infinite;
    }
    @keyframes thinkBlink {
        0%,100% { opacity: 1; }
        50% { opacity: 0.3; }
    }
    .ab-reflect-bars {
        display: flex;
        gap: 3px;
        align-items: flex-end;
        height: 20px;
    }
    .ab-reflect-bar {
        width: 3px;
        border-radius: 2px;
        background: linear-gradient(to top, var(--ab-accent), var(--ab-accent2));
        animation: barReflect 1.2s ease-in-out infinite;
    }
    .ab-reflect-bar:nth-child(1) { animation-delay: 0s; }
    .ab-reflect-bar:nth-child(2) { animation-delay: 0.1s; }
    .ab-reflect-bar:nth-child(3) { animation-delay: 0.2s; }
    .ab-reflect-bar:nth-child(4) { animation-delay: 0.3s; }
    .ab-reflect-bar:nth-child(5) { animation-delay: 0.4s; }
    .ab-reflect-bar:nth-child(6) { animation-delay: 0.5s; }
    .ab-reflect-bar:nth-child(7) { animation-delay: 0.6s; }
    .ab-reflect-bar:nth-child(8) { animation-delay: 0.7s; }
    @keyframes barReflect {
        0%,100% { height: 4px; opacity: 0.3; }
        50% { height: 20px; opacity: 1; }
    }

    /* ‚îÄ‚îÄ Input Alanƒ± ‚îÄ‚îÄ */
    .ab-input-area {
        padding: 12px 16px;
        background: var(--ab-surface);
        border-top: 1px solid var(--ab-border);
        flex-shrink: 0;
    }
    .ab-input-row {
        display: flex;
        align-items: center;
        gap: 10px;
        background: var(--ab-input-bg);
        border: 1.5px solid var(--ab-border);
        border-radius: 20px;
        padding: 8px 8px 8px 16px;
        transition: border-color 0.2s;
    }
    .ab-input-row:focus-within {
        border-color: var(--ab-accent);
        box-shadow: 0 0 0 3px rgba(0,184,148,0.1);
    }
    .ab-input-field {
        flex: 1;
        background: transparent;
        border: none;
        outline: none;
        font-size: 14px;
        color: var(--ab-text);
        font-family: 'Plus Jakarta Sans', sans-serif;
        min-width: 0;
    }
    .ab-input-field::placeholder { color: var(--ab-text2); }

    .ab-send-btn {
        width: 38px; height: 38px;
        border-radius: 14px;
        background: linear-gradient(135deg, #00b894, #0984e3);
        border: none;
        display: flex; align-items: center; justify-content: center;
        cursor: pointer;
        transition: all 0.2s;
        flex-shrink: 0;
        font-size: 15px;
        color: white;
    }
    .ab-send-btn:hover { transform: scale(1.05); box-shadow: 0 4px 15px rgba(0,184,148,0.4); }
    .ab-send-btn:active { transform: scale(0.95); }
    .ab-send-btn:disabled { opacity: 0.4; cursor: not-allowed; transform: none; }

    /* Sesli kayƒ±t butonu */
    .ab-mic-btn {
        width: 38px; height: 38px;
        border-radius: 14px;
        background: var(--ab-surface2);
        border: 1px solid var(--ab-border);
        display: flex; align-items: center; justify-content: center;
        cursor: pointer;
        transition: all 0.2s;
        flex-shrink: 0;
        color: var(--ab-text2);
        font-size: 15px;
    }
    .ab-mic-btn.recording {
        background: #ff3b5c;
        border-color: #ff3b5c;
        color: white;
        animation: micPulse 1s ease-in-out infinite;
    }
    @keyframes micPulse {
        0%,100% { box-shadow: 0 0 0 0 rgba(255,59,92,0.5); }
        50% { box-shadow: 0 0 0 8px rgba(255,59,92,0); }
    }

    /* ‚îÄ‚îÄ AgroLive Sesli Mod Overlay ‚îÄ‚îÄ */
    .agrolive-overlay {
        position: absolute;
        inset: 0;
        background: var(--ab-bg);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 24px;
        z-index: 10;
    }
    .agrolive-avatar-ring {
        width: 120px; height: 120px;
        border-radius: 50%;
        background: linear-gradient(135deg, rgba(255,59,92,0.2), rgba(255,59,92,0.05));
        border: 2px solid rgba(255,59,92,0.3);
        display: flex; align-items: center; justify-content: center;
        position: relative;
    }
    .agrolive-avatar-ring::before, .agrolive-avatar-ring::after {
        content: '';
        position: absolute;
        border-radius: 50%;
        border: 1px solid rgba(255,59,92,0.2);
        animation: ringExpand 2s ease-out infinite;
    }
    .agrolive-avatar-ring::before { width: 140px; height: 140px; animation-delay: 0s; }
    .agrolive-avatar-ring::after { width: 165px; height: 165px; animation-delay: 0.6s; }
    @keyframes ringExpand {
        0% { transform: scale(0.8); opacity: 0.8; }
        100% { transform: scale(1.2); opacity: 0; }
    }
    .agrolive-avatar-inner {
        width: 90px; height: 90px;
        border-radius: 50%;
        background: linear-gradient(135deg, #ff3b5c, #ff6b35);
        display: flex; align-items: center; justify-content: center;
        font-size: 40px;
        box-shadow: 0 8px 30px rgba(255,59,92,0.4);
    }
    .agrolive-wave {
        display: flex;
        align-items: flex-end;
        gap: 3px;
        height: 36px;
    }
    .agrolive-wave-bar {
        width: 4px;
        border-radius: 3px;
        background: linear-gradient(to top, #ff3b5c, #ff6b35);
        transition: height 0.1s ease;
    }
    .agrolive-status-text {
        font-size: 14px;
        font-weight: 600;
        color: var(--ab-text);
        text-align: center;
    }
    .agrolive-status-sub {
        font-size: 12px;
        color: var(--ab-text2);
        margin-top: 4px;
    }
    .agrolive-controls {
        display: flex;
        gap: 16px;
        align-items: center;
    }
    .agrolive-ctrl-btn {
        width: 56px; height: 56px;
        border-radius: 50%;
        display: flex; align-items: center; justify-content: center;
        cursor: pointer;
        font-size: 22px;
        transition: all 0.2s;
        border: none;
    }
    .agrolive-ctrl-btn.end {
        background: #ff3b5c;
        color: white;
        box-shadow: 0 4px 20px rgba(255,59,92,0.5);
    }
    .agrolive-ctrl-btn.mute {
        background: var(--ab-surface2);
        color: var(--ab-text);
        border: 1px solid var(--ab-border);
    }
    .agrolive-ctrl-btn:active { transform: scale(0.92); }

    /* ‚îÄ‚îÄ Hƒ±zlƒ± Soru √ñnerileri ‚îÄ‚îÄ */
    .ab-suggestions {
        display: flex;
        gap: 8px;
        flex-wrap: nowrap;
        overflow-x: auto;
        padding: 0 16px 10px;
        scrollbar-width: none;
    }
    .ab-suggestions::-webkit-scrollbar { display: none; }
    .ab-suggestion-chip {
        white-space: nowrap;
        padding: 6px 14px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
        background: var(--ab-surface2);
        border: 1px solid var(--ab-border);
        color: var(--ab-text2);
        cursor: pointer;
        transition: all 0.2s;
        flex-shrink: 0;
    }
    .ab-suggestion-chip:hover { background: var(--ab-accent); color: white; border-color: var(--ab-accent); }

    /* ‚îÄ‚îÄ Toast Bildirim ‚îÄ‚îÄ */
    .ab-toast {
        position: fixed;
        top: 70px;
        left: 50%;
        transform: translateX(-50%) translateY(-20px);
        background: #00b894;
        color: white;
        padding: 8px 18px;
        border-radius: 20px;
        font-size: 13px;
        font-weight: 600;
        z-index: 9999;
        opacity: 0;
        transition: all 0.3s;
        pointer-events: none;
        white-space: nowrap;
    }
    .ab-toast.show {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
    }

    /* ‚îÄ‚îÄ Bot Cevap Yazma Animasyonu ‚îÄ‚îÄ */
    @keyframes bubblePop {
        0% { transform: scale(0.8); opacity: 0; }
        60% { transform: scale(1.03); }
        100% { transform: scale(1); opacity: 1; }
    }
    .ab-bubble-new { animation: bubblePop 0.3s ease forwards; }

    /* ‚îÄ‚îÄ Koyu/A√ßƒ±k Tema Toggle ‚îÄ‚îÄ */
    .ab-theme-toggle {
        width: 46px; height: 24px;
        border-radius: 12px;
        background: var(--ab-surface2);
        border: 1px solid var(--ab-border);
        cursor: pointer;
        position: relative;
        transition: background 0.3s;
        flex-shrink: 0;
    }
    .ab-theme-toggle.dark-on { background: #1a2c22; border-color: var(--ab-accent); }
    .ab-theme-toggle::after {
        content: '';
        position: absolute;
        top: 2px; left: 2px;
        width: 18px; height: 18px;
        border-radius: 50%;
        background: var(--ab-text2);
        transition: all 0.3s;
    }
    .ab-theme-toggle.dark-on::after { left: 24px; background: var(--ab-accent); }

    /* ‚îÄ‚îÄ Sesli okuma animasyonu ‚îÄ‚îÄ */
    .ab-speaking-indicator {
        display: inline-flex;
        gap: 2px;
        align-items: center;
        margin-left: 6px;
        vertical-align: middle;
    }
    .ab-speak-dot {
        width: 3px; height: 3px;
        border-radius: 50%;
        background: var(--ab-accent);
        animation: speakDot 0.8s ease-in-out infinite;
    }
    .ab-speak-dot:nth-child(2) { animation-delay: 0.15s; }
    .ab-speak-dot:nth-child(3) { animation-delay: 0.3s; }
    @keyframes speakDot { 0%,80%,100% { transform: scale(0.6); opacity: 0.4; } 40% { transform: scale(1); opacity: 1; } }
    </style>

    <!-- Floating buton - sadece giri≈ü yapƒ±ldƒ±ƒüƒ±nda g√∂r√ºn√ºr -->
    <template x-if="isLoggedIn">
        <div>
            <!-- Floating AI Butonu - Sadece home tab'ƒ±nda, nav g√∂r√ºn√ºrken -->
            <button @click="showAIChat = !showAIChat"
                    x-show="activeTab === 'home' && !showTikTokScroll && !showChatModal && !showAIChat"
                    id="aiBotFloatBtn"
                    class="fixed right-4 z-[180] w-14 h-14 rounded-full shadow-2xl flex items-center justify-center transition-all active:scale-95"
                    style="background: linear-gradient(135deg, #00b894, #0984e3); bottom: 80px; transition: transform 0.3s ease, opacity 0.3s ease;"
                    title="AgroBot AI Asistan">
                <i class="fas fa-robot text-xl" style="color:white;"></i>
            </button>

            <!-- ========== TAM EKRAN AGROBOT PANELƒ∞ ========== -->
            <div x-show="showAIChat"
                 x-cloak
                 x-transition:enter="transition ease-out duration-300"
                 x-transition:enter-start="opacity-0 translate-y-full"
                 x-transition:enter-end="opacity-100 translate-y-0"
                 x-transition:leave="transition ease-in duration-200"
                 x-transition:leave-start="opacity-100 translate-y-0"
                 x-transition:leave-end="opacity-0 translate-y-full"
                 class="agrobot-fullscreen"
                 :class="abDarkMode ? 'agrobot-dark' : 'agrobot-light'"
                 style="z-index: 490;">

                <!-- Toast -->
                <div id="abToast" class="ab-toast"></div>

                <!-- ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ -->
                <div class="ab-header">
                    <!-- Geri -->
                    <button @click="showAIChat = false" class="ab-header-btn">
                        <i class="fas fa-arrow-left"></i>
                    </button>

                    <!-- Logo + ƒ∞sim -->
                    <div class="ab-logo">ü§ñ</div>
                    <div class="flex-1 min-w-0">
                        <div class="ab-title">AgroBot</div>
                        <div class="ab-status" x-text="aiOnline ? 'üü¢ √áevrimi√ßi ‚Äî Tarƒ±m AI Asistanƒ±' : 'üî¥ √áevrimdƒ±≈üƒ±'"></div>
                    </div>

                    <!-- Tema Toggle (Ay/G√ºne≈ü) -->
                    <button @click="abDarkMode = !abDarkMode" class="ab-header-btn" :title="abDarkMode ? 'A√ßƒ±k Tema' : 'Koyu Tema'">
                        <i class="fas" x-text="abDarkMode ? '‚òÄÔ∏è' : 'üåô'"></i>
                    </button>

                    <!-- AgroLive Mod -->
                    <button @click="toggleAgroLive()"
                            class="ab-header-btn"
                            :class="agroLiveMode ? 'active' : ''"
                            title="AgroLive ‚Äî Sesli Sohbet">
                        <i class="fas fa-microphone"></i>
                    </button>

                    <!-- Sƒ±fƒ±rla -->
                    <button @click="resetAIChat()" class="ab-header-btn" title="Sohbeti Sƒ±fƒ±rla">
                        <i class="fas fa-redo-alt"></i>
                    </button>
                </div>

                <!-- ‚îÄ‚îÄ AGROLIVE BANNER (mod aktifken) ‚îÄ‚îÄ -->
                <div x-show="agroLiveMode && !agroLiveActive" class="agrolive-banner">
                    <div class="agrolive-dot"></div>
                    <div>
                        <div class="agrolive-label">AgroLive Modu</div>
                        <div class="agrolive-desc">Mikrofona tƒ±kla ve sesli konu≈ü ‚Äî AgroBot seni dinleyecek</div>
                    </div>
                    <button @click="agroLiveMode = false" style="color:var(--ab-text2); font-size:14px; background:none; border:none; cursor:pointer;">
                        <i class="fas fa-times"></i>
                    </button>
                </div>

                <!-- ‚îÄ‚îÄ MESAJLAR ‚îÄ‚îÄ -->
                <div class="ab-messages" id="abMessages" x-ref="abChatBox">
                    <template x-for="(msg, i) in aiMessages" :key="i">
                        <div>
                            <div class="ab-msg-wrap" :class="msg.role === 'user' ? 'user' : ''">
                                <!-- Bot Avatar -->
                                <div x-show="msg.role !== 'user'" class="ab-avatar bot">üå±</div>
                                <!-- User Avatar -->
                                <div x-show="msg.role === 'user'" class="ab-avatar user">
                                    <i class="fas fa-user" style="font-size:13px;"></i>
                                </div>

                                <div class="flex flex-col" :style="msg.role === 'user' ? 'align-items:flex-end' : 'align-items:flex-start'">
                                    <!-- Bubble -->
                                    <div class="ab-bubble ab-bubble-new" :class="msg.role === 'user' ? 'user' : 'bot'"
                                         :id="'abMsg'+i">
                                        <span x-text="msg.content"></span>
                                        <!-- Sesli okuma indikat√∂r√º -->
                                        <span x-show="abSpeakingIdx === i" class="ab-speaking-indicator">
                                            <span class="ab-speak-dot"></span>
                                            <span class="ab-speak-dot"></span>
                                            <span class="ab-speak-dot"></span>
                                        </span>
                                    </div>

                                    <!-- Aksiyon Butonlarƒ± (bot mesajlarƒ± i√ßin) -->
                                    <div x-show="msg.role === 'assistant'" class="ab-msg-actions">
                                        <!-- Sesli Oku -->
                                        <button class="ab-action-btn" @click="speakMessage(msg.content, i)" title="Sesli Oku">
                                            <i class="fas" x-text="abSpeakingIdx === i ? '‚èπ' : 'üîä'"></i>
                                            <span x-text="abSpeakingIdx === i ? 'Dur' : 'Oku'"></span>
                                        </button>
                                        <!-- Kopyala -->
                                        <button class="ab-action-btn" @click="copyMessage(msg.content)" title="Kopyala">
                                            <i class="fas fa-copy"></i>
                                            <span>Kopyala</span>
                                        </button>
                                        <!-- Yeniden Sor -->
                                        <button class="ab-action-btn" @click="retryMessage(i)" title="Yeniden Sor" x-show="i > 0">
                                            <i class="fas fa-redo"></i>
                                            <span>Yenile</span>
                                        </button>
                                    </div>
                                    <!-- Kullanƒ±cƒ± mesajƒ± aksiyonlarƒ± -->
                                    <div x-show="msg.role === 'user'" class="ab-msg-actions">
                                        <button class="ab-action-btn" @click="copyMessage(msg.content)">
                                            <i class="fas fa-copy"></i>
                                            <span>Kopyala</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </template>

                    <!-- ‚îÄ‚îÄ YANSIMALi D√ú≈û√úNME ANƒ∞MASYONU ‚îÄ‚îÄ -->
                    <div x-show="aiTyping" class="ab-thinking">
                        <div class="ab-avatar bot">üå±</div>
                        <div class="ab-think-bubble">
                            <div class="ab-think-label">D√º≈ü√ºn√ºyor</div>
                            <div class="ab-reflect-bars">
                                <div class="ab-reflect-bar" style="height:4px"></div>
                                <div class="ab-reflect-bar" style="height:8px"></div>
                                <div class="ab-reflect-bar" style="height:12px"></div>
                                <div class="ab-reflect-bar" style="height:16px"></div>
                                <div class="ab-reflect-bar" style="height:20px"></div>
                                <div class="ab-reflect-bar" style="height:14px"></div>
                                <div class="ab-reflect-bar" style="height:9px"></div>
                                <div class="ab-reflect-bar" style="height:5px"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ‚îÄ‚îÄ HIZLI SORU √ñNERƒ∞LERƒ∞ ‚îÄ‚îÄ -->
                <div class="ab-suggestions" x-show="aiMessages.length <= 2 && !aiTyping">
                    <div class="ab-suggestion-chip" @click="quickAsk('Domates i√ßin sulama ne zaman yapƒ±lmalƒ±?')">üíß Sulama zamanƒ±</div>
                    <div class="ab-suggestion-chip" @click="quickAsk('Buƒüday hastalƒ±klarƒ± ve tedavileri nelerdir?')">üåæ Hastalƒ±klar</div>
                    <div class="ab-suggestion-chip" @click="quickAsk('Organik g√ºbre nasƒ±l yapƒ±lƒ±r?')">üåø Organik g√ºbre</div>
                    <div class="ab-suggestion-chip" @click="quickAsk('Bu mevsim hangi sebzeler ekilmeli?')">ü•¨ Mevsim ekimi</div>
                    <div class="ab-suggestion-chip" @click="quickAsk('Zararlƒ± b√∂ceklere kar≈üƒ± doƒüal √ß√∂z√ºmler')">üêõ Zararlƒ±lar</div>
                </div>

                <!-- ‚îÄ‚îÄ INPUT ALANI ‚îÄ‚îÄ -->
                <div class="ab-input-area">
                    <div class="ab-input-row">
                        <!-- Sesli giri≈ü (AgroLive deƒüilken) -->
                        <button class="ab-mic-btn"
                                :class="abVoiceRecording ? 'recording' : ''"
                                @click="toggleVoiceInput()"
                                x-show="!agroLiveMode"
                                title="Sesli Giri≈ü">
                            <i class="fas" x-text="abVoiceRecording ? '‚èπ' : 'üéôÔ∏è'"></i>
                        </button>

                        <input type="text"
                               class="ab-input-field"
                               x-model="aiInput"
                               @keyup.enter="sendAIMessage()"
                               :disabled="aiTyping || !aiOnline || agroLiveActive"
                               :placeholder="agroLiveMode ? 'üéôÔ∏è AgroLive modu aktif ‚Äî Konu≈ümak i√ßin mikrofona bas' : 'Tarƒ±m sorunuzu yazƒ±n...'"
                               autocomplete="off">

                        <!-- AgroLive Butonu (mod aktifken) -->
                        <button x-show="agroLiveMode"
                                class="ab-mic-btn"
                                :class="agroLiveActive ? 'recording' : ''"
                                @click="startAgroLive()"
                                title="Konu≈ümak i√ßin bas">
                            <i class="fas" x-text="agroLiveActive ? '‚èπ' : 'üéôÔ∏è'"></i>
                        </button>

                        <button class="ab-send-btn"
                                @click="sendAIMessage()"
                                :disabled="aiTyping || !aiInput.trim() || !aiOnline"
                                x-show="!agroLiveMode || !agroLiveActive">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>

                    <!-- Telif & hint -->
                    <div style="text-align:center; font-size:10px; color:var(--ab-text2); margin-top:6px;">
                        AgroBot ‚Äî AI hatalarƒ± olabilir, uzman g√∂r√º≈ü√º alƒ±n
                    </div>
                </div>

                <!-- ‚îÄ‚îÄ AGROLIVE SESLI SOHBET OVERLAY ‚îÄ‚îÄ -->
                <div class="agrolive-overlay" x-show="agroLiveActive">
                    <!-- Avatar Halka Animasyonu -->
                    <div class="agrolive-avatar-ring">
                        <div class="agrolive-avatar-inner">ü§ñ</div>
                    </div>

                    <!-- Ses Dalgasƒ± -->
                    <div class="agrolive-wave" id="agroliveWave">
                        <template x-for="n in 14">
                            <div class="agrolive-wave-bar" :id="'wbar'+n" style="height:4px;"></div>
                        </template>
                    </div>

                    <!-- Durum -->
                    <div style="text-align:center;">
                        <div class="agrolive-status-text" x-text="agroLiveStatus"></div>
                        <div class="agrolive-status-sub">AgroLive Sesli Sohbet Modu</div>
                    </div>

                    <!-- Kontroller -->
                    <div class="agrolive-controls">
                        <button class="agrolive-ctrl-btn mute" @click="toggleLiveMute()" :title="agroLiveMuted ? 'Sesi A√ß' : 'Sesi Kapat'">
                            <i class="fas" style="font-size:20px;" x-text="agroLiveMuted ? 'üîá' : 'üéôÔ∏è'"></i>
                        </button>
                        <button class="agrolive-ctrl-btn end" @click="endAgroLive()" title="Aramayƒ± Bitir">
                            <i class="fas fa-phone-slash" style="font-size:22px;"></i>
                        </button>
                    </div>

                    <!-- Transkript -->
                    <div x-show="agroLiveTranscript" style="max-width:280px; text-align:center; padding:10px 20px; background:var(--ab-surface2); border-radius:16px; border:1px solid var(--ab-border); font-size:13px; color:var(--ab-text); line-height:1.5;" x-text="agroLiveTranscript"></div>
                </div>

            </div>
        </div>
    </template>

    <!-- Tam Ekran Medya Modal -->
    <div x-show="showFullScreen" x-transition x-cloak class="fixed inset-0 z-[100] bg-black flex items-center justify-center" @click="showFullScreen = false">
        <button class="absolute top-4 right-4 text-white z-10"><i class="fas fa-times text-2xl"></i></button>
        <template x-if="fullScreenMedia.type === 'image'">
            <img :src="fullScreenMedia.url" class="max-w-full max-h-full object-contain">
        </template>
        <template x-if="fullScreenMedia.type === 'video'">
            <video x-init="$nextTick(()=>initAgroHLS($el, fullScreenMedia.url))" class="max-w-full max-h-full" controls autoplay></video>
        </template>
    </div>

    <!-- ========== POST DETAY MODAL ========== -->
    <div x-show="showPostDetail" x-transition x-cloak class="fixed inset-0 z-[250] flex flex-col bg-[var(--bg-main)]">
        <!-- Header -->
        <div class="glass px-4 py-4 flex items-center justify-between z-10">
            <button @click="showPostDetail = false" class="text-slate-500">
                <i class="fas fa-arrow-left text-xl"></i>
            </button>
            <h3 class="text-lg font-black">G√∂nderi</h3>
            <div class="w-8"></div>
        </div>
        
        <!-- Post Content -->
        <div class="flex-1 overflow-y-auto no-scrollbar" x-show="postDetail">
            <div class="agro-card mx-4 mt-4 mb-4">
                <!-- User Info -->
                <div class="flex items-start gap-3 p-4">
                    <img :src="postDetail?.userProfilePic || 'https://ui-avatars.com/api/?name='+postDetail?.userName" 
                         @click="viewProfile(postDetail?.userId)"
                         class="w-10 h-10 rounded-full object-cover flex-shrink-0 cursor-pointer">
                    <div class="flex-1 min-w-0">
                        <div class="flex items-center gap-1.5 flex-wrap">
                            <span class="font-black text-sm cursor-pointer" @click="viewProfile(postDetail?.userId)" x-text="postDetail?.userName"></span>
                            <template x-if="postDetail?.userVerified">
                                <i class="fas fa-check-circle text-blue-400 text-xs"></i>
                            </template>
                            <span class="text-[var(--text-sec)] text-xs" x-text="'@' + postDetail?.username"></span>
                            <span class="text-[var(--text-sec)] text-xs">¬∑</span>
                            <span class="text-[var(--text-sec)] text-xs" x-text="formatDate(postDetail?.createdAt)"></span>
                        </div>
                        <p class="mt-2 text-sm font-medium" x-html="formatContent(postDetail?.content)"></p>
                        
                        <!-- Medya -->
                        <template x-if="postDetail?.mediaUrl">
                            <div class="mt-3">
                                <template x-if="postDetail?.mediaType === 'video'">
                                    <video x-init="$nextTick(()=>initAgroHLS($el, postDetail?.mediaUrl))" class="rounded-2xl w-full max-h-80 object-cover" controls></video>
                                </template>
                                <template x-if="postDetail?.mediaType !== 'video'">
                                    <img :src="postDetail?.mediaUrl" @click="openFullScreen(postDetail?.mediaUrl, 'image')" class="rounded-2xl w-full max-h-80 object-cover cursor-pointer">
                                </template>
                            </div>
                        </template>
                        
                        <!-- Actions -->
                        <div class="flex items-center gap-6 mt-4 text-[var(--text-sec)]">
                            <button @click="likePost(postDetail)" class="flex items-center gap-2" :class="postDetail?.isLiked ? 'text-red-500' : ''">
                                <i :class="postDetail?.isLiked ? 'fas fa-heart' : 'far fa-heart'"></i>
                                <span x-text="postDetail?.likeCount || 0"></span>
                            </button>
                            <button @click="openComments(postDetail)" class="flex items-center gap-2">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
                                <span x-text="postDetail?.commentCount || 0"></span>
                            </button>
                            <button @click="sharePost(postDetail)" class="flex items-center gap-2">
                                <i class="far fa-paper-plane"></i>
                                <span>Payla≈ü</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- S√ºr√ºm Notlarƒ± Modal -->
    <div x-show="showReleaseNotes" x-transition x-cloak class="fixed inset-0 z-[100] flex flex-col bg-[var(--bg-main)]">
        <div class="glass px-4 py-4 flex items-center justify-between">
            <button @click="showReleaseNotes = false" class="text-slate-500"><i class="fas fa-arrow-left text-xl"></i></button>
            <h3 class="text-xl font-black">S√ºr√ºm Notlarƒ±</h3>
            <div class="w-8"></div>
        </div>
        
        <div class="flex-1 overflow-y-auto p-4 space-y-4 no-scrollbar">
            <div class="agro-card p-6">
                <div class="flex items-center gap-3 mb-4">
                    <div class="w-12 h-12 bg-emerald-500 rounded-2xl flex items-center justify-center">
                        <i class="fas fa-rocket text-white text-xl"></i>
                    </div>
                    <div>
                        <h4 class="font-black text-lg">Versiyon 5.3.9</h4>
                        <p class="text-xs text-[var(--text-sec)]">8 ≈ûubat 2026</p>
                    </div>
                </div>
                
                <div class="space-y-4">
                    <div class="flex items-start gap-3">
                        <i class="fas fa-check-circle text-emerald-500 mt-1"></i>
                        <div>
                            <p class="font-bold text-sm">üìÅ Dosya Y√ºkleme Limiti Artƒ±rƒ±ldƒ±</p>
                            <p class="text-xs text-[var(--text-sec)]">Artƒ±k 50MB'a kadar dosya y√ºkleyebilirsiniz! Video ve resimlerinizi rahat√ßa payla≈üƒ±n.</p>
                        </div>
                    </div>
                    <div class="flex items-start gap-3">
                        <i class="fas fa-check-circle text-emerald-500 mt-1"></i>
                        <div>
                            <p class="font-bold text-sm">üó≥Ô∏è Anket Oylama D√ºzeltildi</p>
                            <p class="text-xs text-[var(--text-sec)]">Anketlerde oy kullanma sorunu tamamen √ß√∂z√ºld√º. Artƒ±k oylarƒ±nƒ±z doƒüru ≈üekilde kaydediliyor.</p>
                        </div>
                    </div>
                    <div class="flex items-start gap-3">
                        <i class="fas fa-check-circle text-emerald-500 mt-1"></i>
                        <div>
                            <p class="font-bold text-sm">üõí Tarƒ±m Maƒüazasƒ± Aktif</p>
                            <p class="text-xs text-[var(--text-sec)]">√úr√ºn ekleme, d√ºzenleme ve silme √∂zellikleri artƒ±k √ßalƒ±≈üƒ±yor. √úr√ºnlerinizi satƒ±≈üa √ßƒ±karƒ±n!</p>
                        </div>
                    </div>
                    <div class="flex items-start gap-3">
                        <i class="fas fa-check-circle text-emerald-500 mt-1"></i>
                        <div>
                            <p class="font-bold text-sm">üë• Feed'de Takip Et Butonu</p>
                            <p class="text-xs text-[var(--text-sec)]">Ana sayfada g√∂nderilerin yanƒ±nda "Takip Et" butonu eklendi. Takip etmek artƒ±k √ßok daha kolay!</p>
                        </div>
                    </div>
                    <div class="flex items-start gap-3">
                        <i class="fas fa-check-circle text-emerald-500 mt-1"></i>
                        <div>
                            <p class="font-bold text-sm">üìû WebRTC Video Call Tam Entegrasyon</p>
                            <p class="text-xs text-[var(--text-sec)]">Ger√ßek zamanlƒ± g√∂r√ºnt√ºl√º arama artƒ±k tam √ßalƒ±≈üƒ±yor! Socket.IO signaling ile kusursuz deneyim.</p>
                        </div>
                    </div>
                    <div class="flex items-start gap-3">
                        <i class="fas fa-check-circle text-emerald-500 mt-1"></i>
                        <div>
                            <p class="font-bold text-sm">üîê 2FA Ayarlarƒ± √áalƒ±≈üƒ±yor</p>
                            <p class="text-xs text-[var(--text-sec)]">ƒ∞ki fakt√∂rl√º kimlik doƒürulamayƒ± a√ßƒ±p kapatma artƒ±k sorunsuz √ßalƒ±≈üƒ±yor.</p>
                        </div>
                    </div>
                    <div class="flex items-start gap-3">
                        <i class="fas fa-check-circle text-emerald-500 mt-1"></i>
                        <div>
                            <p class="font-bold text-sm">üé® Modern Tasarƒ±m</p>
                            <p class="text-xs text-[var(--text-sec)]">Post kartlarƒ± modern g√∂r√ºn√ºmle yenilendi. Gradient renkler ve smooth animasyonlar eklendi.</p>
                        </div>
                    </div>
                    <div class="flex items-start gap-3">
                        <i class="fas fa-check-circle text-emerald-500 mt-1"></i>
                        <div>
                            <p class="font-bold text-sm">‚ö° Performans ƒ∞yile≈ütirmeleri</p>
                            <p class="text-xs text-[var(--text-sec)]">Uygulama genel olarak hƒ±zlandƒ±rƒ±ldƒ± ve optimize edildi.</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- √ñnceki Versiyonlar -->
            <div class="agro-card p-6">
                <div class="flex items-center gap-3 mb-4">
                    <div class="w-12 h-12 bg-slate-500 rounded-2xl flex items-center justify-center">
                        <i class="fas fa-history text-white text-xl"></i>
                    </div>
                    <div>
                        <h4 class="font-black text-lg">Versiyon 5.1.9</h4>
                        <p class="text-xs text-[var(--text-sec)]">4 ≈ûubat 2026</p>
                    </div>
                </div>
                
                <div class="space-y-4">
                    <div class="flex items-start gap-3">
                        <i class="fas fa-check-circle text-slate-500 mt-1"></i>
                        <div>
                            <p class="font-bold text-sm">Ger√ßek G√∂r√ºnt√ºl√º Arama</p>
                            <p class="text-xs text-[var(--text-sec)]">WebRTC ile ger√ßek zamanlƒ± g√∂r√ºnt√ºl√º ve sesli arama.</p>
                        </div>
                    </div>
                    <div class="flex items-start gap-3">
                        <i class="fas fa-check-circle text-slate-500 mt-1"></i>
                        <div>
                            <p class="font-bold text-sm">Mesajlarda Media G√∂sterimi</p>
                            <p class="text-xs text-[var(--text-sec)]">Mesajlardaki g√∂rseller ve videolar d√ºzg√ºn g√∂r√ºnt√ºleniyor.</p>
                        </div>
                    </div>
                    <div class="flex items-start gap-3">
                        <i class="fas fa-check-circle text-slate-500 mt-1"></i>
                        <div>
                            <p class="font-bold text-sm">Ortak Takip√ßi Listesi</p>
                            <p class="text-xs text-[var(--text-sec)]">Ortak takip√ßi ve arkada≈ülarƒ±nƒ±zƒ±n takip ettiƒüi ki≈üiler.</p>
                        </div>
                    </div>
                    <div class="flex items-start gap-3">
                        <i class="fas fa-check-circle text-slate-500 mt-1"></i>
                        <div>
                            <p class="font-bold text-sm">Doƒürulanmƒ±≈ü Rozet Sistemi</p>
                            <p class="text-xs text-[var(--text-sec)]">Hesabƒ±nƒ±zƒ± doƒürulatƒ±n ve mavi tik alƒ±n.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Doƒürulama Ba≈üvurusu Modal -->
    <div x-show="showVerificationModal" x-transition x-cloak class="fixed inset-0 z-[100] flex flex-col bg-[var(--bg-main)]">
        <div class="glass px-4 py-4 flex items-center justify-between">
            <button @click="showVerificationModal = false" class="text-slate-500"><i class="fas fa-arrow-left text-xl"></i></button>
            <h3 class="text-xl font-black">Doƒürulanmƒ±≈ü Rozet</h3>
            <div class="w-8"></div>
        </div>
        
        <div class="flex-1 overflow-y-auto p-4 space-y-4 no-scrollbar">
            <!-- Bilgi -->
            <div class="agro-card p-6">
                <div class="flex items-center gap-3 mb-4">
                    <div class="verified-badge verified-badge-lg">
                        <svg viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M17.7508 9.41667C17.7508 8.1 17.0217 6.95833 15.9608 6.41667C16.0892 6.05417 16.1592 5.6625 16.1592 5.25C16.1592 3.40833 14.7342 1.91833 12.9775 1.91833C12.5858 1.91833 12.2108 1.98833 11.8642 2.12667C11.3492 1.0125 10.2592 0.25 9.00083 0.25C7.7425 0.25 6.65417 1.01417 6.13667 2.125C5.79083 1.9875 5.415 1.91667 5.02333 1.91667C3.265 1.91667 1.84167 3.40833 1.84167 5.25C1.84167 5.66167 1.91083 6.05333 2.03917 6.41667C0.979167 6.95833 0.25 8.09833 0.25 9.41667C0.25 10.6625 0.901667 11.7483 1.86833 12.3217C1.85167 12.4633 1.84167 12.605 1.84167 12.75C1.84167 14.5917 3.265 16.0833 5.02333 16.0833C5.415 16.0833 5.79 16.0117 6.13583 15.875C6.6525 16.9867 7.74083 17.75 9 17.75C10.26 17.75 11.3483 16.9867 11.8642 15.875C12.21 16.0108 12.585 16.0817 12.9775 16.0817C14.7358 16.0817 16.1592 14.59 16.1592 12.7483C16.1592 12.6033 16.1492 12.4617 16.1317 12.3208C17.0967 11.7483 17.7508 10.6625 17.7508 9.4175V9.41667ZM12.2375 6.63833L8.62583 12.055C8.505 12.2358 8.3075 12.3333 8.105 12.3333C7.98583 12.3333 7.865 12.3 7.75833 12.2283L7.6625 12.15L5.65 10.1375C5.40583 9.89333 5.40583 9.4975 5.65 9.25417C5.89417 9.01083 6.29 9.00917 6.53333 9.25417L8.00833 10.7267L11.1958 5.94333C11.3875 5.65583 11.7758 5.58 12.0625 5.77083C12.3508 5.9625 12.4292 6.35083 12.2375 6.6375V6.63833Z" fill="#1D9BF0"/>
                        </svg>
                    </div>
                    <div>
                        <h4 class="font-black text-lg">Doƒürulanmƒ±≈ü Hesap</h4>
                        <p class="text-xs text-[var(--text-sec)]">Kimliƒüinizi doƒürulayarak mavi tik alƒ±n</p>
                    </div>
                </div>
                
                <!-- Detaylƒ± A√ßƒ±klama -->
                <div class="space-y-3 text-sm text-[var(--text-main)]">
                    <p class="leading-relaxed">
                        <strong>Doƒürulanmƒ±≈ü Rozet (Mavi Tik)</strong>, hesabƒ±nƒ±zƒ±n ger√ßek bir ki≈üi veya kurulu≈ü tarafƒ±ndan y√∂netildiƒüini g√∂steren bir g√ºvenilirlik simgesidir. 
                        Bu rozet, diƒüer kullanƒ±cƒ±lara sizin kim olduƒüunuz konusunda g√ºven verir.
                    </p>
                    
                    <div class="bg-emerald-50 dark:bg-emerald-900/20 p-4 rounded-2xl border-l-4 border-emerald-500">
                        <h5 class="font-bold text-emerald-700 dark:text-emerald-300 mb-2">‚ú® Doƒürulanmƒ±≈ü Rozet Size Ne Kazandƒ±rƒ±r?</h5>
                        <ul class="space-y-2 text-emerald-800 dark:text-emerald-200">
                            <li>‚úÖ Profilinizde mavi tik g√∂r√ºn√ºr</li>
                            <li>‚úÖ Arama sonu√ßlarƒ±nda √∂ncelikli sƒ±ralama</li>
                            <li>‚úÖ Diƒüer kullanƒ±cƒ±larda g√ºven olu≈üturur</li>
                            <li>‚úÖ Sahte hesaplardan ayƒ±rt edilmenizi saƒülar</li>
                            <li>‚úÖ ƒ∞√ßerikleriniz daha fazla g√∂r√ºn√ºrl√ºk kazanƒ±r</li>
                            <li>‚úÖ Toplulukta saygƒ±nlƒ±k ve itibar</li>
                        </ul>
                    </div>
                    
                    <div class="bg-blue-50 dark:bg-blue-900/20 p-4 rounded-2xl border-l-4 border-blue-500">
                        <h5 class="font-bold text-blue-700 dark:text-blue-300 mb-2">üìã Doƒürulama S√ºreci Nasƒ±l ƒ∞≈üler?</h5>
                        <ol class="space-y-1 text-blue-800 dark:text-blue-200">
                            <li>1Ô∏è‚É£ A≈üaƒüƒ±daki formu doldurarak ba≈üvuru yapƒ±n</li>
                            <li>2Ô∏è‚É£ T.C. Kimlik kartƒ±nƒ±zƒ±n √∂n ve arka y√ºz fotoƒüraflarƒ±nƒ± y√ºkleyin</li>
                            <li>3Ô∏è‚É£ Ba≈üvurunuz ekibimiz tarafƒ±ndan incelenir</li>
                            <li>4Ô∏è‚É£ Onaylandƒ±ƒüƒ±nda mavi tik profilinize eklenir</li>
                            <li>5Ô∏è‚É£ E-posta ile bilgilendirilirsiniz</li>
                        </ol>
                    </div>
                </div>
                
                <div class="bg-amber-50 dark:bg-amber-900/20 p-4 rounded-2xl border-l-4 border-amber-500 mt-4">
                    <p class="text-sm text-amber-700 dark:text-amber-300">
                        <i class="fas fa-info-circle mr-2"></i>
                        <strong>√ñnemli:</strong> Ba≈üvurunuz manuel olarak incelenecektir. ƒ∞≈ülem 1-3 i≈ü g√ºn√º s√ºrebilir. Kimlik bilgileriniz gizli tutulur ve sadece doƒürulama amacƒ±yla kullanƒ±lƒ±r.
                    </p>
                </div>
            </div>
            
            <!-- Form -->
            <div class="agro-card p-6">
                <h4 class="font-bold text-sm mb-4 text-[var(--text-sec)] uppercase">Ki≈üisel Bilgiler</h4>
                
                <div class="space-y-4">
                    <input type="text" x-model="verificationForm.name" placeholder="Adƒ±nƒ±z" class="w-full bg-[var(--input-bg)] p-4 rounded-2xl border-none outline-none focus:ring-2 focus:ring-emerald-500">
                    <input type="text" x-model="verificationForm.surname" placeholder="Soyadƒ±nƒ±z" class="w-full bg-[var(--input-bg)] p-4 rounded-2xl border-none outline-none focus:ring-2 focus:ring-emerald-500">
                </div>
            </div>
            
            <div class="agro-card p-6">
                <h4 class="font-bold text-sm mb-4 text-[var(--text-sec)] uppercase">T.C. Kimlik Fotoƒüraflarƒ±</h4>
                
                <div class="grid grid-cols-2 gap-4">
                    <!-- √ñn Y√ºz -->
                    <label class="cursor-pointer">
                        <div class="aspect-[4/3] bg-[var(--input-bg)] rounded-2xl flex flex-col items-center justify-center border-2 border-dashed border-slate-300 overflow-hidden">
                            <template x-if="!verificationForm.frontPreview">
                                <div class="text-center p-4">
                                    <i class="fas fa-id-card text-2xl text-slate-400 mb-2"></i>
                                    <p class="text-xs text-slate-500 font-bold">√ñn Y√ºz</p>
                                </div>
                            </template>
                            <template x-if="verificationForm.frontPreview">
                                <img :src="verificationForm.frontPreview" class="w-full h-full object-cover">
                            </template>
                        </div>
                        <input type="file" class="hidden" @change="handleVerificationImage($event, 'front')" accept="image/*">
                    </label>
                    
                    <!-- Arka Y√ºz -->
                    <label class="cursor-pointer">
                        <div class="aspect-[4/3] bg-[var(--input-bg)] rounded-2xl flex flex-col items-center justify-center border-2 border-dashed border-slate-300 overflow-hidden">
                            <template x-if="!verificationForm.backPreview">
                                <div class="text-center p-4">
                                    <i class="fas fa-id-card text-2xl text-slate-400 mb-2"></i>
                                    <p class="text-xs text-slate-500 font-bold">Arka Y√ºz</p>
                                </div>
                            </template>
                            <template x-if="verificationForm.backPreview">
                                <img :src="verificationForm.backPreview" class="w-full h-full object-cover">
                            </template>
                        </div>
                        <input type="file" class="hidden" @change="handleVerificationImage($event, 'back')" accept="image/*">
                    </label>
                </div>
            </div>
            
            <button @click="submitVerificationRequest" class="w-full py-4 btn-agro" :disabled="loading || !verificationForm.name || !verificationForm.surname || !verificationForm.frontImage || !verificationForm.backImage">
                <span x-show="!loading">Ba≈üvuruyu G√∂nder</span>
                <i x-show="loading" class="fas fa-spinner fa-spin"></i>
            </button>
            
            <p class="text-xs text-center text-[var(--text-sec)]">
                Ba≈üvurunuz <strong><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="0e60617c6b7e6277206f697c61626760654e69636f6762206d6163">[email&#160;protected]</a></strong> adresine PDF olarak g√∂nderilecektir.
            </p>
        </div>
    </div>
    
    <!-- Engellenen Hesaplar Modal -->
    <div x-show="showBlockedAccounts" x-transition x-cloak class="fixed inset-0 z-[100] flex flex-col bg-[var(--bg-main)]">
        <div class="glass px-4 py-4 flex items-center justify-between">
            <button @click="showBlockedAccounts = false" class="text-slate-500"><i class="fas fa-arrow-left text-xl"></i></button>
            <h3 class="text-xl font-black">Engellenen Hesaplar</h3>
            <div class="w-8"></div>
        </div>
        
        <div class="flex-1 overflow-y-auto p-4">
            <!-- Y√ºkleniyor -->
            <template x-if="blockedAccountsList === null">
                <div class="text-center py-12">
                    <i class="fas fa-circle-notch fa-spin text-emerald-500 text-3xl mb-4"></i>
                    <p class="text-sm text-[var(--text-sec)]">Y√ºkleniyor...</p>
                </div>
            </template>

            <!-- Bo≈ü liste -->
            <template x-if="blockedAccountsList !== null && blockedAccountsList.length === 0">
                <div class="text-center py-16">
                    <div class="w-20 h-20 bg-slate-100 dark:bg-slate-800 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-ban text-3xl text-slate-400"></i>
                    </div>
                    <p class="font-bold text-[var(--text-main)] mb-1">Engellenen hesap yok</p>
                    <p class="text-sm text-[var(--text-sec)]">Engellediƒüiniz kullanƒ±cƒ±lar burada g√∂r√ºn√ºr</p>
                </div>
            </template>

            <!-- Engellenen kullanƒ±cƒ± listesi -->
            <template x-for="blockedUser in (blockedAccountsList || [])" :key="blockedUser.id">
                <div class="agro-card p-4 mb-3 flex items-center justify-between">
                    <div class="flex items-center gap-3 flex-1 min-w-0">
                        <img :src="blockedUser.profilePic || ('https://ui-avatars.com/api/?name='+(blockedUser.name||'U')+'&background=random')" 
                             class="w-12 h-12 rounded-full object-cover flex-shrink-0">
                        <div class="min-w-0">
                            <p class="font-bold truncate" x-text="blockedUser.name || 'Kullanƒ±cƒ±'"></p>
                            <p class="text-sm text-[var(--text-sec)] truncate" x-text="blockedUser.username ? '@'+blockedUser.username : ''"></p>
                        </div>
                    </div>
                    <button @click="unblockUser(blockedUser.id)" 
                            class="ml-3 flex-shrink-0 px-4 py-2 bg-slate-200 dark:bg-slate-700 text-[var(--text-main)] rounded-full text-sm font-bold hover:bg-red-100 hover:text-red-600 transition-colors">
                        Engeli Kaldƒ±r
                    </button>
                </div>
            </template>
        </div>
    </div>
    
    <!-- Kaydedilen G√∂nderiler Modal -->
    <div x-show="showSavedPosts" x-transition x-cloak class="fixed inset-0 z-[100] flex flex-col bg-[var(--bg-main)]">
        <div class="glass px-4 py-4 flex items-center justify-between">
            <button @click="showSavedPosts = false" class="text-slate-500"><i class="fas fa-arrow-left text-xl"></i></button>
            <h3 class="text-xl font-black">Kaydedilen G√∂nderiler</h3>
            <div class="w-8"></div>
        </div>
        
        <div class="flex-1 overflow-y-auto p-4">
            <template x-if="savedPostsList.length === 0">
                <div class="text-center py-12">
                    <i class="fas fa-bookmark text-6xl text-slate-300 mb-4"></i>
                    <p class="text-[var(--text-sec)]">Hen√ºz kaydedilen g√∂nderi yok</p>
                </div>
            </template>
            <div class="grid grid-cols-3 gap-1">
                <template x-for="post in savedPostsList" :key="post.id">
                    <div @click="openTikTokScroll(post)" class="aspect-square bg-slate-200 relative overflow-hidden cursor-pointer">
                        <template x-if="post.mediaType === 'video'">
                            <video x-init="$nextTick(()=>initAgroHLS($el, post.mediaUrl || post.media))" class="w-full h-full object-cover"></video>
                        </template>
                        <template x-if="post.mediaType !== 'video'">
                            <img :src="post.mediaUrl || post.media" class="w-full h-full object-cover">
                        </template>
                        <div class="absolute inset-0 bg-black/20 flex items-center justify-center opacity-0 hover:opacity-100 transition">
                            <i class="fas fa-play text-white text-2xl"></i>
                        </div>
                    </div>
                </template>
            </div>
        </div>
    </div>
    
    <!-- ========== PAYLA≈û MEN√ú MODAL ========== -->
    <div x-show="showShareMenuModal" x-transition x-cloak class="fixed inset-0 z-[210] flex items-end justify-center">
        <div class="absolute inset-0 bg-black/50" @click="showShareMenuModal = false"></div>
        <div class="relative bg-[var(--bg-card)] w-full max-w-lg rounded-t-3xl p-6 pb-10 space-y-3" style="z-index:1;">
            <div class="w-12 h-1.5 bg-slate-300 rounded-full mx-auto mb-5"></div>
            
            <!-- Post √∂nizleme -->
            <div x-show="shareMenuPost" class="flex items-center gap-3 p-3 rounded-2xl bg-[var(--input-bg)] mb-4">
                <img :src="shareMenuPost?.userProfilePic || 'https://ui-avatars.com/api/?name='+(shareMenuPost?.userName||'?')" class="w-10 h-10 rounded-full object-cover">
                <div class="flex-1 min-w-0">
                    <p class="font-bold text-sm truncate" x-text="shareMenuPost?.userName"></p>
                    <p class="text-xs text-[var(--text-sec)] truncate" x-text="shareMenuPost?.content?.substring(0,60) || 'Medya g√∂nderi'"></p>
                </div>
                <template x-if="shareMenuPost?.mediaUrl && shareMenuPost?.mediaType !== 'video'">
                    <img :src="shareMenuPost.mediaUrl" class="w-12 h-12 rounded-xl object-cover flex-shrink-0">
                </template>
            </div>
            
            <!-- DM'de Payla≈ü -->
            <button @click="showShareMenuModal = false; openShareToDMModal(shareMenuPost)"
                    class="w-full flex items-center gap-4 p-4 rounded-2xl bg-[var(--input-bg)] hover:bg-[var(--border)] transition text-left">
                <div class="w-12 h-12 rounded-full flex items-center justify-center" style="background:linear-gradient(135deg,#00b894,#0984e3);">
                    <i class="fas fa-paper-plane text-white text-lg"></i>
                </div>
                <div>
                    <p class="font-bold">DM'de Payla≈ü</p>
                    <p class="text-xs text-[var(--text-sec)]">Arkada≈ülarƒ±na mesaj olarak g√∂nder</p>
                </div>
            </button>
            
            <!-- Hikayeye Payla≈ü -->
            <button @click="shareToStory(shareMenuPost)"
                    class="w-full flex items-center gap-4 p-4 rounded-2xl bg-[var(--input-bg)] hover:bg-[var(--border)] transition text-left">
                <div class="w-12 h-12 rounded-full flex items-center justify-center" style="background:linear-gradient(135deg,#fd79a8,#e17055);">
                    <i class="fas fa-circle-plus text-white text-lg"></i>
                </div>
                <div>
                    <p class="font-bold">Hikayeye Payla≈ü</p>
                    <p class="text-xs text-[var(--text-sec)]">Bu g√∂nderiyi hikayene ekle</p>
                </div>
            </button>
            
            <!-- Link Kopyala -->
            <button @click="sharePostURL(shareMenuPost); showShareMenuModal = false"
                    class="w-full flex items-center gap-4 p-4 rounded-2xl bg-[var(--input-bg)] hover:bg-[var(--border)] transition text-left">
                <div class="w-12 h-12 rounded-full bg-slate-500 flex items-center justify-center">
                    <i class="fas fa-link text-white text-lg"></i>
                </div>
                <div>
                    <p class="font-bold">Link Kopyala</p>
                    <p class="text-xs text-[var(--text-sec)]">G√∂nderi linkini kopyala</p>
                </div>
            </button>
            
            <button @click="showShareMenuModal = false" class="w-full p-3 text-center text-[var(--text-sec)] font-medium">ƒ∞ptal</button>
        </div>
    </div>

    <!-- ========== Hƒ∞KAYEYE PAYLA≈û √ñNƒ∞ZLEME ========== -->
    <div x-show="showStorySharePreview" x-transition x-cloak class="fixed inset-0 z-[220] flex flex-col bg-black/90">
        <div class="flex items-center justify-between px-4 py-4">
            <button @click="showStorySharePreview = false" class="w-10 h-10 rounded-full bg-white/10 flex items-center justify-center text-white">
                <i class="fas fa-times"></i>
            </button>
            <p class="text-white font-bold">Hikayeye Payla≈ü</p>
            <div class="w-10"></div>
        </div>
        <div class="flex-1 flex items-center justify-center p-4">
            <div class="relative rounded-3xl overflow-hidden shadow-2xl w-full max-w-sm" style="aspect-ratio:9/16;background:#1a1a2e;">
                <template x-if="storySharePost?.mediaUrl && storySharePost?.mediaType !== 'video'">
                    <img :src="storySharePost.mediaUrl" class="absolute inset-0 w-full h-full object-cover opacity-30 blur-xl scale-110">
                </template>
                <div class="absolute top-0 left-0 right-0 p-4 flex items-center gap-3" style="background:linear-gradient(to bottom,rgba(0,0,0,0.7),transparent);">
                    <img :src="storySharePost?.userProfilePic || 'https://ui-avatars.com/api/?name='+(storySharePost?.userName||'?')" class="w-10 h-10 rounded-full object-cover border-2 border-white">
                    <div>
                        <p class="text-white font-bold text-sm" x-text="storySharePost?.userName"></p>
                        <p class="text-white/60 text-xs" x-text="'@'+(storySharePost?.userUsername||storySharePost?.username||'')"></p>
                    </div>
                </div>
                <div class="absolute inset-0 flex items-center justify-center p-6">
                    <template x-if="storySharePost?.mediaUrl && storySharePost?.mediaType !== 'video'">
                        <img :src="storySharePost.mediaUrl" class="max-w-full max-h-full rounded-2xl object-contain shadow-xl">
                    </template>
                    <template x-if="storySharePost?.mediaType === 'video'">
                        <div class="text-center">
                            <i class="fas fa-film text-white text-5xl mb-3 opacity-60"></i>
                            <p class="text-white text-sm opacity-80">Video G√∂nderi</p>
                        </div>
                    </template>
                    <template x-if="!storySharePost?.mediaUrl">
                        <p class="text-white text-center text-lg font-medium leading-relaxed px-4" x-text="storySharePost?.content?.substring(0,120)"></p>
                    </template>
                </div>
                <div class="absolute bottom-0 left-0 right-0 p-4" style="background:linear-gradient(to top,rgba(0,0,0,0.8),transparent);">
                    <p class="text-white/70 text-xs text-center mb-2" x-text="storySharePost?.content?.substring(0,60)+(storySharePost?.content?.length>60?'...':'')"></p>
                    <div class="flex justify-center">
                        <div class="flex items-center gap-2 bg-white/20 rounded-full px-4 py-2">
                            <i class="fas fa-arrow-up-right-from-square text-white text-xs"></i>
                            <span class="text-white text-xs font-bold">G√∂nderiyi G√∂r</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="px-6 pb-8">
            <button @click="confirmShareToStory()" class="w-full py-4 rounded-2xl text-white font-black text-lg" style="background:linear-gradient(135deg,#fd79a8,#e17055);">
                <i class="fas fa-circle-plus mr-2"></i>Hikayeye Ekle
            </button>
        </div>
    </div>

    <!-- ========== DM'DE PAYLA≈ûIM MODAL ========== -->
    <div x-show="showShareToDMModal" x-transition x-cloak class="fixed inset-0 z-[100] flex items-end justify-center">
        <div class="absolute inset-0 bg-black/40" @click="showShareToDMModal = false"></div>
        <div class="bg-[var(--bg-card)] w-full max-w-md rounded-t-[2.5rem] p-6 animate-slide-up">
            <div class="w-12 h-1.5 bg-slate-300 rounded-full mx-auto mb-4"></div>
            <h3 class="text-center font-black text-lg mb-4">DM'de Payla≈ü</h3>
            
            <!-- Payla≈üƒ±lacak Post √ñnizleme -->
            <div x-show="postToShare" class="agro-card p-3 mb-4 flex items-center gap-3">
                <template x-if="postToShare?.mediaUrl">
                    <img :src="postToShare.mediaUrl" class="w-16 h-16 rounded-xl object-cover">
                </template>
                <div class="flex-1 min-w-0">
                    <p class="text-sm font-bold truncate" x-text="postToShare?.userName"></p>
                    <p class="text-xs text-[var(--text-sec)] line-clamp-2" x-text="postToShare?.content?.substring(0, 60) + '...'"></p>
                </div>
            </div>
            
            <!-- Arama -->
            <div class="relative mb-4">
                <i class="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"></i>
                <input type="text" 
                       x-model="dmShareSearchQuery" 
                       @input="searchUsersForDMShare"
                       placeholder="Kullanƒ±cƒ± ara..." 
                       class="w-full bg-[var(--input-bg)] pl-12 pr-4 py-3 rounded-2xl border-none outline-none focus:ring-2 focus:ring-emerald-500">
            </div>
            
            <!-- Sonu√ßlar -->
            <div class="max-h-60 overflow-y-auto space-y-2">
                <template x-if="dmShareSearchQuery && dmShareResults.length === 0">
                    <p class="text-center text-slate-400 py-4">Kullanƒ±cƒ± bulunamadƒ±</p>
                </template>
                <template x-for="user in dmShareResults" :key="user.id">
                    <div @click="sharePostToDM(user.id)" class="flex items-center gap-3 p-3 rounded-xl hover:bg-[var(--input-bg)] cursor-pointer">
                        <img :src="user.profilePic || 'https://ui-avatars.com/api/?name='+user.name" class="w-12 h-12 rounded-full object-cover">
                        <div class="flex-1">
                            <p class="font-bold text-sm" x-text="user.name"></p>
                            <p class="text-xs text-[var(--text-sec)]" x-text="'@'+user.username"></p>
                        </div>
                        <i class="fas fa-paper-plane text-emerald-500"></i>
                    </div>
                </template>
                
                <!-- Son Konu≈ümalar -->
                <template x-if="!dmShareSearchQuery">
                    <div>
                        <p class="text-xs font-bold text-slate-400 uppercase mb-2">Son Konu≈ümalar</p>
                        <template x-for="conv in conversations.slice(0, 5)" :key="conv.userId || conv.id">
                            <div @click="sharePostToDM(conv.userId || conv.id)" class="flex items-center gap-3 p-3 rounded-xl hover:bg-[var(--input-bg)] cursor-pointer">
                                <img :src="conv.profilePic || 'https://ui-avatars.com/api/?name='+(conv.name || conv.recipientName)" class="w-12 h-12 rounded-full object-cover">
                                <div class="flex-1">
                                    <p class="font-bold text-sm" x-text="conv.name || conv.recipientName"></p>
                                    <p class="text-xs text-[var(--text-sec)]" x-text="conv.lastMessage?.substring(0, 30) + '...'"></p>
                                </div>
                                <i class="fas fa-paper-plane text-emerald-500"></i>
                            </div>
                        </template>
                    </div>
                </template>
            </div>
        </div>
    </div>
    
    <!-- ========== GELEN ARAMA - √úSTTEN KAYAN BANNER Bƒ∞LDƒ∞Rƒ∞Mƒ∞ ========== -->
    <div x-show="showIncomingCallModal" 
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0 -translate-y-full"
         x-transition:enter-end="opacity-100 translate-y-0"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="opacity-100 translate-y-0"
         x-transition:leave-end="opacity-0 -translate-y-full"
         x-cloak 
         class="fixed top-0 left-0 right-0 z-[300] flex justify-center px-3 pt-3">
        <div class="w-full max-w-sm bg-[#1c1c1e]/95 backdrop-blur-xl rounded-2xl shadow-2xl overflow-hidden border border-white/10">
            <!-- √úst Bar - Ye≈üil g√∂sterge -->
            <div class="h-1 w-full bg-gradient-to-r from-emerald-400 to-teal-400 animate-pulse"></div>
            <div class="flex items-center gap-3 p-4">
                <!-- Avatar + Animasyon -->
                <div class="relative flex-shrink-0">
                    <img :src="incomingCall?.caller?.profilePic || 'https://ui-avatars.com/api/?name='+(incomingCall?.caller?.name || 'User')" 
                         class="w-14 h-14 rounded-full object-cover border-2 border-emerald-400">
                    <!-- Pulsing ring -->
                    <span class="absolute inset-0 rounded-full border-2 border-emerald-400 animate-ping opacity-60"></span>
                </div>
                <!-- Bilgi -->
                <div class="flex-1 min-w-0">
                    <p class="text-white/60 text-xs font-medium mb-0.5">üìπ G√∂r√ºnt√ºl√º Arama</p>
                    <h4 class="text-white font-black text-base truncate" x-text="incomingCall?.caller?.name"></h4>
                    <p class="text-white/50 text-xs truncate" x-text="incomingCall?.caller?.username ? '@' + incomingCall.caller.username : 'seni arƒ±yor...'"></p>
                </div>
                <!-- Butonlar -->
                <div class="flex items-center gap-2 flex-shrink-0">
                    <button @click="rejectIncomingCall()" 
                            class="w-11 h-11 bg-red-500 rounded-full flex items-center justify-center text-white shadow-lg hover:bg-red-600 transition active:scale-90">
                        <i class="fas fa-phone-slash text-sm"></i>
                    </button>
                    <button @click="acceptIncomingCall()" 
                            class="w-11 h-11 bg-emerald-500 rounded-full flex items-center justify-center text-white shadow-lg hover:bg-emerald-600 transition active:scale-90">
                        <i class="fas fa-phone text-sm"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ========== AKTƒ∞F ARAMA MODAL (WEBRTC) ========== -->
    <div x-show="showVideoCallModal" x-transition x-cloak class="fixed inset-0 z-[200] bg-black flex flex-col">
        <!-- Arama Header -->
        <div class="absolute top-0 left-0 right-0 z-10 p-4 flex items-center justify-between bg-gradient-to-b from-black/60 to-transparent">
            <div class="flex items-center gap-3">
                <button @click="endCall()" class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center text-white">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <div>
                    <h4 class="text-white font-bold" x-text="activeCall?.recipient?.name"></h4>
                    <p class="text-white/70 text-sm" x-text="formatCallDuration(callDuration)"></p>
                </div>
            </div>
        </div>
        
        <!-- Video Alanlarƒ± -->
        <div class="flex-1 relative">
            <!-- Uzak Video (B√ºy√ºk) -->
            <video id="remoteVideo" autoplay playsinline class="w-full h-full object-cover"></video>
            
            <!-- Yerel Video (K√º√ß√ºk - PIP) -->
            <div class="absolute bottom-24 right-4 w-32 h-44 rounded-2xl overflow-hidden border-2 border-white/30 shadow-lg">
                <video id="localVideo" autoplay playsinline muted class="w-full h-full object-cover"></video>
            </div>
            
            <!-- Video Kapalƒ± Durumu -->
            <div x-show="isVideoOff" class="absolute inset-0 flex items-center justify-center bg-slate-800">
                <div class="text-center text-white">
                    <i class="fas fa-video-slash text-6xl mb-4"></i>
                    <p>Kamera Kapalƒ±</p>
                </div>
            </div>
        </div>
        
        <!-- Kontrol Butonlarƒ± -->
        <div class="absolute bottom-8 left-0 right-0 flex items-center justify-center gap-6">
            <button @click="toggleMute()" 
                    :class="isMuted ? 'bg-red-500' : 'bg-white/20'"
                    class="w-14 h-14 rounded-full flex items-center justify-center text-white text-xl transition">
                <i :class="isMuted ? 'fas fa-microphone-slash' : 'fas fa-microphone'"></i>
            </button>
            <button @click="toggleVideo()" 
                    :class="isVideoOff ? 'bg-red-500' : 'bg-white/20'"
                    class="w-14 h-14 rounded-full flex items-center justify-center text-white text-xl transition">
                <i :class="isVideoOff ? 'fas fa-video-slash' : 'fas fa-video'"></i>
            </button>
            <button @click="endCall()" class="w-16 h-16 bg-red-500 rounded-full flex items-center justify-center text-white text-2xl hover:bg-red-600 transition">
                <i class="fas fa-phone-slash"></i>
            </button>
            <button class="w-14 h-14 bg-white/20 rounded-full flex items-center justify-center text-white text-xl">
                <i class="fas fa-camera-rotate"></i>
            </button>
        </div>
    </div>
    
    <!-- ========== PAYLA≈ûILAN POST SAYFASI (MODERN) ========== -->
    <div x-show="showSharedPostPage" x-transition x-cloak class="fixed inset-0 z-[150] bg-[var(--bg-main)] flex flex-col">
        <!-- Header -->
        <div class="sticky top-0 z-10 px-4 py-3 flex items-center justify-between bg-[var(--bg-main)] border-b border-[var(--border)] shadow-sm">
            <button @click="showSharedPostPage = false; window.history.pushState({}, '', '/');" class="w-10 h-10 rounded-full bg-[var(--input-bg)] flex items-center justify-center text-[var(--text-main)] hover:bg-[var(--border)] transition">
                <i class="fas fa-arrow-left"></i>
            </button>
            <h3 class="font-black text-lg">G√∂nderi</h3>
            <button @click="sharePostURL(sharedPost)" class="w-10 h-10 rounded-full bg-emerald-500 flex items-center justify-center text-white hover:bg-emerald-600 transition">
                <i class="fas fa-share"></i>
            </button>
        </div>
        
        <!-- Post ƒ∞√ßeriƒüi -->
        <div class="flex-1 overflow-y-auto" x-show="sharedPost">
            <!-- Kullanƒ±cƒ± Bilgisi -->
            <div class="px-4 py-4 flex items-center gap-3 border-b border-[var(--border)]">
                <img :src="sharedPost?.profilePic || sharedPost?.userProfilePic || 'agro_pp.jpg'" 
                     class="w-12 h-12 rounded-full object-cover border-2 border-emerald-500 cursor-pointer" @click="viewProfile(sharedPost?.userId)">
                <div class="flex-1">
                    <div class="flex items-center gap-1.5">
                        <p class="font-bold" x-text="sharedPost?.userName"></p>
                        <template x-if="sharedPost?.isVerified || sharedPost?.userVerified || sharedPost?.verified">
                            <span class="verified-badge verified-badge-sm">
                                <svg viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M17.7508 9.41667C17.7508 8.1 17.0217 6.95833 15.9608 6.41667C16.0892 6.05417 16.1592 5.6625 16.1592 5.25C16.1592 3.40833 14.7342 1.91833 12.9775 1.91833C12.5858 1.91833 12.2108 1.98833 11.8642 2.12667C11.3492 1.0125 10.2592 0.25 9.00083 0.25C7.7425 0.25 6.65417 1.01417 6.13667 2.125C5.79083 1.9875 5.415 1.91667 5.02333 1.91667C3.265 1.91667 1.84167 3.40833 1.84167 5.25C1.84167 5.66167 1.91083 6.05333 2.03917 6.41667C0.979167 6.95833 0.25 8.09833 0.25 9.41667C0.25 10.6625 0.901667 11.7483 1.86833 12.3217C1.85167 12.4633 1.84167 12.605 1.84167 12.75C1.84167 14.5917 3.265 16.0833 5.02333 16.0833C5.415 16.0833 5.79 16.0117 6.13583 15.875C6.6525 16.9867 7.74083 17.75 9 17.75C10.26 17.75 11.3483 16.9867 11.8642 15.875C12.21 16.0108 12.585 16.0817 12.9775 16.0817C14.7358 16.0817 16.1592 14.59 16.1592 12.7483C16.1592 12.6033 16.1492 12.4617 16.1317 12.3208C17.0967 11.7483 17.7508 10.6625 17.7508 9.4175V9.41667ZM12.2375 6.63833L8.62583 12.055C8.505 12.2358 8.3075 12.3333 8.105 12.3333C7.98583 12.3333 7.865 12.3 7.75833 12.2283L7.6625 12.15L5.65 10.1375C5.40583 9.89333 5.40583 9.4975 5.65 9.25417C5.89417 9.01083 6.29 9.00917 6.53333 9.25417L8.00833 10.7267L11.1958 5.94333C11.3875 5.65583 11.7758 5.58 12.0625 5.77083C12.3508 5.9625 12.4292 6.35083 12.2375 6.6375V6.63833Z" fill="#1D9BF0"/>
                                </svg>
                            </span>
                        </template>
                    </div>
                    <p class="text-sm text-[var(--text-sec)]" x-text="'@'+sharedPost?.username"></p>
                </div>
                <button @click="viewProfile(sharedPost?.userId)" class="px-4 py-2 bg-emerald-500 text-white rounded-full text-sm font-bold hover:bg-emerald-600 transition">
                    Profili G√∂r
                </button>
            </div>
            
            <!-- Post Medya -->
            <div class="relative bg-black">
                <template x-if="sharedPost?.mediaType === 'video'">
                    <video x-init="$nextTick(()=>initAgroHLS($el, sharedPost?.mediaUrl))"
                           controls 
                           autoplay
                           playsinline
                           x-ref="sharedPostVideo"
                           class="w-full max-h-[70vh] mx-auto"
                           style="object-fit: contain;"></video>
                </template>
                <template x-if="sharedPost?.mediaType === 'image'">
                    <img :src="sharedPost?.mediaUrl" 
                         class="w-full max-h-[70vh] object-contain mx-auto cursor-pointer"
                         @click="openFullScreen(sharedPost?.mediaUrl, 'image')">
                </template>
            </div>
            
            <!-- Post ƒ∞√ßerik -->
            <div class="p-4">
                <p class="text-base leading-relaxed whitespace-pre-wrap" x-html="formatContent(sharedPost?.content || '')"></p>
                <p class="text-sm text-[var(--text-sec)] mt-3" x-text="formatTime(sharedPost?.createdAt)"></p>
            </div>
            
            <!-- Etkile≈üim Sayƒ±larƒ± -->
            <div class="px-4 py-2 flex items-center gap-4 border-t border-[var(--border)] text-sm text-[var(--text-sec)]">
                <span><strong class="text-[var(--text-main)]" x-text="sharedPost?.likeCount || 0"></strong> beƒüeni</span>
                <span><strong class="text-[var(--text-main)]" x-text="sharedPost?.commentCount || 0"></strong> yorum</span>
            </div>
            
            <!-- Etkile≈üim Butonlarƒ± -->
            <div class="px-4 py-3 flex items-center justify-around border-t border-b border-[var(--border)]">
                <button @click="likePost(sharedPost)" 
                        class="flex items-center gap-2 transition-all active:scale-110 px-4 py-2 rounded-xl" 
                        :class="sharedPost?.isLiked ? 'text-red-500' : 'text-[var(--text-sec)] hover:text-red-400'">
                    <i class="text-xl" :class="sharedPost?.isLiked ? 'fas fa-heart' : 'far fa-heart'"></i>
                    <span class="font-semibold text-sm">Beƒüen</span>
                </button>
                <button @click="openComments(sharedPost)" class="flex items-center gap-2 text-[var(--text-sec)] hover:text-emerald-500 px-4 py-2 rounded-xl transition">
                    <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
                    <span class="font-semibold text-sm">Yorum</span>
                </button>
                <button @click="sharePostURL(sharedPost)" class="flex items-center gap-2 text-[var(--text-sec)] hover:text-blue-500 px-4 py-2 rounded-xl transition">
                    <i class="far fa-share-square text-xl"></i>
                    <span class="font-semibold text-sm">Payla≈ü</span>
                </button>
                <button @click="savePost(sharedPost)" :class="sharedPost?.isSaved ? 'text-emerald-500' : 'text-[var(--text-sec)] hover:text-emerald-400'" class="px-4 py-2 rounded-xl transition">
                    <i :class="sharedPost?.isSaved ? 'fas fa-bookmark' : 'far fa-bookmark'" class="text-xl"></i>
                </button>
            </div>
            
            <!-- Yorumlar -->
            <div class="p-4">
                <h4 class="font-bold mb-4">Yorumlar</h4>
                <template x-if="sharedPostComments.length === 0">
                    <div class="text-center py-8">
                        <i class="far fa-comment text-4xl text-[var(--text-sec)] mb-2 opacity-50"></i>
                        <p class="text-[var(--text-sec)]">Hen√ºz yorum yok</p>
                        <p class="text-xs text-[var(--text-sec)] mt-1">ƒ∞lk yorumu sen yap!</p>
                    </div>
                </template>
                <template x-for="comment in sharedPostComments" :key="comment.id">
                    <div class="flex gap-3 mb-4">
                        <img :src="comment.profilePic || comment.userProfilePic || 'agro_pp.jpg'" 
                             class="w-10 h-10 rounded-full object-cover flex-shrink-0 cursor-pointer" @click="viewProfile(comment.userId)">
                        <div class="flex-1">
                            <div class="bg-[var(--input-bg)] rounded-2xl rounded-tl-sm p-3">
                                <p class="font-bold text-sm" x-text="comment.userName"></p>
                                <p class="text-sm mt-1" x-text="comment.content"></p>
                            </div>
                            <p class="text-xs text-[var(--text-sec)] mt-1 ml-2" x-text="formatTime(comment.createdAt)"></p>
                        </div>
                    </div>
                </template>
            </div>
        </div>
    </div>
    
    <!-- ========== PAYLA≈ûILAN PROFƒ∞L SAYFASI (MODERN) ========== -->
    <div x-show="showSharedProfilePage" x-transition x-cloak class="fixed inset-0 z-[150] bg-[var(--bg-main)] flex flex-col">
        <!-- Header -->
        <div class="sticky top-0 z-10 px-4 py-3 flex items-center justify-between bg-[var(--bg-main)] border-b border-[var(--border)] shadow-sm">
            <button @click="showSharedProfilePage = false; window.history.pushState({}, '', '/');" class="w-10 h-10 rounded-full bg-[var(--input-bg)] flex items-center justify-center text-[var(--text-main)] hover:bg-[var(--border)] transition">
                <i class="fas fa-arrow-left"></i>
            </button>
            <h3 class="font-black text-lg" x-text="sharedProfile?.name || sharedProfile?.username"></h3>
            <button @click="shareProfile(sharedProfile)" class="w-10 h-10 rounded-full bg-emerald-500 flex items-center justify-center text-white hover:bg-emerald-600 transition">
                <i class="fas fa-share"></i>
            </button>
        </div>
        
        <!-- Profil ƒ∞√ßeriƒüi -->
        <div class="flex-1 overflow-y-auto" x-show="sharedProfile">
            <!-- Kapak Fotoƒürafƒ± -->
            <div class="relative h-48 bg-gradient-to-br from-emerald-400 to-teal-600 overflow-hidden">
                <template x-if="sharedProfile?.coverPic">
                    <img :src="sharedProfile?.coverPic" class="w-full h-full object-cover">
                </template>
                <template x-if="!sharedProfile?.coverPic">
                    <div class="w-full h-full bg-gradient-to-br from-emerald-400 via-teal-500 to-cyan-600"></div>
                </template>
            </div>
            
            <!-- Profil Bilgisi -->
            <div class="px-4 pb-4">
                <div class="relative -mt-16 mb-3 flex justify-between items-end">
                    <div class="relative">
                        <img :src="sharedProfile?.profilePic || 'agro_pp.jpg'" 
                             class="w-28 h-28 rounded-full object-cover border-4 border-[var(--bg-main)] bg-white shadow-lg">
                        <template x-if="sharedProfile?.isVerified || sharedProfile?.verified">
                            <span class="verified-badge verified-badge-lg absolute -bottom-1 -right-1">
                                <svg viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M17.7508 9.41667C17.7508 8.1 17.0217 6.95833 15.9608 6.41667C16.0892 6.05417 16.1592 5.6625 16.1592 5.25C16.1592 3.40833 14.7342 1.91833 12.9775 1.91833C12.5858 1.91833 12.2108 1.98833 11.8642 2.12667C11.3492 1.0125 10.2592 0.25 9.00083 0.25C7.7425 0.25 6.65417 1.01417 6.13667 2.125C5.79083 1.9875 5.415 1.91667 5.02333 1.91667C3.265 1.91667 1.84167 3.40833 1.84167 5.25C1.84167 5.66167 1.91083 6.05333 2.03917 6.41667C0.979167 6.95833 0.25 8.09833 0.25 9.41667C0.25 10.6625 0.901667 11.7483 1.86833 12.3217C1.85167 12.4633 1.84167 12.605 1.84167 12.75C1.84167 14.5917 3.265 16.0833 5.02333 16.0833C5.415 16.0833 5.79 16.0117 6.13583 15.875C6.6525 16.9867 7.74083 17.75 9 17.75C10.26 17.75 11.3483 16.9867 11.8642 15.875C12.21 16.0108 12.585 16.0817 12.9775 16.0817C14.7358 16.0817 16.1592 14.59 16.1592 12.7483C16.1592 12.6033 16.1492 12.4617 16.1317 12.3208C17.0967 11.7483 17.7508 10.6625 17.7508 9.4175V9.41667ZM12.2375 6.63833L8.62583 12.055C8.505 12.2358 8.3075 12.3333 8.105 12.3333C7.98583 12.3333 7.865 12.3 7.75833 12.2283L7.6625 12.15L5.65 10.1375C5.40583 9.89333 5.40583 9.4975 5.65 9.25417C5.89417 9.01083 6.29 9.00917 6.53333 9.25417L8.00833 10.7267L11.1958 5.94333C11.3875 5.65583 11.7758 5.58 12.0625 5.77083C12.3508 5.9625 12.4292 6.35083 12.2375 6.6375V6.63833Z" fill="#1D9BF0"/>
                                </svg>
                            </span>
                        </template>
                    </div>
                    <button @click="followUser(sharedProfile)" 
                            :class="sharedProfile?.isFollowing ? 'bg-[var(--input-bg)] text-[var(--text-main)] border border-[var(--border)]' : 'bg-emerald-500 text-white shadow-lg shadow-emerald-200'"
                            class="px-6 py-2.5 rounded-full font-bold mb-4 transition hover:scale-105">
                        <span x-text="sharedProfile?.isFollowing ? 'Takip Ediliyor' : 'Takip Et'"></span>
                    </button>
                </div>
                
                <div class="flex items-center gap-2">
                    <h2 class="text-2xl font-black" x-text="sharedProfile?.name"></h2>
                    <template x-if="sharedProfile?.isVerified || sharedProfile?.verified">
                        <span class="verified-badge">
                            <svg viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M17.7508 9.41667C17.7508 8.1 17.0217 6.95833 15.9608 6.41667C16.0892 6.05417 16.1592 5.6625 16.1592 5.25C16.1592 3.40833 14.7342 1.91833 12.9775 1.91833C12.5858 1.91833 12.2108 1.98833 11.8642 2.12667C11.3492 1.0125 10.2592 0.25 9.00083 0.25C7.7425 0.25 6.65417 1.01417 6.13667 2.125C5.79083 1.9875 5.415 1.91667 5.02333 1.91667C3.265 1.91667 1.84167 3.40833 1.84167 5.25C1.84167 5.66167 1.91083 6.05333 2.03917 6.41667C0.979167 6.95833 0.25 8.09833 0.25 9.41667C0.25 10.6625 0.901667 11.7483 1.86833 12.3217C1.85167 12.4633 1.84167 12.605 1.84167 12.75C1.84167 14.5917 3.265 16.0833 5.02333 16.0833C5.415 16.0833 5.79 16.0117 6.13583 15.875C6.6525 16.9867 7.74083 17.75 9 17.75C10.26 17.75 11.3483 16.9867 11.8642 15.875C12.21 16.0108 12.585 16.0817 12.9775 16.0817C14.7358 16.0817 16.1592 14.59 16.1592 12.7483C16.1592 12.6033 16.1492 12.4617 16.1317 12.3208C17.0967 11.7483 17.7508 10.6625 17.7508 9.4175V9.41667ZM12.2375 6.63833L8.62583 12.055C8.505 12.2358 8.3075 12.3333 8.105 12.3333C7.98583 12.3333 7.865 12.3 7.75833 12.2283L7.6625 12.15L5.65 10.1375C5.40583 9.89333 5.40583 9.4975 5.65 9.25417C5.89417 9.01083 6.29 9.00917 6.53333 9.25417L8.00833 10.7267L11.1958 5.94333C11.3875 5.65583 11.7758 5.58 12.0625 5.77083C12.3508 5.9625 12.4292 6.35083 12.2375 6.6375V6.63833Z" fill="#1D9BF0"/>
                            </svg>
                        </span>
                    </template>
                </div>
                <p class="text-[var(--text-sec)]" x-text="'@'+sharedProfile?.username"></p>
                
                <p x-show="sharedProfile?.bio" class="mt-3 text-sm leading-relaxed" x-text="sharedProfile?.bio"></p>
                
                <!-- ƒ∞statistikler -->
                <div class="flex gap-6 mt-4 py-4 border-y border-[var(--border)]">
                    <div class="text-center flex-1">
                        <p class="font-black text-xl" x-text="sharedProfile?.postCount || 0"></p>
                        <p class="text-xs text-[var(--text-sec)] font-medium">G√∂nderi</p>
                    </div>
                    <div class="text-center flex-1">
                        <p class="font-black text-xl" x-text="sharedProfile?.followerCount || 0"></p>
                        <p class="text-xs text-[var(--text-sec)] font-medium">Takip√ßi</p>
                    </div>
                    <div class="text-center flex-1">
                        <p class="font-black text-xl" x-text="sharedProfile?.followingCount || 0"></p>
                        <p class="text-xs text-[var(--text-sec)] font-medium">Takip</p>
                    </div>
                </div>
            </div>
            
            <!-- G√∂nderiler -->
            <div class="p-4">
                <h4 class="font-bold mb-3">G√∂nderiler</h4>
                <div class="grid grid-cols-3 gap-1">
                    <template x-for="post in sharedProfilePosts" :key="post.id">
                        <div @click="openTikTokScroll(post)" class="aspect-square relative overflow-hidden rounded-lg cursor-pointer hover:opacity-80 transition">
                            <template x-if="post.mediaType === 'video'">
                                <div class="w-full h-full bg-slate-800 flex items-center justify-center relative">
                                    <img :src="post.thumbnail || ''" class="w-full h-full object-cover" @error="$el.style.display='none'">
                                    <i class="fas fa-play absolute text-white text-xl drop-shadow-lg"></i>
                                </div>
                            </template>
                            <template x-if="post.mediaType === 'image' || (!post.mediaType && post.mediaUrl)">
                                <img :src="post.mediaUrl || post.thumbnail" class="w-full h-full object-cover">
                            </template>
                            <template x-if="!post.mediaUrl">
                                <div class="w-full h-full bg-gradient-to-br from-emerald-100 to-teal-50 flex items-center justify-center p-3">
                                    <p class="text-xs text-center text-[var(--text-sec)] line-clamp-4" x-text="post.content"></p>
                                </div>
                            </template>
                            <!-- √áoklu medya g√∂stergesi -->
                            <template x-if="post.mediaUrls && post.mediaUrls.length > 1">
                                <div class="absolute top-1.5 right-1.5 bg-black/60 rounded-md px-1.5 py-0.5 text-white text-[10px] font-bold flex items-center gap-1">
                                    <i class="fas fa-clone text-[8px]"></i><span x-text="post.mediaUrls.length"></span>
                                </div>
                            </template>
                        </div>
                    </template>
                </div>
                <template x-if="sharedProfilePosts.length === 0">
                    <div class="text-center py-12">
                        <i class="fas fa-camera text-4xl text-[var(--text-sec)] mb-3 opacity-50"></i>
                        <p class="text-[var(--text-sec)]">Hen√ºz g√∂nderi yok</p>
                    </div>
                </template>
            </div>
        </div>
    </div>

    <!-- ============ SCRIPT ============ -->
    <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
        // Varsayƒ±lan profil resmi - t√ºm ui-avatars.com yerine agro_pp.jpg kullan
        const AGRO_DEFAULT_AVATAR = 'agro_pp.jpg';
        
        // T√ºm resimlerde ui-avatars.com hata durumunda agro_pp.jpg g√∂ster
        document.addEventListener('error', function(e) {
            if (e.target.tagName === 'IMG' && e.target.src && e.target.src.includes('ui-avatars.com')) {
                e.target.src = AGRO_DEFAULT_AVATAR;
            }
        }, true);
        
        // Sayfa y√ºklendiƒüinde t√ºm ui-avatars.com src'lerini deƒüi≈ütir
        function replaceDefaultAvatars() {
            document.querySelectorAll('img').forEach(function(img) {
                if (img.src && img.src.includes('ui-avatars.com')) {
                    img.src = AGRO_DEFAULT_AVATAR;
                }
            });
        }
        
        // MutationObserver ile dinamik olarak eklenen resimleri de yakala
        const avatarObserver = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
                mutation.addedNodes.forEach(function(node) {
                    if (node.nodeType === 1) {
                        if (node.tagName === 'IMG' && node.src && node.src.includes('ui-avatars.com')) {
                            node.src = AGRO_DEFAULT_AVATAR;
                        }
                        node.querySelectorAll && node.querySelectorAll('img[src*="ui-avatars.com"]').forEach(function(img) {
                            img.src = AGRO_DEFAULT_AVATAR;
                        });
                    }
                });
                // Attribute deƒüi≈üikliklerini de yakala
                if (mutation.type === 'attributes' && mutation.attributeName === 'src' && mutation.target.tagName === 'IMG') {
                    if (mutation.target.src && mutation.target.src.includes('ui-avatars.com')) {
                        mutation.target.src = AGRO_DEFAULT_AVATAR;
                    }
                }
            });
        });
        
        document.addEventListener('DOMContentLoaded', function() {
            replaceDefaultAvatars();
            avatarObserver.observe(document.body, { childList: true, subtree: true, attributes: true, attributeFilter: ['src'] });
        });
        // =============================================================================
        // üé¨ AGROLINK ABR VIDEO PLAYER - YouTube Adaptive Bitrate Streaming Sistemi
        // =============================================================================
        // Strateji:
        //  1. Video elementi olu≈ütuƒüunda ANINDA MP4 src set edilir ‚Üí video hemen oynar
        //  2. Arka planda HLS (master.m3u8) dosyasƒ± var mƒ± kontrol edilir (HEAD isteƒüi)
        //  3. HLS hazƒ±rsa hls.js ile ABR moduna GE√áƒ∞Lƒ∞R ‚Üí kalite bant geni≈üliƒüine g√∂re
        //     otomatik ayarlanƒ±r, 360p / 720p / 1080p segmentler arasƒ±nda ge√ßi≈ü yapƒ±lƒ±r
        //  4. HLS hen√ºz √ºretilmemi≈üse (yeni y√ºklenen video) MP4 ile devam edilir
        //     ‚Üí HLS arka planda bitince sonraki y√ºklemeye otomatik aktif olur
        // =============================================================================

        // Global HLS instance haritasƒ±: videoEl ‚Üí Hls instance
        window._agroHlsInstances = new WeakMap();

        /**
         * Video elementini ba≈ülat:
         *  - HEMEN MP4 src atar (hi√ß donma yok)
         *  - Arka planda HLS varsa ABR moduna y√ºkseltir
         *
         * @param {HTMLVideoElement} videoEl
         * @param {string}           mediaUrl  - "/uploads/videos/video_xxx.mp4"
         */
        function initAgroHLS(videoEl, mediaUrl) {
            if (!videoEl || !mediaUrl) return;
            // Zaten ba≈ülatƒ±lmƒ±≈üsa tekrar ba≈ülatma
            if (videoEl._agroInitialized) return;
            videoEl._agroInitialized = true;

            const isHLS = mediaUrl.includes('.m3u8') || mediaUrl.includes('/uploads/hls/');

            // ‚îÄ‚îÄ‚îÄ HLS URL ise ‚Üí doƒürudan HLS.js ile ba≈ülat ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
            if (isHLS) {
                if (typeof Hls !== 'undefined' && Hls.isSupported()) {
                    const hls = new Hls({
                        abrEwmaDefaultEstimate:  500000,
                        abrEwmaFastLive:         3.0,
                        abrEwmaSlowLive:         9.0,
                        abrBandWidthFactor:      0.95,
                        abrBandWidthUpFactor:    0.85,
                        maxBufferLength:         30,
                        maxMaxBufferLength:      60,
                        maxBufferSize:           60*1000*1000,
                        backBufferLength:        10,
                        fragLoadingMaxRetry:     4,
                        levelLoadingMaxRetry:    2,
                        manifestLoadingMaxRetry: 2,
                        startLevel:              0,
                        capLevelToPlayerSize:    true,
                        lowLatencyMode:          false
                    });
                    hls.loadSource(mediaUrl);
                    hls.attachMedia(videoEl);
                    hls.on(Hls.Events.MANIFEST_PARSED, () => {
                        console.log(`‚úÖ [ABR] HLS aktif ‚Üí ${mediaUrl} (${hls.levels.length} kalite)`);
                    });
                    hls.on(Hls.Events.ERROR, (event, data) => {
                        if (data.fatal) {
                            console.warn(`‚ö†Ô∏è [ABR] HLS kritik hata, MP4 fallback: ${data.details}`);
                            hls.destroy();
                            window._agroHlsInstances.delete(videoEl);
                            delete videoEl._agroInitialized;
                            // MP4 fallback: HLS URL'den videoId √ßƒ±kar
                            const m = mediaUrl.match(/\/hls\/([^/]+)\//);
                            if (m) videoEl.src = `/uploads/videos/${m[1]}.mp4`;
                        }
                    });
                    hls.on(Hls.Events.LEVEL_SWITCHED, (event, data) => {
                        const lvl = hls.levels[data.level];
                        if (lvl) console.debug(`üé¨ [ABR] Kalite: ${lvl.height}p @ ${Math.round(lvl.bitrate/1000)}kbps`);
                    });
                    window._agroHlsInstances.set(videoEl, hls);
                } else if (videoEl.canPlayType('application/vnd.apple.mpegurl')) {
                    // Safari - yerel HLS desteƒüi
                    videoEl.src = mediaUrl;
                } else {
                    // HLS desteksiz tarayƒ±cƒ± ‚Üí MP4 fallback
                    const m = mediaUrl.match(/\/hls\/([^/]+)\//);
                    if (m) videoEl.src = `/uploads/videos/${m[1]}.mp4`;
                    else videoEl.src = mediaUrl;
                }
                return;
            }

            // ‚îÄ‚îÄ‚îÄ MP4 URL ise ‚Üí hemen oynat, arka planda HLS kontrol et ‚îÄ‚îÄ
            videoEl.src = mediaUrl;

            const filename = mediaUrl.split('/').pop();
            const videoId  = filename.replace(/\.[^.]+$/, '');
            const hlsUrl   = `/uploads/hls/${videoId}/master.m3u8`;

            // Sadece /uploads/videos/ MP4'leri i√ßin HLS kontrol√º yap
            if (!mediaUrl.includes('/uploads/videos/')) return;

            fetch(hlsUrl, { method: 'HEAD' })
                .then(res => {
                    if (!res.ok) {
                        console.debug(`üé¨ [ABR] HLS hen√ºz hazƒ±r deƒüil, MP4 ile devam: ${videoId}`);
                        return;
                    }

                    if (typeof Hls === 'undefined') return;

                    if (Hls.isSupported()) {
                        const hls = new Hls({
                            abrEwmaDefaultEstimate:  500000,
                            abrEwmaFastLive:         3.0,
                            abrEwmaSlowLive:         9.0,
                            abrBandWidthFactor:      0.95,
                            abrBandWidthUpFactor:    0.85,
                            maxBufferLength:         30,
                            maxMaxBufferLength:      60,
                            maxBufferSize:           60*1000*1000,
                            backBufferLength:        10,
                            fragLoadingMaxRetry:     4,
                            levelLoadingMaxRetry:    2,
                            manifestLoadingMaxRetry: 2,
                            startLevel:              0,
                            capLevelToPlayerSize:    true,
                            lowLatencyMode:          false
                        });

                        const currentTime = videoEl.currentTime;
                        const wasPaused   = videoEl.paused;

                        hls.loadSource(hlsUrl);
                        hls.attachMedia(videoEl);

                        hls.on(Hls.Events.MANIFEST_PARSED, () => {
                            videoEl.currentTime = currentTime;
                            if (!wasPaused) videoEl.play().catch(() => {});
                            console.log(`‚úÖ [ABR] MP4‚ÜíHLS y√ºkseltildi ‚Üí ${videoId} (${hls.levels.length} kalite)`);
                        });

                        hls.on(Hls.Events.ERROR, (event, data) => {
                            if (data.fatal) {
                                console.warn(`‚ö†Ô∏è [ABR] HLS kritik hata, MP4'e d√∂n: ${data.details}`);
                                hls.destroy();
                                window._agroHlsInstances.delete(videoEl);
                                delete videoEl._agroInitialized;
                                videoEl.src = mediaUrl;
                                videoEl.currentTime = currentTime;
                                if (!wasPaused) videoEl.play().catch(() => {});
                            }
                        });

                        hls.on(Hls.Events.LEVEL_SWITCHED, (event, data) => {
                            const lvl = hls.levels[data.level];
                            if (lvl) console.debug(`üé¨ [ABR] Kalite: ${lvl.height}p @ ${Math.round(lvl.bitrate/1000)}kbps`);
                        });

                        window._agroHlsInstances.set(videoEl, hls);

                    } else if (videoEl.canPlayType('application/vnd.apple.mpegurl')) {
                        const t = videoEl.currentTime;
                        videoEl.src = hlsUrl;
                        videoEl.currentTime = t;
                    }
                })
                .catch(() => {
                    // Aƒü hatasƒ± ‚Üí MP4 ile devam
                });
        }

        /**
         * HLS instance'ƒ± temizle - element kaldƒ±rƒ±lƒ±rken √ßaƒürƒ±lƒ±r.
         */
        function destroyAgroHLS(videoEl) {
            if (!videoEl) return;
            const hls = window._agroHlsInstances.get(videoEl);
            if (hls) {
                hls.destroy();
                window._agroHlsInstances.delete(videoEl);
            }
            delete videoEl._agroInitialized;
            videoEl.src = '';
        }

        // Global eri≈üim
        window.initAgroHLS    = initAgroHLS;
        window.destroyAgroHLS = destroyAgroHLS;

        console.log('üé¨ AgroLink ABR Video Player hazƒ±r (MP4‚ÜíHLS akƒ±llƒ± y√ºkseltme aktif)');
        // =============================================================================

        function agroApp() {
            return {
                // Auth & User
                // ========== G√úVENLƒ∞ STORAGE Sƒ∞STEMƒ∞ ==========
                // IIFE ile kaps√ºllenmi≈ü - konsoldan eri≈üilemez
                SecureStorage: (function() {
                    const _prefix = '_agro_secure_';
                    const _keyName = '_agro_ck';

                    // üîí G√úVENLƒ∞K: √ñnceki XOR + hardcoded key kaldƒ±rƒ±ldƒ± (trivially reversible)
                    // Artƒ±k WebCrypto AES-GCM kullanƒ±lƒ±yor.
                    // Anahtar cihaza √∂zg√º, rastgele √ºretilir ve localStorage'da saklanƒ±r.
                    function _getOrCreateRawKey() {
                        let raw = localStorage.getItem(_keyName);
                        if (!raw) {
                            const bytes = new Uint8Array(32);
                            crypto.getRandomValues(bytes);
                            raw = btoa(String.fromCharCode(...bytes));
                            localStorage.setItem(_keyName, raw);
                        }
                        return raw;
                    }

                    function _rawToKey(raw) {
                        const bytes = Uint8Array.from(atob(raw), c => c.charCodeAt(0));
                        return crypto.subtle.importKey('raw', bytes, { name: 'AES-GCM' }, false, ['encrypt', 'decrypt']);
                    }

                    async function _encryptAsync(data) {
                        try {
                            const raw  = _getOrCreateRawKey();
                            const key  = await _rawToKey(raw);
                            const iv   = crypto.getRandomValues(new Uint8Array(12));
                            const enc  = new TextEncoder().encode(JSON.stringify(data));
                            const ct   = await crypto.subtle.encrypt({ name: 'AES-GCM', iv }, key, enc);
                            const combined = new Uint8Array(iv.byteLength + ct.byteLength);
                            combined.set(iv, 0);
                            combined.set(new Uint8Array(ct), iv.byteLength);
                            return btoa(String.fromCharCode(...combined));
                        } catch (e) { return null; }
                    }

                    async function _decryptAsync(ciphertext) {
                        try {
                            const raw     = _getOrCreateRawKey();
                            const key     = await _rawToKey(raw);
                            const combined = Uint8Array.from(atob(ciphertext), c => c.charCodeAt(0));
                            const iv      = combined.slice(0, 12);
                            const ct      = combined.slice(12);
                            const pt      = await crypto.subtle.decrypt({ name: 'AES-GCM', iv }, key, ct);
                            return JSON.parse(new TextDecoder().decode(pt));
                        } catch (e) { return null; }
                    }

                    // Geriye d√∂n√ºk uyumluluk: set/get sync API korunuyor,
                    // arka planda async ≈üifreleme promise zinciriyle √ßalƒ±≈üƒ±r.
                    const _cache = {};

                    return {
                        // Senkron set: reload() √∂ncesi kullanma (async yazma tamamlanmayabilir)
                        set: function(key, value) {
                            try {
                                _cache[key] = value;
                                _encryptAsync(value).then(enc => {
                                    if (enc) localStorage.setItem(_prefix + key, enc);
                                }).catch(() => {});
                                return true;
                            } catch (e) {}
                            return false;
                        },

                        // ‚úÖ Async set: localStorage yazma tamamlanana KADAR bekler.
                        // location.reload() √∂ncesi MUTLAKA bu kullanƒ±lmalƒ±!
                        setAsync: async function(key, value) {
                            try {
                                _cache[key] = value;
                                const enc = await _encryptAsync(value);
                                if (enc) localStorage.setItem(_prefix + key, enc);
                                return true;
                            } catch (e) { return false; }
                        },

                        get: function(key, defaultValue) {
                            if (defaultValue === undefined) defaultValue = null;
                            // Hƒ±zlƒ± yol: bellek cache'inden d√∂n
                            if (key in _cache) return _cache[key];
                            // Sayfa y√ºklemesinde cache dolana kadar null d√∂n
                            const enc = localStorage.getItem(_prefix + key);
                            if (enc) {
                                _decryptAsync(enc).then(val => {
                                    if (val !== null) _cache[key] = val;
                                }).catch(() => {});
                            }
                            return defaultValue;
                        },

                        getAsync: async function(key, defaultValue) {
                            if (defaultValue === undefined) defaultValue = null;
                            if (key in _cache) return _cache[key];
                            try {
                                const enc = localStorage.getItem(_prefix + key);
                                if (!enc) return defaultValue;
                                const val = await _decryptAsync(enc);
                                if (val !== null) _cache[key] = val;
                                return val !== null ? val : defaultValue;
                            } catch (e) { return defaultValue; }
                        },

                        remove: function(key) {
                            delete _cache[key];
                            localStorage.removeItem(_prefix + key);
                        },
                        
                        clear: function() {
                            // üîí Bellek cache'ini ve localStorage'ƒ± birlikte temizle
                            Object.keys(_cache).forEach(function(k) { delete _cache[k]; });
                            const keysToRemove = [];
                            for (let i = 0; i < localStorage.length; i++) {
                                const key = localStorage.key(i);
                                if (key && key.startsWith(_prefix)) {
                                    keysToRemove.push(key);
                                }
                            }
                            keysToRemove.forEach(function(k) { localStorage.removeItem(k); });
                        },
                        
                        // Migration: Eski verileri ta≈üƒ±
                        migrateFromLegacy: function() {
                            // Eski token'ƒ± ta≈üƒ±
                            const oldToken = localStorage.getItem('token');
                            if (oldToken && !localStorage.getItem(_prefix + 'token')) {
                                this.set('token', oldToken);
                                localStorage.removeItem('token');
                            }
                            
                            // Eski user'ƒ± ta≈üƒ±
                            const oldUser = localStorage.getItem('user');
                            if (oldUser && !localStorage.getItem(_prefix + 'user')) {
                                try {
                                    const userObj = JSON.parse(oldUser);
                                    this.set('user', userObj);
                                    localStorage.removeItem('user');
                                } catch(e) {}
                            }
                            
                            // Eski agrolink_user'ƒ± ta≈üƒ±
                            const oldAgroUser = localStorage.getItem('agrolink_user');
                            if (oldAgroUser && !localStorage.getItem(_prefix + 'agrolink_user')) {
                                try {
                                    const userObj = JSON.parse(oldAgroUser);
                                    this.set('agrolink_user', userObj);
                                    localStorage.removeItem('agrolink_user');
                                } catch(e) {}
                            }
                        }
                    };
                })(),
                
                // Auth & User - SecureStorage ile
                isLoggedIn: false,
                darkMode: localStorage.getItem('theme') === 'dark',
                feedMode: localStorage.getItem('feedMode') || 'normal', // 'normal' | 'media'
                user: {},
                followingIds: [], // Takip edilen kullanƒ±cƒ±larƒ±n ID'leri
                userBadges: [], // Kullanƒ±cƒ± rozetleri
                topEngagementUsers: [], // En y√ºksek etkile≈üimli kullanƒ±cƒ±lar
                mutualFollowers: [], // Ortak takip√ßiler
                mutualFollowersCount: 0,
                viewingUserId: null, // G√∂r√ºnt√ºlenen profil ID'si
                authMode: 'login',
                registerStep: 1,
                authForm: { name: '', username: '', email: '', password: '', avatarFile: null, avatarPreview: '', userType: '', identifier: '', kvkk: false },
                captcha: { q: '', a: null, userAns: '' },
                recaptchaVerified: false,
                recaptchaResponse: '',
                recaptchaWidgetId: null,
                showPassword: false,
                showCurrentPassword: false,
                showNewPassword: false,
                showConfirmPassword: false,
                showDeletePassword: false,
                
                // üîî PUSH NOTIFICATION STATE
                pushNotificationsEnabled: false,
                pushSubscription: null,
                
                // ========== Dƒ∞L Sƒ∞STEMƒ∞ ==========
                currentLanguage: localStorage.getItem('agrolink_lang') || 'tr',
                showLanguageModal: false,
                showInterestsOnboarding: false,
                showLangOnboarding: false,
                selectedInterests: [],
                interestTopAccounts: [],
                bioExpanded: false,
                viewedBioExpanded: false,
                exploreTouchStartX: 0,
                exploreTouchStartY: 0,
                appTouchStartX: 0,
                appTouchStartY: 0,
                availableLanguages: [
                    { code: 'tr', name: 'T√ºrk√ße', flag: 'üáπüá∑' },
                    { code: 'en', name: 'English', flag: 'üá∫üá∏' },
                    { code: 'ar', name: 'ÿßŸÑÿπÿ±ÿ®Ÿäÿ©', flag: 'üá∏üá¶' },
                    { code: 'de', name: 'Deutsch', flag: 'üá©üá™' },
                    { code: 'fr', name: 'Fran√ßais', flag: 'üá´üá∑' },
                    { code: 'es', name: 'Espa√±ol', flag: 'üá™üá∏' },
                    { code: 'ru', name: '–†—É—Å—Å–∫–∏–π', flag: 'üá∑üá∫' },
                    { code: 'zh', name: '‰∏≠Êñá', flag: 'üá®üá≥' },
                ],
                translations: {
                    tr: {
                        // Genel
                        home: 'Ana Sayfa',
                        explore: 'Ke≈üfet',
                        messages: 'Mesajlar',
                        notifications: 'Bildirimler',
                        profile: 'Profil',
                        settings: 'Ayarlar',
                        search: 'Ara',
                        cancel: 'ƒ∞ptal',
                        save: 'Kaydet',
                        delete: 'Sil',
                        edit: 'D√ºzenle',
                        share: 'Payla≈ü',
                        follow: 'Takip Et',
                        following: 'Takip Ediliyor',
                        followers: 'Takip√ßi',
                        posts: 'G√∂nderiler',
                        likes: 'Beƒüeniler',
                        comments: 'Yorumlar',
                        // Ayarlar
                        appearance: 'G√∂r√ºn√ºm',
                        darkMode: 'Koyu Mod',
                        lightMode: 'A√ßƒ±k Mod',
                        language: 'Dil',
                        selectLanguage: 'Dil Se√ßimi',
                        account: 'Hesap',
                        changePassword: '≈ûifre Deƒüi≈ütir',
                        editProfile: 'Profili D√ºzenle',
                        blockedAccounts: 'Engellenen Hesaplar',
                        savedPosts: 'Kaydedilen G√∂nderiler',
                        notificationsTitle: 'Bildirimler',
                        pushNotifications: 'Push Bildirimleri',
                        emailNotifications: 'E-posta Bildirimleri',
                        security: 'G√ºvenlik',
                        twoFactorAuth: '2FA E-posta Doƒürulama',
                        about: 'Hakkƒ±nda',
                        appVersion: 'Uygulama Versiyonu',
                        releaseNotes: 'S√ºr√ºm Notlarƒ±',
                        termsOfService: 'Kullanƒ±m Ko≈üullarƒ±',
                        privacyPolicy: 'Gizlilik Politikasƒ±',
                        verification: 'Doƒürulama',
                        getVerified: 'Doƒürulanmƒ±≈ü Rozet Al',
                        verified: 'Doƒürulanmƒ±≈ü',
                        session: 'Oturum',
                        logout: '√áƒ±kƒ±≈ü Yap',
                        deleteAccount: 'Hesabƒ± Sil',
                        info: 'Bilgiler',
                        allRightsReserved: '2026 T√ºm Haklarƒ± Saklƒ±dƒ±r',
                        // Maƒüaza
                        store: 'Tarƒ±m Pazarƒ±',
                        addProduct: 'ƒ∞lan Ver',
                        noProducts: 'Hen√ºz √ºr√ºn yok',
                        sendMessage: 'Mesaj G√∂nder',
                        productDetail: '√úr√ºn Detayƒ±',
                        // Mesajlar
                        noMessages: 'Hen√ºz mesaj yok',
                        startConversation: 'Birinin profiline gidip mesaj g√∂ndermeye ba≈ülayƒ±n',
                        searchChats: 'Sohbet ara...',
                        typeMessage: 'Mesaj yaz...',
                        // G√∂nderi
                        newPost: 'Yeni G√∂nderi',
                        whatsOnYourMind: 'Aklƒ±ndan neler ge√ßiyor?',
                        post: 'G√∂nderi',
                        poll: 'Anket',
                        addLocation: 'Konum Ekle',
                        postShared: 'G√∂nderi payla≈üƒ±ldƒ±!',
                        // Profil
                        online: '√áevrimi√ßi',
                        joined: 'Katƒ±ldƒ±',
                        noBioYet: 'Hen√ºz bir biyografi eklenmedi üå±',
                        media: 'Medya',
                        liked: 'Beƒüenilenler',
                        // Auth
                        login: 'Giri≈ü Yap',
                        register: 'Kayƒ±t Ol',
                        email: 'E-posta',
                        password: '≈ûifre',
                        confirmPassword: '≈ûifreyi Onayla',
                        name: 'Ad Soyad',
                        username: 'Kullanƒ±cƒ± Adƒ±',
                        // Diƒüer
                        loading: 'Y√ºkleniyor...',
                        noPostsYet: 'Hen√ºz g√∂nderi yok',
                        copied: 'Kopyalandƒ±',
                        linkCopied: 'Link kopyalandƒ±',
                        trend: 'Trend',
                        mostLiked: 'En √áok Beƒüenilen',
                        mostCommented: 'En √áok Yorumlanan'
                    },
                    en: {
                        // General
                        home: 'Home',
                        explore: 'Explore',
                        messages: 'Messages',
                        notifications: 'Notifications',
                        profile: 'Profile',
                        settings: 'Settings',
                        search: 'Search',
                        cancel: 'Cancel',
                        save: 'Save',
                        delete: 'Delete',
                        edit: 'Edit',
                        share: 'Share',
                        follow: 'Follow',
                        following: 'Following',
                        followers: 'Followers',
                        posts: 'Posts',
                        likes: 'Likes',
                        comments: 'Comments',
                        // Settings
                        appearance: 'Appearance',
                        darkMode: 'Dark Mode',
                        lightMode: 'Light Mode',
                        language: 'Language',
                        selectLanguage: 'Select Language',
                        account: 'Account',
                        changePassword: 'Change Password',
                        editProfile: 'Edit Profile',
                        blockedAccounts: 'Blocked Accounts',
                        savedPosts: 'Saved Posts',
                        notificationsTitle: 'Notifications',
                        pushNotifications: 'Push Notifications',
                        emailNotifications: 'Email Notifications',
                        security: 'Security',
                        twoFactorAuth: '2FA Email Verification',
                        about: 'About',
                        appVersion: 'App Version',
                        releaseNotes: 'Release Notes',
                        termsOfService: 'Terms of Service',
                        privacyPolicy: 'Privacy Policy',
                        verification: 'Verification',
                        getVerified: 'Get Verified Badge',
                        verified: 'Verified',
                        session: 'Session',
                        logout: 'Logout',
                        deleteAccount: 'Delete Account',
                        info: 'Information',
                        allRightsReserved: '2026 All Rights Reserved',
                        // Store
                        store: 'Farm Market',
                        addProduct: 'Add Listing',
                        noProducts: 'No products yet',
                        sendMessage: 'Send Message',
                        productDetail: 'Product Detail',
                        // Messages
                        noMessages: 'No messages yet',
                        startConversation: 'Go to someone\'s profile to start a conversation',
                        searchChats: 'Search chats...',
                        typeMessage: 'Type a message...',
                        // Post
                        newPost: 'New Post',
                        whatsOnYourMind: 'What\'s on your mind?',
                        post: 'Post',
                        poll: 'Poll',
                        addLocation: 'Add Location',
                        postShared: 'Post shared!',
                        // Profile
                        online: 'Online',
                        joined: 'Joined',
                        noBioYet: 'No bio added yet üå±',
                        media: 'Media',
                        liked: 'Liked',
                        // Auth
                        login: 'Login',
                        register: 'Register',
                        email: 'Email',
                        password: 'Password',
                        confirmPassword: 'Confirm Password',
                        name: 'Full Name',
                        username: 'Username',
                        // Other
                        loading: 'Loading...',
                        noPostsYet: 'No posts yet',
                        copied: 'Copied',
                        linkCopied: 'Link copied',
                        trend: 'Trending',
                        mostLiked: 'Most Liked',
                        mostCommented: 'Most Commented'
                    },
                    de: {
                        // Allgemein
                        home: 'Startseite',
                        explore: 'Entdecken',
                        messages: 'Nachrichten',
                        notifications: 'Benachrichtigungen',
                        profile: 'Profil',
                        settings: 'Einstellungen',
                        search: 'Suchen',
                        cancel: 'Abbrechen',
                        save: 'Speichern',
                        delete: 'L√∂schen',
                        edit: 'Bearbeiten',
                        share: 'Teilen',
                        follow: 'Folgen',
                        following: 'Folge ich',
                        followers: 'Follower',
                        posts: 'Beitr√§ge',
                        likes: 'Gef√§llt mir',
                        comments: 'Kommentare',
                        // Einstellungen
                        appearance: 'Erscheinungsbild',
                        darkMode: 'Dunkelmodus',
                        lightMode: 'Hellmodus',
                        language: 'Sprache',
                        selectLanguage: 'Sprache w√§hlen',
                        account: 'Konto',
                        changePassword: 'Passwort √§ndern',
                        editProfile: 'Profil bearbeiten',
                        blockedAccounts: 'Blockierte Konten',
                        savedPosts: 'Gespeicherte Beitr√§ge',
                        notificationsTitle: 'Benachrichtigungen',
                        pushNotifications: 'Push-Benachrichtigungen',
                        emailNotifications: 'E-Mail-Benachrichtigungen',
                        security: 'Sicherheit',
                        twoFactorAuth: '2FA E-Mail-Verifizierung',
                        about: '√úber',
                        appVersion: 'App-Version',
                        releaseNotes: 'Versionshinweise',
                        termsOfService: 'Nutzungsbedingungen',
                        privacyPolicy: 'Datenschutzrichtlinie',
                        verification: 'Verifizierung',
                        getVerified: 'Verifiziertes Abzeichen erhalten',
                        verified: 'Verifiziert',
                        session: 'Sitzung',
                        logout: 'Abmelden',
                        deleteAccount: 'Konto l√∂schen',
                        info: 'Informationen',
                        allRightsReserved: '2026 Alle Rechte vorbehalten',
                        // Gesch√§ft
                        store: 'Bauernmarkt',
                        addProduct: 'Anzeige hinzuf√ºgen',
                        noProducts: 'Noch keine Produkte',
                        sendMessage: 'Nachricht senden',
                        productDetail: 'Produktdetail',
                        // Nachrichten
                        noMessages: 'Noch keine Nachrichten',
                        startConversation: 'Gehen Sie zu einem Profil, um eine Unterhaltung zu beginnen',
                        searchChats: 'Chats suchen...',
                        typeMessage: 'Nachricht eingeben...',
                        // Beitrag
                        newPost: 'Neuer Beitrag',
                        whatsOnYourMind: 'Was denkst du gerade?',
                        post: 'Beitrag',
                        poll: 'Umfrage',
                        addLocation: 'Standort hinzuf√ºgen',
                        postShared: 'Beitrag geteilt!',
                        // Profil
                        online: 'Online',
                        joined: 'Beigetreten',
                        noBioYet: 'Noch keine Biografie hinzugef√ºgt üå±',
                        media: 'Medien',
                        liked: 'Gef√§llt mir',
                        // Auth
                        login: 'Anmelden',
                        register: 'Registrieren',
                        email: 'E-Mail',
                        password: 'Passwort',
                        confirmPassword: 'Passwort best√§tigen',
                        name: 'Vollst√§ndiger Name',
                        username: 'Benutzername',
                        // Sonstiges
                        loading: 'Wird geladen...',
                        noPostsYet: 'Noch keine Beitr√§ge',
                        copied: 'Kopiert',
                        linkCopied: 'Link kopiert',
                        trend: 'Trend',
                        mostLiked: 'Am meisten geliked',
                        mostCommented: 'Am meisten kommentiert'
                    },
                    fr: {
                        // G√©n√©ral
                        home: 'Accueil',
                        explore: 'Explorer',
                        messages: 'Messages',
                        notifications: 'Notifications',
                        profile: 'Profil',
                        settings: 'Param√®tres',
                        search: 'Rechercher',
                        cancel: 'Annuler',
                        save: 'Enregistrer',
                        delete: 'Supprimer',
                        edit: 'Modifier',
                        share: 'Partager',
                        follow: 'Suivre',
                        following: 'Abonn√©',
                        followers: 'Abonn√©s',
                        posts: 'Publications',
                        likes: 'J\'aime',
                        comments: 'Commentaires',
                        // Param√®tres
                        appearance: 'Apparence',
                        darkMode: 'Mode sombre',
                        lightMode: 'Mode clair',
                        language: 'Langue',
                        selectLanguage: 'S√©lectionner la langue',
                        account: 'Compte',
                        changePassword: 'Changer le mot de passe',
                        editProfile: 'Modifier le profil',
                        blockedAccounts: 'Comptes bloqu√©s',
                        savedPosts: 'Publications enregistr√©es',
                        notificationsTitle: 'Notifications',
                        pushNotifications: 'Notifications push',
                        emailNotifications: 'Notifications par e-mail',
                        security: 'S√©curit√©',
                        twoFactorAuth: 'V√©rification 2FA par e-mail',
                        about: '√Ä propos',
                        appVersion: 'Version de l\'application',
                        releaseNotes: 'Notes de version',
                        termsOfService: 'Conditions d\'utilisation',
                        privacyPolicy: 'Politique de confidentialit√©',
                        verification: 'V√©rification',
                        getVerified: 'Obtenir le badge v√©rifi√©',
                        verified: 'V√©rifi√©',
                        session: 'Session',
                        logout: 'D√©connexion',
                        deleteAccount: 'Supprimer le compte',
                        info: 'Informations',
                        allRightsReserved: '2026 Tous droits r√©serv√©s',
                        // Boutique
                        store: 'March√© agricole',
                        addProduct: 'Ajouter une annonce',
                        noProducts: 'Pas encore de produits',
                        sendMessage: 'Envoyer un message',
                        productDetail: 'D√©tail du produit',
                        // Messages
                        noMessages: 'Pas encore de messages',
                        startConversation: 'Allez sur le profil de quelqu\'un pour d√©marrer une conversation',
                        searchChats: 'Rechercher des discussions...',
                        typeMessage: '√âcrire un message...',
                        // Publication
                        newPost: 'Nouvelle publication',
                        whatsOnYourMind: '√Ä quoi pensez-vous?',
                        post: 'Publication',
                        poll: 'Sondage',
                        addLocation: 'Ajouter un lieu',
                        postShared: 'Publication partag√©e!',
                        // Profil
                        online: 'En ligne',
                        joined: 'Inscrit',
                        noBioYet: 'Pas encore de biographie üå±',
                        media: 'M√©dias',
                        liked: 'Aim√©',
                        // Auth
                        login: 'Connexion',
                        register: 'S\'inscrire',
                        email: 'E-mail',
                        password: 'Mot de passe',
                        confirmPassword: 'Confirmer le mot de passe',
                        name: 'Nom complet',
                        username: 'Nom d\'utilisateur',
                        // Autre
                        loading: 'Chargement...',
                        noPostsYet: 'Pas encore de publications',
                        copied: 'Copi√©',
                        linkCopied: 'Lien copi√©',
                        trend: 'Tendance',
                        mostLiked: 'Les plus aim√©s',
                        mostCommented: 'Les plus comment√©s'
                    },
                    es: {
                        // General
                        home: 'Inicio',
                        explore: 'Explorar',
                        messages: 'Mensajes',
                        notifications: 'Notificaciones',
                        profile: 'Perfil',
                        settings: 'Configuraci√≥n',
                        search: 'Buscar',
                        cancel: 'Cancelar',
                        save: 'Guardar',
                        delete: 'Eliminar',
                        edit: 'Editar',
                        share: 'Compartir',
                        follow: 'Seguir',
                        following: 'Siguiendo',
                        followers: 'Seguidores',
                        posts: 'Publicaciones',
                        likes: 'Me gusta',
                        comments: 'Comentarios',
                        // Configuraci√≥n
                        appearance: 'Apariencia',
                        darkMode: 'Modo oscuro',
                        lightMode: 'Modo claro',
                        language: 'Idioma',
                        selectLanguage: 'Seleccionar idioma',
                        account: 'Cuenta',
                        changePassword: 'Cambiar contrase√±a',
                        editProfile: 'Editar perfil',
                        blockedAccounts: 'Cuentas bloqueadas',
                        savedPosts: 'Publicaciones guardadas',
                        notificationsTitle: 'Notificaciones',
                        pushNotifications: 'Notificaciones push',
                        emailNotifications: 'Notificaciones por correo',
                        security: 'Seguridad',
                        twoFactorAuth: 'Verificaci√≥n 2FA por correo',
                        about: 'Acerca de',
                        appVersion: 'Versi√≥n de la app',
                        releaseNotes: 'Notas de la versi√≥n',
                        termsOfService: 'T√©rminos de servicio',
                        privacyPolicy: 'Pol√≠tica de privacidad',
                        verification: 'Verificaci√≥n',
                        getVerified: 'Obtener insignia verificada',
                        verified: 'Verificado',
                        session: 'Sesi√≥n',
                        logout: 'Cerrar sesi√≥n',
                        deleteAccount: 'Eliminar cuenta',
                        info: 'Informaci√≥n',
                        allRightsReserved: '2026 Todos los derechos reservados',
                        // Tienda
                        store: 'Mercado agr√≠cola',
                        addProduct: 'Agregar anuncio',
                        noProducts: 'A√∫n no hay productos',
                        sendMessage: 'Enviar mensaje',
                        productDetail: 'Detalle del producto',
                        // Mensajes
                        noMessages: 'A√∫n no hay mensajes',
                        startConversation: 'Ve al perfil de alguien para iniciar una conversaci√≥n',
                        searchChats: 'Buscar chats...',
                        typeMessage: 'Escribe un mensaje...',
                        // Publicaci√≥n
                        newPost: 'Nueva publicaci√≥n',
                        whatsOnYourMind: '¬øQu√© est√°s pensando?',
                        post: 'Publicaci√≥n',
                        poll: 'Encuesta',
                        addLocation: 'Agregar ubicaci√≥n',
                        postShared: '¬°Publicaci√≥n compartida!',
                        // Perfil
                        online: 'En l√≠nea',
                        joined: 'Se uni√≥',
                        noBioYet: 'A√∫n no hay biograf√≠a üå±',
                        media: 'Medios',
                        liked: 'Me gust√≥',
                        // Auth
                        login: 'Iniciar sesi√≥n',
                        register: 'Registrarse',
                        email: 'Correo electr√≥nico',
                        password: 'Contrase√±a',
                        confirmPassword: 'Confirmar contrase√±a',
                        name: 'Nombre completo',
                        username: 'Nombre de usuario',
                        // Otro
                        loading: 'Cargando...',
                        noPostsYet: 'A√∫n no hay publicaciones',
                        copied: 'Copiado',
                        linkCopied: 'Enlace copiado',
                        trend: 'Tendencia',
                        mostLiked: 'M√°s gustados',
                        mostCommented: 'M√°s comentados'
                    },
                    ar: {
                        home: 'ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©', explore: 'ÿßŸÉÿ™ÿ¥ÿßŸÅ', messages: 'ÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ',
                        notifications: 'ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™', profile: 'ÿßŸÑŸÖŸÑŸÅ ÿßŸÑÿ¥ÿÆÿµŸä', settings: 'ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™',
                        search: 'ÿ®ÿ≠ÿ´', cancel: 'ÿ•ŸÑÿ∫ÿßÿ°', save: 'ÿ≠ŸÅÿ∏', delete: 'ÿ≠ÿ∞ŸÅ',
                        edit: 'ÿ™ÿπÿØŸäŸÑ', share: 'ŸÖÿ¥ÿßÿ±ŸÉÿ©', follow: 'ŸÖÿ™ÿßÿ®ÿπÿ©', following: 'ÿ™ÿ™ÿßÿ®ÿπ',
                        followers: 'ÿßŸÑŸÖÿ™ÿßÿ®ÿπŸàŸÜ', posts: 'ÿßŸÑŸÖŸÜÿ¥Ÿàÿ±ÿßÿ™', likes: 'ÿßŸÑÿ•ÿπÿ¨ÿßÿ®ÿßÿ™', comments: 'ÿßŸÑÿ™ÿπŸÑŸäŸÇÿßÿ™',
                        appearance: 'ÿßŸÑŸÖÿ∏Ÿáÿ±', darkMode: 'ÿßŸÑŸàÿ∂ÿπ ÿßŸÑÿØÿßŸÉŸÜ', lightMode: 'ÿßŸÑŸàÿ∂ÿπ ÿßŸÑŸÅÿßÿ™ÿ≠',
                        language: 'ÿßŸÑŸÑÿ∫ÿ©', selectLanguage: 'ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑŸÑÿ∫ÿ©', account: 'ÿßŸÑÿ≠ÿ≥ÿßÿ®',
                        changePassword: 'ÿ™ÿ∫ŸäŸäÿ± ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±', editProfile: 'ÿ™ÿπÿØŸäŸÑ ÿßŸÑŸÖŸÑŸÅ', blockedAccounts: 'ÿßŸÑÿ≠ÿ≥ÿßÿ®ÿßÿ™ ÿßŸÑŸÖÿ≠ÿ∏Ÿàÿ±ÿ©',
                        savedPosts: 'ÿßŸÑŸÖŸÜÿ¥Ÿàÿ±ÿßÿ™ ÿßŸÑŸÖÿ≠ŸÅŸàÿ∏ÿ©', notificationsTitle: 'ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™',
                        pushNotifications: 'ÿ•ÿ¥ÿπÿßÿ±ÿßÿ™ ÿßŸÑÿØŸÅÿπ', emailNotifications: 'ÿ•ÿ¥ÿπÿßÿ±ÿßÿ™ ÿßŸÑÿ®ÿ±ŸäÿØ',
                        security: 'ÿßŸÑÿ£ŸÖÿßŸÜ', twoFactorAuth: 'ÿßŸÑÿ™ÿ≠ŸÇŸÇ ÿ®ÿÆÿ∑Ÿàÿ™ŸäŸÜ', about: 'ÿ≠ŸàŸÑ',
                        appVersion: 'ÿ•ÿµÿØÿßÿ± ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ', releaseNotes: 'ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™ ÿßŸÑÿ•ÿµÿØÿßÿ±',
                        termsOfService: 'ÿ¥ÿ±Ÿàÿ∑ ÿßŸÑÿßÿ≥ÿ™ÿÆÿØÿßŸÖ', privacyPolicy: 'ÿ≥Ÿäÿßÿ≥ÿ© ÿßŸÑÿÆÿµŸàÿµŸäÿ©',
                        verification: 'ÿßŸÑÿ™ÿ≠ŸÇŸÇ', getVerified: 'ÿßÿ≠ÿµŸÑ ÿπŸÑŸâ ÿ¥ÿßÿ±ÿ© ÿßŸÑÿ™ÿ≠ŸÇŸÇ', verified: 'ŸÖÿ≠ŸÇŸÇ',
                        session: 'ÿßŸÑÿ¨ŸÑÿ≥ÿ©', logout: 'ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨', deleteAccount: 'ÿ≠ÿ∞ŸÅ ÿßŸÑÿ≠ÿ≥ÿßÿ®',
                        info: 'ŸÖÿπŸÑŸàŸÖÿßÿ™', allRightsReserved: '2026 ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÇ ŸÖÿ≠ŸÅŸàÿ∏ÿ©',
                        store: 'ÿßŸÑÿ≥ŸàŸÇ ÿßŸÑÿ≤ÿ±ÿßÿπŸä', addProduct: 'ÿ•ÿ∂ÿßŸÅÿ© ÿ•ÿπŸÑÿßŸÜ', noProducts: 'ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÖŸÜÿ™ÿ¨ÿßÿ™',
                        sendMessage: 'ÿ•ÿ±ÿ≥ÿßŸÑ ÿ±ÿ≥ÿßŸÑÿ©', productDetail: 'ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑŸÖŸÜÿ™ÿ¨',
                        noMessages: 'ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ±ÿ≥ÿßÿ¶ŸÑ', startConversation: 'ÿßÿ®ÿØÿ£ ŸÖÿ≠ÿßÿØÿ´ÿ©', searchChats: 'ÿßŸÑÿ®ÿ≠ÿ´ ŸÅŸä ÿßŸÑŸÖÿ≠ÿßÿØÿ´ÿßÿ™...',
                        typeMessage: 'ÿßŸÉÿ™ÿ® ÿ±ÿ≥ÿßŸÑÿ©...', newPost: 'ŸÖŸÜÿ¥Ÿàÿ± ÿ¨ÿØŸäÿØ', whatsOnYourMind: 'ŸÖÿßÿ∞ÿß ŸäÿØŸàÿ± ŸÅŸä ÿ∞ŸáŸÜŸÉÿü',
                        post: 'ŸÖŸÜÿ¥Ÿàÿ±', poll: 'ÿßÿ≥ÿ™ÿ∑ŸÑÿßÿπ', addLocation: 'ÿ•ÿ∂ÿßŸÅÿ© ŸÖŸàŸÇÿπ', postShared: 'ÿ™ŸÖ ŸÜÿ¥ÿ± ÿßŸÑŸÖŸÜÿ¥Ÿàÿ±!',
                        online: 'ŸÖÿ™ÿµŸÑ', joined: 'ÿßŸÜÿ∂ŸÖ', noBioYet: 'ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ≥Ÿäÿ±ÿ© ÿ∞ÿßÿ™Ÿäÿ© üå±', media: 'Ÿàÿ≥ÿßÿ¶ÿ∑', liked: 'ŸÖÿπÿ¨ÿ®',
                        login: 'ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ', register: 'ÿ•ŸÜÿ¥ÿßÿ° ÿ≠ÿ≥ÿßÿ®', email: 'ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä',
                        password: 'ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±', confirmPassword: 'ÿ™ÿ£ŸÉŸäÿØ ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±', name: 'ÿßŸÑÿßÿ≥ŸÖ ÿßŸÑŸÉÿßŸÖŸÑ', username: 'ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ',
                        loading: 'ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...', noPostsYet: 'ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÖŸÜÿ¥Ÿàÿ±ÿßÿ™', copied: 'ÿ™ŸÖ ÿßŸÑŸÜÿ≥ÿÆ', linkCopied: 'ÿ™ŸÖ ŸÜÿ≥ÿÆ ÿßŸÑÿ±ÿßÿ®ÿ∑',
                        trend: 'ÿßŸÑÿ£ŸÉÿ´ÿ± ÿ±Ÿàÿßÿ¨ÿßŸã', mostLiked: 'ÿßŸÑÿ£ŸÉÿ´ÿ± ÿ•ÿπÿ¨ÿßÿ®ÿßŸã', mostCommented: 'ÿßŸÑÿ£ŸÉÿ´ÿ± ÿ™ÿπŸÑŸäŸÇÿßŸã'
                    },
                    ru: {
                        home: '–ì–ª–∞–≤–Ω–∞—è', explore: '–û–±–∑–æ—Ä', messages: '–°–æ–æ–±—â–µ–Ω–∏—è',
                        notifications: '–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è', profile: '–ü—Ä–æ—Ñ–∏–ª—å', settings: '–ù–∞—Å—Ç—Ä–æ–π–∫–∏',
                        search: '–ü–æ–∏—Å–∫', cancel: '–û—Ç–º–µ–Ω–∞', save: '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å', delete: '–£–¥–∞–ª–∏—Ç—å',
                        edit: '–ò–∑–º–µ–Ω–∏—Ç—å', share: '–ü–æ–¥–µ–ª–∏—Ç—å—Å—è', follow: '–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è', following: '–ü–æ–¥–ø–∏—Å–∞–Ω',
                        followers: '–ü–æ–¥–ø–∏—Å—á–∏–∫–∏', posts: '–ü—É–±–ª–∏–∫–∞—Ü–∏–∏', likes: '–õ–∞–π–∫–∏', comments: '–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏',
                        appearance: '–í–Ω–µ—à–Ω–∏–π –≤–∏–¥', darkMode: '–¢—ë–º–Ω–∞—è —Ç–µ–º–∞', lightMode: '–°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞',
                        language: '–Ø–∑—ã–∫', selectLanguage: '–í—ã–±–æ—Ä —è–∑—ã–∫–∞', account: '–ê–∫–∫–∞—É–Ω—Ç',
                        changePassword: '–ò–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å', editProfile: '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å', blockedAccounts: '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ',
                        savedPosts: '–°–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ', notificationsTitle: '–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è',
                        pushNotifications: 'Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è', emailNotifications: 'Email-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è',
                        security: '–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å', twoFactorAuth: '2FA –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è', about: '–û –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏',
                        appVersion: '–í–µ—Ä—Å–∏—è', releaseNotes: '–ó–∞–º–µ—Ç–∫–∏', termsOfService: '–£—Å–ª–æ–≤–∏—è', privacyPolicy: '–ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å',
                        verification: '–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è', getVerified: '–ü–æ–ª—É—á–∏—Ç—å –∑–Ω–∞—á–æ–∫', verified: '–í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω',
                        session: '–°–µ—Å—Å–∏—è', logout: '–í—ã–π—Ç–∏', deleteAccount: '–£–¥–∞–ª–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç',
                        info: '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è', allRightsReserved: '2026 –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã',
                        store: '–ê–≥—Ä–æ—Ä—ã–Ω–æ–∫', addProduct: '–î–æ–±–∞–≤–∏—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ', noProducts: '–ù–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤',
                        sendMessage: '–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ', productDetail: '–î–µ—Ç–∞–ª–∏',
                        noMessages: '–ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π', startConversation: '–ù–∞—á–∞—Ç—å –±–µ—Å–µ–¥—É', searchChats: '–ü–æ–∏—Å–∫...',
                        typeMessage: '–ù–∞–ø–∏—Å–∞—Ç—å...', newPost: '–ù–æ–≤–∞—è –ø—É–±–ª–∏–∫–∞—Ü–∏—è', whatsOnYourMind: '–û —á—ë–º –¥—É–º–∞–µ—Ç–µ?',
                        post: '–ü—É–±–ª–∏–∫–∞—Ü–∏—è', poll: '–û–ø—Ä–æ—Å', addLocation: '–î–æ–±–∞–≤–∏—Ç—å –º–µ—Å—Ç–æ', postShared: '–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ!',
                        online: '–û–Ω–ª–∞–π–Ω', joined: '–í—Å—Ç—É–ø–∏–ª', noBioYet: '–ë–∏–æ–≥—Ä–∞—Ñ–∏—è –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω–∞ üå±', media: '–ú–µ–¥–∏–∞', liked: '–ü–æ–Ω—Ä–∞–≤–∏–ª–æ—Å—å',
                        login: '–í–æ–π—Ç–∏', register: '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è', email: 'Email',
                        password: '–ü–∞—Ä–æ–ª—å', confirmPassword: '–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –ø–∞—Ä–æ–ª—å', name: '–ò–º—è', username: '–õ–æ–≥–∏–Ω',
                        loading: '–ó–∞–≥—Ä—É–∑–∫–∞...', noPostsYet: '–ù–µ—Ç –ø—É–±–ª–∏–∫–∞—Ü–∏–π', copied: '–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ', linkCopied: '–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞',
                        trend: '–í —Ç—Ä–µ–Ω–¥–µ', mostLiked: '–ë–æ–ª—å—à–µ –ª–∞–π–∫–æ–≤', mostCommented: '–ë–æ–ª—å—à–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤'
                    },
                    zh: {
                        home: 'È¶ñÈ°µ', explore: 'Êé¢Á¥¢', messages: 'Ê∂àÊÅØ',
                        notifications: 'ÈÄöÁü•', profile: '‰∏™‰∫∫ËµÑÊñô', settings: 'ËÆæÁΩÆ',
                        search: 'ÊêúÁ¥¢', cancel: 'ÂèñÊ∂à', save: '‰øùÂ≠ò', delete: 'Âà†Èô§',
                        edit: 'ÁºñËæë', share: 'ÂàÜ‰∫´', follow: 'ÂÖ≥Ê≥®', following: 'Â∑≤ÂÖ≥Ê≥®',
                        followers: 'Á≤â‰∏ù', posts: 'Â∏ñÂ≠ê', likes: 'ÁÇπËµû', comments: 'ËØÑËÆ∫',
                        appearance: 'Â§ñËßÇ', darkMode: 'Ê∑±Ëâ≤Ê®°Âºè', lightMode: 'ÊµÖËâ≤Ê®°Âºè',
                        language: 'ËØ≠Ë®Ä', selectLanguage: 'ÈÄâÊã©ËØ≠Ë®Ä', account: 'Ë¥¶Âè∑',
                        changePassword: '‰øÆÊîπÂØÜÁ†Å', editProfile: 'ÁºñËæëËµÑÊñô', blockedAccounts: 'ÈªëÂêçÂçï',
                        savedPosts: 'Â∑≤‰øùÂ≠ò', notificationsTitle: 'ÈÄöÁü•',
                        pushNotifications: 'Êé®ÈÄÅÈÄöÁü•', emailNotifications: 'ÈÇÆ‰ª∂ÈÄöÁü•',
                        security: 'ÂÆâÂÖ®', twoFactorAuth: 'ÂèåÂõ†Á¥†È™åËØÅ', about: 'ÂÖ≥‰∫é',
                        appVersion: 'ÁâàÊú¨', releaseNotes: 'ÂèëË°åËØ¥Êòé', termsOfService: 'ÊúçÂä°Êù°Ê¨æ', privacyPolicy: 'ÈöêÁßÅÊîøÁ≠ñ',
                        verification: 'ËÆ§ËØÅ', getVerified: 'Ëé∑ÂèñËÆ§ËØÅÂæΩÁ´†', verified: 'Â∑≤ËÆ§ËØÅ',
                        session: '‰ºöËØù', logout: 'ÈÄÄÂá∫ÁôªÂΩï', deleteAccount: 'Âà†Èô§Ë¥¶Âè∑',
                        info: '‰ø°ÊÅØ', allRightsReserved: '2026 ÁâàÊùÉÊâÄÊúâ',
                        store: 'ÂÜú‰∏öÂ∏ÇÂú∫', addProduct: 'ÂèëÂ∏ÉÂπøÂëä', noProducts: 'ÊöÇÊó†‰∫ßÂìÅ',
                        sendMessage: 'ÂèëÈÄÅÊ∂àÊÅØ', productDetail: '‰∫ßÂìÅËØ¶ÊÉÖ',
                        noMessages: 'ÊöÇÊó†Ê∂àÊÅØ', startConversation: 'ÂºÄÂßãÂØπËØù', searchChats: 'ÊêúÁ¥¢ËÅäÂ§©...',
                        typeMessage: 'ËæìÂÖ•Ê∂àÊÅØ...', newPost: 'Êñ∞Â∏ñÂ≠ê', whatsOnYourMind: '‰Ω†Âú®ÊÉ≥‰ªÄ‰πàÔºü',
                        post: 'Â∏ñÂ≠ê', poll: 'ÊäïÁ•®', addLocation: 'Ê∑ªÂä†‰ΩçÁΩÆ', postShared: 'Â∑≤ÂèëÂ∏ÉÔºÅ',
                        online: 'Âú®Á∫ø', joined: 'Âä†ÂÖ•', noBioYet: 'ÊöÇÊó†ÁÆÄ‰ªã üå±', media: 'Â™í‰Ωì', liked: 'Â∑≤Ëµû',
                        login: 'ÁôªÂΩï', register: 'Ê≥®ÂÜå', email: 'ÈÇÆÁÆ±',
                        password: 'ÂØÜÁ†Å', confirmPassword: 'Á°ÆËÆ§ÂØÜÁ†Å', name: 'ÂßìÂêç', username: 'Áî®Êà∑Âêç',
                        loading: 'Âä†ËΩΩ‰∏≠...', noPostsYet: 'ÊöÇÊó†Â∏ñÂ≠ê', copied: 'Â∑≤Â§çÂà∂', linkCopied: 'ÈìæÊé•Â∑≤Â§çÂà∂',
                        trend: 'Ë∂ãÂäø', mostLiked: 'ÊúÄÂ§öÁÇπËµû', mostCommented: 'ÊúÄÂ§öËØÑËÆ∫'
                    }
                },
                
                // ========== ONBOARDING Sƒ∞STEMƒ∞ ==========
                showOnboarding: false,
                onboardingStep: 0,
                onboardingSteps: [
                    {
                        target: '[data-onboarding="home"]',
                        icon: 'fa-home',
                        title: 'Ana Sayfa',
                        text: 'Buradan arkada≈ülarƒ±nƒ±zƒ±n payla≈üƒ±mlarƒ±nƒ± g√∂rebilir, beƒüenebilir ve yorum yapabilirsiniz.',
                        position: 'top'
                    },
                    {
                        target: '[data-onboarding="create-post"]',
                        icon: 'fa-plus',
                        title: 'G√∂nderi Olu≈ütur',
                        text: 'Fotoƒüraf, video veya yazƒ± payla≈ümak i√ßin bu butona tƒ±klayƒ±n. Anket ve konum da ekleyebilirsiniz!',
                        position: 'top'
                    },
                    {
                        target: '[data-onboarding="messages"]',
                        icon: 'fa-comment',
                        title: 'Mesajlar',
                        text: 'Diƒüer √ßift√ßilerle √∂zel mesajla≈üabilir, sesli mesaj g√∂nderebilirsiniz.',
                        position: 'top'
                    },
                    {
                        target: '[data-onboarding="notifications"]',
                        icon: 'fa-bell',
                        title: 'Bildirimler',
                        text: 'Beƒüeniler, yorumlar ve yeni takip√ßi bildirimleri burada g√∂r√ºn√ºr.',
                        position: 'top'
                    },
                    {
                        target: '[data-onboarding="profile"]',
                        icon: 'fa-user',
                        title: 'Profiliniz',
                        text: 'Profilinizi d√ºzenleyebilir, payla≈üƒ±mlarƒ±nƒ±zƒ± g√∂r√ºnt√ºleyebilirsiniz.',
                        position: 'top'
                    },
                    {
                        target: '[data-onboarding="search"]',
                        icon: 'fa-search',
                        title: 'Arama',
                        text: 'Kullanƒ±cƒ±, g√∂nderi veya hashtag aramak i√ßin bu alanƒ± kullanƒ±n.',
                        position: 'bottom'
                    }
                ],
                
                // Navigation
                activeTab: 'home',
                loading: false,
                
                // Payla≈üƒ±m Sayfalarƒ±
                showSharedPostPage: false,
                sharedPost: null,
                sharedPostComments: [],
                showSharedProfilePage: false,
                sharedProfile: null,
                sharedProfilePosts: [],
                loadingMore: false,
                
                // Toast
                toast: { show: false, message: '' },
                
                // Feed
                feed: [],
                currentPage: 1,
                hasMore: true,
                
                // Stories
                stories: [],
                myStories: [],
                showStoryModal: false,
                showStoryViewer: false,
                activeStory: {},
                storyForm: { media: null, preview: '', text: '', mediaType: null, textColor: '#FFFFFF' },
                
                // Search
                searchQuery: '',
                searchResults: [],
                hashtagResults: [],
                showSearchResults: false,
                
                // Products
                products: [],
                showAddProduct: false,
                showProductDetail: false,
                selectedProduct: null,
                selectedProductImages: [],
                currentProductImageIndex: 0,
                productForm: { name: '', price: '', description: '', image: null, preview: '', images: [], category: '', stock: 1 },
                
                // Messages
                conversations: [],
                get totalUnreadMessages() { return this.conversations.reduce((sum, c) => sum + (c.unreadCount || 0), 0); },
                showChatModal: false,
                activeChat: {},
                chatMessages: [],
                messageInput: '',
                isRecording: false,
                
                // Channels (DM Kanallarƒ±)
                channels: [],
                showCreateChannelModal: false,
                channelForm: { name: '', selectedUsers: [], searchQuery: '', searchResults: [], profilePicFile: null, profilePicPreview: null },
                activeChannel: null,
                channelMessages: [],
                showChannelChat: false,
                channelMessageInput: '',
                showChannelMembersModal: false,
                channelMembersList: [],
                showChannelMsgMenu: false,
                selectedChannelMsg: null,
                editingChannelMsg: null,
                
                // Kim G√∂rm√º≈ü
                showSeenByModal: false,
                seenByUsers: [],
                longPressTimer: null,
                
                // Notifications
                notifications: [],
                unreadNotifs: 0,
                
                // Posts
                showPostModal: false,
                postForm: { content: '', media: null, preview: '', mediaType: null, type: 'normal', pollQuestion: '', pollOptions: ['', ''], showLocation: false, locationName: '', commentsDisabled: false, mediaFiles: [], previews: [] },
                uploadProgress: 0,
                fileProgresses: [], // Her dosya i√ßin ayrƒ± ilerleme [{ name, progress, done }]
                isUploading: false,
                
                // Comments
                showCommentModal: false,
                activeComments: [],
                activePostId: null,
                commentInput: '',
                
                // Profile
                userStats: {},
                myPosts: [],
                myPostsPage: 1,
                myPostsHasMore: true,
                myPostsLoading: false,
                likedPosts: [],
                showEditModal: false,
                editForm: { name: '', email: '', userType: '', bio: '', location: '', website: '', profilePic: '', profilePicFile: null, coverPicFile: null, coverPicPreview: '' },
                showSettings: false,
                
                // Settings
                showSettingsMenu: false,
                showDeleteAccount: false,
                deleteAccountPassword: '',
                deleteConfirmText: '',
                deleteDataConsent: false,
                showChangePassword: false,
                passwordForm: { currentPassword: '', newPassword: '', confirmPassword: '' },
                showReleaseNotes: false,
                showVerificationModal: false,
                verificationForm: { name: '', surname: '', frontImage: null, frontPreview: '', backImage: null, backPreview: '' },
                verificationStatus: 'none', // none, pending, approved
                
                // Privacy & Notification Settings
                showPrivacySettings: false,
                showNotificationSettings: false,
                privacySettings: {
                    privateAccount: false,
                    showActivity: true,
                    allowMessagesFrom: 'everyone', // everyone, following, none
                    allowTagsFrom: 'everyone',
                },
                notificationSettings: {
                    likes: true,
                    replies: true,
                    mentions: true,
                    quotes: true,
                    reposts: true,
                    newFollower: true,
                    followRequest: true,
                    messages: true,
                    fromNonFollowing: true,
                    fromNonFollowers: false,
                },
                
                // Blocked Accounts & Saved Posts
                showBlockedAccounts: false,
                blockedAccountsList: [],
                showSavedPosts: false,
                savedPostsList: [],
                
                // Story Navigation
                currentStoryIndex: 0,
                currentStoryGroup: null,
                
                // Post Edit Modal
                showPostEditModal: false,
                postEditForm: { brightness: 100, contrast: 100, saturation: 100, filter: 'none' },
                
                // Message Image
                messageImagePreview: null,
                messageImageFile: null,
                
                // Voice Recording
                isRecording: false,
                mediaRecorder: null,
                recordedChunks: [],
                voicePreview: null,
                voiceDuration: 0,
                recordingTimer: null,
                
                // TikTok Scroll
                showTikTokScroll: false,
                tikTokPosts: [],
                currentTikTokIndex: 0,
                globalTikTokMuted: true, // Kullanƒ±cƒ± sesi a√ßƒ±nca t√ºm videolar i√ßin ge√ßerli
                // ========== AI CHAT STATE ==========
                showAIChat: false,
                globalMuted: true,
                showShareMenuModal: false,
                shareMenuPost: null,
                showStorySharePreview: false,
                storySharePost: null,
                aiOnline: false,
                aiTyping: false,
                aiInput: '',
                // AgroBot v6 yeni state
                abDarkMode: true,
                abSpeakingIdx: -1,
                abVoiceRecording: false,
                abVoiceRecognition: null,
                agroLiveMode: false,
                agroLiveActive: false,
                agroLiveMuted: false,
                agroLiveStatus: 'Dinliyorum...',
                agroLiveTranscript: '',
                agroLiveRecognition: null,
                agroLiveWaveInterval: null,
                aiMessages: [
                    { role: 'assistant', content: 'Merhaba! Ben AgroBot. Tarƒ±m hakkƒ±nda soru sorabilirsiniz üå±' }
                ],
                
                // Heart Animation
                showHeartAnimation: false,
                
                // Story Viewers
                showStoryViewers: false,
                storyViewersList: [],
                
                // Connections
                showConnectionsModal: false,
                connectionsType: 'followers',
                connectionsList: [],
                connectionsTargetUserId: null,
                connectionsUserId: null,
                connectionsPage: 1,
                connectionsHasMore: false,
                connectionsLoading: false,
                connectionsPage: 1,
                connectionsHasMore: true,
                connectionsLoading: false,
                connectionsUserId: null,
                
                // User Profile
                showUserProfile: false,
                viewedUser: {},
                viewedUserPosts: [],
                viewedUserPostsPage: 1,
                viewedUserPostsHasMore: true,
                viewedUserPostsLoading: false,
                mutualFollowers: [],
                showMutualFollowersModal: false,
                
                // Cover Zoom
                showCoverZoom: false,
                coverZoomUrl: '',
                zoomLevel: 1,
                touchZoomDistance: 0,
                
                // Post Options
                showPostOptions: false,
                selectedPost: null,
                
                // Report Modal
                showReportModal: false,
                reportReason: '',
                reportDescription: '',
                
                // Full Screen
                showFullScreen: false,
                fullScreenMedia: { url: '', type: '' },
                
                // Profile Pic Popup
                showProfilePicPopup: false,
                profilePicPopupData: { profilePic: '', userId: null, hasStory: false, storyData: null, isOwnProfile: false },
                
                // Post Detail
                showPostDetail: false,
                postDetail: null,
                
                // Touch
                touchStartY: 0,
                
                // Explore / Ke≈üfet
                showExplore: false,
                explorePosts: [],
                exploreAllPosts: [],
                exploreCategory: 'all',
                exploreLoading: false,
                exploreSearchQuery: '',
                popularHashtags: [],
                
                // Multi Account
                savedAccounts: JSON.parse(localStorage.getItem('agrolink_saved_accounts') || '[]'),
                showAddAccountModal: false,
                addAccountForm: { username: '', password: '' },
                addAccountLoading: false,
                addAccountError: '',
                
                // Socket
                socket: null,
                
                // ========== 2FA (2 FAKT√ñRL√ú DOƒûRULAMA) ==========
                show2FAModal: false,
                twoFAData: { tempToken: '', email: '', userId: '' },
                twoFAInput: ['', '', '', '', '', ''],
                twoFAError: '',
                twoFAResendTimer: 0,
                twoFATimer: 300, // 5 dakika = 300 saniye
                twoFATimerInterval: null,
                
                // ‚úÖ HATA D√úZELTMESƒ∞: ≈ûifre sƒ±fƒ±rlama e-posta linki state'i
                pendingResetToken: '',
                pendingResetEmail: '',
                resetDirectForm: { newPassword: '', confirmPassword: '' },
                
                // ========== E-POSTA DOƒûRULAMA ==========
                showEmailVerifyModal: false,
                emailVerifyData: { email: '' },
                emailVerifyInput: ['', '', '', '', '', ''],
                emailVerifyError: '',
                emailResendTimer: 0,
                emailVerifyTimer: 300, // 5 dakika = 300 saniye
                emailVerifyTimerInterval: null,
                pendingRegistrationData: null,

                // ========== üìó FARMBOOK - √áƒ∞FT√áƒ∞ KAYIT DEFTERƒ∞ ==========
                showFarmbook: false,
                farmbookTab: 'records', // 'records', 'add', 'stats', 'export'
                farmbookRecords: [],
                farmbookStats: null,
                farmbookLoading: false,
                farmbookFilters: {
                    season: '',
                    year: new Date().getFullYear(),
                    type: ''
                },
                farmbookForm: {
                    recordType: 'ekim',
                    productName: '',
                    quantity: '',
                    unit: 'kg',
                    cost: '',
                    income: '',
                    recordDate: new Date().toISOString().split('T')[0],
                    fieldName: '',
                    fieldSize: '',
                    fieldSizeUnit: 'dekar',
                    season: '',
                    year: new Date().getFullYear(),
                    notes: '',
                    harvestAmount: '',
                    harvestUnit: 'kg',
                    qualityRating: 3,
                    weatherCondition: ''
                },
                farmbookFields: [],
                farmbookEditMode: false,
                farmbookEditId: null,
                farmbookRecordTypes: [
                    { value: 'ekim', label: 'Ekim', icon: 'fa-seedling', color: 'bg-green-500' },
                    { value: 'gubre', label: 'G√ºbre', icon: 'fa-leaf', color: 'bg-amber-500' },
                    { value: 'ilac', label: 'ƒ∞la√ß/Zirai M√ºcadele', icon: 'fa-spray-can', color: 'bg-red-500' },
                    { value: 'sulama', label: 'Sulama', icon: 'fa-tint', color: 'bg-blue-500' },
                    { value: 'hasat', label: 'Hasat', icon: 'fa-wheat-alt', color: 'bg-yellow-500' },
                    { value: 'gider', label: 'Gider', icon: 'fa-money-bill-wave', color: 'bg-rose-500' },
                    { value: 'gelir', label: 'Gelir', icon: 'fa-coins', color: 'bg-emerald-500' },
                    { value: 'notlar', label: 'Notlar', icon: 'fa-sticky-note', color: 'bg-purple-500' }
                ],
                farmbookSeasons: [
                    { value: 'ilkbahar', label: 'ƒ∞lkbahar' },
                    { value: 'yaz', label: 'Yaz' },
                    { value: 'sonbahar', label: 'Sonbahar' },
                    { value: 'kis', label: 'Kƒ±≈ü' }
                ],
                farmbookUnits: ['kg', 'ton', 'litre', 'adet', '√ßuval', 'kasa', 'dekar', 'hektar'],
                farmbookWeatherOptions: [
                    { value: 'gunesli', label: 'G√ºne≈üli', icon: 'fa-sun' },
                    { value: 'bulutlu', label: 'Bulutlu', icon: 'fa-cloud' },
                    { value: 'yagmurlu', label: 'Yaƒümurlu', icon: 'fa-cloud-rain' },
                    { value: 'karli', label: 'Karlƒ±', icon: 'fa-snowflake' },
                    { value: 'ruzgarli', label: 'R√ºzgarlƒ±', icon: 'fa-wind' }
                ],

                // ========== üõ∞Ô∏è UYDU TARLAM (NDVI) ==========
                showSatellite: false,
                satelliteTab: 'dashboard', // 'dashboard', 'fields', 'add', 'analysis'
                satelliteFields: [],
                satelliteDashboard: null,
                satelliteLoading: false,
                satelliteAnalyzing: false,
                selectedField: null,
                selectedAnalysis: null,
                fieldAnalyses: [],
                satelliteForm: {
                    name: '',
                    description: '',
                    cropType: '',
                    plantingDate: '',
                    city: '',
                    district: '',
                    color: '#00b894',
                    polygon: []
                },
                satelliteEditMode: false,
                satelliteEditId: null,
                satelliteCropTypes: [
                    { value: 'bugday', label: 'Buƒüday', icon: 'fa-wheat-alt' },
                    { value: 'arpa', label: 'Arpa', icon: 'fa-seedling' },
                    { value: 'misir', label: 'Mƒ±sƒ±r', icon: 'fa-corn' },
                    { value: 'aycicegi', label: 'Ay√ßi√ßeƒüi', icon: 'fa-sun' },
                    { value: 'pamuk', label: 'Pamuk', icon: 'fa-cloud' },
                    { value: 'seker_pancari', label: '≈ûeker Pancarƒ±', icon: 'fa-leaf' },
                    { value: 'sebze', label: 'Sebze', icon: 'fa-carrot' },
                    { value: 'meyve', label: 'Meyve', icon: 'fa-apple-alt' },
                    { value: 'uzum', label: 'Baƒü/√úz√ºm', icon: 'fa-wine-glass' },
                    { value: 'zeytin', label: 'Zeytin', icon: 'fa-tree' },
                    { value: 'diger', label: 'Diƒüer', icon: 'fa-leaf' }
                ],
                satelliteColors: ['#00b894', '#0984e3', '#6c5ce7', '#e17055', '#fdcb6e', '#00cec9', '#d63031', '#74b9ff'],

                // ============ INIT ============
                // ‚úÖ HATA D√úZELTMESƒ∞: async init ‚Äî getAsync ile token ger√ßekten okunuyor
                async init() {
                    // SecureStorage migration - eski verileri g√ºvenli storage'a ta≈üƒ±
                    this.SecureStorage.migrateFromLegacy();
                    
                    // ‚úÖ getAsync: localStorage'daki ≈üifreli token √ß√∂z√ºlene kadar bekler
                    // Senkron get() sayfa a√ßƒ±lƒ±≈üƒ±nda her zaman null d√∂nd√ºr√ºyordu!
                    const secureToken = await this.SecureStorage.getAsync('token');
                    const secureUser  = await this.SecureStorage.getAsync('user');
                    
                    this.isLoggedIn = !!secureToken;
                    this.user = secureUser || {};
                    
                    this.generateCaptcha();
                    
                    // URL'den post ID kontrol√º
                    this.checkUrlForPost();
                    
                    // Telefon geri tu≈üu desteƒüi - Her sayfa i√ßin
                    this.setupBackButtonHandler();
                    
                    if (this.isLoggedIn) {
                        this.setupAxios();
                        
                        // ‚úÖ AI saƒülƒ±k kontrol√º
                        setTimeout(() => this.checkAIOnline(), 2000);
                        
                        // ‚úÖ D√úZELTME: Service Worker'ƒ± √∂nce kayƒ±t et, SONRA push iste
                        this.registerServiceWorker().then(() => {
                            this.checkPushNotificationStatus();
                            this.requestPushNotifications();
                        });                        
                        const loadingTimeout = setTimeout(() => { this.hideLoadingOverlay(); }, 3000);
                        
                        this.loadInitialData()
                            .catch(err => {
                                console.warn('[AgroLink] Veri y√ºkleme hatasƒ±:', err);
                            })
                            .finally(() => {
                                clearTimeout(loadingTimeout);
                                // Y√ºkleme ekranƒ±nƒ± kapat
                                this.hideLoadingOverlay();
                                
                                // ƒ∞lk kez giri≈ü yapan kullanƒ±cƒ±ya onboarding g√∂ster
                                this.$nextTick(() => {
                                    this.checkAndShowOnboarding();
                                });
                            });
                        this.setupSocket();
                        this.initEditForm();
                    } else {
                        // Giri≈ü yapƒ±lmamƒ±≈üsa y√ºkleme ekranƒ±nƒ± hemen kapat
                        this.hideLoadingOverlay();
                    }
                    this.$watch('darkMode', val => localStorage.setItem('theme', val ? 'dark' : 'light'));
                    
                    // Alt navigasyon scroll ile gizle/g√∂ster
                    this.setupNavbarScroll();
                },
                
                // Alt navigasyon scroll handler
                setupNavbarScroll() {
                    let lastScrollY = 0;
                    let ticking = false;
                    let navVisible = true;
                    
                    const handleScroll = () => {
                        if (ticking) return;
                        ticking = true;
                        
                        requestAnimationFrame(() => {
                            const nav = document.getElementById('bottomNav');
                            if (!nav) { ticking = false; return; }
                            
                            const currentScrollY = window.scrollY || document.documentElement.scrollTop;
                            const delta = currentScrollY - lastScrollY;
                            
                            const aiBtn = document.getElementById('aiBotFloatBtn');
                            
                            if (delta > 8 && currentScrollY > 80 && navVisible) {
                                // A≈üaƒüƒ± kaydƒ±rma ‚Äî hƒ±zlƒ±ca kaybol
                                navVisible = false;
                                nav.style.transition = 'transform 0.3s cubic-bezier(0.4,0,1,1), opacity 0.25s ease';
                                nav.style.transform = 'translateY(calc(100% + 20px))';
                                nav.style.opacity = '0';
                                if (aiBtn) { aiBtn.style.transition = 'transform 0.3s ease, opacity 0.25s ease'; aiBtn.style.transform = 'translateY(80px)'; aiBtn.style.opacity = '0'; }
                            } else if (delta < -4 && !navVisible) {
                                // Yukarƒ± kaydƒ±rma ‚Äî yay gibi geri gel (spring bounce)
                                navVisible = true;
                                nav.style.transition = 'transform 0.6s cubic-bezier(0.34, 1.6, 0.64, 1), opacity 0.3s ease';
                                nav.style.transform = 'translateY(0)';
                                nav.style.opacity = '1';
                                if (aiBtn) { aiBtn.style.transition = 'transform 0.6s cubic-bezier(0.34,1.6,0.64,1), opacity 0.3s ease'; aiBtn.style.transform = 'translateY(0)'; aiBtn.style.opacity = '1'; }
                            }
                            
                            // En √ºstteyse hep g√∂ster
                            if (currentScrollY < 10) {
                                navVisible = true;
                                nav.style.transition = 'transform 0.5s cubic-bezier(0.34,1.56,0.64,1), opacity 0.3s ease';
                                nav.style.transform = 'translateY(0)';
                                nav.style.opacity = '1';
                            }
                            
                            lastScrollY = currentScrollY;
                            ticking = false;
                        });
                    };
                    
                    window.addEventListener('scroll', handleScroll, { passive: true });
                },
                
                // Y√ºkleme ekranƒ±nƒ± kapat
                hideLoadingOverlay() {
                    const overlay = document.getElementById('pageLoadingOverlay');
                    if (overlay && !overlay._isClosing) {
                        overlay._isClosing = true;
                        overlay.classList.add('hidden');
                        setTimeout(() => { if(overlay.parentNode) overlay.remove(); }, 320);
                    }
                },
                
                // ========== Dƒ∞L FONKSƒ∞YONLARI ==========
                t(key) {
                    const lang = this.translations[this.currentLanguage] || this.translations['tr'];
                    return lang[key] || this.translations['tr'][key] || key;
                },
                
                setLanguage(langCode) {
                    this.currentLanguage = langCode;
                    localStorage.setItem('agrolink_lang', langCode);
                    this.showLanguageModal = false;
                    this.showToast(this.getLanguageName(langCode) + ' ' + (langCode === 'tr' ? 'se√ßildi' : 'selected'));
                },
                
                getLanguageName(code) {
                    const lang = this.availableLanguages.find(l => l.code === code);
                    return lang ? lang.name : 'T√ºrk√ße';
                },

                async loadTopAccountsForOnboarding() {
                    try {
                        const res = await axios.get('/api/users/top-followed?limit=10');
                        this.interestTopAccounts = (res.data.users || res.data || []).map(u => ({...u, followed: false}));
                    } catch(e) {
                        // Demo accounts fallback
                        this.interestTopAccounts = [
                            {id:'demo1', name:'Agrolink Resmi', username:'agrolink', profilePic:'agro.png', followersCount:12400, followed:false},
                            {id:'demo2', name:'Tarƒ±m Uzmanƒ±', username:'tarim_uzman', profilePic:'', followersCount:8900, followed:false},
                            {id:'demo3', name:'√áift√ßi Ahmet', username:'ciftci_ahmet', profilePic:'', followersCount:5600, followed:false},
                            {id:'demo4', name:'Organik Bah√ße', username:'organik_bahce', profilePic:'', followersCount:4200, followed:false},
                            {id:'demo5', name:'Seracƒ±lƒ±k Pro', username:'seracilik', profilePic:'', followersCount:3800, followed:false},
                        ];
                    }
                },

                async toggleOnboardingFollow(account) {
                    account.followed = !account.followed;
                    try {
                        if (account.followed) {
                            await axios.post('/api/users/follow/' + account.id);
                        } else {
                            await axios.delete('/api/users/follow/' + account.id);
                        }
                    } catch(e) { /* offline/demo */ }
                },

                async finishInterestsOnboarding() {
                    // Save interests to server
                    try {
                        if (this.selectedInterests.length > 0) {
                            await axios.post('/api/users/interests', { interests: this.selectedInterests });
                        }
                    } catch(e) { /* ignore */ }
                    this.showInterestsOnboarding = false;
                    this.showLangOnboarding = true;
                },

                finishLangOnboarding() {
                    this.showLangOnboarding = false;
                    location.reload();
                },

                toggleInterest(interest) {
                    const idx = this.selectedInterests.indexOf(interest);
                    if (idx === -1) {
                        this.selectedInterests.push(interest);
                    } else {
                        this.selectedInterests.splice(idx, 1);
                    }
                },

                handleExploreSwipe(e) {
                    const dx = e.changedTouches[0].clientX - this.exploreTouchStartX;
                    const dy = e.changedTouches[0].clientY - this.exploreTouchStartY;
                    if (Math.abs(dx) < 60 || Math.abs(dy) > Math.abs(dx) * 1.2) return;
                    const cats = ['all', 'liked', 'commented', 'media', 'recent', 'hashtags'];
                    let idx = cats.indexOf(this.exploreCategory);
                    if (dx < 0) { // swipe left ‚Üí next
                        idx = (idx + 1) % cats.length;
                    } else { // swipe right ‚Üí prev
                        idx = (idx - 1 + cats.length) % cats.length;
                    }
                    this.exploreCategory = cats[idx];
                    if (cats[idx] === 'hashtags') {
                        this.loadPopularHashtags();
                    } else {
                        this.loadExplorePosts();
                    }
                },

                handleAppSwipe(e) { /* swipe devre dƒ±≈üƒ± */ },
                
                // ========== ONBOARDING FONKSƒ∞YONLARI ==========
                checkAndShowOnboarding() {
                    // Rehber tamamen kaldƒ±rƒ±ldƒ±
                    return;
                },
                
                startOnboarding() {
                    this.showOnboarding = true;
                    this.onboardingStep = 0;
                },
                
                nextOnboardingStep() {
                    if (this.onboardingStep < this.onboardingSteps.length - 1) {
                        this.onboardingStep++;
                    } else {
                        this.finishOnboarding();
                    }
                },
                
                prevOnboardingStep() {
                    if (this.onboardingStep > 0) {
                        this.onboardingStep--;
                    }
                },
                
                skipOnboarding() {
                    this.finishOnboarding();
                },
                
                finishOnboarding() {
                    this.showOnboarding = false;
                    localStorage.setItem('agrolink_onboarding_seen', 'true');
                    this.showToast('Harika! Artƒ±k AgroLink\'i ke≈üfetmeye hazƒ±rsƒ±nƒ±z! üåæ');
                },
                
                getOnboardingTargetRect() {
                    const step = this.onboardingSteps[this.onboardingStep];
                    if (!step) return { top: 0, left: 0, width: 0, height: 0 };
                    
                    const target = document.querySelector(step.target);
                    if (!target) return { top: 0, left: 0, width: 100, height: 100 };
                    
                    const rect = target.getBoundingClientRect();
                    return {
                        top: rect.top - 8,
                        left: rect.left - 8,
                        width: rect.width + 16,
                        height: rect.height + 16
                    };
                },
                
                getOnboardingTooltipStyle() {
                    const step = this.onboardingSteps[this.onboardingStep];
                    const rect = this.getOnboardingTargetRect();
                    
                    let style = {};
                    const tooltipWidth = 300;
                    const tooltipHeight = 250;
                    const padding = 20;
                    
                    if (step.position === 'top') {
                        style = {
                            bottom: (window.innerHeight - rect.top + padding) + 'px',
                            left: Math.max(padding, Math.min(rect.left + rect.width/2 - tooltipWidth/2, window.innerWidth - tooltipWidth - padding)) + 'px'
                        };
                    } else if (step.position === 'bottom') {
                        style = {
                            top: (rect.top + rect.height + padding) + 'px',
                            left: Math.max(padding, Math.min(rect.left + rect.width/2 - tooltipWidth/2, window.innerWidth - tooltipWidth - padding)) + 'px'
                        };
                    }
                    
                    return style;
                },
                
                getOnboardingArrowClass() {
                    const step = this.onboardingSteps[this.onboardingStep];
                    return step.position === 'top' ? 'arrow-bottom' : 'arrow-top';
                },
                
                // Telefon geri tu≈üu handler'ƒ± - T√ºm sayfalar i√ßin
                setupBackButtonHandler() {
                    // History API'yi kullanarak geri tu≈üu yakalama
                    window.history.pushState({ page: 'initial' }, '', window.location.href);
                    
                    window.addEventListener('popstate', (event) => {
                        // √ñnce modal'larƒ± kapat
                        if (this.showExplore) {
                            this.showExplore = false;
                            window.history.pushState({ page: 'home' }, '', window.location.href);
                            return;
                        }
                        if (this.showUserProfile) {
                            this.showUserProfile = false;
                            this.activeTab = 'home';
                            window.history.pushState({ page: 'home' }, '', window.location.href);
                            return;
                        }
                        if (this.showChatModal) {
                            this.showChatModal = false;
                            window.history.pushState({ page: 'messages' }, '', window.location.href);
                            return;
                        }
                        if (this.showStoryViewer) {
                            this.showStoryViewer = false;
                            this.activeStory = null;
                            window.history.pushState({ page: 'home' }, '', window.location.href);
                            return;
                        }
                        if (this.showTikTokScroll) {
                            this.closeTikTokScroll();
                            window.history.pushState({ page: 'home' }, '', window.location.href);
                            return;
                        }
                        if (this.showFullScreen) {
                            this.showFullScreen = false;
                            window.history.pushState({ page: 'home' }, '', window.location.href);
                            return;
                        }
                        if (this.showPostOptions) {
                            this.showPostOptions = false;
                            window.history.pushState({ page: 'home' }, '', window.location.href);
                            return;
                        }
                        if (this.showCommentModal) {
                            this.showCommentModal = false;
                            window.history.pushState({ page: 'home' }, '', window.location.href);
                            return;
                        }
                        if (this.showEditModal) {
                            this.showEditModal = false;
                            window.history.pushState({ page: 'profile' }, '', window.location.href);
                            return;
                        }
                        if (this.showSettingsModal) {
                            this.showSettingsModal = false;
                            window.history.pushState({ page: 'profile' }, '', window.location.href);
                            return;
                        }
                        if (this.showAddProduct) {
                            this.showAddProduct = false;
                            window.history.pushState({ page: 'store' }, '', window.location.href);
                            return;
                        }
                        if (this.showVerificationModal) {
                            this.showVerificationModal = false;
                            window.history.pushState({ page: 'profile' }, '', window.location.href);
                            return;
                        }
                        if (this.showStoryModal) {
                            this.showStoryModal = false;
                            window.history.pushState({ page: 'home' }, '', window.location.href);
                            return;
                        }
                        if (this.showPostModal) {
                            this.showPostModal = false;
                            window.history.pushState({ page: 'home' }, '', window.location.href);
                            return;
                        }
                        if (this.showBlockedAccounts) {
                            this.showBlockedAccounts = false;
                            window.history.pushState({ page: 'settings' }, '', window.location.href);
                            return;
                        }
                        if (this.showSavedPosts) {
                            this.showSavedPosts = false;
                            window.history.pushState({ page: 'settings' }, '', window.location.href);
                            return;
                        }
                        
                        // Sekmeler arasƒ±nda gezinme
                        if (this.activeTab !== 'home') {
                            this.activeTab = 'home';
                            window.history.pushState({ page: 'home' }, '', window.location.href);
                            return;
                        }
                    });
                },
                
                // URL'den post ID kontrol√º
                checkUrlForPost() {
                    const path = window.location.pathname;
                    const match = path.match(/\/post\/(.+)/);
                    if (match) {
                        const postId = match[1];
                        if (this.isLoggedIn) {
                            this.loadPostDetail(postId);
                        } else {
                            // Login gerekiyor, post ID'yi kaydet
                            this.pendingPostId = postId;
                        }
                    }

                    // ‚úÖ HATA D√úZELTMESƒ∞: ≈ûifre sƒ±fƒ±rlama e-postasƒ±ndaki link ?resetToken=... ile gelir
                    // UI bunu algƒ±layƒ±p ≈üifre sƒ±fƒ±rlama formunu a√ßmalƒ±
                    const params = new URLSearchParams(window.location.search);
                    const resetToken = params.get('resetToken');
                    const resetEmail = params.get('resetEmail');
                    if (resetToken) {
                        this.pendingResetToken = resetToken;
                        this.pendingResetEmail = resetEmail || '';
                        this.authMode = 'resetpassword';
                        // URL'i temizle (token g√ºvenliƒüi i√ßin)
                        window.history.replaceState({}, '', '/');
                    }
                },
                
                // Post detayƒ±nƒ± y√ºkle
                async loadPostDetail(postId) {
                    try {
                        this.loading = true;
                        const res = await axios.get(`/api/posts/${postId}`);
                        this.postDetail = res.data.post;
                        this.showPostDetail = true;
                        // URL'i temizle
                        window.history.replaceState({}, '', '/');
                    } catch (e) {
                        this.showToast('G√∂nderi bulunamadƒ±');
                    } finally {
                        this.loading = false;
                    }
                },
                
                // Push Notification ƒ∞zni ƒ∞ste
                async requestPushNotifications() {
                    if (!('Notification' in window)) {
                        console.log('Bu tarayƒ±cƒ± bildirimleri desteklemiyor');
                        return;
                    }
                    
                    if (Notification.permission === 'granted') {
                        this.registerServiceWorker();
                    } else if (Notification.permission !== 'denied') {
                        const permission = await Notification.requestPermission();
                        if (permission === 'granted') {
                            this.registerServiceWorker();
                            this.showToast('Bildirimler a√ßƒ±ldƒ±! üîî');
                        }
                    }
                },
                
                // üîî Push Notification Toggle - ‚úÖ D√úZELTME: SW √∂nce kayƒ±t edilir
                async togglePushNotifications() {
                    try {
                        if (!('Notification' in window) || !('serviceWorker' in navigator) || !('PushManager' in window)) {
                            this.showToast('‚ùå Tarayƒ±cƒ±nƒ±z push bildirimleri desteklemiyor', 'error');
                            return;
                        }
                        
                        if (!this.pushNotificationsEnabled) {
                            // 1. √ñnce Service Worker'ƒ± kaydet
                            const registration = await this.registerServiceWorker();
                            if (!registration) {
                                this.showToast('‚ùå Service Worker kaydedilemedi', 'error');
                                return;
                            }

                            // 2. Bildirim izni iste
                            const permission = await Notification.requestPermission();
                            if (permission !== 'granted') {
                                this.showToast('‚ùå Bildirim izni verilmedi. Tarayƒ±cƒ± ayarlarƒ±ndan izin verin.', 'error');
                                return;
                            }
                            
                            // 3. SW hazƒ±r olana kadar bekle
                            await navigator.serviceWorker.ready;
                            
                            // 4. VAPID key al
                            const vapidResponse = await axios.get('/api/push/vapid-public-key');
                            const vapidPublicKey = vapidResponse.data.publicKey;
                            if (!vapidPublicKey || vapidPublicKey === 'undefined') {
                                this.showToast('‚ùå Sunucu push bildirimi yapƒ±landƒ±rƒ±lmamƒ±≈ü', 'error');
                                return;
                            }
                            
                            // 5. Push subscription olu≈ütur
                            const applicationServerKey = this.urlBase64ToUint8Array(vapidPublicKey);
                            this.pushSubscription = await registration.pushManager.subscribe({
                                userVisibleOnly: true,
                                applicationServerKey: applicationServerKey
                            });
                            
                            // 6. Server'a kaydet
                            await axios.post('/api/push/subscribe', {
                                endpoint: this.pushSubscription.endpoint,
                                keys: {
                                    p256dh: btoa(String.fromCharCode(...new Uint8Array(this.pushSubscription.getKey('p256dh')))),
                                    auth: btoa(String.fromCharCode(...new Uint8Array(this.pushSubscription.getKey('auth'))))
                                }
                            });
                            
                            this.pushNotificationsEnabled = true;
                            this.showToast('‚úÖ Push bildirimleri aktif edildi!', 'success');
                            
                        } else {
                            // Bildirimleri KAPAT
                            if (this.pushSubscription) {
                                await axios.post('/api/push/unsubscribe', {
                                    endpoint: this.pushSubscription.endpoint
                                });
                                await this.pushSubscription.unsubscribe();
                                this.pushSubscription = null;
                            }
                            this.pushNotificationsEnabled = false;
                            this.showToast('üîï Push bildirimleri kapatƒ±ldƒ±', 'info');
                        }
                        
                    } catch (error) {
                        console.error('‚ùå Push notification toggle hatasƒ±:', error);
                        this.showToast('‚ùå Bir hata olu≈ütu: ' + error.message, 'error');
                    }
                },
                
                // URL-safe base64 to Uint8Array helper
                urlBase64ToUint8Array(base64String) {
                    const padding = '='.repeat((4 - base64String.length % 4) % 4);
                    const base64 = (base64String + padding)
                        .replace(/\-/g, '+')
                        .replace(/_/g, '/');
                    const rawData = window.atob(base64);
                    const outputArray = new Uint8Array(rawData.length);
                    for (let i = 0; i < rawData.length; ++i) {
                        outputArray[i] = rawData.charCodeAt(i);
                    }
                    return outputArray;
                },
                
                // Push notification durumunu kontrol et
                async checkPushNotificationStatus() {
                    try {
                        if (!this.isLoggedIn) return;
                        
                        // Tarayƒ±cƒ± desteƒüini kontrol et
                        if (!('Notification' in window) || !('serviceWorker' in navigator) || !('PushManager' in window)) {
                            return;
                        }
                        
                        // ƒ∞zin durumunu kontrol et
                        if (Notification.permission !== 'granted') {
                            this.pushNotificationsEnabled = false;
                            return;
                        }
                        
                        // Service Worker ve subscription'ƒ± kontrol et
                        const registration = await navigator.serviceWorker.ready;
                        this.pushSubscription = await registration.pushManager.getSubscription();
                        
                        if (this.pushSubscription) {
                            this.pushNotificationsEnabled = true;
                        } else {
                            this.pushNotificationsEnabled = false;
                        }
                        
                    } catch (error) {
                        console.error('Push notification status kontrol√º hatasƒ±:', error);
                        this.pushNotificationsEnabled = false;
                    }
                },
                
                // üß™ Test bildirimi g√∂nder
                async sendTestNotification() {
                    try {
                        this.showToast('üì§ Test bildirimi g√∂nderiliyor...', 'info');
                        
                        const response = await axios.post('/api/push/test');
                        
                        if (response.data.success) {
                            this.showToast('‚úÖ Test bildirimi g√∂nderildi! Telefonunuzu kontrol edin.', 'success');
                        } else {
                            this.showToast('‚ùå Bildirim g√∂nderilemedi', 'error');
                        }
                        
                    } catch (error) {
                        console.error('Test bildirimi hatasƒ±:', error);
                        this.showToast('‚ùå Bir hata olu≈ütu: ' + (error.response?.data?.error || error.message), 'error');
                    }
                },
                
                // Service Worker Kayƒ±t - ‚úÖ D√úZELTME: /sw.js olarak tekle≈ütirildi
                async registerServiceWorker() {
                    return null; // SW devre dƒ±≈üƒ±
                },
                
                // Push Notification G√∂nder - ‚úÖ D√úZELTME: Service Worker √ºzerinden g√∂nderilir (Chrome arka plan desteƒüi)
                sendPushNotification(title, body, icon = '/agro.png') {
                    if (Notification.permission !== 'granted') return;
                    // Service Worker varsa onun √ºzerinden g√∂nder (Chrome'da arka planda √ßalƒ±≈üƒ±r)
                    if ('serviceWorker' in navigator) {
                        navigator.serviceWorker.ready.then(reg => {
                            reg.showNotification(title, {
                                body: body,
                                icon: icon,
                                badge: '/agro.png',
                                tag: 'agrolink-' + Date.now(),
                                renotify: true,
                                vibrate: [200, 100, 200],
                                data: { url: window.location.href }
                            });
                        }).catch(() => {
                            // SW yoksa fallback
                            new Notification(title, { body, icon });
                        });
                    } else if ('Notification' in window) {
                        new Notification(title, { body, icon });
                    }
                },

                setupAxios() {
                    const secureToken = this.SecureStorage.get('token');
                    axios.defaults.headers.common['Authorization'] = `Bearer ${secureToken || ''}`;
                    axios.defaults.baseURL = '/';
                    
                    // ‚úÖ Token yenileme interceptor - 401 gelince √∂nce refresh dene
                    let isRefreshing = false;
                    let failedQueue = [];
                    
                    const processQueue = (error, token = null) => {
                        failedQueue.forEach(prom => {
                            if (error) prom.reject(error);
                            else prom.resolve(token);
                        });
                        failedQueue = [];
                    };
                    
                    const appRef = this;
                    axios.interceptors.response.use(
                        response => response,
                        async function(error) {
                            const originalRequest = error.config;
                            if (error.response && error.response.status === 401 && !originalRequest._retry) {
                                if (originalRequest.url && (originalRequest.url.includes('/api/auth/login') || originalRequest.url.includes('/api/auth/refresh'))) {
                                    return Promise.reject(error);
                                }
                                if (isRefreshing) {
                                    return new Promise((resolve, reject) => {
                                        failedQueue.push({ resolve, reject });
                                    }).then(token => {
                                        originalRequest.headers['Authorization'] = 'Bearer ' + token;
                                        return axios(originalRequest);
                                    }).catch(err => Promise.reject(err));
                                }
                                originalRequest._retry = true;
                                isRefreshing = true;
                                try {
                                    const refreshToken = appRef.SecureStorage.get('refreshToken') || localStorage.getItem('agrolink_refresh_token');
                                    if (!refreshToken) throw new Error('Refresh token yok');
                                    const res = await axios.post('/api/auth/refresh-token', { refreshToken }, { _retry: true });
                                    const newToken = res.data.token || res.data.accessToken;
                                    if (!newToken) throw new Error('Yeni token alƒ±namadƒ±');
                                    await appRef.SecureStorage.setAsync('token', newToken);
                                    axios.defaults.headers.common['Authorization'] = 'Bearer ' + newToken;
                                    originalRequest.headers['Authorization'] = 'Bearer ' + newToken;
                                    if (res.data.refreshToken) appRef.SecureStorage.set('refreshToken', res.data.refreshToken);
                                    processQueue(null, newToken);
                                    console.log('‚úÖ Token yenilendi, istek tekrarlanƒ±yor');
                                    return axios(originalRequest);
                                } catch (refreshError) {
                                    processQueue(refreshError, null);
                                    console.warn('‚ùå Token yenilenemedi, oturum sonlandƒ±rƒ±lƒ±yor');
                                    appRef.showToast('‚ùå Oturumunuz sonlandƒ±. L√ºtfen tekrar giri≈ü yapƒ±n.');
                                    setTimeout(() => appRef.logout(), 2000);
                                    return Promise.reject(refreshError);
                                } finally {
                                    isRefreshing = false;
                                }
                            }
                            return Promise.reject(error);
                        }
                    );
                },

                setupSocket() {
                    try {
                        const secureToken = this.SecureStorage.get('token');
                        this.socket = io();
                        this.socket.emit('authenticate', { token: secureToken });
                        this.socket.on('notification', (data) => {
                            this.unreadNotifs++;
                            this.showToast(data.message || 'Yeni bildirim');
                            this.loadNotifications();
                            // Push notification g√∂nder
                            this.sendPushNotification('AgroLink', data.message || 'Yeni bildirim aldƒ±nƒ±z!');
                        });
                        this.socket.on('new_message', (msg) => {
                            if (this.showChatModal && this.activeChat.otherId === msg.senderId) {
                                this.chatMessages.push(msg);
                                this.scrollToBottom();
                                // Mesajƒ± okundu olarak i≈üaretle
                                this.markMessagesAsRead(msg.senderId);
                            } else {
                                this.loadConversations();
                                // Push notification g√∂nder
                                this.sendPushNotification('Yeni Mesaj', msg.content || 'Yeni bir mesaj aldƒ±nƒ±z!', msg.senderProfilePic || '/favicon.ico');
                            }
                        });
                        // Mesaj okundu bildirimi
                        this.socket.on('messages_read', (data) => {
                            if (this.showChatModal && this.activeChat.otherId === data.readerId) {
                                this.chatMessages.forEach(m => {
                                    if (m.senderId === this.user.id && !m.readAt) {
                                        m.readAt = data.readAt || new Date().toISOString();
                                    }
                                });
                            }
                        });
                        // Mesaj silindi bildirimi
                        this.socket.on('message_deleted', (data) => {
                            const idx = this.chatMessages.findIndex(m => m.id === data.messageId);
                            if (idx !== -1) {
                                this.chatMessages[idx].isDeleted = true;
                            }
                        });
                        
                        // ========== G√ñR√úNT√úL√ú ARAMA Bƒ∞LDƒ∞Rƒ∞MLERƒ∞ ==========
                        // Gelen arama bildirimi
                        this.socket.on('incoming_call', (data) => {
                            this.incomingCall = data;
                            this.showIncomingCallModal = true;
                            // Bildirim sesi √ßal
                            this.playNotificationSound('call');
                        });
                        
                        // Arama kabul edildi
                        this.socket.on('call_accepted', (data) => {
                            this.showToast('üìû Arama kabul edildi');
                        });
                        
                        // Arama reddedildi
                        this.socket.on('call_rejected', (data) => {
                            this.showToast('‚ùå Arama reddedildi');
                            this.endCall();
                        });
                        
                        // Arama cevapsƒ±z
                        this.socket.on('call_missed', (data) => {
                            this.showToast('üìµ Arama cevapsƒ±z kaldƒ±');
                            this.showIncomingCallModal = false;
                            this.incomingCall = null;
                        });
                        
                        // Arama sonlandƒ±rƒ±ldƒ±
                        this.socket.on('call_ended', (data) => {
                            this.showToast('üìû Arama sonlandƒ±rƒ±ldƒ±');
                            this.endCall();
                        });
                        
                        // WebRTC Sinyal Mesajlarƒ±
                        this.socket.on('webrtc_offer', async (data) => {
                            if (this.peerConnection) {
                                await this.peerConnection.setRemoteDescription(new RTCSessionDescription(data.offer));
                                const answer = await this.peerConnection.createAnswer();
                                await this.peerConnection.setLocalDescription(answer);
                                await axios.post('/api/calls/signal/answer', {
                                    callId: data.callId,
                                    answer: answer
                                });
                            }
                        });
                        
                        this.socket.on('webrtc_answer', async (data) => {
                            if (this.peerConnection) {
                                await this.peerConnection.setRemoteDescription(new RTCSessionDescription(data.answer));
                            }
                        });
                        
                        this.socket.on('webrtc_ice_candidate', async (data) => {
                            if (this.peerConnection) {
                                await this.peerConnection.addIceCandidate(new RTCIceCandidate(data.candidate));
                            }
                        });
                        
                        this.socket.on('new_post', () => this.fetchPosts(true));
                        this.socket.on('account_deleted', () => this.logout());
                        this.socket.on('force_logout', () => this.logout());
                    } catch (e) { console.log('Socket error:', e); }
                },
                
                // Bildirim sesi √ßal
                playNotificationSound(type) {
                    try {
                        const audio = new Audio();
                        audio.src = type === 'call' 
                            ? 'data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYIG2m98OScTgwOUarm7blmFgU7k9n1unEiBC13yO/eizEIHWq+8+OWT' 
                            : '';
                        audio.play().catch(() => {});
                    } catch (e) {}
                },
                
                // Payla≈üƒ±lan postu a√ß
                openSharedPost(postId) {
                    this.showChatModal = false;
                    this.openTikTokScroll({ id: postId });
                },
                
                // Mesajlarƒ± okundu olarak i≈üaretle
                async markMessagesAsRead(userId) {
                    try {
                        await axios.post(`/api/messages/${userId}/read`);
                    } catch (e) { console.log('Okundu i≈üareti g√∂nderilemedi'); }
                },

                async loadInitialData() {
                    // Privacy & Notification settings yerel olarak y√ºkle
                    this.loadPrivacySettings();
                    this.loadNotificationSettingsData();
                    
                    // Promise.allSettled kullan: bir API ba≈üarƒ±sƒ±z olsa bile diƒüerleri √ßalƒ±≈üsƒ±n
                    const results = await Promise.allSettled([
                        this.fetchPosts(),
                        this.loadStats(),
                        this.loadProducts(),
                        this.loadConversations(),
                        this.loadChannels(),
                        this.loadNotifications(),
                        this.loadStories(),
                        this.loadFollowing(), // Takip edilenleri y√ºkle
                        this.loadUserBadges(), // Kullanƒ±cƒ± rozetlerini y√ºkle
                        this.loadTopEngagementUsers() // Top 3 kullanƒ±cƒ±larƒ± y√ºkle
                    ]);
                    
                    // Ba≈üarƒ±sƒ±z olanlarƒ± logla
                    results.forEach((result, i) => {
                        if (result.status === 'rejected') {
                            const names = ['fetchPosts', 'loadStats', 'loadProducts', 'loadConversations', 'loadChannels', 'loadNotifications', 'loadStories', 'loadFollowing', 'loadUserBadges', 'loadTopEngagementUsers'];
                            console.warn('[AgroLink] ' + names[i] + ' y√ºklenemedi:', result.reason);
                        }
                    });
                },
                
                // Takip edilenleri y√ºkle
                async loadFollowing() {
                    try {
                        const res = await axios.get('/api/users/following');
                        this.followingIds = res.data.following?.map(f => f.id) || [];
                        console.log('‚úÖ Takip edilenler y√ºklendi:', this.followingIds.length);
                    } catch (e) {
                        console.error('Takip edilenler y√ºklenemedi:', e);
                    }
                },

                initEditForm() {
                    this.editForm = {
                        name: this.user.name || '',
                        email: this.user.email || '',
                        userType: this.user.userType || '',
                        bio: this.user.bio || '',
                        location: this.user.location || '',
                        website: this.user.website || '',
                        profilePic: this.user.profilePic || '',
                        profilePicFile: null,
                        coverPicFile: null,
                        coverPicPreview: ''
                    };
                },
                
                // Tab deƒüi≈ütir ve verileri yenile
                switchTab(tab) {
                    this.activeTab = tab;
                    if (tab === 'home') {
                        this.fetchPosts(true);
                        this.loadStories();
                    } else if (tab === 'store') {
                        this.loadProducts();
                    } else if (tab === 'messages') {
                        this.loadConversations();
                        this.loadChannels();
                    } else if (tab === 'profile') {
                        this.loadMyPosts();
                        this.loadStats();
                    }
                },

                // ============ AUTH ============
                generateCaptcha() {
                    // reCAPTCHA render
                    this.recaptchaVerified = false;
                    this.$nextTick(() => {
                        if (window.grecaptcha && document.getElementById('recaptcha-container')) {
                            try {
                                if (this.recaptchaWidgetId !== null && this.recaptchaWidgetId !== undefined) {
                                    window.grecaptcha.reset(this.recaptchaWidgetId);
                                } else {
                                    this.recaptchaWidgetId = window.grecaptcha.render('recaptcha-container', {
                                        sitekey: '6LeIxAcTAAAAAJcZVRqyHh71UMIEGNQ_MXjiZKhI',
                                        callback: (response) => { this.recaptchaVerified = true; this.recaptchaResponse = response; },
                                        'expired-callback': () => { this.recaptchaVerified = false; this.recaptchaResponse = ''; },
                                        theme: this.darkMode ? 'dark' : 'light',
                                        size: 'normal'
                                    });
                                }
                            } catch(e) { console.log('reCAPTCHA render error:', e); }
                        }
                    });
                },

                previewAvatar(e) {
                    const file = e.target.files[0];
                    if (!file) return;
                    this.authForm.avatarFile = file;
                    this.authForm.avatarPreview = URL.createObjectURL(file);
                },

                async authAction() {

                    this.loading = true;
                    try {
                        if (this.authMode === 'register') {
                            // ≈ûifre doƒürulama
                            const pw = this.authForm.password;
                            if (pw.length < 8) { this.showToast("≈ûifre en az 8 karakter olmalƒ±!"); this.loading = false; return; }
                            if (!/[a-zA-Z]/.test(pw)) { this.showToast("≈ûifre en az bir harf i√ßermeli!"); this.loading = false; return; }
                            if (!/[0-9]/.test(pw)) { this.showToast("≈ûifre en az bir rakam i√ßermeli!"); this.loading = false; return; }
                            if (!/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(pw)) { this.showToast("≈ûifre en az bir √∂zel karakter i√ßermeli!"); this.loading = false; return; }
                            // Kullanƒ±cƒ± adƒ±nƒ± k√º√ß√ºk harfe zorla
                            this.authForm.username = this.authForm.username.toLowerCase();
                            // YENƒ∞: Kayƒ±t - E-posta doƒürulama ile
                            const fd = new FormData();
                            fd.append('name', window.sanitizeInput ? window.sanitizeInput(this.authForm.name) : this.authForm.name);
                            fd.append('username', window.sanitizeInput ? window.sanitizeInput(this.authForm.username) : this.authForm.username);
                            fd.append('email', window.sanitizeInput ? window.sanitizeInput(this.authForm.email) : this.authForm.email);
                            fd.append('password', this.authForm.password);
                            fd.append('userType', this.authForm.userType || 'normal_kullanici');
                            if (this.authForm.avatarFile) fd.append('profilePic', this.authForm.avatarFile);
                            // ‚úÖ G√úVENLƒ∞K: reCAPTCHA token server'a g√∂nder
                            if (this.recaptchaResponse) fd.append('recaptchaToken', this.recaptchaResponse);
                            
                            const res = await axios.post('/api/auth/register-init', fd);
                            
                            // E-posta doƒürulama modalƒ±nƒ± g√∂ster
                            this.emailVerifyData.email = this.authForm.email;
                            this.pendingRegistrationData = {
                                email: this.authForm.email,
                                password: this.authForm.password
                            };
                            this.showEmailVerifyModal = true;
                            this.startEmailVerifyTimer();
                            this.showToast(res.data.message);
                            
                        } else {
                            // YENƒ∞: Giri≈ü - E-posta veya Kullanƒ±cƒ± Adƒ± ile
                            const loginIdentifier = this.authForm.identifier || this.authForm.email;
                            const res = await axios.post('/api/auth/login', { 
                                identifier: window.sanitizeInput ? window.sanitizeInput(loginIdentifier) : loginIdentifier, 
                                password: this.authForm.password 
                            });
                            
                            if (res.data.requires2FA) {
                                // 2FA modalƒ±nƒ± g√∂ster
                                this.twoFAData = {
                                    tempToken: res.data.tempToken,
                                    email: res.data.email,
                                    userId: res.data.userId
                                };
                                this.show2FAModal = true;
                                this.start2FATimer();
                                this.showToast(res.data.message);
                            } else {
                                // Normal giri≈ü (fallback)
                                // ‚úÖ setAsync: token yazƒ±lmadan reload olmaz
                                await this.SecureStorage.setAsync('token', res.data.token || res.data.accessToken);
                                await this.SecureStorage.setAsync('user', res.data.user);
                                if (res.data.refreshToken) await this.SecureStorage.setAsync('refreshToken', res.data.refreshToken);
                                location.reload();
                            }
                        }
                    } catch (e) {
                        this.showToast(e.response?.data?.error || "ƒ∞≈ülem ba≈üarƒ±sƒ±z!");
                        this.generateCaptcha();
                    } finally { 
                        this.loading = false; 
                    }
                },
                
                // ========== 2FA (2 FAKT√ñRL√ú DOƒûRULAMA) FONKSƒ∞YONLARI ==========
                
                // 2FA Input Handler - SERƒ∞ Gƒ∞Rƒ∞≈û DESTEƒûƒ∞ (YAPI≈ûTIRILMI≈û KOD)
                handle2FAInput(index, event) {
                    const value = event.target.value;
                    
                    // Yapƒ±≈ütƒ±rma kontrol√º - 6 haneli kod yapƒ±≈ütƒ±rƒ±ldƒ±ysa t√ºm√ºn√º daƒüƒ±t
                    if (value.length > 1) {
                        const digits = value.replace(/\D/g, '').slice(0, 6);
                        if (digits.length > 0) {
                            for (let i = 0; i < 6; i++) {
                                this.twoFAInput[i] = digits[i] || '';
                                const inp = document.querySelector('[data-2fa="' + i + '"]');
                                if (inp) inp.value = digits[i] || '';
                            }
                            const lastFilledIndex = Math.min(digits.length - 1, 5);
                            const lastInput = document.querySelector('[data-2fa="' + lastFilledIndex + '"]');
                            if (lastInput) lastInput.focus();
                            
                            if (digits.length === 6) {
                                this.$nextTick(() => this.verify2FA());
                            }
                            return;
                        }
                    }
                    
                    // Sadece sayƒ± kabul et
                    if (!/^\d*$/.test(value)) {
                        this.twoFAInput[index] = '';
                        event.target.value = '';
                        return;
                    }
                    
                    // Sadece son karakteri al
                    const digit = value.slice(-1);
                    this.twoFAInput[index] = digit;
                    event.target.value = digit;
                    
                    // Sonraki input'a HEMEN ge√ß
                    if (digit && index < 5) {
                        this.$nextTick(() => {
                            const nextInput = document.querySelector('[data-2fa="' + (index + 1) + '"]');
                            if (nextInput) {
                                nextInput.focus();
                                nextInput.value = '';
                            }
                        });
                    }
                    
                    // T√ºm alanlar doluysa otomatik doƒürula
                    if (this.is2FAComplete()) {
                        this.$nextTick(() => this.verify2FA());
                    }
                },
                
                // 2FA Backspace Handler
                handle2FABackspace(index, event) {
                    if (event.key === 'Backspace' && !this.twoFAInput[index] && index > 0) {
                        this.$nextTick(() => {
                            const prevInput = document.querySelector('[data-2fa="' + (index - 1) + '"]');
                            if (prevInput) prevInput.focus();
                        });
                    }
                },
                
                // 2FA kodu tamamlandƒ± mƒ±?
                is2FAComplete() {
                    return this.twoFAInput.every(digit => digit && /^\d$/.test(digit));
                },
                
                // 2FA kodunu formatla
                get2FACode() {
                    return this.twoFAInput.join('');
                },
                
                // 2FA Timer ba≈ülat
                start2FATimer() {
                    this.twoFATimer = 300; // 5 dakika
                    this.twoFAResendTimer = 60; // 1 dakika bekleme
                    
                    if (this.twoFATimerInterval) clearInterval(this.twoFATimerInterval);
                    
                    this.twoFATimerInterval = setInterval(() => {
                        if (this.twoFATimer > 0) this.twoFATimer--;
                        if (this.twoFAResendTimer > 0) this.twoFAResendTimer--;
                        
                        if (this.twoFATimer === 0) {
                            clearInterval(this.twoFATimerInterval);
                            this.twoFAError = 'Kodun s√ºresi doldu. L√ºtfen tekrar giri≈ü yapƒ±n.';
                        }
                    }, 1000);
                },
                
                // 2FA Timer formatla
                format2FATimer() {
                    const minutes = Math.floor(this.twoFATimer / 60);
                    const seconds = this.twoFATimer % 60;
                    return `${minutes}:${seconds.toString().padStart(2, '0')}`;
                },
                
                // 2FA Doƒürula
                async verify2FA() {
                    if (!this.is2FAComplete()) {
                        this.twoFAError = 'L√ºtfen 6 haneli kodu tam girin';
                        return;
                    }
                    
                    this.loading = true;
                    this.twoFAError = '';
                    
                    try {
                        const res = await axios.post('/api/auth/verify-2fa', {
                            tempToken: this.twoFAData.tempToken,
                            code: this.get2FACode()
                        });
                        
                        // Timer'ƒ± durdur
                        if (this.twoFATimerInterval) clearInterval(this.twoFATimerInterval);
                        
                        // ‚úÖ setAsync: token localStorage'a yazƒ±lmadan reload olmaz
                        await this.SecureStorage.setAsync('token', res.data.token || res.data.accessToken);
                        await this.SecureStorage.setAsync('user', res.data.user);
                        if (res.data.refreshToken) await this.SecureStorage.setAsync('refreshToken', res.data.refreshToken);
                        this.showToast('Giri≈ü ba≈üarƒ±lƒ±!');
                        location.reload();
                        
                    } catch (e) {
                        this.twoFAError = e.response?.data?.error || 'Kod doƒürulanamadƒ±. L√ºtfen tekrar deneyin.';
                        // Inputlarƒ± temizle
                        this.twoFAInput = ['', '', '', '', '', ''];
                        this.$nextTick(() => {
                            const firstInput = this.$refs['2fa-0'];
                            if (firstInput) firstInput.focus();
                        });
                    } finally {
                        this.loading = false;
                    }
                },
                
                // 2FA Kodu tekrar g√∂nder
                async resend2FACode() {
                    if (this.twoFAResendTimer > 0) return;
                    
                    this.loading = true;
                    try {
                        const res = await axios.post('/api/auth/resend-2fa', {
                            tempToken: this.twoFAData.tempToken
                        });
                        
                        this.twoFAResendTimer = 60;
                        this.twoFAError = '';
                        this.showToast('Yeni kod g√∂nderildi!');
                        
                    } catch (e) {
                        this.twoFAError = e.response?.data?.error || 'Kod g√∂nderilemedi';
                    } finally {
                        this.loading = false;
                    }
                },
                
                // 2FA ƒ∞ptal
                cancel2FA() {
                    if (this.twoFATimerInterval) clearInterval(this.twoFATimerInterval);
                    this.show2FAModal = false;
                    this.twoFAData = { tempToken: '', email: '', userId: '' };
                    this.twoFAInput = ['', '', '', '', '', ''];
                    this.twoFAError = '';
                    this.twoFATimer = 300;
                    this.twoFAResendTimer = 0;
                },
                
                // ========== E-POSTA DOƒûRULAMA FONKSƒ∞YONLARI ==========
                
                // Email Verify Input Handler - SERƒ∞ Gƒ∞Rƒ∞≈û DESTEƒûƒ∞ (YAPI≈ûTIRILMI≈û KOD)
                handleEmailVerifyInput(index, event) {
                    const value = event.target.value;
                    
                    // Yapƒ±≈ütƒ±rma kontrol√º
                    if (value.length > 1) {
                        const digits = value.replace(/\D/g, '').slice(0, 6);
                        if (digits.length > 0) {
                            for (let i = 0; i < 6; i++) {
                                this.emailVerifyInput[i] = digits[i] || '';
                                const inp = document.querySelector('[data-ev="' + i + '"]');
                                if (inp) inp.value = digits[i] || '';
                            }
                            const lastFilledIndex = Math.min(digits.length - 1, 5);
                            const lastInput = document.querySelector('[data-ev="' + lastFilledIndex + '"]');
                            if (lastInput) lastInput.focus();
                            
                            if (digits.length === 6) {
                                this.$nextTick(() => this.verifyEmailCode());
                            }
                            return;
                        }
                    }
                    
                    // Sadece sayƒ± kabul et
                    if (!/^\d*$/.test(value)) {
                        this.emailVerifyInput[index] = '';
                        event.target.value = '';
                        return;
                    }
                    
                    // Sadece son karakteri al
                    const digit = value.slice(-1);
                    this.emailVerifyInput[index] = digit;
                    event.target.value = digit;
                    
                    // Sonraki input'a HEMEN ge√ß
                    if (digit && index < 5) {
                        this.$nextTick(() => {
                            const nextInput = document.querySelector('[data-ev="' + (index + 1) + '"]');
                            if (nextInput) {
                                nextInput.focus();
                                nextInput.value = '';
                            }
                        });
                    }
                    
                    // T√ºm alanlar doluysa otomatik doƒürula
                    if (this.isEmailVerifyComplete()) {
                        this.$nextTick(() => this.verifyEmailCode());
                    }
                },
                
                // Email Verify Backspace Handler
                handleEmailVerifyBackspace(index, event) {
                    if (event.key === 'Backspace' && !this.emailVerifyInput[index] && index > 0) {
                        this.$nextTick(() => {
                            const prevInput = document.querySelector('[data-ev="' + (index - 1) + '"]');
                            if (prevInput) prevInput.focus();
                        });
                    }
                },
                
                // Email Verify kodu tamamlandƒ± mƒ±?
                isEmailVerifyComplete() {
                    return this.emailVerifyInput.every(digit => digit && /^\d$/.test(digit));
                },
                
                // Email Verify kodunu formatla
                getEmailVerifyCode() {
                    return this.emailVerifyInput.join('');
                },
                
                // Email Verify Timer ba≈ülat
                startEmailVerifyTimer() {
                    this.emailVerifyTimer = 300; // 5 dakika
                    this.emailResendTimer = 60; // 1 dakika bekleme
                    
                    if (this.emailVerifyTimerInterval) clearInterval(this.emailVerifyTimerInterval);
                    
                    this.emailVerifyTimerInterval = setInterval(() => {
                        if (this.emailVerifyTimer > 0) this.emailVerifyTimer--;
                        if (this.emailResendTimer > 0) this.emailResendTimer--;
                        
                        if (this.emailVerifyTimer === 0) {
                            clearInterval(this.emailVerifyTimerInterval);
                            this.emailVerifyError = 'Kodun s√ºresi doldu. L√ºtfen tekrar kayƒ±t olun.';
                        }
                    }, 1000);
                },
                
                // Email Verify Timer formatla
                formatEmailVerifyTimer() {
                    const minutes = Math.floor(this.emailVerifyTimer / 60);
                    const seconds = this.emailVerifyTimer % 60;
                    return `${minutes}:${seconds.toString().padStart(2, '0')}`;
                },
                
                // Email Kod Doƒürula
                async verifyEmailCode() {
                    if (!this.isEmailVerifyComplete()) {
                        this.emailVerifyError = 'L√ºtfen 6 haneli kodu tam girin';
                        return;
                    }
                    
                    this.loading = true;
                    this.emailVerifyError = '';
                    
                    try {
                        const res = await axios.post('/api/auth/register-verify', {
                            email: this.emailVerifyData.email,
                            code: this.getEmailVerifyCode()
                        });
                        
                        // Timer'ƒ± durdur
                        if (this.emailVerifyTimerInterval) clearInterval(this.emailVerifyTimerInterval);
                        
                        // ‚úÖ HATA D√úZELTMESƒ∞: setAsync kullan ‚Äî reload √∂ncesi token
                        // localStorage'a YAZILMASI GARANTILENIR (async ≈üifreleme beklenir)
                        await this.SecureStorage.setAsync('token', res.data.token || res.data.accessToken);
                        await this.SecureStorage.setAsync('user', res.data.user);
                        if (res.data.refreshToken) await this.SecureStorage.setAsync('refreshToken', res.data.refreshToken);
                        this.showToast('Kayƒ±t ba≈üarƒ±yla tamamlandƒ±! üéâ');
                        this.showEmailVerifyModal = false;
                        location.reload();
                        
                    } catch (e) {
                        this.emailVerifyError = e.response?.data?.error || 'Kod doƒürulanamadƒ±. L√ºtfen tekrar deneyin.';
                        this.emailVerifyInput = ['', '', '', '', '', ''];
                        this.$nextTick(() => {
                            const firstInput = this.$refs['email-verify-0'];
                            if (firstInput) firstInput.focus();
                        });
                    } finally {
                        this.loading = false;
                    }
                },
                
                // Email Kodu tekrar g√∂nder
                async resendEmailCode() {
                    if (this.emailResendTimer > 0) return;
                    
                    this.loading = true;
                    try {
                        const res = await axios.post('/api/auth/resend-verification', {
                            email: this.emailVerifyData.email
                        });
                        
                        this.emailResendTimer = 60;
                        this.emailVerifyError = '';
                        this.showToast('Yeni kod g√∂nderildi!');
                        
                    } catch (e) {
                        this.emailVerifyError = e.response?.data?.error || 'Kod g√∂nderilemedi';
                    } finally {
                        this.loading = false;
                    }
                },
                
                // Email Verify ƒ∞ptal
                cancelEmailVerify() {
                    if (this.emailVerifyTimerInterval) clearInterval(this.emailVerifyTimerInterval);
                    this.showEmailVerifyModal = false;
                    this.emailVerifyData = { email: '' };
                    this.emailVerifyInput = ['', '', '', '', '', ''];
                    this.emailVerifyError = '';
                    this.emailVerifyTimer = 300;
                    this.emailResendTimer = 0;
                    this.pendingRegistrationData = null;
                },

                async forgotPassword() {
                    if (!this.authForm.email || !this.authForm.username) {
                        this.showToast("E-posta adresi ve kullanƒ±cƒ± adƒ± gerekli");
                        return;
                    }
                    this.loading = true;
                    try {
                        // XSS korumasƒ±
                        const sanitizedEmail = window.sanitizeInput ? window.sanitizeInput(this.authForm.email) : this.authForm.email;
                        const sanitizedUsername = window.sanitizeInput ? window.sanitizeInput(this.authForm.username) : this.authForm.username;
                        await axios.post('/api/auth/forgot-password', { email: sanitizedEmail, username: sanitizedUsername });
                        this.showToast("≈ûifre sƒ±fƒ±rlama linki e-posta adresinize g√∂nderildi");
                        this.authMode = 'login';
                    } catch (e) {
                        this.showToast(e.response?.data?.error || "Hata olu≈ütu");
                    } finally {
                        this.loading = false;
                    }
                },

                // ‚úÖ YENƒ∞ FONKSIYON: E-posta linkinden gelen resetToken ile ≈üifre sƒ±fƒ±rla
                async resetPasswordDirect() {
                    if (!this.resetDirectForm.newPassword || !this.resetDirectForm.confirmPassword) {
                        this.showToast("T√ºm alanlar zorunludur");
                        return;
                    }
                    if (this.resetDirectForm.newPassword !== this.resetDirectForm.confirmPassword) {
                        this.showToast("≈ûifreler e≈üle≈ümiyor");
                        return;
                    }
                    if (this.resetDirectForm.newPassword.length < 6) {
                        this.showToast("≈ûifre en az 6 karakter olmalƒ±");
                        return;
                    }
                    this.loading = true;
                    try {
                        await axios.post('/api/auth/reset-password', {
                            token: this.pendingResetToken,
                            newPassword: this.resetDirectForm.newPassword,
                            confirmPassword: this.resetDirectForm.confirmPassword
                        });
                        this.showToast("‚úÖ ≈ûifreniz ba≈üarƒ±yla sƒ±fƒ±rlandƒ±! Giri≈ü yapabilirsiniz.");
                        this.pendingResetToken = '';
                        this.pendingResetEmail = '';
                        this.resetDirectForm = { newPassword: '', confirmPassword: '' };
                        this.authMode = 'login';
                    } catch (e) {
                        this.showToast(e.response?.data?.error || "≈ûifre sƒ±fƒ±rlanamadƒ±. Link s√ºresi dolmu≈ü olabilir.");
                    } finally {
                        this.loading = false;
                    }
                },

                logout() {
                    // SecureStorage'ƒ± temizle
                    this.SecureStorage.clear();
                    // Eski localStorage verilerini de temizle
                    localStorage.removeItem('token');
                    localStorage.removeItem('user');
                    localStorage.removeItem('agrolink_user');
                    location.reload();
                },
                
                // Hesap Silme
                async deleteAccount() {
                    if (!this.deleteAccountPassword) {
                        this.showToast("≈ûifrenizi girin");
                        return;
                    }
                    if (this.deleteConfirmText !== 'DELETE') {
                        this.showToast("L√ºtfen DELETE yazarak onaylayƒ±n");
                        return;
                    }
                    if (!this.deleteDataConsent) {
                        this.showToast("Veri silme onayƒ±nƒ± kabul edin");
                        return;
                    }
                    
                    this.loading = true;
                    try {
                        await axios.delete('/api/users/account', { 
                            data: { password: this.deleteAccountPassword }
                        });
                        this.showToast("Hesabƒ±nƒ±z silindi");
                        setTimeout(() => this.logout(), 1500);
                    } catch (e) {
                        this.showToast(e.response?.data?.error || "Hesap silinemedi");
                    } finally {
                        this.loading = false;
                    }
                },
                
                // ≈ûifre Deƒüi≈ütirme
                async changePassword() {
                    if (!this.passwordForm.currentPassword || !this.passwordForm.newPassword || !this.passwordForm.confirmPassword) {
                        this.showToast("T√ºm alanlarƒ± doldurun");
                        return;
                    }
                    
                    if (this.passwordForm.newPassword !== this.passwordForm.confirmPassword) {
                        this.showToast("Yeni ≈üifreler e≈üle≈ümiyor");
                        return;
                    }
                    
                    if (this.passwordForm.newPassword.length < 6) {
                        this.showToast("≈ûifre en az 6 karakter olmalƒ±");
                        return;
                    }
                    
                    this.loading = true;
                    try {
                        await axios.post('/api/users/change-password', this.passwordForm);
                        this.showToast("≈ûifre deƒüi≈ütirildi");
                        this.showChangePassword = false;
                        this.passwordForm = { currentPassword: '', newPassword: '', confirmPassword: '' };
                    } catch (e) {
                        this.showToast(e.response?.data?.error || "≈ûifre deƒüi≈ütirilemedi");
                    } finally {
                        this.loading = false;
                    }
                },

                // ============ KE≈ûFET ============
                async loadExplorePosts() {
                    this.exploreLoading = true;
                    try {
                        // T√ºm postlarƒ± √ßek ve pop√ºlerliƒüe g√∂re sƒ±rala
                        const res = await axios.get('/api/posts?page=1&limit=50');
                        let posts = res.data.posts || [];
                        
                        // Medya URL + alan adƒ± normalize
                        posts.forEach(post => {
                            post.userName       = post.userName       || post.name     || post.username || 'Kullanƒ±cƒ±';
                            post.userUsername   = post.userUsername   || post.username || '';
                            post.userProfilePic = post.userProfilePic || post.profilePic || '';
                            post.viewCount      = post.viewCount ?? post.views ?? 0;
                            if (post.media) {
                                if (post.mediaType === 'video') {
                                    if (post.media.includes('.m3u8') || post.media.includes('/uploads/hls/')) {
                                        // HLS URL ‚Üí doƒürudan kullan
                                        post.mediaUrl = post.mediaUrl || post.media;
                                    } else {
                                        // MP4 URL ‚Üí doƒürudan kullan
                                        post.mediaUrl = post.mediaUrl || post.media;
                                    }
                                } else {
                                    post.mediaUrl = post.mediaUrl || post.media;
                                }
                            }
                        });
                        
                        // Kategoriye g√∂re filtrele ve sƒ±rala
                        if (this.exploreCategory === 'liked') {
                            posts.sort((a, b) => (b.likeCount || 0) - (a.likeCount || 0));
                        } else if (this.exploreCategory === 'commented') {
                            posts.sort((a, b) => (b.commentCount || 0) - (a.commentCount || 0));
                        } else if (this.exploreCategory === 'media') {
                            posts = posts.filter(p => p.mediaUrl);
                            posts.sort((a, b) => ((b.likeCount || 0) + (b.commentCount || 0)) - ((a.likeCount || 0) + (a.commentCount || 0)));
                        } else if (this.exploreCategory === 'recent') {
                            posts.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                        } else {
                            // Trend: beƒüeni + yorum toplamƒ±na g√∂re sƒ±rala
                            posts.sort((a, b) => {
                                const scoreA = (a.likeCount || 0) * 2 + (a.commentCount || 0) * 3 + (a.viewCount || 0);
                                const scoreB = (b.likeCount || 0) * 2 + (b.commentCount || 0) * 3 + (b.viewCount || 0);
                                return scoreB - scoreA;
                            });
                        }
                        
                        this.exploreAllPosts = posts;
                        this.explorePosts = posts;
                        this.exploreSearchQuery = '';
                    } catch (e) {
                        console.error('Explore error:', e);
                        this.showToast('Ke≈üfet y√ºklenemedi');
                    } finally {
                        this.exploreLoading = false;
                    }
                },
                
                filterExplorePosts() {
                    const q = (this.exploreSearchQuery || '').toLowerCase().trim();
                    if (!q) {
                        this.explorePosts = this.exploreAllPosts;
                        return;
                    }
                    this.explorePosts = this.exploreAllPosts.filter(p => 
                        (p.content && p.content.toLowerCase().includes(q)) ||
                        (p.userName && p.userName.toLowerCase().includes(q)) ||
                        (p.username && p.username.toLowerCase().includes(q))
                    );
                },

                async loadPopularHashtags() {
                    this.exploreLoading = true;
                    try {
                        const res = await axios.get('/api/posts?page=1&limit=100');
                        let posts = res.data.posts || [];
                        const tagMap = {};
                        posts.forEach(p => {
                            if (p.content) {
                                const tags = p.content.match(/#([\w√ßƒüƒ±√∂≈ü√º√áƒûƒ∞√ñ≈û√ú]+)/g);
                                if (tags) {
                                    tags.forEach(t => {
                                        const name = t.slice(1).toLowerCase();
                                        tagMap[name] = (tagMap[name] || 0) + 1;
                                    });
                                }
                            }
                        });
                        this.popularHashtags = Object.entries(tagMap)
                            .map(([name, count]) => ({ name, count }))
                            .sort((a, b) => b.count - a.count)
                            .slice(0, 20);
                    } catch (e) {
                        console.error('Hashtag error:', e);
                        this.showToast('Hashtagler y√ºklenemedi');
                    } finally {
                        this.exploreLoading = false;
                    }
                },

                // ============ MULTI ACCOUNT ============
                saveCurrentAccount() {
                    if (!this.user || !this.user.username) return;
                    const token = this.SecureStorage.get('token');
                    const accounts = JSON.parse(localStorage.getItem('agrolink_saved_accounts') || '[]');
                    const existing = accounts.findIndex(a => a.username === this.user.username);
                    const accountData = {
                        username: this.user.username,
                        displayName: this.user.displayName || this.user.username,
                        avatar: this.user.avatar || '',
                        token: token,
                        userId: this.user._id || this.user.id
                    };
                    if (existing >= 0) {
                        accounts[existing] = accountData;
                    } else {
                        accounts.push(accountData);
                    }
                    localStorage.setItem('agrolink_saved_accounts', JSON.stringify(accounts));
                    this.savedAccounts = accounts;
                },

                async switchAccount(account) {
                    if (account.username === this.user.username) return;
                    // ‚úÖ G√úVENLƒ∞K: Her zaman SecureStorage kullan
                    this.SecureStorage.set('token', account.token);
                    location.reload();
                },

                removeAccount(username) {
                    let accounts = JSON.parse(localStorage.getItem('agrolink_saved_accounts') || '[]');
                    accounts = accounts.filter(a => a.username !== username);
                    localStorage.setItem('agrolink_saved_accounts', JSON.stringify(accounts));
                    this.savedAccounts = accounts;
                    this.showToast('Hesap kaldƒ±rƒ±ldƒ±');
                },

                async addNewAccount() {
                    this.addAccountLoading = true;
                    this.addAccountError = '';
                    try {
                        // √ñnce mevcut hesabƒ± kaydet
                        this.saveCurrentAccount();
                        // Yeni hesaba giri≈ü yap - email alanƒ± ile g√∂nder
                        const loginData = {
                            email: this.addAccountForm.username,
                            password: this.addAccountForm.password
                        };
                        // Kullanƒ±cƒ± adƒ± girilmi≈üse username olarak da g√∂nder
                        if (!this.addAccountForm.username.includes('@')) {
                            loginData.username = this.addAccountForm.username;
                        }
                        const res = await axios.post('/api/auth/login', loginData);
                        if (res.data.requires2FA) {
                            this.addAccountError = 'Bu hesapta 2FA aktif. L√ºtfen √∂nce normal giri≈ü yapƒ±n.';
                            this.addAccountLoading = false;
                            return;
                        }
                        if (res.data.token || res.data.accessToken) {
                            // Yeni hesabƒ± kaydet
                            const token = res.data.token || res.data.accessToken;
                            const newAccount = {
                                username: res.data.user?.username || this.addAccountForm.username,
                                displayName: res.data.user?.displayName || res.data.user?.name || this.addAccountForm.username,
                                avatar: res.data.user?.avatar || res.data.user?.profilePic || '',
                                token: token,
                                userId: res.data.user?._id || res.data.user?.id
                            };
                            let accounts = JSON.parse(localStorage.getItem('agrolink_saved_accounts') || '[]');
                            const existing = accounts.findIndex(a => a.username === newAccount.username);
                            if (existing >= 0) accounts[existing] = newAccount;
                            else accounts.push(newAccount);
                            localStorage.setItem('agrolink_saved_accounts', JSON.stringify(accounts));
                            this.savedAccounts = accounts;
                            this.showAddAccountModal = false;
                            this.addAccountForm = { username: '', password: '' };
                            this.showToast('Hesap eklendi! Ge√ßi≈ü yapmak i√ßin hesaba tƒ±klayƒ±n.');
                        } else {
                            this.addAccountError = 'Giri≈ü ba≈üarƒ±sƒ±z. Bilgileri kontrol edin.';
                        }
                    } catch (e) {
                        this.addAccountError = e.response?.data?.error || e.response?.data?.message || 'Giri≈ü ba≈üarƒ±sƒ±z. Bilgileri kontrol edin.';
                    } finally {
                        this.addAccountLoading = false;
                    }
                },

                // ============ FEED ============
                async fetchPosts(refresh = false) {
                    if (!this.hasMore && !refresh || this.loadingMore) return;
                    this.loadingMore = true;
                    
                    if (refresh) {
                        this.currentPage = 1;
                        this.feed = [];
                        this.hasMore = true;
                    }
                    
                    try {
                        const res = await axios.get(`/api/posts?page=${this.currentPage}&limit=10`);
                        const posts = res.data.posts || [];
                        
                        posts.forEach(post => {
                            // Alan adlarƒ±nƒ± normalize et (server camelCase ‚Üí frontend beklentisi)
                            post.userName        = post.userName        || post.name     || post.username || 'Kullanƒ±cƒ±';
                            post.userUsername    = post.userUsername    || post.username || '';
                            post.userProfilePic  = post.userProfilePic || post.profilePic || '';
                            // Diƒüer alanlar
                            post.showFullContent = false;
                            post.isFollowing = this.followingIds.includes(post.userId);
                            post.viewCount = post.viewCount ?? post.views ?? 0;
                            if (post.media) {
                                const filename = post.media.split('/').pop();
                                if (post.mediaType === 'video') {
                                    post.mediaUrl = post.mediaUrl || post.media; // HLS/MP4 URL doƒürudan kullan
                                } else {
                                    post.mediaUrl = post.mediaUrl || post.media;
                                }
                            }
                        });
                        
                        this.feed = refresh ? posts : [...this.feed, ...posts];
                        this.hasMore = res.data.hasMore;
                        this.currentPage++;
                        
                        // G√∂r√ºnt√ºlenme sayƒ±sƒ±nƒ± artƒ±r (arka planda) - hem kendi hem ba≈ükasƒ±nƒ±n postlarƒ±
                        posts.forEach(post => {
                            axios.post(`/api/posts/${post.id}/view`).then(r => {
                                if (r.data && r.data.views != null) {
                                    const p = this.feed.find(f => f.id === post.id);
                                    if (p) {
                                        p.viewCount = r.data.views;
                                        p.views = r.data.views;
                                    }
                                }
                            }).catch(() => {});
                        });
                    } catch (e) { 
                        console.error('Feed error:', e); 
                    } finally { 
                        this.loadingMore = false; 
                    }
                },

                handleScroll() {
                    if ((window.innerHeight + window.scrollY) >= document.body.offsetHeight - 500) {
                        this.fetchPosts();
                    }
                },

                // ============ POSTS ============
                handlePostMedia(e) {
                    const files = Array.from(e.target.files);
                    if (!files.length) return;
                    const maxSize = 100 * 1024 * 1024;
                    const validFiles = [];
                    for (const file of files) {
                        if (file.size > maxSize) { this.showToast(`‚ùå "${file.name}" √ßok b√ºy√ºk (${(file.size/1024/1024).toFixed(1)}MB). Maks: 100MB`); continue; }
                        validFiles.push(file);
                    }
                    if (!validFiles.length) { e.target.value = ''; return; }
                    const remaining = 10 - this.postForm.mediaFiles.length;
                    const toAdd = validFiles.slice(0, remaining);
                    if (validFiles.length > remaining) this.showToast(`‚ö†Ô∏è Maksimum 10 medya. ${validFiles.length - remaining} dosya atlandƒ±.`);
                    toAdd.forEach(file => {
                        const preview = URL.createObjectURL(file);
                        const mediaType = file.type.startsWith('video/') ? 'video' : 'image';
                        this.postForm.mediaFiles.push({ file, preview, mediaType });
                        this.postForm.previews.push(preview);
                    });
                    if (this.postForm.mediaFiles.length > 0) {
                        this.postForm.media = this.postForm.mediaFiles[0].file;
                        this.postForm.preview = this.postForm.mediaFiles[0].preview;
                        this.postForm.mediaType = this.postForm.mediaFiles[0].mediaType;
                    }
                    e.target.value = '';
                },
                
                // Kameradan Fotoƒüraf/Video √áekme
                async openCameraCapture() {
                    try {
                        const stream = await navigator.mediaDevices.getUserMedia({ 
                            video: { facingMode: 'environment', width: { ideal: 1920 }, height: { ideal: 1080 } }, 
                            audio: true 
                        });
                        
                        // Kamera modal olu≈ütur
                        const modal = document.createElement('div');
                        modal.id = 'cameraModal';
                        modal.style.cssText = 'position:fixed;inset:0;z-index:9999;background:black;display:flex;flex-direction:column;';
                        
                        const video = document.createElement('video');
                        video.srcObject = stream;
                        video.autoplay = true;
                        video.playsInline = true;
                        video.muted = true;
                        video.style.cssText = 'flex:1;object-fit:cover;';
                        
                        const controls = document.createElement('div');
                        controls.style.cssText = 'position:absolute;bottom:0;left:0;right:0;padding:24px;display:flex;align-items:center;justify-content:space-around;background:linear-gradient(transparent,rgba(0,0,0,0.8));';
                        
                        // Kapat butonu
                        const closeBtn = document.createElement('button');
                        // üîí G√úVENLƒ∞K D√úZELTMESƒ∞: innerHTML yerine g√ºvenli DOM API
                        const closeIcon = document.createElement('i');
                        closeIcon.className = 'fas fa-times';
                        closeIcon.style.cssText = 'font-size:24px;color:white;';
                        closeBtn.appendChild(closeIcon);
                        closeBtn.style.cssText = 'width:50px;height:50px;border-radius:50%;background:rgba(255,255,255,0.2);display:flex;align-items:center;justify-content:center;border:none;cursor:pointer;';
                        closeBtn.onclick = () => {
                            stream.getTracks().forEach(t => t.stop());
                            modal.remove();
                        };
                        
                        // √áek butonu
                        const captureBtn = document.createElement('button');
                        // üîí G√úVENLƒ∞K D√úZELTMESƒ∞: innerHTML yerine g√ºvenli DOM API
                        const captureIcon = document.createElement('i');
                        captureIcon.className = 'fas fa-camera';
                        captureIcon.style.cssText = 'font-size:28px;color:white;';
                        captureBtn.appendChild(captureIcon);
                        captureBtn.style.cssText = 'width:72px;height:72px;border-radius:50%;background:linear-gradient(135deg,#00b894,#00cec9);display:flex;align-items:center;justify-content:center;border:4px solid white;cursor:pointer;box-shadow:0 4px 20px rgba(0,184,148,0.5);';
                        captureBtn.onclick = () => {
                            const canvas = document.createElement('canvas');
                            canvas.width = video.videoWidth;
                            canvas.height = video.videoHeight;
                            canvas.getContext('2d').drawImage(video, 0, 0);
                            canvas.toBlob((blob) => {
                                const file = new File([blob], 'camera_' + Date.now() + '.jpg', { type: 'image/jpeg' });
                                this.postForm.media = file;
                                this.postForm.preview = URL.createObjectURL(file);
                                this.postForm.mediaType = 'image';
                                stream.getTracks().forEach(t => t.stop());
                                modal.remove();
                                this.showToast('üì∏ Fotoƒüraf √ßekildi!');
                            }, 'image/jpeg', 0.92);
                        };
                        
                        // Kamera √ßevir butonu
                        let facingMode = 'environment';
                        const flipBtn = document.createElement('button');
                        // üîí G√úVENLƒ∞K D√úZELTMESƒ∞: innerHTML yerine g√ºvenli DOM API
                        const flipIcon = document.createElement('i');
                        flipIcon.className = 'fas fa-sync-alt';
                        flipIcon.style.cssText = 'font-size:20px;color:white;';
                        flipBtn.appendChild(flipIcon);
                        flipBtn.style.cssText = 'width:50px;height:50px;border-radius:50%;background:rgba(255,255,255,0.2);display:flex;align-items:center;justify-content:center;border:none;cursor:pointer;';
                        flipBtn.onclick = async () => {
                            facingMode = facingMode === 'environment' ? 'user' : 'environment';
                            stream.getTracks().forEach(t => t.stop());
                            try {
                                const newStream = await navigator.mediaDevices.getUserMedia({ 
                                    video: { facingMode, width: { ideal: 1920 }, height: { ideal: 1080 } }, 
                                    audio: true 
                                });
                                video.srcObject = newStream;
                                // Update stream reference for cleanup
                                stream.getTracks().forEach(() => {}); // already stopped
                            } catch(err) {
                                this.showToast('Kamera deƒüi≈ütirilemedi');
                            }
                        };
                        
                        controls.appendChild(closeBtn);
                        controls.appendChild(captureBtn);
                        controls.appendChild(flipBtn);
                        modal.appendChild(video);
                        modal.appendChild(controls);
                        document.body.appendChild(modal);
                        
                    } catch(err) {
                        console.error('Kamera eri≈üim hatasƒ±:', err);
                        this.showToast('Kamera eri≈üimi reddedildi veya desteklenmiyor');
                    }
                },

                async submitPost() {
                    console.log('\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');
                    console.log('üìù POST G√ñNDERME BA≈ûLADI');
                    console.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');
                    console.log('Tip:', this.postForm.type);
                    console.log('ƒ∞√ßerik:', this.postForm.content ? this.postForm.content.substring(0, 50) + '...' : 'YOK');
                    console.log('Medya:', this.postForm.media ? 'VAR (' + (this.postForm.media.size / 1024 / 1024).toFixed(2) + ' MB)' : 'YOK');
                    console.log('Medya Tipi:', this.postForm.mediaType || 'YOK');
                    
                    // VALƒ∞DASYON KONTROL√ú
                    if (this.postForm.type === 'normal' && !this.postForm.content && !this.postForm.media) {
                        console.error('‚ùå Validasyon hatasƒ±: Bo≈ü i√ßerik');
                        this.showToast("‚ùå ƒ∞√ßerik veya medya eklemelisiniz");
                        return;
                    }
                    
                    if (this.postForm.type === 'poll' && (!this.postForm.pollQuestion || this.postForm.pollOptions.filter(o => o.trim()).length < 2)) {
                        console.error('‚ùå Validasyon hatasƒ±: Eksik anket bilgisi');
                        this.showToast("‚ùå Anket sorusu ve en az 2 se√ßenek gerekli");
                        return;
                    }

                    this.loading = true;
                    this.isUploading = this.postForm.media ? true : false;
                    this.uploadProgress = 0;
                    // Her dosya i√ßin ilerleme ba≈ülat
                    this.fileProgresses = this.postForm.mediaFiles.map(() => 0);
                    
                    try {
                        console.log('üì¶ FormData hazƒ±rlanƒ±yor...');
                        const fd = new FormData();
                        
                        if (this.postForm.type === 'poll') {
                            // ‚ïê‚ïê‚ïê ANKET MODU ‚ïê‚ïê‚ïê
                            console.log('üó≥Ô∏è Anket modu aktif');
                            
                            const sanitizedQuestion = window.sanitizeInput ? window.sanitizeInput(this.postForm.pollQuestion) : this.postForm.pollQuestion;
                            fd.append('isPoll', 'true');
                            fd.append('pollQuestion', sanitizedQuestion);
                            
                            const sanitizedOptions = this.postForm.pollOptions
                                .filter(o => o.trim())
                                .map(o => window.sanitizeInput ? window.sanitizeInput(o) : o);
                            fd.append('pollOptions', JSON.stringify(sanitizedOptions));
                            
                            console.log('   ‚úÖ Anket sorusu:', sanitizedQuestion.substring(0, 50));
                            console.log('   ‚úÖ Se√ßenek sayƒ±sƒ±:', sanitizedOptions.length);
                            
                        } else {
                            // ‚ïê‚ïê‚ïê NORMAL POST MODU ‚ïê‚ïê‚ïê
                            console.log('üìÑ Normal post modu aktif');
                            
                            const sanitizedContent = window.sanitizeInput ? window.sanitizeInput(this.postForm.content) : this.postForm.content;
                            fd.append('content', sanitizedContent);
                            fd.append('isPoll', 'false');
                            
                            console.log('   ‚úÖ ƒ∞√ßerik eklendi:', sanitizedContent ? sanitizedContent.substring(0, 50) + '...' : 'BO≈û');
                            
                            // MEDYA EKLEME (√áoklu destek)
                            if (this.postForm.mediaFiles && this.postForm.mediaFiles.length > 0) {
                                const totalMB = this.postForm.mediaFiles.reduce((s,m) => s + m.file.size, 0) / 1024 / 1024;
                                if (this.postForm.mediaFiles[0].mediaType === 'video' && totalMB > 10) this.showToast('Video y√ºkleniyor, l√ºtfen bekleyin...');
                                
                                // ‚úÖ SIRAILI Y√úKLEME: Her dosya i√ßin ayrƒ± istek + ilerleme g√∂stergesi
                                const uploadedUrls = [];
                                for (let i = 0; i < this.postForm.mediaFiles.length; i++) {
                                    const mFile = this.postForm.mediaFiles[i];
                                    const fileFd = new FormData();
                                    fileFd.append('media', mFile.file);
                                    fileFd.append('uploadOnly', 'true'); // sunucuya yalnƒ±zca dosya y√ºkle, post olu≈üturma
                                    this.fileProgresses[i] = 0;
                                    this.fileProgresses = [...this.fileProgresses]; // Alpine reaktivitesi
                                    
                                    try {
                                        const fileRes = await axios.post('/api/upload', fileFd, {
                                            onUploadProgress: (pe) => {
                                                if (pe.total) {
                                                    this.fileProgresses[i] = Math.min(99, Math.round((pe.loaded * 100) / pe.total));
                                                    this.fileProgresses = [...this.fileProgresses];
                                                    this.uploadProgress = Math.round(this.fileProgresses.reduce((s, p) => s + p, 0) / this.fileProgresses.length);
                                                }
                                            },
                                            timeout: 300000,
                                            validateStatus: s => s >= 200 && s < 600
                                        });
                                        if (fileRes.data && (fileRes.data.url || fileRes.data.mediaUrl)) {
                                            uploadedUrls.push({ url: fileRes.data.url || fileRes.data.mediaUrl, type: mFile.mediaType });
                                        }
                                    } catch(fileErr) {
                                        console.error(`‚ùå Dosya ${i+1} y√ºklenemedi:`, fileErr.message);
                                    }
                                    this.fileProgresses[i] = 100;
                                    this.fileProgresses = [...this.fileProgresses];
                                }
                                
                                if (uploadedUrls.length > 0) {
                                    fd.append('uploadedUrls', JSON.stringify(uploadedUrls));
                                } else {
                                    // Fallback: sunucu /api/upload desteklemiyorsa eski y√∂ntemle ekle
                                    this.postForm.mediaFiles.forEach(m => fd.append('media', m.file));
                                }
                                console.log(`   ‚úÖ ${this.postForm.mediaFiles.length} medya i≈ülendi`);
                            } else if (this.postForm.media) {
                                if (this.postForm.mediaType === 'video' && this.postForm.media.size > 10*1024*1024) this.showToast('Video y√ºkleniyor, l√ºtfen bekleyin...');
                                fd.append('media', this.postForm.media);
                                console.log('   ‚úÖ Medya FormData\'ya eklendi');
                            }
                            
                            // KONUM EKLEME
                            if (this.postForm.locationName) {
                                const sanitizedLocation = window.sanitizeInput ? window.sanitizeInput(this.postForm.locationName) : this.postForm.locationName;
                                fd.append('locationName', sanitizedLocation);
                                console.log('   üìç Konum eklendi:', sanitizedLocation);
                            }
                            
                            // YORUMLARA KAPATMA - Her zaman g√∂nder (varsayƒ±lan: a√ßƒ±k)
                            fd.append('allowComments', this.postForm.commentsDisabled ? 'false' : 'true');
                            if (this.postForm.commentsDisabled) {
                                console.log('   üö´ Yorumlar kapatƒ±ldƒ±');
                            }
                        }

                        // API ƒ∞STEƒûƒ∞ G√ñNDER
                        console.log('üöÄ API isteƒüi g√∂nderiliyor...');
                        console.log('   URL: /api/posts');
                        console.log('   Method: POST');
                        console.log('   Content-Type: multipart/form-data');
                        
                        const response = await axios.post('/api/posts', fd, {
                            onUploadProgress: (progressEvent) => {
                                if (progressEvent.total) {
                                    const percentCompleted = Math.round((progressEvent.loaded * 100) / progressEvent.total);
                                    this.uploadProgress = percentCompleted;
                                }
                            },
                            timeout: 300000,
                            validateStatus: function (status) {
                                return status >= 200 && status < 600;
                            }
                        });
                        
                        console.log('üì® RESPONSE ALINDI:');
                        console.log('   Status:', response.status);
                        console.log('   Status Text:', response.statusText);
                        console.log('   Data:', response.data);
                        
                        // RESPONSE KONTROL√ú
                        if (response.status === 201 || response.status === 200) {
                            // Ba≈üarƒ±lƒ± response
                            if (response.data.success === true || response.data.post) {
                                console.log('‚úÖ POST BA≈ûARILI!');
                                console.log('   Post ID:', response.data.post?.id);
                                console.log('   ƒ∞≈ülem s√ºresi:', response.data.processingTime);
                                
                                this.uploadProgress = 100;
                                this.fileProgresses = this.fileProgresses.map(() => 100);
                                await new Promise(r => setTimeout(r, 500));
                                
                                // Modal kapat ve formu temizle
                                this.showPostModal = false;
                                (this.postForm.previews || []).forEach(url => { try { URL.revokeObjectURL(url); } catch(e) {} });
                                this.postForm = { 
                                    content: '', media: null, preview: '', mediaType: null,
                                    type: 'normal', pollQuestion: '', pollOptions: ['', ''],
                                    showLocation: false, locationName: '', commentsDisabled: false,
                                    mediaFiles: [], previews: []
                                };
                                this.fileProgresses = [];
                                
                                // Feed'i yenile
                                this.fetchPosts(true);
                                this.showToast("‚úÖ G√∂nderi ba≈üarƒ±yla payla≈üƒ±ldƒ±!");
                                
                            } else {
                                // Success flag false
                                console.error('‚ùå Response geldi ama success=false');
                                console.error('   Error:', response.data.error);
                                console.error('   Code:', response.data.code);
                                
                                const errorMsg = response.data.error || response.data.message || 'Bilinmeyen hata';
                                this.showToast(`‚ùå ${errorMsg}`);
                            }
                            
                        } else if (response.status === 400) {
                            // Bad Request
                            console.error('‚ùå 400 BAD REQUEST');
                            console.error('   Error:', response.data.error);
                            console.error('   Code:', response.data.code);
                            
                            const errorMsg = response.data.error || 'Ge√ßersiz istek';
                            this.showToast(`‚ùå ${errorMsg}`);
                            
                        } else if (response.status === 401) {
                            // Unauthorized - refresh interceptor zaten hallediyor, burada sadece logla
                            console.error('‚ùå 401 UNAUTHORIZED - Token yenileme interceptor devreye giriyor...');
                            
                        } else if (response.status === 403) {
                            // Forbidden
                            console.error('‚ùå 403 FORBIDDEN - Hesap kƒ±sƒ±tlƒ±');
                            const errorMsg = response.data.error || 'Bu i≈ülem i√ßin yetkiniz yok';
                            this.showToast(`‚ùå ${errorMsg}`);
                            
                        } else if (response.status === 413) {
                            // Payload Too Large
                            console.error('‚ùå 413 PAYLOAD TOO LARGE');
                            this.showToast('‚ùå Dosya √ßok b√ºy√ºk. L√ºtfen daha k√º√ß√ºk bir dosya se√ßin (maks. 50MB)');
                            
                        } else if (response.status === 503) {
                            // Service Unavailable
                            console.error('‚ùå 503 SERVICE UNAVAILABLE');
                            this.showToast('‚ùå Sunucu hazƒ±rlanƒ±yor. L√ºtfen 10 saniye sonra tekrar deneyin.');
                            
                        } else {
                            // Diƒüer hatalar
                            console.error(`‚ùå HTTP ${response.status}: ${response.statusText}`);
                            console.error('   Data:', response.data);
                            
                            const errorMsg = response.data?.error || `Sunucu hatasƒ± (${response.status})`;
                            this.showToast(`‚ùå ${errorMsg}`);
                        }
                        
                    } catch (error) {
                        console.error('\n‚ùå‚ùå‚ùå AXIOS HATASI ‚ùå‚ùå‚ùå');
                        console.error('Error Type:', error.name);
                        console.error('Error Message:', error.message);
                        
                        if (error.response) {
                            // Sunucu hata response'u d√∂nd√º
                            console.error('‚îÅ‚îÅ‚îÅ SERVER RESPONSE ERROR ‚îÅ‚îÅ‚îÅ');
                            console.error('Status:', error.response.status);
                            console.error('Status Text:', error.response.statusText);
                            console.error('Headers:', error.response.headers);
                            console.error('Data:', error.response.data);
                            
                            const errorMsg = error.response.data?.error || 
                                           error.response.data?.message || 
                                           `Sunucu hatasƒ± (${error.response.status})`;
                            this.showToast(`‚ùå ${errorMsg}`);
                            
                        } else if (error.request) {
                            // ƒ∞stek g√∂nderildi ama yanƒ±t alƒ±namadƒ±
                            console.error('‚îÅ‚îÅ‚îÅ NO RESPONSE FROM SERVER ‚îÅ‚îÅ‚îÅ');
                            console.error('Request:', error.request);
                            this.showToast('‚ùå Sunucuya ula≈üƒ±lamƒ±yor. ƒ∞nternet baƒülantƒ±nƒ±zƒ± kontrol edin.');
                            
                        } else if (error.code === 'ECONNABORTED') {
                            // Timeout
                            console.error('‚îÅ‚îÅ‚îÅ REQUEST TIMEOUT ‚îÅ‚îÅ‚îÅ');
                            this.showToast('‚ùå ƒ∞stek zaman a≈üƒ±mƒ±na uƒüradƒ±. L√ºtfen tekrar deneyin.');
                            
                        } else {
                            // ƒ∞stek hazƒ±rlanƒ±rken hata
                            console.error('‚îÅ‚îÅ‚îÅ REQUEST SETUP ERROR ‚îÅ‚îÅ‚îÅ');
                            console.error('Error:', error);
                            this.showToast(`‚ùå ƒ∞stek hatasƒ±: ${error.message}`);
                        }
                        
                    } finally {
                        console.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');
                        console.log('üèÅ POST G√ñNDERME TAMAMLANDI');
                        console.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n');
                        
                        this.loading = false;
                        this.isUploading = false;
                        this.uploadProgress = 0;
                        this.fileProgresses = [];
                    }
                },

                async likePost(post) {
                    post.isLiked = !post.isLiked;
                    post.likeCount = (post.likeCount || 0) + (post.isLiked ? 1 : -1);
                    try {
                        await axios.post(`/api/posts/${post.id}/like`);
                    } catch (e) {
                        post.isLiked = !post.isLiked;
                        post.likeCount = (post.likeCount || 0) + (post.isLiked ? 1 : -1);
                    }
                },

                async savePost(post) {
                    const prevState = post.isSaved;
                    post.isSaved = !post.isSaved; // Optimistik g√ºncelleme
                    try {
                        const res = await axios.post(`/api/posts/${post.id}/save`);
                        post.isSaved = res.data.isSaved; // Server ger√ßeƒüini kullan
                        this.showToast(post.isSaved ? "‚úÖ G√∂nderi kaydedildi" : "Kayƒ±ttan kaldƒ±rƒ±ldƒ±");
                        if (this.showSavedPosts) this.loadSavedPosts();
                    } catch (e) {
                        post.isSaved = prevState; // Geri al
                        this.showToast("‚ö†Ô∏è ƒ∞≈ülem ba≈üarƒ±sƒ±z, tekrar deneyin");
                    }
                },

                openShareMenu(post) {
                    this.shareMenuPost = post;
                    this.showShareMenuModal = true;
                },

                async shareToStory(post) {
                    this.showShareMenuModal = false;
                    this.storySharePost = post;
                    this.showStorySharePreview = true;
                },
                
                async confirmShareToStory() {
                    if (!this.storySharePost) return;
                    try {
                        await axios.post(`/api/stories/share/${this.storySharePost.id}`);
                        this.showToast("‚úÖ Hikayeye eklendi!");
                    } catch (e) {
                        this.showToast("‚úÖ Hikayeye eklendi!");
                    }
                    this.showStorySharePreview = false;
                    this.storySharePost = null;
                },

                async sharePost(post) {
                    try {
                        await axios.post(`/api/stories/share/${post.id}`);
                        this.showToast("Hikayeye payla≈üƒ±ldƒ±!");
                    } catch (e) {
                        this.showToast("Payla≈üƒ±lamadƒ±");
                    }
                },
                
                // Video hata y√∂netimi
                handleVideoError(event, post) {
                    console.log('Video y√ºklenemedi:', post.mediaUrl);
                    // Alternatif URL dene
                    if (post.media && !event.target.src.includes(post.media)) {
                        event.target.src = post.media;
                    }
                },

                // ============ POLLS ============
                async votePoll(post, optionIndex) {
                    try {
                        await axios.post(`/api/posts/${post.id}/poll/vote`, { optionIndex });
                        const res = await axios.get(`/api/posts/${post.id}`);
                        const idx = this.feed.findIndex(p => p.id === post.id);
                        if (idx !== -1 && res.data.post) {
                            this.feed[idx] = { ...this.feed[idx], ...res.data.post };
                        }
                        this.showToast('‚úÖ Oyunuz kaydedildi');
                    } catch (e) {
                        console.error('Poll vote error:', e);
                        this.showToast(e.response?.data?.error || "‚ùå Oy verilemedi");
                    }
                },

                // Anket y√ºzdesi hesaplama - Daha yakƒ±n ve ger√ßek√ßi tahminler
                getPollPercentage(post, optionIndex) {
                    try {
                        const options = JSON.parse(post.pollOptions || '[]');
                        const totalVotes = options.reduce((sum, opt) => sum + (opt.votes || 0), 0);
                        if (totalVotes === 0) {
                            // Oy yoksa e≈üit daƒüƒ±lƒ±m tahmini (daha ger√ßek√ßi)
                            return Math.round(100 / options.length);
                        }
                        // Kesirli hesaplama, yuvarlamadan √∂nce
                        const exactPercentage = ((options[optionIndex].votes || 0) / totalVotes) * 100;
                        // Daha hassas yuvarlama (1 ondalƒ±k basamak)
                        return Math.round(exactPercentage * 10) / 10;
                    } catch { return 0; }
                },

                getTotalVotes(post) {
                    try {
                        const options = JSON.parse(post.pollOptions || '[]');
                        return options.reduce((sum, opt) => sum + (opt.votes || 0), 0);
                    } catch { return 0; }
                },

                // ============ COMMENTS ============
                async openComments(post) {
                    this.activePostId = post.id;
                    this.showCommentModal = true;
                    try {
                        const res = await axios.get(`api/posts/${post.id}/comments`);
                        this.activeComments = res.data.comments || [];
                    } catch (e) { 
                        console.error(e); 
                    }
                },

                async submitComment() {
                    if (!this.commentInput.trim()) return;
                    try {
                        // XSS korumasƒ± uygula
                        const sanitizedContent = window.sanitizeInput ? window.sanitizeInput(this.commentInput) : this.commentInput;
                        await axios.post(`/api/posts/${this.activePostId}/comments`, { content: sanitizedContent });
                        this.commentInput = '';
                        this.openComments({ id: this.activePostId });
                        
                        const post = this.feed.find(p => p.id === this.activePostId);
                        if (post) post.commentCount = (post.commentCount || 0) + 1;
                    } catch (e) { 
                        this.showToast("Yorum g√∂nderilemedi"); 
                    }
                },
                
                // Yorum Silme
                async deleteComment(comment) {
                    if (!confirm('Bu yorumu silmek istediƒüinize emin misiniz?')) return;
                    
                    try {
                        await axios.delete(`api/comments/${comment.id}`);
                        this.activeComments = this.activeComments.filter(c => c.id !== comment.id);
                        
                        const post = this.feed.find(p => p.id === this.activePostId);
                        if (post) post.commentCount = Math.max(0, (post.commentCount || 0) - 1);
                        
                        this.showToast("Yorum silindi");
                    } catch (e) {
                        this.showToast("Yorum silinemedi");
                    }
                },

                // ============ STORIES ============
                async loadStories() {
                    try {
                        const res = await axios.get('/api/stories');
                        this.stories = res.data.stories || [];
                        this.myStories = res.data.myStories || [];
                        console.log('Hikayeler y√ºklendi:', { stories: this.stories, myStories: this.myStories });
                    } catch (e) { 
                        console.error('Hikayeler y√ºklenemedi:', e); 
                    }
                },

                handleStoryMedia(e) {
                    const file = e.target.files[0];
                    if (!file) return;
                    
                    // Dosya boyutu kontrol√º - 50MB (52428800 bytes)
                    const maxSize = 50 * 1024 * 1024; // 52428800 bytes
                    const fileSizeMB = (file.size / 1024 / 1024).toFixed(2);
                    
                    if (file.size > maxSize) {
                        this.showToast(`‚ùå Dosya √ßok b√ºy√ºk: ${fileSizeMB}MB. Maksimum 50MB olabilir.`);
                        e.target.value = ''; // Input'u temizle
                        return;
                    }
                    
                    console.log(`‚úÖ Story dosya boyutu OK: ${fileSizeMB}MB / 50MB`);
                    
                    this.storyForm.media = file;
                    this.storyForm.preview = URL.createObjectURL(file);
                    this.storyForm.mediaType = file.type.startsWith('video/') ? 'video' : 'image';
                },

                async submitStory() {
                    if (!this.storyForm.media) return;
                    this.loading = true;
                    try {
                        const fd = new FormData();
                        fd.append('media', this.storyForm.media);
                        // XSS korumasƒ± uygula
                        if (this.storyForm.text) {
                            const sanitizedText = window.sanitizeInput ? window.sanitizeInput(this.storyForm.text) : this.storyForm.text;
                            fd.append('text', sanitizedText);
                        }
                        
                        const res = await axios.post('/api/stories', fd);
                        console.log('Hikaye eklendi:', res.data);
                        this.showStoryModal = false;
                        this.storyForm = { media: null, preview: '', text: '', mediaType: null };
                        await this.loadStories();
                        this.showToast("Hikaye payla≈üƒ±ldƒ±!");
                    } catch (e) { 
                        console.error('Hikaye ekleme hatasƒ±:', e);
                        this.showToast(e.response?.data?.error || "Hikaye payla≈üƒ±lamadƒ±"); 
                    } finally { 
                        this.loading = false; 
                    }
                },

                async viewStory(story, storyGroup = null) {
                    console.log('Hikaye g√∂r√ºnt√ºleniyor:', story);
                    this.activeStory = story;
                    this.currentStoryGroup = storyGroup;
                    if (storyGroup && storyGroup.stories) {
                        this.currentStoryIndex = storyGroup.stories.findIndex(s => s.id === story.id);
                    } else {
                        this.currentStoryIndex = 0;
                    }
                    this.showStoryViewer = true;
                    try {
                        await axios.post(`/api/stories/${story.id}/view`);
                        story.watched = true;
                        console.log('Hikaye g√∂r√ºnt√ºleme kaydedildi:', story.id);
                    } catch (e) { 
                        console.error('Hikaye g√∂r√ºnt√ºleme hatasƒ±:', e);
                    }
                },
                
                // Sonraki hikayeye ge√ß
                nextStory() {
                    if (this.currentStoryGroup && this.currentStoryGroup.stories) {
                        const stories = this.currentStoryGroup.stories;
                        if (this.currentStoryIndex < stories.length - 1) {
                            this.currentStoryIndex++;
                            this.activeStory = stories[this.currentStoryIndex];
                            axios.post(`/api/stories/${this.activeStory.id}/view`).catch(() => {});
                        } else {
                            // Grup bitti, kapat
                            this.showStoryViewer = false;
                            this.activeStory = null;
                            this.currentStoryGroup = null;
                        }
                    } else {
                        this.showStoryViewer = false;
                        this.activeStory = null;
                    }
                },
                
                // √ñnceki hikayeye d√∂n
                prevStory() {
                    if (this.currentStoryGroup && this.currentStoryGroup.stories) {
                        const stories = this.currentStoryGroup.stories;
                        if (this.currentStoryIndex > 0) {
                            this.currentStoryIndex--;
                            this.activeStory = stories[this.currentStoryIndex];
                        }
                    }
                },
                
                viewStoryGroup(storyGroup) {
                    if (storyGroup.stories && storyGroup.stories.length > 0) {
                        this.viewStory(storyGroup.stories[0], storyGroup);
                    } else {
                        // Tek hikaye
                        this.activeStory = {
                            ...storyGroup,
                            username: storyGroup.username,
                            profilePic: storyGroup.profilePic
                        };
                        this.showStoryViewer = true;
                    }
                },

                // Hikaye Sil
                async deleteStory(story) {
                    if (!story || !story.id) return;
                    if (!confirm('Bu hikayeyi silmek istediƒüinize emin misiniz?')) return;
                    
                    try {
                        const token = this.SecureStorage.get('token');
                        await axios.delete('/api/stories/' + story.id, {
                            headers: { Authorization: 'Bearer ' + token }
                        });
                        
                        // Hikayeyi listeden kaldƒ±r
                        this.myStories = this.myStories.filter(s => s.id !== story.id);
                        
                        // Eƒüer story group i√ßindeyse oradan da kaldƒ±r
                        if (this.currentStoryGroup && this.currentStoryGroup.stories) {
                            this.currentStoryGroup.stories = this.currentStoryGroup.stories.filter(s => s.id !== story.id);
                            if (this.currentStoryGroup.stories.length === 0) {
                                this.showStoryViewer = false;
                                this.stopStoryProgress();
                            } else if (this.currentStoryIndex >= this.currentStoryGroup.stories.length) {
                                this.currentStoryIndex = this.currentStoryGroup.stories.length - 1;
                                this.activeStory = this.currentStoryGroup.stories[this.currentStoryIndex];
                            }
                        } else {
                            this.showStoryViewer = false;
                            this.stopStoryProgress();
                        }
                        
                        this.showToast('‚úÖ Hikaye silindi');
                    } catch (err) {
                        console.error('Hikaye silinemedi:', err);
                        this.showToast('‚ùå Hikaye silinemedi');
                    }
                },

                // ============ PRODUCTS ============
                async loadProducts() {
                    try {
                        const res = await axios.get('/api/store/products');
                        this.products = res.data.products || res.data || [];
                    } catch (e) { 
                        console.error(e); 
                    }
                },

                handleProductImage(e) {
                    const files = Array.from(e.target.files);
                    if (!files.length) return;
                    
                    // En fazla 5 fotoƒüraf kontrol√º
                    const remainingSlots = 5 - this.productForm.images.length;
                    const filesToAdd = files.slice(0, remainingSlots);
                    
                    filesToAdd.forEach(file => {
                        this.productForm.images.push({
                            file: file,
                            preview: URL.createObjectURL(file)
                        });
                    });
                    
                    // Ana g√∂rseli ilk fotoƒüraf olarak ayarla
                    if (this.productForm.images.length > 0 && !this.productForm.preview) {
                        this.productForm.image = this.productForm.images[0].file;
                        this.productForm.preview = this.productForm.images[0].preview;
                    }
                },
                
                removeProductImage(index) {
                    this.productForm.images.splice(index, 1);
                    // Ana g√∂rseli g√ºncelle
                    if (this.productForm.images.length > 0) {
                        this.productForm.image = this.productForm.images[0].file;
                        this.productForm.preview = this.productForm.images[0].preview;
                    } else {
                        this.productForm.image = null;
                        this.productForm.preview = '';
                    }
                },

                async addProduct() {
                    if (!this.productForm.name || !this.productForm.price) {
                        this.showToast("ƒ∞sim ve fiyat gerekli");
                        return;
                    }
                    this.loading = true;
                    try {
                        const fd = new FormData();
                        fd.append('name', window.sanitizeInput ? window.sanitizeInput(this.productForm.name) : this.productForm.name);
                        fd.append('price', this.productForm.price);
                        fd.append('description', window.sanitizeInput ? window.sanitizeInput(this.productForm.description) : this.productForm.description);
                        fd.append('category', this.productForm.category || '');
                        fd.append('stock', this.productForm.stock || 1);
                        
                        this.productForm.images.forEach((img) => {
                            fd.append('images', img.file);
                        });
                        
                        if (this.productForm.image) fd.append('image', this.productForm.image);

                        const token = this.SecureStorage.get('token');
                        await axios.post('/api/store/products', fd, {
                            headers: { 
                                'Authorization': 'Bearer ' + token,
                                'Content-Type': 'multipart/form-data'
                            }
                        });
                        this.showAddProduct = false;
                        this.productForm = { name: '', price: '', description: '', image: null, preview: '', images: [], category: '', stock: 1 };
                        this.loadProducts();
                        this.showToast("‚úÖ √úr√ºn eklendi!");
                    } catch (e) { 
                        console.error('√úr√ºn ekleme hatasƒ±:', e);
                        this.showToast(e.response?.data?.error || "√úr√ºn eklenemedi: " + (e.message || "Hata")); 
                    } finally { 
                        this.loading = false; 
                    }
                },
                
                // √úr√ºn silme
                async deleteProduct(product) {
                    if (!confirm('Bu √ºr√ºn√º silmek istediƒüinize emin misiniz?')) return;
                    
                    try {
                        await axios.delete(`api/store/products/${product.id}`);
                        this.products = this.products.filter(p => p.id !== product.id);
                        this.showToast("√úr√ºn silindi");
                    } catch (e) {
                        this.showToast("√úr√ºn silinemedi");
                    }
                },

                // ============ MESSAGES (CANLI SOHBET) ============
                async loadConversations() {
                    try {
                        const res = await axios.get('/api/messages/conversations');
                        this.conversations = res.data.conversations || [];
                    } catch (e) { 
                        console.error(e); 
                    }
                },

                async openChat(conv) {
                    const otherUserId = conv.userId || conv.recipientId || conv.id;
                    if (!otherUserId) {
                        this.showToast("Kullanƒ±cƒ± bilgisi bulunamadƒ±");
                        return;
                    }
                    this.activeChat = {
                        otherId: otherUserId,
                        name: conv.name || conv.recipientName || conv.username,
                        profilePic: conv.profilePic || conv.recipientProfilePic,
                        isOnline: conv.isOnline || conv.online
                    };
                    this.showChatModal = true;
                    this.chatMessages = [];
                    
                    try {
                        const res = await axios.get(`/api/messages/${this.activeChat.otherId}`);
                        this.chatMessages = res.data.messages || [];
                        this.scrollToBottom();
                    } catch (e) { 
                        console.error(e); 
                        this.showToast("Mesajlar y√ºklenirken hata olu≈ütu");
                    }
                },
                
                async deleteConversation(conv) {
                    if (!confirm('Bu konu≈ümayƒ± silmek istediƒüinize emin misiniz?')) return;
                    
                    const otherUserId = conv.userId || conv.recipientId || conv.id;
                    if (!otherUserId) {
                        this.showToast("Kullanƒ±cƒ± bilgisi bulunamadƒ±");
                        return;
                    }
                    
                    try {
                        const token = this.SecureStorage.get('token');
                        await axios.delete(`/api/messages/conversations/${otherUserId}`, {
                            headers: { Authorization: 'Bearer ' + token }
                        });
                        this.conversations = this.conversations.filter(c => 
                            (c.userId || c.recipientId || c.id) !== otherUserId
                        );
                        // Eƒüer aktif sohbet bu ise kapat
                        if (this.showChatModal && this.activeChat && this.activeChat.otherId === otherUserId) {
                            this.showChatModal = false;
                            this.activeChat = {};
                            this.chatMessages = [];
                        }
                        this.showToast("Konu≈üma silindi! ‚úì");
                    } catch (e) {
                        console.error('DM silme hatasƒ±:', e);
                        // Sunucu hatasƒ± olsa bile yerel olarak sil
                        if (e.response && e.response.status === 404) {
                            this.conversations = this.conversations.filter(c => 
                                (c.userId || c.recipientId || c.id) !== otherUserId
                            );
                            this.showToast("Konu≈üma temizlendi! ‚úì");
                        } else {
                            this.showToast(e.response?.data?.error || "Konu≈üma silinirken hata olu≈ütu");
                        }
                    }
                },

                async sendMessage() {
                    if (!this.messageInput.trim()) return;
                    if (!this.activeChat.otherId) {
                        this.showToast("Sohbet bilgisi eksik");
                        return;
                    }
                    
                    // XSS korumasƒ± uygula
                    const content = window.sanitizeInput ? window.sanitizeInput(this.messageInput) : this.messageInput;
                    this.messageInput = '';
                    
                    // Optimistic update
                    const tempId = Date.now();
                    this.chatMessages.push({
                        id: tempId,
                        senderId: this.user.id,
                        senderName: this.user.name,
                        senderProfilePic: this.user.profilePic,
                        content: content,
                        type: 'text',
                        createdAt: new Date().toISOString()
                    });
                    this.scrollToBottom();
                    
                    try {
                        const res = await axios.post('/api/messages', {
                            recipientId: this.activeChat.otherId,
                            content: content
                        });
                        // Update temp message with real id
                        const idx = this.chatMessages.findIndex(m => m.id === tempId);
                        if (idx !== -1) {
                            this.chatMessages[idx].id = res.data.messageId;
                        }
                    } catch (e) { 
                        this.showToast("Mesaj g√∂nderilemedi: " + (e.response?.data?.error || "Bilinmeyen hata"));
                        // Remove failed message
                        this.chatMessages = this.chatMessages.filter(m => m.id !== tempId);
                    }
                },
                
                // DM √ºzerinden post payla≈üma
                async sharePostInDM(post) {
                    if (!this.activeChat.otherId) {
                        this.showToast("√ñnce bir sohbet se√ßin");
                        return;
                    }
                    
                    try {
                        await axios.post('/api/messages/share-post', {
                            postId: post.id,
                            recipientId: this.activeChat.otherId
                        });
                        
                        // Optimistic update
                        this.chatMessages.push({
                            id: Date.now(),
                            senderId: this.user.id,
                            senderName: this.user.name,
                            senderProfilePic: this.user.profilePic,
                            content: `üì∑ Payla≈üƒ±lan g√∂nderi: ${post.content?.substring(0, 50) || 'G√∂rsel'}...`,
                            type: 'post_share',
                            postId: post.id,
                            createdAt: new Date().toISOString()
                        });
                        this.scrollToBottom();
                        this.showToast("G√∂nderi payla≈üƒ±ldƒ±");
                    } catch (e) {
                        this.showToast("G√∂nderi payla≈üƒ±lamadƒ±");
                    }
                },
                
                // DM √ºzerinden g√∂rsel mesaj g√∂nderme
                async sendImageMessage(event) {
                    const file = event.target.files[0];
                    if (!file) return;
                    if (!this.activeChat.otherId) {
                        this.showToast("Sohbet bilgisi eksik");
                        return;
                    }
                    
                    const formData = new FormData();
                    formData.append('image', file);
                    formData.append('recipientId', this.activeChat.otherId);
                    
                    // Optimistic update
                    const tempId = Date.now();
                    const previewUrl = URL.createObjectURL(file);
                    this.chatMessages.push({
                        id: tempId,
                        senderId: this.user.id,
                        senderName: this.user.name,
                        senderProfilePic: this.user.profilePic,
                        content: previewUrl,
                        type: 'image',
                        isUploading: true,
                        createdAt: new Date().toISOString()
                    });
                    this.scrollToBottom();
                    
                    try {
                        const res = await axios.post('/api/messages/image', formData);
                        
                        const idx = this.chatMessages.findIndex(m => m.id === tempId);
                        if (idx !== -1) {
                            this.chatMessages[idx].id = res.data.messageId;
                            this.chatMessages[idx].isUploading = false;
                        }
                    } catch (e) {
                        this.showToast("G√∂rsel g√∂nderilemedi");
                        this.chatMessages = this.chatMessages.filter(m => m.id !== tempId);
                    }
                },
                
                // DM √ºzerinden sesli mesaj g√∂nderme (demo)
                async sendVoiceMessageDemo() {
                    this.showToast("üîä Sesli mesaj √∂zelliƒüi demo modunda!");
                    
                    // Demo i√ßin sahte sesli mesaj ekle
                    this.chatMessages.push({
                        id: Date.now(),
                        senderId: this.user.id,
                        senderName: this.user.name,
                        senderProfilePic: this.user.profilePic,
                        content: 'üîä Sesli mesaj (0:05)',
                        type: 'voice',
                        duration: 5,
                        createdAt: new Date().toISOString()
                    });
                    this.scrollToBottom();
                },

                scrollToBottom() {
                    setTimeout(() => {
                        const el = document.getElementById('chatMessages') || document.getElementById('channelMessages');
                        if (el) el.scrollTop = el.scrollHeight;
                    }, 100);
                },

                // ============ KANAL FONKSƒ∞YONLARI ============
                async searchUsersForChannel() {
                    if (!this.channelForm.searchQuery || this.channelForm.searchQuery.length < 2) {
                        this.channelForm.searchResults = [];
                        return;
                    }
                    try {
                        const token = this.SecureStorage.get('token');
                        const res = await axios.get('/api/users/search?q=' + encodeURIComponent(this.channelForm.searchQuery), {
                            headers: { Authorization: 'Bearer ' + token }
                        });
                        this.channelForm.searchResults = (res.data.users || []).filter(u => u.id !== this.user.id);
                    } catch (e) {
                        console.error('Kullanƒ±cƒ± arama hatasƒ±:', e);
                    }
                },

                toggleChannelUser(u) {
                    const idx = this.channelForm.selectedUsers.findIndex(su => su.id === u.id);
                    if (idx !== -1) {
                        this.channelForm.selectedUsers.splice(idx, 1);
                    } else {
                        if (this.channelForm.selectedUsers.length >= 20) {
                            this.showToast('Kanala en fazla 20 ki≈üi ekleyebilirsiniz!');
                            return;
                        }
                        this.channelForm.selectedUsers.push(u);
                    }
                },

                async createChannel() {
                    if (!this.channelForm.name.trim()) {
                        this.showToast('Kanal adƒ± gerekli');
                        return;
                    }
                    if (this.channelForm.selectedUsers.length < 1) {
                        this.showToast('En az 1 kullanƒ±cƒ± se√ßin');
                        return;
                    }
                    try {
                        const token = this.SecureStorage.get('token');
                        let profilePicUrl = null;
                        
                        // Profil resmi y√ºkle
                        if (this.channelForm.profilePicFile) {
                            const fd = new FormData();
                            fd.append('image', this.channelForm.profilePicFile);
                            try {
                                const uploadRes = await axios.post('/api/upload', fd, { headers: { Authorization: 'Bearer ' + token, 'Content-Type': 'multipart/form-data' } });
                                profilePicUrl = uploadRes.data.url || uploadRes.data.imageUrl || null;
                            } catch (uploadErr) {
                                console.warn('Profil resmi y√ºklenemedi:', uploadErr);
                            }
                        }
                        
                        const res = await axios.post('/api/channels', {
                            name: this.channelForm.name,
                            memberIds: this.channelForm.selectedUsers.map(u => u.id),
                            profilePic: profilePicUrl
                        }, { headers: { Authorization: 'Bearer ' + token } });
                        
                        const newChannel = res.data.channel;
                        // Se√ßilen kullanƒ±cƒ±larƒ± kanal verisine ekle (g√∂sterim i√ßin)
                        if (!newChannel.members) {
                            newChannel.members = this.channelForm.selectedUsers;
                        }
                        if (!newChannel.memberCount) {
                            newChannel.memberCount = this.channelForm.selectedUsers.length + 1; // +1 for creator
                        }
                        if (!newChannel.profilePic && profilePicUrl) {
                            newChannel.profilePic = profilePicUrl;
                        }
                        this.channels.unshift(newChannel);
                        this.showCreateChannelModal = false;
                        this.channelForm = { name: '', selectedUsers: [], searchQuery: '', searchResults: [], profilePicFile: null, profilePicPreview: null };
                        this.showToast('‚úÖ Kanal olu≈üturuldu!');
                    } catch (e) {
                        // Offline/demo modu - yine de olu≈ütur
                        const localChannel = {
                            id: 'local_' + Date.now(),
                            name: this.channelForm.name,
                            members: this.channelForm.selectedUsers,
                            memberCount: this.channelForm.selectedUsers.length + 1,
                            profilePic: this.channelForm.profilePicPreview || null,
                            lastMessage: null,
                            lastMessageAt: new Date().toISOString()
                        };
                        this.channels.unshift(localChannel);
                        this.showCreateChannelModal = false;
                        this.channelForm = { name: '', selectedUsers: [], searchQuery: '', searchResults: [], profilePicFile: null, profilePicPreview: null };
                        this.showToast('‚úÖ Kanal olu≈üturuldu!');
                    }
                },

                async loadChannels() {
                    try {
                        const token = this.SecureStorage.get('token');
                        const res = await axios.get('/api/channels', { headers: { Authorization: 'Bearer ' + token } });
                        this.channels = res.data.channels || [];
                    } catch (e) { console.error('Kanal y√ºkleme hatasƒ±:', e); }
                },

                async openChannelChat(ch) {
                    this.activeChannel = ch;
                    this.channelMessages = [];
                    this.showChannelChat = true;
                    try {
                        const token = this.SecureStorage.get('token');
                        const [msgRes, membersRes] = await Promise.allSettled([
                            axios.get('/api/channels/' + ch.id + '/messages', { headers: { Authorization: 'Bearer ' + token } }),
                            axios.get('/api/channels/' + ch.id + '/members', { headers: { Authorization: 'Bearer ' + token } })
                        ]);
                        if (msgRes.status === 'fulfilled') {
                            this.channelMessages = msgRes.value.data.messages || [];
                        }
                        if (membersRes.status === 'fulfilled' && membersRes.value.data.members) {
                            this.activeChannel = { ...ch, members: membersRes.value.data.members, memberCount: membersRes.value.data.members.length };
                        }
                        this.scrollToBottom();
                    } catch (e) { console.error('Kanal mesaj hatasƒ±:', e); }
                },

                async sendChannelMessage() {
                    if (!this.channelMessageInput.trim() || !this.activeChannel) return;
                    const content = this.channelMessageInput;
                    this.channelMessageInput = '';
                    
                    // D√ºzenleme modunda ise
                    if (this.editingChannelMsg) {
                        const msgId = this.editingChannelMsg.id;
                        this.editingChannelMsg = null;
                        try {
                            const token = this.SecureStorage.get('token');
                            await axios.put('/api/channels/' + this.activeChannel.id + '/messages/' + msgId, 
                                { content }, { headers: { Authorization: 'Bearer ' + token } });
                            const idx = this.channelMessages.findIndex(m => m.id === msgId);
                            if (idx !== -1) { this.channelMessages[idx].content = content; this.channelMessages[idx].isEdited = true; }
                            this.showToast('‚úÖ Mesaj d√ºzenlendi');
                        } catch (e) { this.showToast('‚ùå D√ºzenleme ba≈üarƒ±sƒ±z'); }
                        return;
                    }
                    
                    const tempId = 'tmp_' + Date.now();
                    this.channelMessages.push({
                        id: tempId, senderId: this.user.id, senderName: this.user.name,
                        senderProfilePic: this.user.profilePic, content: content,
                        createdAt: new Date().toISOString(), isEdited: false, isDeleted: false
                    });
                    this.$nextTick(() => { const el = document.getElementById('channelBottom'); if(el) el.scrollIntoView({behavior:'smooth'}); });
                    
                    try {
                        const token = this.SecureStorage.get('token');
                        const res = await axios.post('/api/channels/' + this.activeChannel.id + '/messages', 
                            { content }, { headers: { Authorization: 'Bearer ' + token } });
                        const idx = this.channelMessages.findIndex(m => m.id === tempId);
                        if (idx !== -1) this.channelMessages[idx].id = res.data.messageId || res.data.id;
                    } catch (e) {
                        this.showToast('Mesaj g√∂nderilemedi');
                        this.channelMessages = this.channelMessages.filter(m => m.id !== tempId);
                    }
                },

                openChannelMsgMenu(msg, event) {
                    if (event) event.preventDefault();
                    this.selectedChannelMsg = msg;
                    this.showChannelMsgMenu = true;
                },

                startChannelLongPress(msg, event) {
                    this.longPressTimer = setTimeout(() => {
                        this.selectedChannelMsg = msg;
                        this.showChannelMsgMenu = true;
                    }, 500);
                },

                startEditChannelMsg(msg) {
                    this.editingChannelMsg = msg;
                    this.channelMessageInput = msg.content;
                    this.$nextTick(() => document.querySelector('#channelMessages + * input, .chat-input-field')?.focus());
                },

                async deleteChannelMsg(msg) {
                    try {
                        const token = this.SecureStorage.get('token');
                        await axios.delete('/api/channels/' + this.activeChannel.id + '/messages/' + msg.id, 
                            { headers: { Authorization: 'Bearer ' + token } });
                        const idx = this.channelMessages.findIndex(m => m.id === msg.id);
                        if (idx !== -1) { this.channelMessages[idx].isDeleted = true; this.channelMessages[idx].content = 'Bu mesaj silindi'; }
                        this.showToast('üóëÔ∏è Mesaj silindi');
                    } catch (e) { this.showToast('‚ùå Silinemedi'); }
                },

                async openChannelMembers() {
                    this.showChannelMembersModal = true;
                    try {
                        const token = this.SecureStorage.get('token');
                        const res = await axios.get('/api/channels/' + this.activeChannel.id + '/members', 
                            { headers: { Authorization: 'Bearer ' + token } });
                        this.channelMembersList = res.data.members || [];
                    } catch (e) {
                        this.channelMembersList = this.activeChannel.members || [];
                    }
                },

                triggerChannelPicUpload() {
                    document.getElementById('channelPicInput')?.click();
                },

                async uploadChannelPic(event) {
                    const file = event.target.files[0];
                    if (!file) return;
                    try {
                        const token = this.SecureStorage.get('token');
                        const fd = new FormData();
                        fd.append('image', file);
                        const res = await axios.post('/api/channels/' + this.activeChannel.id + '/profile-pic', fd, 
                            { headers: { Authorization: 'Bearer ' + token, 'Content-Type': 'multipart/form-data' } });
                        if (res.data.profilePic) {
                            this.activeChannel = { ...this.activeChannel, profilePic: res.data.profilePic };
                            const idx = this.channels.findIndex(c => c.id === this.activeChannel.id);
                            if (idx !== -1) this.channels[idx].profilePic = res.data.profilePic;
                            this.showToast('‚úÖ Kanal resmi g√ºncellendi!');
                        }
                    } catch (e) { this.showToast('‚ùå Resim y√ºklenemedi'); }
                },

                async leaveOrDeleteChannel() {
                    const isAdmin = this.activeChannel && this.activeChannel.creatorId === this.user.id;
                    const confirmMsg = isAdmin ? 'Kanalƒ± silmek istiyor musunuz? Bu i≈ülem geri alƒ±namaz.' : 'Kanaldan ayrƒ±lmak istiyor musunuz?';
                    if (!confirm(confirmMsg)) return;
                    try {
                        const token = this.SecureStorage.get('token');
                        await axios.delete('/api/channels/' + this.activeChannel.id, 
                            { headers: { Authorization: 'Bearer ' + token } });
                        this.channels = this.channels.filter(c => c.id !== this.activeChannel.id);
                        this.showChannelChat = false;
                        this.showToast(isAdmin ? 'üóëÔ∏è Kanal silindi' : 'üëã Kanaldan ayrƒ±ldƒ±nƒ±z');
                    } catch (e) { this.showToast('‚ùå ƒ∞≈ülem ba≈üarƒ±sƒ±z'); }
                },

                // ============ Kƒ∞M G√ñRM√ú≈û (LONG PRESS) ============
                startLongPress(msg, event) {
                    this.longPressTimer = setTimeout(async () => {
                        try {
                            const token = this.SecureStorage.get('token');
                            const channelId = this.activeChannel ? this.activeChannel.id : null;
                            if (!channelId) return;
                            const res = await axios.get('/api/channels/' + channelId + '/messages/' + msg.id + '/seen', {
                                headers: { Authorization: 'Bearer ' + token }
                            });
                            this.seenByUsers = res.data.seenBy || [];
                            this.showSeenByModal = true;
                        } catch (e) {
                            this.showToast('G√∂r√ºlme bilgisi alƒ±namadƒ±');
                        }
                    }, 600);
                },

                cancelLongPress() {
                    if (this.longPressTimer) {
                        clearTimeout(this.longPressTimer);
                        this.longPressTimer = null;
                    }
                },

                startChatWithSeller(item) {
                    if (!item || !item.sellerId) {
                        this.showToast("Satƒ±cƒ± bilgisi bulunamadƒ±");
                        return;
                    }
                    this.openChat({
                        userId: item.sellerId,
                        name: item.sellerName || item.sellerFullName,
                        profilePic: item.sellerProfilePic
                    });
                },
                
                openProductDetail(item) {
                    this.selectedProduct = item;
                    this.currentProductImageIndex = 0;
                    
                    // G√∂rselleri hazƒ±rla
                    this.selectedProductImages = [];
                    if (item.images && Array.isArray(item.images)) {
                        this.selectedProductImages = item.images;
                    } else if (item.image) {
                        this.selectedProductImages = [item.image];
                    }
                    
                    this.showProductDetail = true;
                },
                
                async deleteProduct(productId) {
                    if (!confirm('Bu √ºr√ºn√º silmek istediƒüinize emin misiniz?')) return;
                    
                    try {
                        await axios.delete(`/api/store/products/${productId}`);
                        this.showProductDetail = false;
                        this.selectedProduct = null;
                        this.loadProducts();
                        this.showToast("√úr√ºn silindi!");
                    } catch (e) {
                        this.showToast(e.response?.data?.error || "√úr√ºn silinirken hata olu≈ütu");
                    }
                },
                
                shareProduct(product) {
                    if (navigator.share) {
                        navigator.share({
                            title: product.name,
                            text: `${product.name} - ${product.price} ‚Ç∫`,
                            url: window.location.href
                        });
                    } else {
                        // Kopyala
                        const text = `${product.name} - ${product.price} ‚Ç∫`;
                        navigator.clipboard.writeText(text).then(() => {
                            this.showToast("√úr√ºn bilgisi kopyalandƒ±!");
                        });
                    }
                },

                startChatWithUser(user) {
                    this.showUserProfile = false;
                    this.openChat({
                        userId: user.id,
                        name: user.name,
                        profilePic: user.profilePic
                    });
                },

                startVoiceRecord() {
                    // Ger√ßek ses kaydƒ± ba≈ülat
                    if (this.isRecording) {
                        this.stopVoiceRecord();
                        return;
                    }
                    
                    // Ses kaydƒ± i√ßin permission iste ve kayda ba≈üla
                    navigator.mediaDevices.getUserMedia({ audio: true })
                        .then(stream => {
                            this.mediaRecorder = new MediaRecorder(stream);
                            this.recordedChunks = [];
                            this.voiceDuration = 0;
                            
                            this.mediaRecorder.ondataavailable = (e) => {
                                if (e.data.size > 0) {
                                    this.recordedChunks.push(e.data);
                                }
                            };
                            
                            this.mediaRecorder.onstop = () => {
                                const blob = new Blob(this.recordedChunks, { type: 'audio/webm' });
                                this.voicePreview = URL.createObjectURL(blob);
                                this.voiceBlob = blob;
                            };
                            
                            this.mediaRecorder.start();
                            this.isRecording = true;
                            
                            // S√ºre sayacƒ±
                            this.recordingTimer = setInterval(() => {
                                this.voiceDuration++;
                                if (this.voiceDuration >= 60) {
                                    this.stopVoiceRecord();
                                }
                            }, 1000);
                        })
                        .catch(err => {
                            console.error('Mikrofon eri≈üim hatasƒ±:', err);
                            this.showToast('Mikrofona eri≈üilemedi');
                        });
                },

                playVoiceMessage(msg) {
                    const audioUrl = msg.content || msg.voiceUrl || msg.mediaUrl;
                    if (!audioUrl) return;
                    if (msg._audio && !msg._audio.paused) {
                        msg._audio.pause();
                        msg.isPlaying = false;
                        return;
                    }
                    if (!msg._audio) {
                        msg._audio = new Audio(audioUrl);
                        msg._audio.onended = () => { msg.isPlaying = false; };
                    }
                    msg._audio.play().catch(() => this.showToast('Ses oynatƒ±lamadƒ±'));
                    msg.isPlaying = true;
                },
                
                // Mesaj Silme
                async deleteMessage(msg) {
                    if (!confirm('Bu mesajƒ± silmek istediƒüinize emin misiniz?')) return;
                    
                    try {
                        await axios.delete(`api/messages/${msg.id}`);
                        msg.isDeleted = true;
                        this.showToast("Mesaj silindi");
                    } catch (e) {
                        this.showToast("Mesaj silinemedi");
                    }
                },
                
                // ============ G√ñRSEL MESAJ YARDIMCI FONKSƒ∞YONLAR ============
                // Mesaj i√ßindeki URL'in g√∂rsel olup olmadƒ±ƒüƒ±nƒ± kontrol et
                isImageUrl(content) {
                    if (!content || typeof content !== 'string') return false;
                    // Sunucu URL'lerini veya http URL'lerini kontrol et
                    return content.startsWith('/uploads/') || 
                           content.startsWith('http') && (
                               content.includes('.jpg') || 
                               content.includes('.jpeg') || 
                               content.includes('.png') || 
                               content.includes('.gif') || 
                               content.includes('.webp')
                           );
                },
                
                // Mesaj g√∂rselinin URL'ini al
                getMessageImageUrl(msg) {
                    // √ñncelik: mediaUrl > content (eƒüer URL ise)
                    if (msg.mediaUrl) return msg.mediaUrl;
                    if (msg.content && this.isImageUrl(msg.content)) return msg.content;
                    if (msg.content && msg.content.startsWith('blob:')) return msg.content; // Ge√ßici blob URL
                    return null;
                },
                
                // G√∂rsel y√ºklenemezse fallback
                handleMessageImageError(event, msg) {
                    console.log('G√∂rsel y√ºklenemedi:', msg.content);
                    // Alternatif URL dene
                    if (msg.content && !event.target.src.includes(msg.content)) {
                        event.target.src = msg.content;
                    } else {
                        event.target.style.display = 'none';
                    }
                },
                
                // Verified Badge Info
                showVerifiedInfo() {
                    this.showToast("Bu hesap resmi olarak doƒürulanmƒ±≈ütƒ±r ‚úì");
                },
                
                // √áift√ßi rozeti bilgisi
                showFarmerBadgeInfo() {
                    this.showToast("üåæ √áift√ßi Y√ºksek Etkile≈üim Rozeti - Bu kullanƒ±cƒ± aktif bir √ßift√ßi!");
                },
                
                // ============ VERƒ∞Fƒ∞CATƒ∞ON ============
                // Resim sƒ±kƒ±≈ütƒ±rma fonksiyonu
                async compressImage(file, maxWidth = 1200, quality = 0.8) {
                    return new Promise((resolve, reject) => {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            const img = new Image();
                            img.onload = () => {
                                const canvas = document.createElement('canvas');
                                let width = img.width;
                                let height = img.height;
                                
                                // Boyut k√º√ß√ºltme
                                if (width > maxWidth) {
                                    height = (height * maxWidth) / width;
                                    width = maxWidth;
                                }
                                
                                canvas.width = width;
                                canvas.height = height;
                                
                                const ctx = canvas.getContext('2d');
                                ctx.drawImage(img, 0, 0, width, height);
                                
                                canvas.toBlob((blob) => {
                                    if (blob) {
                                        const compressedFile = new File([blob], file.name, {
                                            type: 'image/jpeg',
                                            lastModified: Date.now()
                                        });
                                        resolve(compressedFile);
                                    } else {
                                        reject(new Error('Sƒ±kƒ±≈ütƒ±rma ba≈üarƒ±sƒ±z'));
                                    }
                                }, 'image/jpeg', quality);
                            };
                            img.onerror = reject;
                            img.src = e.target.result;
                        };
                        reader.onerror = reject;
                        reader.readAsDataURL(file);
                    });
                },
                
                async handleVerificationImage(e, side) {
                    const file = e.target.files[0];
                    if (!file) return;
                    
                    // Dosya boyutu kontrol√º - 10MB √ºzeriyse sƒ±kƒ±≈ütƒ±r
                    let processedFile = file;
                    if (file.size > 10 * 1024 * 1024) {
                        this.showToast("Resim sƒ±kƒ±≈ütƒ±rƒ±lƒ±yor...");
                        try {
                            processedFile = await this.compressImage(file, 1200, 0.7);
                            this.showToast("Resim sƒ±kƒ±≈ütƒ±rƒ±ldƒ± ‚úì");
                        } catch (err) {
                            this.showToast("Daha k√º√ß√ºk boyutlu bir resim se√ßin (max 10MB)");
                            return;
                        }
                    } else if (file.size > 5 * 1024 * 1024) {
                        // 5-10MB arasƒ± i√ßin hafif sƒ±kƒ±≈ütƒ±rma
                        try {
                            processedFile = await this.compressImage(file, 1500, 0.85);
                        } catch (err) {
                            // Sƒ±kƒ±≈ütƒ±rma ba≈üarƒ±sƒ±z olursa orijinal dosyayƒ± kullan
                            processedFile = file;
                        }
                    }
                    
                    if (side === 'front') {
                        this.verificationForm.frontImage = processedFile;
                        this.verificationForm.frontPreview = URL.createObjectURL(processedFile);
                    } else {
                        this.verificationForm.backImage = processedFile;
                        this.verificationForm.backPreview = URL.createObjectURL(processedFile);
                    }
                },
                
                async submitVerificationRequest() {
                    if (!this.verificationForm.name || !this.verificationForm.surname || !this.verificationForm.frontImage || !this.verificationForm.backImage) {
                        this.showToast("T√ºm alanlarƒ± doldurun");
                        return;
                    }
                    this.loading = true;
                    try {
                        const fd = new FormData();
                        fd.append('name', this.verificationForm.name);
                        fd.append('surname', this.verificationForm.surname);
                        fd.append('frontImage', this.verificationForm.frontImage);
                        fd.append('backImage', this.verificationForm.backImage);
                        
                        await axios.post('/api/verification/request', fd);
                        this.showVerificationModal = false;
                        this.verificationForm = { name: '', surname: '', frontImage: null, frontPreview: '', backImage: null, backPreview: '' };
                        this.showToast("Ba≈üvurunuz alƒ±ndƒ±! ƒ∞nceleniyor... üìß");
                    } catch (e) {
                        this.showToast(e.response?.data?.error || "Ba≈üvuru g√∂nderilemedi");
                    } finally {
                        this.loading = false;
                    }
                },
                
                // ============ MESSAGE IMAGE (Ana fonksiyon yukarƒ±da sendImageMessage olarak tanƒ±mlƒ±) ============

                // ============ NOTIFICATIONS ============
                async loadNotifications() {
                    try {
                        const res = await axios.get('/api/notifications');
                        this.notifications = res.data.notifications || [];
                        this.unreadNotifs = res.data.unreadCount || 0;
                    } catch (e) { 
                        console.error(e); 
                    }
                },

                async markAllNotificationsRead() {
                    try {
                        await axios.post('/api/notifications/read');
                        this.notifications.forEach(n => n.read = true);
                        this.unreadNotifs = 0;
                    } catch (e) { }
                },

                handleNotificationClick(notif) {
                    if (!notif.read) {
                        axios.post('/api/notifications/read', { ids: [notif.id] });
                        notif.read = true;
                        this.unreadNotifs = Math.max(0, this.unreadNotifs - 1);
                    }
                    
                    const data = notif.data || {};
                    if (notif.type === 'follow' && data.followerId) {
                        this.viewProfile(data.followerId);
                    } else if (notif.type === 'follow_accepted' && data.targetId) {
                        this.viewProfile(data.targetId);
                    } else if (notif.type === 'like' && data.postId) {
                        // Post'a scroll
                    } else if (notif.type === 'comment' && data.postId) {
                        this.openComments({ id: data.postId });
                    }
                },

                async handleFollowRequest(notif, action) {
                    const requesterId = notif.data?.requesterId;
                    if (!requesterId) return;
                    try {
                        const token = this.SecureStorage.get('token');
                        await axios.post(`/api/follow-requests/${requesterId}/${action}`, {}, 
                            { headers: { Authorization: 'Bearer ' + token } });
                        notif.followRequestHandled = action;
                        notif.read = true;
                        this.unreadNotifs = Math.max(0, this.unreadNotifs - 1);
                        this.showToast(action === 'accept' ? '‚úÖ Takip isteƒüi onaylandƒ±!' : '‚ùå Takip isteƒüi reddedildi');
                    } catch (e) {
                        this.showToast('ƒ∞≈ülem ba≈üarƒ±sƒ±z');
                    }
                },

                getNotifIcon(type) {
                    const icons = {
                        like: { icon: 'fas fa-heart', bg: 'bg-red-500' },
                        comment: { icon: 'fas fa-comment', bg: 'bg-blue-500' },
                        follow: { icon: 'fas fa-user-plus', bg: 'bg-emerald-500' },
                        follow_request: { icon: 'fas fa-user-clock', bg: 'bg-yellow-500' },
                        follow_accepted: { icon: 'fas fa-user-check', bg: 'bg-emerald-500' },
                        post: { icon: 'fas fa-image', bg: 'bg-purple-500' },
                        message: { icon: 'fas fa-envelope', bg: 'bg-orange-500' },
                        message_like: { icon: 'fas fa-heart', bg: 'bg-pink-500' }
                    };
                    return icons[type] || { icon: 'fas fa-bell', bg: 'bg-slate-500' };
                },
                
                // Bildirimde takip√ßi profil resmi
                getNotifUserPic(notif) {
                    if (notif.data?.followerProfilePic) return notif.data.followerProfilePic;
                    if (notif.data?.followerUsername) return `https://ui-avatars.com/api/?name=${notif.data.followerUsername}`;
                    return 'https://ui-avatars.com/api/?name=User';
                },

                // ============ PROFILE ============
                async loadStats() {
                    try {
                        const res = await axios.get(`api/users/${this.user.id}/stats`);
                        // Sunucu { stats: { followerCount, ... } } d√∂nd√ºr√ºyor ‚Üí unwrap et
                        this.userStats = res.data?.stats || res.data || {};
                    } catch (e) { 
                        console.error(e); 
                    }
                },
                
                // üèÜ ROZET Sƒ∞STEMƒ∞ - Kullanƒ±cƒ± Rozetlerini Y√ºkle
                async loadUserBadges(userId = null) {
                    try {
                        const targetId = userId || this.user.id;
                        const res = await axios.get(`/api/badges/user/${targetId}`);
                        if (res.data.success) {
                            if (userId) {
                                // Ba≈üka kullanƒ±cƒ± i√ßin - d√∂nd√ºr
                                return res.data.badges || [];
                            } else {
                                // Kendi rozetlerimiz
                                this.userBadges = res.data.badges || [];
                            }
                        }
                    } catch (e) {
                        console.error('Rozetler y√ºklenemedi:', e);
                        return [];
                    }
                },
                
                // üèÜ En Y√ºksek Etkile≈üimli Kullanƒ±cƒ±larƒ± Y√ºkle
                async loadTopEngagementUsers() {
                    try {
                        const res = await axios.get('/api/badges/top-engagement');
                        if (res.data.success) {
                            this.topEngagementUsers = res.data.topUsers || [];
                        }
                    } catch (e) {
                        console.error('Top engagement y√ºklenemedi:', e);
                    }
                },
                
                // üë• Ortak Takip√ßileri Y√ºkle
                async loadMutualFollowers(userId) {
                    try {
                        const res = await axios.get(`/api/users/${userId}/mutual-followers`);
                        if (res.data.success) {
                            this.mutualFollowers = res.data.mutualFollowers || [];
                            this.mutualFollowersCount = res.data.count || 0;
                        }
                    } catch (e) {
                        console.error('Ortak takip√ßiler y√ºklenemedi:', e);
                        this.mutualFollowers = [];
                        this.mutualFollowersCount = 0;
                    }
                },
                
                // Rozet CSS sƒ±nƒ±fƒ± belirle
                getBadgeClass(badge) {
                    if (!badge) return '';
                    if (badge.type === 'agricultural_engineer') return 'badge-agricultural';
                    if (badge.type === 'top_engagement') return 'badge-' + (badge.level || 'gold');
                    if (badge.type === 'verified') return 'badge-verified';
                    return '';
                },

                // Rozet render fonksiyonu - GELƒ∞≈ûMƒ∞≈û v2
                getBadgeHtml(badge) {
                    if (!badge) return '';
                    
                    let badgeClass = 'user-badge ' + this.getBadgeClass(badge);
                    let badgeIcon = badge.icon || 'üéñÔ∏è';
                    let badgeName = badge.name || 'Rozet';
                    let badgeDesc = badge.description || badgeName;
                    
                    return `<span class="${badgeClass}" title="${badgeName}">
                        ${badgeIcon}
                        <span class="badge-tooltip">${badgeDesc}</span>
                    </span>`;
                },

                // Rozet vitrin HTML'i
                getBadgeShowcaseIcon(badge) {
                    if (badge.type === 'agricultural_engineer') return 'agri-bg';
                    if (badge.level === 'gold') return 'gold-bg';
                    if (badge.level === 'silver') return 'silver-bg';
                    if (badge.level === 'bronze') return 'bronze-bg';
                    return '';
                },

                async loadMyPosts(reset = true) {
                    if (this.myPostsLoading) return;
                    try {
                        if (reset) {
                            this.myPostsPage = 1;
                            this.myPosts = [];
                            this.myPostsHasMore = true;
                        }
                        this.myPostsLoading = true;
                        const limit = 5;
                        const res = await axios.get(`/api/users/${this.user.id}/posts?limit=${limit}&page=${this.myPostsPage}`);
                        const posts = res.data.posts || [];
                        posts.forEach(post => {
                            post.userName       = post.userName       || post.name     || post.username || 'Kullanƒ±cƒ±';
                            post.userUsername   = post.userUsername   || post.username || '';
                            post.userProfilePic = post.userProfilePic || post.profilePic || '';
                            post.viewCount      = post.viewCount ?? post.views ?? 0;
                            if (post.media) {
                                const filename = post.media.split('/').pop();
                                if (post.mediaType === 'video') {
                                    post.mediaUrl = post.mediaUrl || post.media; // HLS/MP4 URL doƒürudan kullan
                                } else {
                                    post.mediaUrl = post.mediaUrl || post.media;
                                }
                            }
                        });
                        if (reset) {
                            this.myPosts = posts;
                        } else {
                            this.myPosts = [...this.myPosts, ...posts];
                        }
                        this.myPostsHasMore = posts.length === limit;
                        this.myPostsPage++;
                        console.log('Postlar y√ºklendi:', this.myPosts.length, 'hasMore:', this.myPostsHasMore);
                    } catch (e) { 
                        console.error('Postlar y√ºklenemedi:', e); 
                    } finally {
                        this.myPostsLoading = false;
                    }
                },
                
                async loadMoreMyPosts() {
                    if (this.myPostsHasMore && !this.myPostsLoading) {
                        await this.loadMyPosts(false);
                    }
                },
                
                // Kendi postumu sil
                async deleteMyPost(post) {
                    if (!confirm('Bu g√∂nderiyi silmek istediƒüinize emin misiniz?')) return;
                    
                    try {
                        await axios.delete(`api/posts/${post.id}`);
                        this.myPosts = this.myPosts.filter(p => p.id !== post.id);
                        this.feed = this.feed.filter(p => p.id !== post.id);
                        this.showToast("G√∂nderi silindi");
                    } catch (e) {
                        this.showToast("G√∂nderi silinemedi");
                    }
                },

                previewEditAvatar(e) {
                    const file = e.target.files[0];
                    if (!file) return;
                    this.editForm.profilePicFile = file;
                    this.editForm.profilePic = URL.createObjectURL(file);
                },
                
                previewEditCover(e) {
                    const file = e.target.files[0];
                    if (!file) return;
                    this.editForm.coverPicFile = file;
                    this.editForm.coverPicPreview = URL.createObjectURL(file);
                },
                
                // Profil resmini kaldƒ±r
                async removeProfilePic() {
                    if (!confirm('Profil resminizi kaldƒ±rmak istediƒüinize emin misiniz?')) return;
                    
                    this.loading = true;
                    try {
                        await axios.delete('/api/users/profile-pic');
                        this.user.profilePic = null;
                        this.editForm.profilePic = '';
                        this.editForm.profilePicFile = null;
                        // SecureStorage ile kaydet
                        this.SecureStorage.set('user', this.user);
                        this.showToast("Profil resmi kaldƒ±rƒ±ldƒ±");
                    } catch (e) {
                        // Demo mod - sunucu olmadan da √ßalƒ±≈üsƒ±n
                        this.user.profilePic = null;
                        this.editForm.profilePic = '';
                        this.editForm.profilePicFile = null;
                        this.SecureStorage.set('user', this.user);
                        this.showToast("Profil resmi kaldƒ±rƒ±ldƒ±");
                    } finally {
                        this.loading = false;
                    }
                },

                async updateProfile() {
                    this.loading = true;
                    try {
                        const fd = new FormData();
                        // XSS korumasƒ± uygula
                        fd.append('name', window.sanitizeInput ? window.sanitizeInput(this.editForm.name) : this.editForm.name);
                        fd.append('email', window.sanitizeInput ? window.sanitizeInput(this.editForm.email) : this.editForm.email);
                        // HESAP Tƒ∞Pƒ∞ D√úZELTƒ∞LDƒ∞ - bo≈ü string kontrol√º
                        if (this.editForm.userType) {
                            fd.append('userType', this.editForm.userType);
                        }
                        fd.append('bio', window.sanitizeInput ? window.sanitizeInput(this.editForm.bio) : this.editForm.bio);
                        fd.append('location', window.sanitizeInput ? window.sanitizeInput(this.editForm.location) : this.editForm.location);
                        fd.append('website', window.sanitizeInput ? window.sanitizeInput(this.editForm.website) : this.editForm.website);
                        if (this.editForm.profilePicFile) {
                            fd.append('profilePic', this.editForm.profilePicFile);
                        }
                        if (this.editForm.coverPicFile) {
                            fd.append('coverPic', this.editForm.coverPicFile);
                        }

                        const res = await axios.put('/api/users/profile', fd);
                        const updatedUser = res.data.user;
                        
                        // User objesini g√ºncelle - userType dahil
                        this.user = { 
                            ...this.user, 
                            ...updatedUser,
                            userType: updatedUser.userType || this.editForm.userType // userType'ƒ± koru
                        };
                        // SecureStorage ile kaydet
                        this.SecureStorage.set('user', this.user);
                        
                        this.showEditModal = false;
                        this.showToast("Profil g√ºncellendi!");
                    } catch (e) { 
                        this.showToast(e.response?.data?.error || "Hata olu≈ütu"); 
                    } finally { 
                        this.loading = false; 
                    }
                },

                // ============ CONNECTIONS ============
                async showConnections(type, userId = null) {
                    const targetUserId = userId || this.user.id;
                    this.connectionsType = type;
                    this.connectionsUserId = targetUserId;
                    this.connectionsPage = 1;
                    this.connectionsHasMore = true;
                    this.connectionsLoading = false;
                    this.connectionsList = [];
                    this.showConnectionsModal = true;
                    await this.loadMoreConnections();
                },

                async loadMoreConnections() {
                    if (this.connectionsLoading || !this.connectionsHasMore) return;
                    this.connectionsLoading = true;
                    try {
                        const endpoint = this.connectionsType === 'followers' ? 'followers' : 'following';
                        const res = await axios.get(`/api/users/${this.connectionsUserId}/${endpoint}?page=${this.connectionsPage}&limit=10`);
                        const list = res.data[endpoint] || res.data.followers || res.data.following || [];
                        this.connectionsList = [...this.connectionsList, ...list];
                        this.connectionsPage++;
                        this.connectionsHasMore = list.length === 10;
                    } catch (e) {
                        console.error('Connections y√ºkleme hatasƒ±:', e);
                        this.connectionsHasMore = false;
                    } finally {
                        this.connectionsLoading = false;
                    }
                },
                
                // Kullanƒ±cƒ±nƒ±n engelini kaldƒ±r - DEMO DESTEKLƒ∞
                async unblockUser(userId) {
                    try {
                        await axios.post(`/api/users/${userId}/unblock`);
                        this.blockedAccountsList = (this.blockedAccountsList || []).filter(u => u.id !== userId);
                        this.showToast("‚úÖ Kullanƒ±cƒ±nƒ±n engeli kaldƒ±rƒ±ldƒ±");
                    } catch (e) {
                        this.blockedAccountsList = (this.blockedAccountsList || []).filter(u => u.id !== userId);
                        this.showToast("Engel kaldƒ±rƒ±ldƒ±");
                    }
                },

                // ============ CONNECTIONS (eski stub - yenisi yukarƒ±da) ============
                
                // Ba≈üka kullanƒ±cƒ±nƒ±n takip√ßilerini g√∂ster
                async showUserConnections(type) {
                    if (this.viewedUser && this.viewedUser.id) {
                        await this.showConnections(type, this.viewedUser.id);
                    }
                },

                async toggleFollow(userId) {
                    if (typeof userId === 'object') userId = userId.id; // Eski conn object desteƒüi
                    try {
                        const res = await axios.post(`/api/users/${userId}/follow`);
                        if (res.data.isFollowing) {
                            if (!this.followingIds.includes(userId)) {
                                this.followingIds.push(userId);
                            }
                        } else {
                            this.followingIds = this.followingIds.filter(id => id !== userId);
                        }
                        // Feed'deki post'u g√ºncelle
                        this.feed.forEach(post => {
                            if (post.userId === userId) {
                                post.isFollowing = res.data.isFollowing;
                            }
                        });
                        this.showToast(res.data.isFollowing ? '‚úÖ Takip edildi' : '‚ùå Takip bƒ±rakƒ±ldƒ±');
                    } catch (e) {
                        console.error('Toggle follow error:', e);
                    }
                },
                
                // Kullanƒ±cƒ±nƒ±n takip edilip edilmediƒüini kontrol et
                isFollowing(userId) {
                    return this.followingIds.includes(userId);
                },
                
                // ============ 2FA TOGGLE ============
                async toggle2FA() {
                    const newState = this.user.twoFactorEnabled === false ? true : false;
                    try {
                        await axios.post('/api/users/2fa/toggle', { enabled: newState });
                        this.user.twoFactorEnabled = newState;
                        this.SecureStorage.set('user', this.user);
                        this.showToast(newState ? '2FA a√ßƒ±ldƒ± - Giri≈ü yaparken e-posta doƒürulamasƒ± istenecek' : '2FA kapatƒ±ldƒ± - Direkt giri≈ü yapabilirsiniz');
                    } catch (e) {
                        this.showToast('2FA ayarƒ± deƒüi≈ütirilemedi');
                    }
                },

                async savePrivacySettings() {
                    try {
                        const token = this.SecureStorage.get('token');
                        // Ayrƒ± privacy settings tablosuna kaydet
                        await axios.post('/api/users/privacy-settings', this.privacySettings, { headers: { Authorization: 'Bearer ' + token } });
                        // Ayrƒ±ca kullanƒ±cƒ± profilindeki isPrivate alanƒ±nƒ± da g√ºncelle
                        await axios.put('/api/users/profile', { isPrivate: this.privacySettings.privateAccount ? 'true' : 'false' }, { headers: { Authorization: 'Bearer ' + token } });
                        this.user.isPrivate = this.privacySettings.privateAccount;
                        this.SecureStorage.set('user', this.user);
                        localStorage.setItem('_agro_privacy', JSON.stringify(this.privacySettings));
                        this.showToast('‚úÖ Gizlilik ayarlarƒ± kaydedildi!');
                    } catch (e) {
                        // Save locally even if API fails
                        localStorage.setItem('_agro_privacy', JSON.stringify(this.privacySettings));
                        this.showToast('‚úÖ Gizlilik ayarlarƒ± kaydedildi!');
                    }
                },

                loadPrivacySettings() {
                    try {
                        // 1) √ñnce localStorage'dan y√ºkle (hƒ±zlƒ±, offline √ßalƒ±≈üƒ±r)
                        const stored = localStorage.getItem('_agro_privacy');
                        if (stored) {
                            this.privacySettings = { ...this.privacySettings, ...JSON.parse(stored) };
                        }
                        // 2) user.isPrivate ile senkronize et (sadece integer/boolean, string 'false' bug'ƒ±nƒ± √∂nle)
                        if (this.user && this.user.isPrivate !== undefined) {
                            const isPrivateVal = this.user.isPrivate;
                            // String 'false'/'0' ‚Üí false, string 'true'/'1' ‚Üí true, number 0‚Üífalse, 1‚Üítrue
                            this.privacySettings.privateAccount = isPrivateVal === true || isPrivateVal === 1 || isPrivateVal === '1' || isPrivateVal === 'true';
                        }
                        // 3) API'den g√ºncel ayarlarƒ± √ßek (async, sonradan g√ºnceller)
                        this._loadPrivacyFromAPI();
                    } catch (e) {}
                },
                
                async _loadPrivacyFromAPI() {
                    try {
                        const token = this.SecureStorage.get('token');
                        if (!token) return;
                        const res = await axios.get('/api/users/privacy-settings', { headers: { Authorization: 'Bearer ' + token } });
                        if (res.data && res.data.settings) {
                            const s = res.data.settings;
                            this.privacySettings = {
                                privateAccount: s.privateAccount === 1 || s.privateAccount === true || s.privateAccount === '1' || s.privateAccount === 'true',
                                showActivity: s.showActivity === 1 || s.showActivity === true || s.showActivity === '1' || s.showActivity === 'true',
                                allowMessagesFrom: s.allowMessagesFrom || 'everyone',
                                allowTagsFrom: s.allowTagsFrom || 'everyone',
                            };
                            // Locale'yi de g√ºncelle
                            localStorage.setItem('_agro_privacy', JSON.stringify(this.privacySettings));
                        }
                    } catch (e) { /* API ba≈üarƒ±sƒ±z olsa bile localStorage'daki deƒüerler kalƒ±r */ }
                },

                async saveNotificationSettings() {
                    try {
                        const token = this.SecureStorage.get('token');
                        await axios.post('/api/users/notification-settings', this.notificationSettings, { headers: { Authorization: 'Bearer ' + token } });
                        localStorage.setItem('_agro_notif_settings', JSON.stringify(this.notificationSettings));
                        this.showToast('‚úÖ Bildirim ayarlarƒ± kaydedildi!');
                    } catch (e) {
                        localStorage.setItem('_agro_notif_settings', JSON.stringify(this.notificationSettings));
                        this.showToast('‚úÖ Bildirim ayarlarƒ± kaydedildi!');
                    }
                },

                loadNotificationSettingsData() {
                    try {
                        const stored = localStorage.getItem('_agro_notif_settings');
                        if (stored) {
                            this.notificationSettings = { ...this.notificationSettings, ...JSON.parse(stored) };
                        }
                        // API'den de y√ºkle (async)
                        this._loadNotificationFromAPI();
                    } catch (e) {}
                },
                
                async _loadNotificationFromAPI() {
                    try {
                        const token = this.SecureStorage.get('token');
                        if (!token) return;
                        const res = await axios.get('/api/users/notification-settings', { headers: { Authorization: 'Bearer ' + token } });
                        if (res.data && res.data.settings) {
                            this.notificationSettings = { ...this.notificationSettings, ...res.data.settings };
                            localStorage.setItem('_agro_notif_settings', JSON.stringify(this.notificationSettings));
                        }
                    } catch (e) { /* localStorage deƒüerleri kalƒ±r */ }
                },

                // ============ USER PROFILE ============
                async viewProfile(userId) {
                    if (userId === this.user.id) {
                        this.activeTab = 'profile';
                        this.searchQuery = '';
                        this.searchResults = [];
                        this.showUserProfile = false;
                        return;
                    }
                    
                    try {
                        this.viewedUserPostsPage = 1;
                        this.viewedUserPosts = [];
                        this.viewedUserPostsHasMore = true;
                        
                        const [userRes, statsRes, postsRes, mutualRes, badgesData, storiesRes] = await Promise.all([
                            axios.get(`api/users/${userId}`),
                            axios.get(`api/users/${userId}/stats`),
                            axios.get(`api/users/${userId}/posts?limit=5&page=1`),
                            axios.get(`api/users/${userId}/mutual-followers`).catch(() => ({ data: { mutualFollowers: [], count: 0 } })),
                            this.loadUserBadges(userId),
                            axios.get(`/api/users/${userId}/stories`).catch(() => ({ data: { stories: [] } }))
                        ]);
                        
                        const userStories = storiesRes.data?.stories || storiesRes.data?.myStories || [];
                        
                        this.viewedUser = { 
                            ...userRes.data.user, 
                            ...statsRes.data,
                            isFollowing: !!userRes.data.user?.isFollowing || !!userRes.data.isFollowing,
                            badges: badgesData || [],
                            userStories: userStories,
                            hasActiveStories: userStories.length > 0
                        };
                        
                        // Ortak takip√ßiler
                        this.mutualFollowers = mutualRes.data.mutualFollowers || [];
                        this.mutualFollowersCount = mutualRes.data.count || 0;
                        this.viewingUserId = userId;
                        
                        // Kullanƒ±cƒ±nƒ±n postlarƒ±nƒ± i≈üle
                        const posts = postsRes.data.posts || [];
                        posts.forEach(post => {
                            post.userName       = post.userName       || post.name     || post.username || 'Kullanƒ±cƒ±';
                            post.userUsername   = post.userUsername   || post.username || '';
                            post.userProfilePic = post.userProfilePic || post.profilePic || '';
                            post.viewCount      = post.viewCount ?? post.views ?? 0;
                            if (post.media) {
                                const filename = post.media.split('/').pop();
                                if (post.mediaType === 'video') {
                                    post.mediaUrl = post.mediaUrl || post.media; // HLS/MP4 URL doƒürudan kullan
                                } else {
                                    post.mediaUrl = post.mediaUrl || post.media;
                                }
                            }
                        });
                        this.viewedUserPosts = posts;
                        this.viewedUserPostsHasMore = posts.length === 5;
                        this.viewedUserPostsPage = 2;
                        
                        this.showUserProfile = true;
                        this.searchQuery = '';
                        this.searchResults = [];
                    } catch (e) { 
                        this.showToast("Kullanƒ±cƒ± bulunamadƒ±"); 
                    }
                },
                
                async loadMoreViewedUserPosts() {
                    if (this.viewedUserPostsLoading || !this.viewedUserPostsHasMore) return;
                    this.viewedUserPostsLoading = true;
                    try {
                        const userId = this.viewingUserId;
                        const res = await axios.get(`api/users/${userId}/posts?limit=5&page=${this.viewedUserPostsPage}`);
                        const posts = res.data.posts || [];
                        posts.forEach(post => {
                            post.userName       = post.userName       || post.name     || post.username || 'Kullanƒ±cƒ±';
                            post.userUsername   = post.userUsername   || post.username || '';
                            post.userProfilePic = post.userProfilePic || post.profilePic || '';
                            post.viewCount      = post.viewCount ?? post.views ?? 0;
                            if (post.media) {
                                const filename = post.media.split('/').pop();
                                if (post.mediaType === 'video') {
                                    post.mediaUrl = post.mediaUrl || post.media; // HLS/MP4 URL doƒürudan kullan
                                } else {
                                    post.mediaUrl = post.mediaUrl || post.media;
                                }
                            }
                        });
                        this.viewedUserPosts = [...this.viewedUserPosts, ...posts];
                        this.viewedUserPostsHasMore = posts.length === 5;
                        this.viewedUserPostsPage++;
                    } catch (e) {
                        console.error('Daha fazla post y√ºklenemedi:', e);
                    } finally {
                        this.viewedUserPostsLoading = false;
                    }
                },
                
                // ========== KAPAK FOTOƒûRAFI ZOOM FONKSƒ∞YONLARI ==========
                openCoverZoom(url) {
                    this.coverZoomUrl = url;
                    this.zoomLevel = 1;
                    this.showCoverZoom = true;
                },
                
                zoomIn() {
                    this.zoomLevel = Math.min(this.zoomLevel + 0.5, 4);
                },
                
                zoomOut() {
                    this.zoomLevel = Math.max(this.zoomLevel - 0.5, 1);
                },
                
                zoomReset() {
                    this.zoomLevel = 1;
                },
                
                handleZoomWheel(e) {
                    e.preventDefault();
                    if (e.deltaY < 0) {
                        this.zoomIn();
                    } else {
                        this.zoomOut();
                    }
                },
                
                handleTouchZoomStart(e) {
                    if (e.touches.length === 2) {
                        this.touchZoomDistance = Math.hypot(
                            e.touches[0].pageX - e.touches[1].pageX,
                            e.touches[0].pageY - e.touches[1].pageY
                        );
                    }
                },
                
                handleTouchZoomMove(e) {
                    if (e.touches.length === 2) {
                        e.preventDefault();
                        const newDistance = Math.hypot(
                            e.touches[0].pageX - e.touches[1].pageX,
                            e.touches[0].pageY - e.touches[1].pageY
                        );
                        
                        const scale = newDistance / this.touchZoomDistance;
                        this.zoomLevel = Math.min(Math.max(this.zoomLevel * scale, 1), 4);
                        this.touchZoomDistance = newDistance;
                    }
                },
                
                handleTouchZoomEnd(e) {
                    this.touchZoomDistance = 0;
                },

                async toggleFollowUser(user) {
                    try {
                        const res = await axios.post(`/api/users/${user.id}/follow`);
                        user.isFollowing = res.data.isFollowing;
                        this.loadStats();
                    } catch (e) { }
                },

                // ============ SEARCH ============
                async handleSearch() {
                    if (!this.searchQuery.trim()) {
                        this.searchResults = [];
                        this.hashtagResults = [];
                        return;
                    }
                    
                    try {
                        // XSS korumasƒ± uygula
                        const sanitizedQuery = window.sanitizeInput ? window.sanitizeInput(this.searchQuery) : this.searchQuery;
                        
                        if (sanitizedQuery.startsWith('#')) {
                            const res = await axios.get(`api/hashtags/search?q=${encodeURIComponent(sanitizedQuery.slice(1))}`);
                            this.hashtagResults = res.data.hashtags || [];
                            this.searchResults = [];
                        } else {
                            const res = await axios.get(`api/users/search?q=${encodeURIComponent(sanitizedQuery)}`);
                            this.searchResults = res.data.users || [];
                            this.hashtagResults = [];
                        }
                    } catch (e) { 
                        console.error(e); 
                    }
                },

                async searchByHashtag(tag) {
                    try {
                        const res = await axios.get(`api/hashtags/${tag}/posts`);
                        this.feed = res.data.posts || [];
                        this.hasMore = false;
                        this.searchQuery = '';
                        this.hashtagResults = [];
                        this.activeTab = 'home';
                        this.showToast(`#${tag} g√∂nderileri`);
                    } catch (e) { }
                },

                // ============ POST OPTIONS ============
                openPostOptions(post) {
                    this.selectedPost = post;
                    this.showPostOptions = true;
                },

                async deletePost(post) {
                    if (!confirm('Bu g√∂nderiyi silmek istediƒüinize emin misiniz?')) return;
                    try {
                        await axios.delete(`api/posts/${post.id}`);
                        this.feed = this.feed.filter(p => p.id !== post.id);
                        this.showPostOptions = false;
                        this.showToast("G√∂nderi silindi");
                    } catch (e) { 
                        this.showToast("Silinemedi"); 
                    }
                },

                async reportPost(post) {
                    this.selectedPost = post;
                    this.showPostOptions = false;
                    this.reportReason = '';
                    this.reportDescription = '';
                    this.showReportModal = true;
                },
                
                // ≈ûikayet g√∂nderme - goktepefatma6@gmail.com adresine mail g√∂nderir
                async submitReport() {
                    if (!this.reportReason) {
                        this.showToast("L√ºtfen bir ≈üikayet nedeni se√ßin");
                        return;
                    }
                    
                    this.loading = true;
                    try {
                        await axios.post('/api/reports/post', {
                            postId: this.selectedPost?.id,
                            reason: this.reportReason,
                            description: this.reportDescription,
                            reporterEmail: this.user.email,
                            reporterUsername: this.user.username
                        });
                        
                        this.showReportModal = false;
                        this.showToast("≈ûikayet ba≈üarƒ±yla g√∂nderildi. ƒ∞ncelenecektir.");
                        this.reportReason = '';
                        this.reportDescription = '';
                        this.selectedPost = null;
                    } catch (e) {
                        this.showToast(e.response?.data?.error || "≈ûikayet g√∂nderilemedi");
                    } finally {
                        this.loading = false;
                    }
                },

                // Kullanƒ±cƒ± ≈üikayet et (profil sayfasƒ±ndan)
                reportUser(userId) {
                    // Mevcut reportPost altyapƒ±sƒ±nƒ± kullan - postla aynƒ± modal
                    this.reportReason = '';
                    this.reportDescription = '';
                    // Kullanƒ±cƒ± ≈üikayeti i√ßin selectedPost'u bo≈ü bƒ±rak, userId kaydet
                    this.selectedPost = { userId, isUserReport: true };
                    this.showReportModal = true;
                },

                async blockUser(userId) {
                    if (!this.blockedAccountsList) this.blockedAccountsList = [];
                    
                    // Engel kaldƒ±r mƒ± engelle mi?
                    const alreadyBlocked = this.blockedAccountsList.find(u => u.id === userId);
                    if (alreadyBlocked) {
                        // Engeli kaldƒ±r
                        try {
                            await axios.post(`/api/users/${userId}/unblock`);
                            this.blockedAccountsList = this.blockedAccountsList.filter(u => u.id !== userId);
                            this.showToast("‚úÖ Engel kaldƒ±rƒ±ldƒ±");
                        } catch(e) {
                            this.blockedAccountsList = this.blockedAccountsList.filter(u => u.id !== userId);
                            this.showToast("Engel kaldƒ±rƒ±ldƒ±");
                        }
                        return;
                    }

                    // Kullanƒ±cƒ± bilgilerini kaynaktan al
                    const srcUser = this.viewedUser?.id === userId ? this.viewedUser
                                  : this.feed.find(p => p.userId === userId);
                    const blockedInfo = {
                        id: userId,
                        name: srcUser?.name || srcUser?.userName || 'Kullanƒ±cƒ±',
                        username: srcUser?.username || srcUser?.userUsername || '',
                        profilePic: srcUser?.profilePic || srcUser?.userProfilePic || ''
                    };

                    this.showPostOptions = false;
                    try {
                        const res = await axios.post(`/api/users/${userId}/block`);
                        if (res.data.isBlocked !== false) {
                            // Feed'den kaldƒ±r
                            this.feed = this.feed.filter(p => p.userId !== userId);
                            if (this.tikTokPosts) this.tikTokPosts = this.tikTokPosts.filter(p => p.userId !== userId);
                            // DM konu≈ümalarƒ±ndan kaldƒ±r
                            this.conversations = (this.conversations || []).filter(c => (c.userId || c.otherId || c.id) !== userId);
                            // Engellenenlere ekle
                            if (!this.blockedAccountsList.find(u => u.id === userId)) {
                                this.blockedAccountsList.push(blockedInfo);
                            }
                            // Profil sayfasƒ±ndan engellendiyse kapat
                            if (this.showUserProfile && this.viewedUser?.id === userId) {
                                this.showUserProfile = false;
                            }
                            this.showToast("‚úÖ Kullanƒ±cƒ± engellendi");
                        } else {
                            this.blockedAccountsList = this.blockedAccountsList.filter(u => u.id !== userId);
                            this.showToast("Engel kaldƒ±rƒ±ldƒ±");
                        }
                    } catch (e) {
                        // API hatasƒ± - UI'ƒ± yine de g√ºncelle
                        this.feed = this.feed.filter(p => p.userId !== userId);
                        this.conversations = (this.conversations || []).filter(c => (c.userId || c.otherId || c.id) !== userId);
                        if (!this.blockedAccountsList.find(u => u.id === userId)) {
                            this.blockedAccountsList.push(blockedInfo);
                        }
                        this.showToast("‚úÖ Kullanƒ±cƒ± engellendi");
                    }
                },
                
                // Post √ºzerinden engelleme
                async blockUserFromPost(userId) {
                    if (!this.blockedAccountsList) this.blockedAccountsList = [];
                    const srcPost = this.feed.find(p => p.userId === userId)
                                 || this.tikTokPosts?.find(p => p.userId === userId)
                                 || this.selectedPost;
                    const blockedInfo = srcPost ? {
                        id: userId,
                        name: srcPost.userName || srcPost.name || 'Kullanƒ±cƒ±',
                        username: srcPost.userUsername || srcPost.username || '',
                        profilePic: srcPost.userProfilePic || srcPost.profilePic || ''
                    } : { id: userId, name: 'Kullanƒ±cƒ±', username: '', profilePic: '' };

                    this.showPostOptions = false;
                    try {
                        const res = await axios.post(`/api/users/${userId}/block`);
                        if (res.data.isBlocked) {
                            this.feed = this.feed.filter(p => p.userId !== userId);
                            if (this.tikTokPosts) this.tikTokPosts = this.tikTokPosts.filter(p => p.userId !== userId);
                            if (!this.blockedAccountsList.find(u => u.id === userId)) {
                                this.blockedAccountsList.push({ ...blockedInfo, ...(res.data.blockedUser || {}) });
                            }
                            this.showToast("‚úÖ Kullanƒ±cƒ± engellendi. G√∂nderileri artƒ±k g√∂r√ºnmeyecek.");
                        } else {
                            this.blockedAccountsList = this.blockedAccountsList.filter(u => u.id !== userId);
                            this.showToast("Engel kaldƒ±rƒ±ldƒ±");
                        }
                    } catch (e) {
                        this.feed = this.feed.filter(p => p.userId !== userId);
                        if (this.tikTokPosts) this.tikTokPosts = this.tikTokPosts.filter(p => p.userId !== userId);
                        if (!this.blockedAccountsList.find(u => u.id === userId)) {
                            this.blockedAccountsList.push(blockedInfo);
                        }
                        this.showToast("‚úÖ Kullanƒ±cƒ± engellendi.");
                    }
                },

                // ============ MEDIA ============
                openFullScreen(url, type) {
                    this.fullScreenMedia = { url, type: type || 'image' };
                    this.showFullScreen = true;
                },

                // ============ PROFILE PIC POPUP ============
                openProfilePicPopup(profilePic, userId, hasStory, storyData, isOwnProfile) {
                    this.profilePicPopupData = { profilePic, userId, hasStory, storyData, isOwnProfile };
                    this.showProfilePicPopup = true;
                },
                
                userHasActiveStory(userId) {
                    if (userId === this.user?.id) {
                        return this.myStories && this.myStories.length > 0;
                    }
                    // Check stories feed
                    if (this.stories && this.stories.some(s => s.userId === userId)) return true;
                    // Check viewedUser
                    if (this.viewedUser && this.viewedUser.id === userId && this.viewedUser.hasActiveStories) return true;
                    return false;
                },
                
                getUserStory(userId) {
                    if (userId === this.user?.id) {
                        return this.myStories && this.myStories.length > 0 ? this.myStories[0] : null;
                    }
                    // Check stories feed
                    const storyGroup = this.stories ? this.stories.find(s => s.userId === userId) : null;
                    if (storyGroup) return storyGroup;
                    // Check viewedUser stories
                    if (this.viewedUser && this.viewedUser.id === userId && this.viewedUser.userStories && this.viewedUser.userStories.length > 0) {
                        return this.viewedUser.userStories[0];
                    }
                    return null;
                },
                
                handleViewStoryFromPopup() {
                    const data = this.profilePicPopupData;
                    if (data.isOwnProfile && this.myStories && this.myStories.length > 0) {
                        this.viewStory(this.myStories[0]);
                    } else if (data.storyData) {
                        if (typeof this.viewStoryGroup === 'function') {
                            this.viewStoryGroup(data.storyData);
                        } else if (typeof this.viewStory === 'function') {
                            this.viewStory(data.storyData);
                        }
                    }
                },

                // ============ HELPERS ============
                formatDate(date) {
                    if (!date) return '';
                    const d = new Date(date);
                    const now = new Date();
                    const diff = (now - d) / 1000;
                    
                    if (diff < 60) return 'Az √∂nce';
                    if (diff < 3600) return Math.floor(diff / 60) + ' dk';
                    if (diff < 86400) return Math.floor(diff / 3600) + ' sa';
                    if (diff < 604800) return Math.floor(diff / 86400) + ' g√ºn';
                    
                    return d.toLocaleDateString('tr-TR', { day: '2-digit', month: 'short' });
                },

                formatTime(date) {
                    if (!date) return '';
                    return new Date(date).toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit' });
                },

                formatJoinDate(date) {
                    if (!date) return 'Ocak 2024 tarihinde katƒ±ldƒ±';
                    const d = new Date(date);
                    const months = ['Ocak', '≈ûubat', 'Mart', 'Nisan', 'Mayƒ±s', 'Haziran', 'Temmuz', 'Aƒüustos', 'Eyl√ºl', 'Ekim', 'Kasƒ±m', 'Aralƒ±k'];
                    return `${months[d.getMonth()]} ${d.getFullYear()} tarihinde katƒ±ldƒ±`;
                },

                formatCount(num) {
                    if (!num) return '0';
                    if (num >= 1000000) return (num / 1000000).toFixed(1).replace(/\.0$/, '') + 'M';
                    if (num >= 1000) return (num / 1000).toFixed(1).replace(/\.0$/, '') + 'K';
                    return num.toString();
                },

                formatContent(content) {
                    if (!content) return '';
                    // √ñnce URL'leri ayƒ±kla ve placeholder ile deƒüi≈ütir
                    const urlRegex = /(https?:\/\/[^\s<]+|www\.[^\s<]+)/gi;
                    const urls = [];
                    let tempContent = content.replace(urlRegex, (url) => {
                        urls.push(url);
                        return `__URL_PLACEHOLDER_${urls.length - 1}__`;
                    });
                    // üîí Sonra i√ßeriƒüi escape et (XSS korumasƒ±) - DOM yerine string replace
                    let escaped = tempContent
                        .replace(/&/g, '&amp;').replace(/</g, '&lt;')
                        .replace(/>/g, '&gt;').replace(/"/g, '&quot;')
                        .replace(/'/g, '&#x27;').replace(/\//g, '&#x2F;');
                    // URL placeholder'larƒ±nƒ± ger√ßek linklerle deƒüi≈ütir
                    urls.forEach((url, i) => {
                        let href = url;
                        if (url.startsWith('www.')) {
                            href = 'https://' + url;
                        }
                        const safeHref = href.replace(/['"<>]/g, '');
                        if (/^https?:\/\//i.test(safeHref)) {
                            escaped = escaped.replace(`__URL_PLACEHOLDER_${i}__`, '<a href="' + safeHref + '" target="_blank" rel="noopener noreferrer" style="color:#3b82f6;text-decoration:underline;word-break:break-all;" onclick="event.stopPropagation()">' + url + '</a>');
                        } else {
                            escaped = escaped.replace(`__URL_PLACEHOLDER_${i}__`, url);
                        }
                    });
                    // Hashtags - tƒ±klanabilir
                    escaped = escaped.replace(/#(\w+)/g, '<span class="hashtag" onclick="window.searchHashtag(\'$1\')">#$1</span>');
                    // Mentions - tƒ±klanabilir
                    escaped = escaped.replace(/@(\w+)/g, '<span class="mention" onclick="window.viewUserByUsername(\'$1\')">@$1</span>');
                    return escaped;
                },
                
                // DM MESAJLARI ƒ∞√áƒ∞N Lƒ∞NK FORMATLAMA - MAVƒ∞ VE TIKLANABƒ∞Lƒ∞R
                formatMessageContent(content) {
                    if (!content) return '';
                    // üîí √ñnce t√ºm i√ßeriƒüi escape et (XSS korumasƒ±) - DOM yerine string replace
                    let escaped = content
                        .replace(/&/g, '&amp;').replace(/</g, '&lt;')
                        .replace(/>/g, '&gt;').replace(/"/g, '&quot;')
                        .replace(/'/g, '&#x27;').replace(/\//g, '&#x2F;');
                    // URL regex - http, https ve www ile ba≈ülayan linkler
                    const urlRegex = /(https?:\/\/[^\s<]+|www\.[^\s<]+)/gi;
                    // URL'leri mavi, tƒ±klanabilir linklere d√∂n√º≈üt√ºr
                    escaped = escaped.replace(urlRegex, (url) => {
                        let href = url;
                        if (url.startsWith('www.')) {
                            href = 'https://' + url;
                        }
                        // href'i de encode et - javascript: protocol korumasƒ±
                        try {
                            const parsed = new URL(href, window.location.origin);
                            if (!['http:', 'https:'].includes(parsed.protocol)) return url;
                        } catch(e) { return url; }
                        return `<a href="${href}" target="_blank" rel="noopener noreferrer" class="text-blue-400 hover:underline break-all" onclick="event.stopPropagation()">${url}</a>`;
                    });
                    return escaped;
                },

                async loadLikedPosts() {
                    try {
                        const res = await axios.get('/api/posts/liked');
                        this.likedPosts = res.data.posts || [];
                    } catch (e) { 
                        console.error('Beƒüenilen postlar y√ºklenemedi:', e); 
                    }
                },

                showToast(message) {
                    this.toast = { show: true, message };
                    setTimeout(() => { this.toast.show = false; }, 3000);
                },
                
                // ========== TIKTOK TARZI KAYDIRMA ==========
                // ========== AI CHAT FONKSƒ∞YONLARI ==========
                async checkAIOnline() {
                    try {
                        const r = await axios.get('/api/ai-chat/health', { timeout: 5000 });
                        this.aiOnline = r.data?.online === true;
                    } catch {
                        this.aiOnline = false;
                    }
                },

                async sendAIMessage() {
                    const text = this.aiInput.trim();
                    if (!text || this.aiTyping || !this.aiOnline) return;

                    this.aiMessages.push({ role: 'user', content: text });
                    this.aiInput = '';
                    this.aiTyping = true;
                    this.abScrollToBottom();

                    const history = this.aiMessages.slice(-10).map(m => ({ role: m.role, content: m.content }));
                    const systemMsg = {
                        role: 'system',
                        content: 'Sen AgroBotsun. T√ºrk √ßift√ßilerine tarƒ±m, hayvancƒ±lƒ±k, ekim, sulama, g√ºbre, hastalƒ±k-zararlƒ± ve hava konularƒ±nda T√ºrk√ße, kƒ±sa ve pratik √∂neriler veriyorsun. Teknik ama anla≈üƒ±lƒ±r ol.'
                    };

                    // Streaming bot mesajƒ± i√ßin bo≈ü slot a√ß
                    this.aiMessages.push({ role: 'assistant', content: '' });
                    const botIdx = this.aiMessages.length - 1;

                    try {
                        const res = await fetch('/api/ai-chat', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ messages: [systemMsg, ...history], stream: true, max_tokens: 512, temperature: 0.7 })
                        });

                        if (!res.ok || !res.body) throw new Error('Stream ba≈ülatƒ±lamadƒ±');

                        const reader = res.body.getReader();
                        const decoder = new TextDecoder();
                        let buffer = '';
                        this.aiTyping = false; // D√º≈ü√ºnme animasyonu bitti, kelimeler akmaya ba≈ülƒ±yor

                        while (true) {
                            const { done, value } = await reader.read();
                            if (done) break;
                            buffer += decoder.decode(value, { stream: true });
                            const lines = buffer.split(String.fromCharCode(10));
                            buffer = lines.pop();
                            for (const line of lines) {
                                if (!line.startsWith('data:')) continue;
                                const raw = line.slice(5).trim();
                                if (raw === '[DONE]') break;
                                try {
                                    const parsed = JSON.parse(raw);
                                    const token = parsed?.choices?.[0]?.delta?.content || parsed?.content || '';
                                    if (token) {
                                        this.aiMessages[botIdx].content += token;
                                        this.abScrollToBottom();
                                    }
                                } catch(e) {}
                            }
                        }

                        // Eƒüer stream gelmezse (server stream desteklemiyorsa) fallback
                        if (!this.aiMessages[botIdx].content) {
                            throw new Error('empty_stream');
                        }

                    } catch (streamErr) {
                        // Fallback: normal istek
                        try {
                            const res2 = await axios.post('/api/ai-chat', {
                                messages: [systemMsg, ...history],
                                stream: false, max_tokens: 512, temperature: 0.7
                            }, { timeout: 90000 });
                            const reply = res2.data?.choices?.[0]?.message?.content || res2.data?.content || res2.data?.response || 'Yanƒ±t alƒ±namadƒ±.';
                            // Kelime kelime animasyonla yaz (fallback stream sim√ºlasyonu)
                            this.aiMessages[botIdx].content = '';
                            const words = reply.trim().split(' ');
                            for (let i = 0; i < words.length; i++) {
                                await new Promise(r => setTimeout(r, 35));
                                this.aiMessages[botIdx].content += (i === 0 ? '' : ' ') + words[i];
                                if (i % 5 === 0) this.abScrollToBottom();
                            }
                        } catch (err) {
                            const errMsg = err.response?.data?.error || err.message || 'AI sunucusuna ula≈üƒ±lamadƒ±.';
                            this.aiMessages[botIdx].content = '‚ùå ' + errMsg;
                            if (err.code === 'ECONNABORTED' || (err.response?.status >= 500)) this.aiOnline = false;
                        }
                    } finally {
                        this.aiTyping = false;
                        this.abScrollToBottom();
                    }
                },

                // ========== AGROBOT v6 FONKSƒ∞YONLARI ==========

                resetAIChat() {
                    this.aiMessages = [{ role: 'assistant', content: 'Merhaba! Ben AgroBot. Tarƒ±m hakkƒ±nda soru sorabilirsiniz üå±' }];
                    this.aiInput = '';
                    this.aiTyping = false;
                    this.abSpeakingIdx = -1;
                    if (window.speechSynthesis) window.speechSynthesis.cancel();
                },

                abScrollToBottom() {
                    this.$nextTick(() => {
                        const box = document.getElementById('abMessages');
                        if (box) box.scrollTop = box.scrollHeight;
                    });
                },

                abShowToast(msg, color = '#00b894') {
                    const t = document.getElementById('abToast');
                    if (!t) return;
                    t.textContent = msg;
                    t.style.background = color;
                    t.classList.add('show');
                    setTimeout(() => t.classList.remove('show'), 2500);
                },

                quickAsk(text) {
                    this.aiInput = text;
                    this.sendAIMessage();
                },

                copyMessage(text) {
                    navigator.clipboard.writeText(text).then(() => {
                        this.abShowToast('‚úÖ Kopyalandƒ±!');
                    }).catch(() => {
                        // fallback
                        const el = document.createElement('textarea');
                        el.value = text; document.body.appendChild(el);
                        el.select(); document.execCommand('copy');
                        document.body.removeChild(el);
                        this.abShowToast('‚úÖ Kopyalandƒ±!');
                    });
                },

                retryMessage(idx) {
                    // idx = bot mesajƒ± indeksi, bir √∂nceki user mesajƒ±nƒ± bul
                    let userMsg = null;
                    for (let i = idx - 1; i >= 0; i--) {
                        if (this.aiMessages[i].role === 'user') { userMsg = this.aiMessages[i].content; break; }
                    }
                    if (!userMsg) return;
                    // Bot mesajƒ±nƒ± kaldƒ±r, yeniden g√∂nder
                    this.aiMessages.splice(idx, 1);
                    this.aiInput = userMsg;
                    this.sendAIMessage();
                },

                speakMessage(text, idx) {
                    if (!window.speechSynthesis) {
                        this.abShowToast('‚ùå Tarayƒ±cƒ± TTS desteklemiyor', '#ff4757');
                        return;
                    }
                    if (this.abSpeakingIdx === idx) {
                        window.speechSynthesis.cancel();
                        this.abSpeakingIdx = -1;
                        return;
                    }
                    window.speechSynthesis.cancel();
                    const utter = new SpeechSynthesisUtterance(text);
                    utter.lang = 'tr-TR';
                    utter.rate = 0.95;
                    utter.pitch = 1;
                    this.abSpeakingIdx = idx;
                    utter.onend = () => { this.abSpeakingIdx = -1; };
                    utter.onerror = () => { this.abSpeakingIdx = -1; };
                    window.speechSynthesis.speak(utter);
                },

                toggleVoiceInput() {
                    const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
                    if (!SR) { this.abShowToast('‚ùå Tarayƒ±cƒ± ses tanƒ±ma desteklemiyor', '#ff4757'); return; }
                    if (this.abVoiceRecording) {
                        if (this.abVoiceRecognition) this.abVoiceRecognition.stop();
                        this.abVoiceRecording = false;
                        return;
                    }
                    const rec = new SR();
                    rec.lang = 'tr-TR';
                    rec.interimResults = false;
                    rec.maxAlternatives = 1;
                    rec.onresult = (e) => {
                        const transcript = e.results[0][0].transcript;
                        this.aiInput = transcript;
                        this.abVoiceRecording = false;
                        this.abShowToast('üéôÔ∏è "' + transcript.substring(0, 30) + '..."');
                    };
                    rec.onerror = () => { this.abVoiceRecording = false; this.abShowToast('‚ùå Ses tanƒ±ma hatasƒ±', '#ff4757'); };
                    rec.onend = () => { this.abVoiceRecording = false; };
                    this.abVoiceRecognition = rec;
                    rec.start();
                    this.abVoiceRecording = true;
                    this.abShowToast('üéôÔ∏è Dinliyorum...');
                },

                toggleAgroLive() {
                    const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
                    if (!SR) { this.abShowToast('‚ùå Tarayƒ±cƒ± ses tanƒ±ma desteklemiyor', '#ff4757'); return; }
                    if (!window.speechSynthesis) { this.abShowToast('‚ùå TTS desteklemiyor', '#ff4757'); return; }
                    this.agroLiveMode = !this.agroLiveMode;
                    if (this.agroLiveMode) {
                        this.abShowToast('üî¥ AgroLive modu a√ßƒ±ldƒ± ‚Äî Mikrofona bas ve konu≈ü!');
                    } else {
                        this.endAgroLive();
                        this.abShowToast('AgroLive kapatƒ±ldƒ±');
                    }
                },

                startAgroLive() {
                    if (this.agroLiveActive) { this.endAgroLive(); return; }
                    const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
                    if (!SR) return;
                    this.agroLiveActive = true;
                    this.agroLiveStatus = 'Dinliyorum...';
                    this.agroLiveTranscript = '';
                    this.agroLiveMuted = false;

                    // Dalga animasyonu
                    this.agroLiveWaveInterval = setInterval(() => {
                        for (let i = 1; i <= 14; i++) {
                            const bar = document.getElementById('wbar' + i);
                            if (bar) bar.style.height = (Math.random() * 28 + 4) + 'px';
                        }
                    }, 120);

                    const rec = new SR();
                    rec.lang = 'tr-TR';
                    rec.continuous = false;
                    rec.interimResults = true;
                    rec.onresult = (e) => {
                        let interim = '';
                        let final = '';
                        for (let r of e.results) {
                            if (r.isFinal) final += r[0].transcript;
                            else interim += r[0].transcript;
                        }
                        this.agroLiveTranscript = final || interim;
                        if (final) {
                            this.agroLiveStatus = 'Yanƒ±t hazƒ±rlanƒ±yor...';
                            this.agroLiveReplySpeech(final.trim());
                        }
                    };
                    rec.onerror = () => { this.endAgroLive(); this.abShowToast('‚ùå Mikrofon hatasƒ±', '#ff4757'); };
                    rec.onend = () => {
                        if (this.agroLiveActive && !this.agroLiveMuted) {
                            // Konu≈üma bitince tekrar dinle
                            setTimeout(() => {
                                if (this.agroLiveActive && !this.agroLiveSpeaking) {
                                    try { rec.start(); } catch(e) {}
                                }
                            }, 800);
                        }
                    };
                    this.agroLiveRecognition = rec;
                    try { rec.start(); } catch(e) {}
                },

                async agroLiveReplySpeech(userText) {
                    if (!userText || !this.aiOnline) return;
                    this.agroLiveSpeaking = true;
                    this.aiMessages.push({ role: 'user', content: userText });
                    this.aiTyping = true;
                    this.abScrollToBottom();
                    try {
                        const history = this.aiMessages.slice(-8).map(m => ({ role: m.role, content: m.content }));
                        const systemMsg = { role: 'system', content: 'Sen AgroBotsun. T√ºrk √ßift√ßilerine tarƒ±m, hayvancƒ±lƒ±k, ekim, sulama, g√ºbre, hastalƒ±k-zararlƒ± ve hava konularƒ±nda T√ºrk√ße, kƒ±sa ve pratik √∂neriler veriyorsun. AgroLive sesli sohbet modundasƒ±n ‚Äî √ßok kƒ±sa (1-2 c√ºmle) ve konu≈üma diline uygun cevaplar ver.' };
                        const res = await axios.post('/api/ai-chat', { messages: [systemMsg, ...history], stream: false, max_tokens: 200, temperature: 0.7 }, { timeout: 30000 });
                        const fullReply = (res.data?.choices?.[0]?.message?.content || res.data?.content || res.data?.response || 'Yanƒ±t alƒ±namadƒ±.').trim();
                        // Kelime kelime yaz
                        this.aiMessages.push({ role: 'assistant', content: '' });
                        const botIdx = this.aiMessages.length - 1;
                        this.aiTyping = false;
                        const words = fullReply.split(' ');
                        for (let i = 0; i < words.length; i++) {
                            await new Promise(r => setTimeout(r, 40));
                            this.aiMessages[botIdx].content += (i === 0 ? '' : ' ') + words[i];
                        }
                        const reply = this.aiMessages[botIdx].content;
                        this.abScrollToBottom();

                        // Sesli oku
                        if (window.speechSynthesis) {
                            window.speechSynthesis.cancel();
                            const utter = new SpeechSynthesisUtterance(reply.trim());
                            utter.lang = 'tr-TR'; utter.rate = 1; utter.pitch = 1;
                            this.agroLiveStatus = 'Yanƒ±t veriliyor...';
                            this.agroLiveTranscript = reply.trim();
                            utter.onend = () => {
                                this.agroLiveSpeaking = false;
                                if (this.agroLiveActive && !this.agroLiveMuted) {
                                    this.agroLiveStatus = 'Dinliyorum...';
                                    this.agroLiveTranscript = '';
                                    try { if (this.agroLiveRecognition) this.agroLiveRecognition.start(); } catch(e) {}
                                }
                            };
                            window.speechSynthesis.speak(utter);
                        }
                    } catch(err) {
                        this.aiTyping = false;
                        this.agroLiveSpeaking = false;
                        this.aiMessages.push({ role: 'assistant', content: '‚ùå Baƒülantƒ± hatasƒ±.' });
                        this.abScrollToBottom();
                    }
                },

                toggleLiveMute() {
                    this.agroLiveMuted = !this.agroLiveMuted;
                    if (this.agroLiveMuted) {
                        if (this.agroLiveRecognition) try { this.agroLiveRecognition.stop(); } catch(e) {}
                        window.speechSynthesis.cancel();
                        this.agroLiveStatus = 'Sessiz mod';
                        this.abShowToast('üîá Mikrofon kapatƒ±ldƒ±');
                    } else {
                        this.agroLiveStatus = 'Dinliyorum...';
                        this.agroLiveTranscript = '';
                        try { if (this.agroLiveRecognition) this.agroLiveRecognition.start(); } catch(e) {}
                        this.abShowToast('üéôÔ∏è Mikrofon a√ßƒ±ldƒ±');
                    }
                },

                endAgroLive() {
                    this.agroLiveActive = false;
                    this.agroLiveSpeaking = false;
                    if (this.agroLiveRecognition) { try { this.agroLiveRecognition.stop(); } catch(e) {} this.agroLiveRecognition = null; }
                    if (this.agroLiveWaveInterval) { clearInterval(this.agroLiveWaveInterval); this.agroLiveWaveInterval = null; }
                    if (window.speechSynthesis) window.speechSynthesis.cancel();
                    this.agroLiveStatus = 'Dinliyorum...';
                    this.agroLiveTranscript = '';
                    this.abShowToast('AgroLive sesli g√∂r√º≈üme sonlandƒ±');
                },

                // ========== END AGROBOT v6 ==========

                openTikTokScroll(clickedPost) {
                    // Feed'i kopyala, tƒ±klanan post yoksa ekle
                    const allPosts = [...this.feed];
                    if (!allPosts.find(p => p.id === clickedPost.id)) {
                        allPosts.unshift(clickedPost);
                    }
                    this.tikTokPosts = allPosts;

                    // ‚úÖ D√úZELTME K√ñK NEDEN: id ile bul (nesne referansƒ± farklƒ± olabilir)
                    const targetIndex = this.tikTokPosts.findIndex(p => p.id === clickedPost.id);
                    this.currentTikTokIndex = targetIndex === -1 ? 0 : targetIndex;

                    this.showTikTokScroll = true;
                    document.body.style.overflow = 'hidden';

                    // ‚úÖ D√úZELTME SCROLL:
                    // Sorun 1: Alpine x-for listesi render tamamlanmadan scroll yapƒ±lƒ±yordu ‚Üí retry ile bekleniyor
                    // Sorun 2: container.clientHeight dvh farklƒ±lƒ±ƒüƒ±ndan dolayƒ± yanlƒ±≈ü hesaplƒ±yordu
                    // √á√∂z√ºm: ƒ∞lk .tiktok-post'un ger√ßek y√ºksekliƒüini al (getBoundingClientRect)
                    const savedIndex = this.currentTikTokIndex;
                    this.$nextTick(() => {
                        const doScroll = (attempt) => {
                            const container = document.querySelector('.tiktok-scroll-wrapper');
                            if (!container) {
                                if (attempt < 40) requestAnimationFrame(() => doScroll(attempt + 1));
                                return;
                            }
                            const postEls = container.querySelectorAll('.tiktok-post');
                            if (postEls.length < savedIndex + 1) {
                                if (attempt < 40) requestAnimationFrame(() => doScroll(attempt + 1));
                                return;
                            }
                            if (savedIndex === 0) return; // Zaten en √ºstte

                            // Ger√ßek eleman y√ºksekliƒüini √∂l√ß (100dvh'ƒ± g√ºvenilir ≈üekilde alƒ±r)
                            const postH = postEls[0].getBoundingClientRect().height || container.clientHeight;
                            container.scrollTo({ top: savedIndex * postH, behavior: 'instant' });
                        };
                        doScroll(0);
                    });
                },
                
                closeTikTokScroll() {
                    this.showTikTokScroll = false;
                    document.body.style.overflow = '';
                },
                
                _tiktokScrollRAF: null,
                _tiktokLastIndex: -1,
                handleTikTokScroll(e) {
                    if (this._tiktokScrollRAF) return;
                    this._tiktokScrollRAF = requestAnimationFrame(() => {
                        const container = e.target;
                        const scrollTop = container.scrollTop;
                        const firstPost = container.querySelector('.tiktok-post');
                        const postHeight = firstPost
                            ? firstPost.getBoundingClientRect().height
                            : container.clientHeight;
                        const newIndex = Math.round(scrollTop / postHeight);
                        
                        if (newIndex !== this._tiktokLastIndex && newIndex >= 0 && newIndex < this.tikTokPosts.length) {
                            this._tiktokLastIndex = newIndex;
                            this.currentTikTokIndex = newIndex;
                            
                            // Son videoya yakla≈ütƒ±ƒüƒ±nda daha fazla video y√ºkle
                            if (newIndex >= this.tikTokPosts.length - 3 && this.hasMore && !this.loadingMore) {
                                this.fetchPosts().then(() => {
                                    const newPosts = this.feed.filter(p => !this.tikTokPosts.find(tp => tp.id === p.id));
                                    this.tikTokPosts = [...this.tikTokPosts, ...newPosts];
                                });
                            }
                        }
                        this._tiktokScrollRAF = null;
                    });
                },
                
                handleTouchStart(e) {
                    this.touchStartY = e.touches[0].clientY;
                },
                
                handleTouchEnd(e, post) {
                    const touchEndY = e.changedTouches[0].clientY;
                    const diff = this.touchStartY - touchEndY;
                    
                    if (diff > 50) {
                        this.nextTikTokPost();
                    } else if (diff < -50) {
                        this.prevTikTokPost();
                    }
                },
                
                nextTikTokPost() {
                    if (this.currentTikTokIndex < this.tikTokPosts.length - 1) {
                        this.currentTikTokIndex++;
                        this.scrollToTikTokPost(this.currentTikTokIndex);
                    }
                },
                
                prevTikTokPost() {
                    if (this.currentTikTokIndex > 0) {
                        this.currentTikTokIndex--;
                        this.scrollToTikTokPost(this.currentTikTokIndex);
                    }
                },
                
                scrollToTikTokPost(index) {
                    const container = document.querySelector('.tiktok-scroll-wrapper');
                    if (container) {
                        const firstPost = container.querySelector('.tiktok-post');
                        const postH = firstPost
                            ? firstPost.getBoundingClientRect().height
                            : container.clientHeight;
                        // scroll-snap kendi animasyonunu yapƒ±yor ‚Äî instant kullan
                        container.scrollTo({ top: index * postH, behavior: 'instant' });
                    }
                },
                
                // ========== KALP ATMA ANIMasyonu ==========
                showHeartAnim(postId) {
                    this.showHeartAnimation = postId;
                    setTimeout(() => { this.showHeartAnimation = false; }, 800);
                },
                
                doubleTapLike(post) {
                    this.showHeartAnim(post.id);
                    if (!post.isLiked) {
                        this.likePost(post);
                    }
                },
                
                // ========== SES KAYIT ==========
                async startVoiceRecord() {
                    if (this.isRecording) {
                        this.stopVoiceRecord();
                        return;
                    }
                    
                    try {
                        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                        this.mediaRecorder = new MediaRecorder(stream);
                        this.recordedChunks = [];
                        this.voiceDuration = 0;
                        
                        this.mediaRecorder.ondataavailable = (e) => {
                            if (e.data.size > 0) {
                                this.recordedChunks.push(e.data);
                            }
                        };
                        
                        this.mediaRecorder.onstop = () => {
                            const blob = new Blob(this.recordedChunks, { type: 'audio/webm' });
                            this.voicePreview = URL.createObjectURL(blob);
                            this.voiceBlob = blob;
                        };
                        
                        this.mediaRecorder.start();
                        this.isRecording = true;
                        
                        // S√ºre sayacƒ±
                        this.recordingTimer = setInterval(() => {
                            this.voiceDuration++;
                            if (this.voiceDuration >= 60) { // Max 60 saniye
                                this.stopVoiceRecord();
                            }
                        }, 1000);
                        
                    } catch (err) {
                        console.error('Mikrofon eri≈üim hatasƒ±:', err);
                        this.showToast('Mikrofona eri≈üilemedi');
                    }
                },
                
                stopVoiceRecord() {
                    if (this.mediaRecorder && this.isRecording) {
                        this.mediaRecorder.stop();
                        this.mediaRecorder.stream.getTracks().forEach(track => track.stop());
                        clearInterval(this.recordingTimer);
                        this.isRecording = false;
                    }
                },
                
                cancelVoiceRecord() {
                    this.voicePreview = null;
                    this.voiceBlob = null;
                    this.voiceDuration = 0;
                },
                
                async sendVoiceMessage() {
                    if (!this.voiceBlob) return;
                    if (!this.activeChat.otherId) {
                        this.showToast("Sohbet bilgisi eksik");
                        return;
                    }
                    
                    const formData = new FormData();
                    formData.append('voice', this.voiceBlob, 'voice.webm');
                    formData.append('recipientId', this.activeChat.otherId);
                    
                    // Optimistic update
                    const tempId = Date.now();
                    this.chatMessages.push({
                        id: tempId,
                        senderId: this.user.id,
                        senderName: this.user.name,
                        senderProfilePic: this.user.profilePic,
                        content: this.voicePreview,
                        type: 'voice',
                        duration: this.voiceDuration,
                        isUploading: true,
                        createdAt: new Date().toISOString()
                    });
                    this.scrollToBottom();
                    
                    try {
                        const res = await axios.post('/api/messages/voice', formData);
                        
                        const idx = this.chatMessages.findIndex(m => m.id === tempId);
                        if (idx !== -1) {
                            this.chatMessages[idx].id = res.data.messageId;
                            this.chatMessages[idx].isUploading = false;
                            this.chatMessages[idx].content = res.data.voiceUrl || this.voicePreview;
                        }
                        
                        this.voicePreview = null;
                        this.voiceBlob = null;
                        this.voiceDuration = 0;
                    } catch (e) {
                        this.showToast('Ses mesajƒ± g√∂nderilemedi');
                        this.chatMessages = this.chatMessages.filter(m => m.id !== tempId);
                    }
                },
                
                // ========== Hƒ∞KAYE G√ñR√úNT√úLEYENLER ==========
                async loadStoryViewers(storyId) {
                    try {
                        // √ñnce g√∂r√ºnt√ºleme kaydƒ± yap
                        await axios.post(`/api/stories/${storyId}/view`).catch(() => {});
                        
                        const res = await axios.get(`/api/stories/${storyId}/viewers`);
                        this.storyViewersList = res.data.viewers || res.data || [];
                        this.showStoryViewers = true;
                        
                        if (this.storyViewersList.length === 0) {
                            this.showToast('Hen√ºz kimse g√∂rmemi≈ü');
                        }
                    } catch (e) {
                        console.error('Hikaye g√∂r√ºnt√ºleyenler y√ºklenemedi:', e);
                        this.storyViewersList = [];
                        this.showStoryViewers = true;
                        this.showToast('G√∂r√ºnt√ºleyenler y√ºklenemedi');
                    }
                },
                
                // ========== YORUM BEƒûENME ==========
                async likeComment(comment) {
                    try {
                        await axios.post(`/api/comments/${comment.id}/like`);
                        comment.isLiked = !comment.isLiked;
                        comment.likeCount = (comment.likeCount || 0) + (comment.isLiked ? 1 : -1);
                        this.showHeartAnim(comment.id);
                    } catch (e) {
                        console.error('Yorum beƒüenme hatasƒ±:', e);
                    }
                },
                
                // ========== PAYLA≈û ==========
                async sharePost(post) {
                    const shareUrl = `${window.location.origin}/p/${post.id}`;
                    if (navigator.share) {
                        try {
                            await navigator.share({
                                title: 'AgroLink G√∂nderisi',
                                text: post.content?.substring(0, 100) || 'Bir g√∂nderi payla≈ütƒ±',
                                url: shareUrl
                            });
                        } catch (e) {
                            // Kullanƒ±cƒ± iptal etti
                        }
                    } else {
                        // Kopyala
                        navigator.clipboard.writeText(shareUrl);
                        this.showToast('Link kopyalandƒ±: ' + shareUrl);
                    }
                },
                
                // Profil Payla≈ü
                async shareProfile(user) {
                    const userId = user?.id || this.viewedUser?.id || this.user?.id;
                    const userName = user?.username || this.viewedUser?.username || this.user?.username;
                    if (!userId) {
                        this.showToast('Profil bilgisi bulunamadƒ±');
                        return;
                    }
                    const shareUrl = `${window.location.origin}/u/${userId}`;
                    if (navigator.share) {
                        try {
                            await navigator.share({
                                title: `${userName} - AgroLink Profili`,
                                text: `${userName} kullanƒ±cƒ±sƒ±nƒ±n AgroLink profilini g√∂r√ºnt√ºle`,
                                url: shareUrl
                            });
                        } catch (e) {
                            // Kullanƒ±cƒ± iptal etti
                        }
                    } else {
                        navigator.clipboard.writeText(shareUrl);
                        this.showToast('Profil linki kopyalandƒ±: ' + shareUrl);
                    }
                },
                
                // ========== POST URL PAYLA≈û (YENƒ∞) ==========
                async sharePostURL(post) {
                    const shareUrl = `${window.location.origin}/p/${post.id}`;
                    try {
                        await navigator.clipboard.writeText(shareUrl);
                        this.showToast('üîó Link kopyalandƒ±!');
                    } catch (e) {
                        this.showToast('Link kopyalanamadƒ±');
                    }
                },
                
                // ========== DM'DE POST PAYLA≈û (YENƒ∞) ==========
                showShareToDMModal: false,
                postToShare: null,
                dmShareSearchQuery: '',
                dmShareResults: [],
                
                openShareToDMModal(post) {
                    this.postToShare = post;
                    this.showShareToDMModal = true;
                    this.dmShareSearchQuery = '';
                    this.dmShareResults = [];
                    this.loadConversations();
                },
                
                async searchUsersForDMShare() {
                    if (!this.dmShareSearchQuery.trim()) {
                        this.dmShareResults = [];
                        return;
                    }
                    try {
                        const res = await axios.get(`api/users/search?q=${encodeURIComponent(this.dmShareSearchQuery)}`);
                        this.dmShareResults = res.data.users || [];
                    } catch (e) {
                        console.error('Kullanƒ±cƒ± arama hatasƒ±:', e);
                    }
                },
                
                async sharePostToDM(userId) {
                    if (!this.postToShare) return;
                    try {
                        await axios.post('/api/messages/share-post', {
                            postId: this.postToShare.id,
                            recipientId: userId
                        });
                        this.showToast('üì§ G√∂nderi payla≈üƒ±ldƒ±!');
                        this.showShareToDMModal = false;
                        this.postToShare = null;
                    } catch (e) {
                        this.showToast('G√∂nderi payla≈üƒ±lamadƒ±');
                    }
                },
                
                // ========== G√ñR√úNT√úL√ú ARAMA (WEBRTC - YENƒ∞) ==========
                showVideoCallModal: false,
                showIncomingCallModal: false,
                activeCall: null,
                incomingCall: null,
                localStream: null,
                remoteStream: null,
                peerConnection: null,
                callTimer: null,
                callDuration: 0,
                isMuted: false,
                isVideoOff: false,
                
                async initiateVideoCall(recipientId) {
                    try {
                        // Aktif sohbet bilgilerini kullan
                        const recipientInfo = this.activeChat && this.activeChat.otherId === recipientId ? {
                            id: recipientId,
                            name: this.activeChat.name,
                            profilePic: this.activeChat.profilePic
                        } : null;

                        // √ñnce kamera/mikrofon eri≈üimi iste
                        try {
                            this.localStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
                        } catch (mediaError) {
                            this.showToast('Kamera ve mikrofon eri≈üimi gerekli');
                            return;
                        }
                        
                        // Modal'ƒ± hemen a√ß (baƒülantƒ± bekleniyor durumunda)
                        this.activeCall = {
                            callId: Date.now().toString(),
                            recipient: recipientInfo || { id: recipientId, name: 'Kullanƒ±cƒ±', profilePic: '' },
                            type: 'video'
                        };
                        this.showVideoCallModal = true;
                        this.startCallTimer();
                        
                        // Yerel videoyu g√∂ster
                        this.$nextTick(() => {
                            const localVideo = document.getElementById('localVideo');
                            if (localVideo && this.localStream) {
                                localVideo.srcObject = this.localStream;
                            }
                        });
                        
                        // API'ye bildir (opsiyonel)
                        try {
                            const res = await axios.post('/api/calls/initiate', { recipientId });
                            if (res.data.callId) {
                                this.activeCall.callId = res.data.callId;
                            }
                        } catch (apiError) {
                            console.log('API baƒülantƒ±sƒ± yok, demo modda √ßalƒ±≈üƒ±yor');
                        }
                        
                    } catch (e) {
                        console.error('Video arama hatasƒ±:', e);
                        this.showToast('Arama ba≈ülatƒ±lƒ±yor... Kamera eri≈üimi kontrol ediliyor.');
                    }
                },
                
                async initiateAudioCall(recipientId) {
                    try {
                        // Aktif sohbet bilgilerini kullan
                        const recipientInfo = this.activeChat && this.activeChat.otherId === recipientId ? {
                            id: recipientId,
                            name: this.activeChat.name,
                            profilePic: this.activeChat.profilePic
                        } : null;

                        // √ñnce mikrofon eri≈üimi iste
                        try {
                            this.localStream = await navigator.mediaDevices.getUserMedia({ video: false, audio: true });
                        } catch (mediaError) {
                            this.showToast('Mikrofon eri≈üimi gerekli');
                            return;
                        }
                        
                        // Modal'ƒ± hemen a√ß
                        this.activeCall = {
                            callId: Date.now().toString(),
                            recipient: recipientInfo || { id: recipientId, name: 'Kullanƒ±cƒ±', profilePic: '' },
                            type: 'audio'
                        };
                        this.showVideoCallModal = true;
                        this.isVideoOff = true; // Sesli aramada video kapalƒ±
                        this.startCallTimer();
                        
                        // API'ye bildir (opsiyonel)
                        try {
                            const res = await axios.post('/api/calls/initiate', { recipientId });
                            if (res.data.callId) {
                                this.activeCall.callId = res.data.callId;
                            }
                        } catch (apiError) {
                            console.log('API baƒülantƒ±sƒ± yok, demo modda √ßalƒ±≈üƒ±yor');
                        }
                        
                    } catch (e) {
                        console.error('Sesli arama hatasƒ±:', e);
                        this.showToast('Arama ba≈ülatƒ±lƒ±yor...');
                    }
                },
                
                async initializeWebRTC(recipientId, type) {
                    try {
                        // Kamera/Mikrofon eri≈üimi
                        const constraints = type === 'video' 
                            ? { video: true, audio: true }
                            : { video: false, audio: true };
                        
                        this.localStream = await navigator.mediaDevices.getUserMedia(constraints);
                        
                        // Yerel videoyu g√∂ster
                        const localVideo = document.getElementById('localVideo');
                        if (localVideo) {
                            localVideo.srcObject = this.localStream;
                        }
                        
                        // PeerConnection olu≈ütur
                        this.peerConnection = new RTCPeerConnection({
                            iceServers: [
                                { urls: 'stun:stun.l.google.com:19302' },
                                { urls: 'stun:stun1.l.google.com:19302' }
                            ]
                        });
                        
                        // Yerel stream'i ekle
                        this.localStream.getTracks().forEach(track => {
                            this.peerConnection.addTrack(track, this.localStream);
                        });
                        
                        // Uzak stream'i al
                        this.peerConnection.ontrack = (event) => {
                            this.remoteStream = event.streams[0];
                            const remoteVideo = document.getElementById('remoteVideo');
                            if (remoteVideo) {
                                remoteVideo.srcObject = this.remoteStream;
                            }
                        };
                        
                        // ICE candidate'larƒ± g√∂nder
                        this.peerConnection.onicecandidate = (event) => {
                            if (event.candidate) {
                                axios.post('/api/calls/signal/ice', {
                                    callId: this.activeCall.callId,
                                    candidate: event.candidate
                                });
                            }
                        };
                        
                        // Offer olu≈ütur
                        const offer = await this.peerConnection.createOffer();
                        await this.peerConnection.setLocalDescription(offer);
                        
                        // Offer'ƒ± g√∂nder
                        await axios.post('/api/calls/signal/offer', {
                            callId: this.activeCall.callId,
                            offer: offer
                        });
                        
                    } catch (e) {
                        console.error('WebRTC ba≈ülatma hatasƒ±:', e);
                        this.showToast('Kamera/Mikrofon eri≈üimi gerekli');
                    }
                },
                
                async acceptIncomingCall() {
                    if (!this.incomingCall) return;
                    
                    try {
                        await axios.post('/api/calls/respond', {
                            callId: this.incomingCall.callId,
                            response: 'accept'
                        });
                        
                        this.showIncomingCallModal = false;
                        this.activeCall = {
                            callId: this.incomingCall.callId,
                            recipient: this.incomingCall.caller,
                            type: 'video'
                        };
                        this.showVideoCallModal = true;
                        this.startCallTimer();
                        
                        // WebRTC yanƒ±t bekle
                        this.waitForWebRTCAnswer();
                        
                    } catch (e) {
                        this.showToast('Arama kabul edilemedi');
                    }
                },
                
                async rejectIncomingCall() {
                    if (!this.incomingCall) return;
                    
                    try {
                        await axios.post('/api/calls/respond', {
                            callId: this.incomingCall.callId,
                            response: 'reject'
                        });
                        
                        this.showIncomingCallModal = false;
                        this.incomingCall = null;
                    } catch (e) {
                        this.showToast('Arama reddedilemedi');
                    }
                },
                
                async waitForWebRTCAnswer() {
                    // Answer'ƒ± bekle ve set et
                    // Bu kƒ±sƒ±m socket.io ile ger√ßekle≈ütirilmeli
                },
                
                async endCall() {
                    if (this.activeCall) {
                        try {
                            await axios.post('/api/calls/end', {
                                callId: this.activeCall.callId
                            });
                        } catch (e) {
                            console.error('Arama sonlandƒ±rma hatasƒ±:', e);
                        }
                    }
                    
                    // Stream'leri temizle
                    if (this.localStream) {
                        this.localStream.getTracks().forEach(track => track.stop());
                        this.localStream = null;
                    }
                    
                    if (this.peerConnection) {
                        this.peerConnection.close();
                        this.peerConnection = null;
                    }
                    
                    this.stopCallTimer();
                    this.showVideoCallModal = false;
                    this.activeCall = null;
                    this.remoteStream = null;
                },
                
                toggleMute() {
                    if (this.localStream) {
                        const audioTrack = this.localStream.getAudioTracks()[0];
                        if (audioTrack) {
                            audioTrack.enabled = !audioTrack.enabled;
                            this.isMuted = !audioTrack.enabled;
                        }
                    }
                },
                
                toggleVideo() {
                    if (this.localStream) {
                        const videoTrack = this.localStream.getVideoTracks()[0];
                        if (videoTrack) {
                            videoTrack.enabled = !videoTrack.enabled;
                            this.isVideoOff = !videoTrack.enabled;
                        }
                    }
                },
                
                startCallTimer() {
                    this.callDuration = 0;
                    this.callTimer = setInterval(() => {
                        this.callDuration++;
                    }, 1000);
                },
                
                stopCallTimer() {
                    if (this.callTimer) {
                        clearInterval(this.callTimer);
                        this.callTimer = null;
                    }
                },
                
                formatCallDuration(seconds) {
                    const mins = Math.floor(seconds / 60);
                    const secs = seconds % 60;
                    return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
                },
                
                // ========== KAYDEDƒ∞LEN G√ñNDERƒ∞LER D√úZELTME ==========
                async loadSavedPosts() {
                    try {
                        this.loading = true;
                        const res = await axios.get('/api/posts/saved');
                        this.savedPostsList = res.data.posts || [];
                        console.log('Kaydedilen g√∂nderiler y√ºklendi:', this.savedPostsList.length);
                    } catch (e) { 
                        console.error('Kaydedilen g√∂nderiler y√ºklenemedi:', e);
                        this.savedPostsList = [];
                    } finally {
                        this.loading = false;
                    }
                },
                
                // ========== ENGELLENEN KULLANICILAR D√úZELTME ==========
                async loadBlockedAccounts() {
                    this.blockedAccountsList = null; // null = y√ºkleniyor
                    try {
                        const res = await axios.get('/api/users/blocked');
                        this.blockedAccountsList = res.data.blockedUsers || [];
                        console.log('Engellenen hesaplar y√ºklendi:', this.blockedAccountsList.length);
                    } catch (e) {
                        console.error('Engellenen hesaplar y√ºklenemedi:', e);
                        this.blockedAccountsList = [];
                    }
                },
                
                // ========== PAYLA≈ûILAN POST SAYFASI ==========
                async loadSharedPost(postId) {
                    try {
                        this.loading = true;
                        const res = await axios.get(`/api/posts/${postId}`);
                        if (res.data.post) {
                            this.sharedPost = res.data.post;
                            this.sharedPostComments = res.data.comments || [];
                            this.showSharedPostPage = true;
                        }
                    } catch (e) {
                        console.error('Payla≈üƒ±lan post y√ºklenemedi:', e);
                        this.showToast('G√∂nderi bulunamadƒ±');
                    } finally {
                        this.loading = false;
                    }
                },
                
                // ========== PAYLA≈ûILAN PROFƒ∞L SAYFASI ==========
                async loadSharedProfile(userId) {
                    try {
                        this.loading = true;
                        const res = await axios.get(`/api/users/${userId}`);
                        if (res.data.user) {
                            this.sharedProfile = res.data.user;
                            // Kullanƒ±cƒ±nƒ±n g√∂nderilerini y√ºkle
                            const postsRes = await axios.get(`/api/posts/user/${userId}`);
                            this.sharedProfilePosts = postsRes.data.posts || [];
                            this.showSharedProfilePage = true;
                        }
                    } catch (e) {
                        console.error('Payla≈üƒ±lan profil y√ºklenemedi:', e);
                        this.showToast('Profil bulunamadƒ±');
                    } finally {
                        this.loading = false;
                    }
                },
                
                // ========== Vƒ∞DEO/G√ñRSEL ƒ∞≈ûLEME HIZLANDIRMA ==========
                async processMediaOptimized(file, options = {}) {
                    const { maxWidth = 1920, maxHeight = 1080, quality = 0.85, maxSizeMB = 10 } = options;
                    
                    // Hemen d√∂n√º≈ü - k√º√ß√ºk dosyalar i√ßin
                    if (file.size < 1024 * 1024) { // 1MB'dan k√º√ß√ºk
                        return file;
                    }
                    
                    return new Promise((resolve, reject) => {
                        const isVideo = file.type.startsWith('video/');
                        
                        if (isVideo) {
                            // Video i√ßin hƒ±zlƒ± i≈üleme
                            if (file.size > maxSizeMB * 1024 * 1024) {
                                this.showToast('Video sƒ±kƒ±≈ütƒ±rƒ±lƒ±yor...');
                                // Video sƒ±kƒ±≈ütƒ±rma - basit yakla≈üƒ±m
                                const video = document.createElement('video');
                                video.preload = 'metadata';
                                video.onloadedmetadata = () => {
                                    URL.revokeObjectURL(video.src);
                                    // Dosya √ßok b√ºy√ºkse uyarƒ± ver ama g√∂nder
                                    if (file.size > 50 * 1024 * 1024) {
                                        this.showToast('Video boyutu √ßok b√ºy√ºk, y√ºkleniyor...');
                                    }
                                    resolve(file);
                                };
                                video.onerror = () => resolve(file);
                                video.src = URL.createObjectURL(file);
                            } else {
                                resolve(file);
                            }
                        } else {
                            // G√∂rsel i√ßin hƒ±zlƒ± sƒ±kƒ±≈ütƒ±rma
                            const img = new Image();
                            const canvas = document.createElement('canvas');
                            const ctx = canvas.getContext('2d');
                            
                            img.onload = () => {
                                let { width, height } = img;
                                
                                // Boyut sƒ±nƒ±rlama
                                if (width > maxWidth || height > maxHeight) {
                                    const ratio = Math.min(maxWidth / width, maxHeight / height);
                                    width *= ratio;
                                    height *= ratio;
                                }
                                
                                canvas.width = width;
                                canvas.height = height;
                                ctx.drawImage(img, 0, 0, width, height);
                                
                                canvas.toBlob((blob) => {
                                    if (blob) {
                                        const processedFile = new File([blob], file.name, {
                                            type: 'image/jpeg',
                                            lastModified: Date.now()
                                        });
                                        resolve(processedFile);
                                    } else {
                                        resolve(file);
                                    }
                                }, 'image/jpeg', quality);
                            };
                            
                            img.onerror = () => resolve(file);
                            img.src = URL.createObjectURL(file);
                        }
                    });
                },
        
        // ========== üìó FARMBOOK FONKSƒ∞YONLARI ==========
        
        async loadFarmbookRecords() {
            this.farmbookLoading = true;
            try {
                const params = new URLSearchParams();
                if (this.farmbookFilters.season) params.append('season', this.farmbookFilters.season);
                if (this.farmbookFilters.year) params.append('year', this.farmbookFilters.year);
                if (this.farmbookFilters.type) params.append('type', this.farmbookFilters.type);
                
                const res = await axios.get('/api/farmbook/records?' + params.toString());
                this.farmbookRecords = res.data.records || [];
            } catch (e) {
                console.error('Farmbook kayƒ±tlarƒ± y√ºklenemedi:', e);
                this.showToast('Kayƒ±tlar y√ºklenemedi');
            } finally {
                this.farmbookLoading = false;
            }
        },
        
        async loadFarmbookStats() {
            try {
                const params = new URLSearchParams();
                if (this.farmbookFilters.season) params.append('season', this.farmbookFilters.season);
                if (this.farmbookFilters.year) params.append('year', this.farmbookFilters.year);
                
                const res = await axios.get('/api/farmbook/stats?' + params.toString());
                this.farmbookStats = res.data.stats;
            } catch (e) {
                console.error('Farmbook istatistikleri y√ºklenemedi:', e);
            }
        },
        
        async loadFarmbookFields() {
            try {
                const res = await axios.get('/api/farmbook/fields');
                this.farmbookFields = res.data.fields || [];
            } catch (e) {
                console.error('Tarlalar y√ºklenemedi:', e);
            }
        },
        
        async openFarmbook() {
            this.showFarmbook = true;
            this.farmbookTab = 'records';
            // Demo data y√ºkle - API yoksa bile √ßalƒ±≈üsƒ±n
            this.farmbookRecords = this.farmbookRecords.length > 0 ? this.farmbookRecords : [
                { id: 1, recordType: 'ekim', productName: 'Buƒüday', fieldName: 'Ana Tarla', date: new Date().toISOString(), quantity: 500, unit: 'kg', cost: 2500, notes: 'ƒ∞lkbahar ekimi', season: 'ilkbahar', weatherCondition: 'gunesli' },
                { id: 2, recordType: 'gubre', productName: 'DAP G√ºbre', fieldName: 'G√ºney Tarla', date: new Date().toISOString(), quantity: 200, unit: 'kg', cost: 4000, notes: 'Taban g√ºbre', season: 'ilkbahar', weatherCondition: 'bulutlu' },
                { id: 3, recordType: 'hasat', productName: 'Domates', fieldName: 'Sera', date: new Date().toISOString(), quantity: 3000, unit: 'kg', income: 45000, notes: 'ƒ∞lk hasat', season: 'yaz', weatherCondition: 'gunesli' }
            ];
            this.farmbookStats = this.farmbookStats || { totalRecords: 3, totalCost: 6500, totalIncome: 45000, profit: 38500 };
            this.farmbookFields = this.farmbookFields.length > 0 ? this.farmbookFields : [
                { id: 1, name: 'Ana Tarla', area: 50, unit: 'dekar' },
                { id: 2, name: 'G√ºney Tarla', area: 30, unit: 'dekar' },
                { id: 3, name: 'Sera', area: 5, unit: 'dekar' }
            ];
            try {
                await Promise.all([
                    this.loadFarmbookRecords(),
                    this.loadFarmbookStats(),
                    this.loadFarmbookFields()
                ]);
            } catch (e) {
                console.warn('Farmbook API mevcut deƒüil, demo mod aktif:', e);
            }
        },
        
        async saveFarmbookRecord() {
            if (!this.farmbookForm.recordType || !this.farmbookForm.recordDate) {
                this.showToast('Kayƒ±t tipi ve tarih zorunludur');
                return;
            }
            
            this.farmbookLoading = true;
            try {
                if (this.farmbookEditMode && this.farmbookEditId) {
                    await axios.put('/api/farmbook/records/' + this.farmbookEditId, this.farmbookForm);
                    this.showToast('Kayƒ±t g√ºncellendi');
                } else {
                    await axios.post('/api/farmbook/records', this.farmbookForm);
                    this.showToast('Kayƒ±t eklendi');
                }
                
                this.resetFarmbookForm();
                this.farmbookTab = 'records';
                await Promise.all([
                    this.loadFarmbookRecords(),
                    this.loadFarmbookStats()
                ]);
            } catch (e) {
                console.error('Kayƒ±t hatasƒ±:', e);
                this.showToast('Kayƒ±t eklenemedi');
            } finally {
                this.farmbookLoading = false;
            }
        },
        
        editFarmbookRecord(record) {
            this.farmbookEditMode = true;
            this.farmbookEditId = record.id;
            this.farmbookForm = { ...record };
            this.farmbookTab = 'add';
        },
        
        async deleteFarmbookRecord(id) {
            if (!confirm('Bu kaydƒ± silmek istediƒüinize emin misiniz?')) return;
            
            try {
                await axios.delete('/api/farmbook/records/' + id);
                this.showToast('Kayƒ±t silindi');
                await this.loadFarmbookRecords();
                await this.loadFarmbookStats();
            } catch (e) {
                console.error('Silme hatasƒ±:', e);
                this.showToast('Kayƒ±t silinemedi');
            }
        },
        
        resetFarmbookForm() {
            this.farmbookEditMode = false;
            this.farmbookEditId = null;
            this.farmbookForm = {
                recordType: 'ekim',
                productName: '',
                quantity: '',
                unit: 'kg',
                cost: '',
                income: '',
                recordDate: new Date().toISOString().split('T')[0],
                fieldName: '',
                fieldSize: '',
                fieldSizeUnit: 'dekar',
                season: '',
                year: new Date().getFullYear(),
                notes: '',
                harvestAmount: '',
                harvestUnit: 'kg',
                qualityRating: 3,
                weatherCondition: ''
            };
        },
        
        async exportFarmbook(format = 'csv') {
            try {
                const params = new URLSearchParams();
                if (this.farmbookFilters.season) params.append('season', this.farmbookFilters.season);
                if (this.farmbookFilters.year) params.append('year', this.farmbookFilters.year);
                params.append('format', format);
                
                const res = await axios.get('/api/farmbook/export?' + params.toString(), { responseType: 'blob' });
                
                const url = window.URL.createObjectURL(new Blob([res.data]));
                const link = document.createElement('a');
                link.href = url;
                link.setAttribute('download', `farmbook_${this.farmbookFilters.year || 'tum'}.csv`);
                document.body.appendChild(link);
                link.click();
                link.remove();
                window.URL.revokeObjectURL(url);
                
                this.showToast('Dosya indiriliyor...');
            } catch (e) {
                console.error('Export hatasƒ±:', e);
                this.showToast('Dosya indirilemedi');
            }
        },
        
        getRecordTypeInfo(type) {
            return this.farmbookRecordTypes.find(r => r.value === type) || { label: type, icon: 'fa-file', color: 'bg-gray-500' };
        },
        
        getSeasonLabel(season) {
            const s = this.farmbookSeasons.find(s => s.value === season);
            return s ? s.label : season;
        },
        
        formatMoney(val) {
            return parseFloat(val || 0).toLocaleString('tr-TR', { minimumFractionDigits: 2 });
        },
        
        closeFarmbook() {
            this.showFarmbook = false;
            this.resetFarmbookForm();
        },

        // =============================================================================
        // üõ∞Ô∏è UYDU TARLAM (NDVI) FONKSƒ∞YONLARI
        // =============================================================================
        
        async openSatellite() {
            this.showSatellite = true;
            this.satelliteTab = 'dashboard';
            // Demo data y√ºkle - API yoksa bile √ßalƒ±≈üsƒ±n
            this.satelliteDashboard = this.satelliteDashboard || { 
                totalFields: 3, 
                totalArea: 85, 
                lastAnalysis: new Date().toISOString(),
                avgNdvi: 0.72,
                healthStatus: 'ƒ∞yi'
            };
            this.satelliteFields = this.satelliteFields.length > 0 ? this.satelliteFields : [
                { id: 1, name: 'Ana Tarla', area: 50, coordinates: '39.9334,32.8597', lastNdvi: 0.78, healthStatus: '√áok ƒ∞yi', crop: 'Buƒüday', lastAnalysisDate: new Date().toISOString() },
                { id: 2, name: 'G√ºney Tarla', area: 30, coordinates: '39.9250,32.8650', lastNdvi: 0.65, healthStatus: 'ƒ∞yi', crop: 'Mƒ±sƒ±r', lastAnalysisDate: new Date().toISOString() },
                { id: 3, name: 'Sera', area: 5, coordinates: '39.9300,32.8550', lastNdvi: 0.82, healthStatus: 'M√ºkemmel', crop: 'Domates', lastAnalysisDate: new Date().toISOString() }
            ];
            try {
                await this.loadSatelliteDashboard();
            } catch (e) {
                console.warn('Satellite API mevcut deƒüil, demo mod aktif:', e);
            }
        },
        
        closeSatellite() {
            this.showSatellite = false;
            this.selectedField = null;
            this.selectedAnalysis = null;
            this.resetSatelliteForm();
        },
        
        async loadSatelliteDashboard() {
            this.satelliteLoading = true;
            try {
                const res = await axios.get('/api/satellite/dashboard');
                this.satelliteDashboard = res.data.dashboard;
            } catch (e) {
                console.error('Satellite dashboard hatasƒ±:', e);
                this.showToast('Dashboard y√ºklenemedi');
            } finally {
                this.satelliteLoading = false;
            }
        },
        
        async loadSatelliteFields() {
            this.satelliteLoading = true;
            try {
                const res = await axios.get('/api/satellite/fields');
                this.satelliteFields = res.data.fields || [];
            } catch (e) {
                console.error('Satellite fields hatasƒ±:', e);
                this.showToast('Tarlalar y√ºklenemedi');
            } finally {
                this.satelliteLoading = false;
            }
        },
        
        async selectField(field) {
            this.selectedField = field;
            this.satelliteTab = 'analysis';
            await this.loadFieldAnalyses(field.id);
        },
        
        async loadFieldAnalyses(fieldId) {
            this.satelliteLoading = true;
            try {
                const res = await axios.get(`/api/satellite/history/${fieldId}`);
                this.fieldAnalyses = res.data.analyses || [];
            } catch (e) {
                console.error('Field analyses hatasƒ±:', e);
                this.showToast('Analizler y√ºklenemedi');
            } finally {
                this.satelliteLoading = false;
            }
        },
        
        async analyzeField(fieldId) {
            if (this.satelliteAnalyzing) return;
            
            this.satelliteAnalyzing = true;
            this.showToast('üõ∞Ô∏è Uydu g√∂r√ºnt√ºs√º analiz ediliyor...');
            
            try {
                const res = await axios.post(`/api/satellite/analyze/${fieldId}`);
                this.selectedAnalysis = res.data.analysis;
                this.showToast('‚úÖ Analiz tamamlandƒ±!');
                
                // Analizleri ve dashboard'u yenile
                await this.loadFieldAnalyses(fieldId);
                await this.loadSatelliteDashboard();
            } catch (e) {
                console.error('Analyze hatasƒ±:', e);
                const errorMsg = e.response?.data?.error || 'Analiz yapƒ±lamadƒ±';
                this.showToast('‚ùå ' + errorMsg);
            } finally {
                this.satelliteAnalyzing = false;
            }
        },
        
        async saveSatelliteField() {
            if (!this.satelliteForm.name || this.satelliteForm.polygon.length < 3) {
                this.showToast('Tarla adƒ± ve en az 3 nokta gerekli');
                return;
            }
            
            this.satelliteLoading = true;
            try {
                if (this.satelliteEditMode && this.satelliteEditId) {
                    await axios.put(`/api/satellite/fields/${this.satelliteEditId}`, this.satelliteForm);
                    this.showToast('Tarla g√ºncellendi');
                } else {
                    await axios.post('/api/satellite/fields', this.satelliteForm);
                    this.showToast('Tarla eklendi');
                }
                
                this.resetSatelliteForm();
                this.satelliteTab = 'fields';
                await this.loadSatelliteFields();
                await this.loadSatelliteDashboard();
            } catch (e) {
                console.error('Save field hatasƒ±:', e);
                this.showToast('Tarla kaydedilemedi');
            } finally {
                this.satelliteLoading = false;
            }
        },
        
        editSatelliteField(field) {
            this.satelliteEditMode = true;
            this.satelliteEditId = field.id;
            this.satelliteForm = {
                name: field.name,
                description: field.description || '',
                cropType: field.cropType || '',
                plantingDate: field.plantingDate || '',
                city: field.city || '',
                district: field.district || '',
                color: field.color || '#00b894',
                polygon: field.polygon || []
            };
            this.satelliteTab = 'add';
        },
        
        async deleteSatelliteField(fieldId) {
            if (!confirm('Bu tarlayƒ± silmek istediƒüinize emin misiniz?')) return;
            
            try {
                await axios.delete(`/api/satellite/fields/${fieldId}`);
                this.showToast('Tarla silindi');
                await this.loadSatelliteFields();
                await this.loadSatelliteDashboard();
                
                if (this.selectedField && this.selectedField.id === fieldId) {
                    this.selectedField = null;
                    this.satelliteTab = 'fields';
                }
            } catch (e) {
                console.error('Delete field hatasƒ±:', e);
                this.showToast('Tarla silinemedi');
            }
        },
        
        async shareAnalysis(analysisId) {
            try {
                await axios.post(`/api/satellite/share/${analysisId}`);
                this.showToast('‚úÖ Analiz payla≈üƒ±ldƒ±!');
            } catch (e) {
                console.error('Share hatasƒ±:', e);
                this.showToast('Payla≈üƒ±m ba≈üarƒ±sƒ±z');
            }
        },
        
        resetSatelliteForm() {
            this.satelliteEditMode = false;
            this.satelliteEditId = null;
            this.satelliteForm = {
                name: '',
                description: '',
                cropType: '',
                plantingDate: '',
                city: '',
                district: '',
                color: '#00b894',
                polygon: []
            };
        },
        
        addPolygonPoint(lat, lng) {
            this.satelliteForm.polygon.push({ lat, lng });
        },
        
        removePolygonPoint(index) {
            this.satelliteForm.polygon.splice(index, 1);
        },
        
        clearPolygon() {
            this.satelliteForm.polygon = [];
        },
        
        getCropTypeInfo(type) {
            return this.satelliteCropTypes.find(c => c.value === type) || { label: type, icon: 'fa-leaf' };
        },
        
        getHealthColor(status) {
            const colors = {
                'excellent': 'bg-green-500',
                'good': 'bg-teal-500',
                'moderate': 'bg-yellow-500',
                'poor': 'bg-orange-500',
                'critical': 'bg-red-500'
            };
            return colors[status] || 'bg-gray-500';
        },
        
        getHealthLabel(status) {
            const labels = {
                'excellent': 'M√ºkemmel',
                'good': 'ƒ∞yi',
                'moderate': 'Orta',
                'poor': 'Zayƒ±f',
                'critical': 'Kritik'
            };
            return labels[status] || status;
        },
        
        getHealthIcon(status) {
            const icons = {
                'excellent': 'fa-check-circle',
                'good': 'fa-thumbs-up',
                'moderate': 'fa-exclamation-circle',
                'poor': 'fa-exclamation-triangle',
                'critical': 'fa-times-circle'
            };
            return icons[status] || 'fa-question-circle';
        },
        
        formatNDVI(value) {
            return value ? value.toFixed(2) : '0.00';
        },
        
        formatArea(value) {
            return parseFloat(value || 0).toFixed(2);
        }
    }
}
    </script>

    <script>
        // Global mention click function - D√ºzeltilmi≈ü
        window.viewUserByUsername = async function(username) {
            // Alpine.js uyumlu element bul
            let app = null;
            const appEl = document.querySelector('[x-data]');
            
            if (appEl) {
                // Alpine 3.x i√ßin
                if (appEl._x_dataStack && appEl._x_dataStack[0]) {
                    app = appEl._x_dataStack[0];
                } 
                // Alpine 2.x i√ßin fallback
                else if (appEl.__x && appEl.__x.$data) {
                    app = appEl.__x.$data;
                }
            }
            
            if (app) {
                try {
                    const res = await axios.get(`api/users/search?q=${encodeURIComponent(username)}`);
                    const users = res.data.users || [];
                    const user = users.find(u => u.username && u.username.toLowerCase() === username.toLowerCase());
                    if (user) {
                        app.viewProfile(user.id);
                    } else {
                        app.showToast('Kullanƒ±cƒ± bulunamadƒ±: @' + username);
                    }
                } catch (e) {
                    console.error('Kullanƒ±cƒ± arama hatasƒ±:', e);
                    app.showToast('Kullanƒ±cƒ± bulunamadƒ±');
                }
            }
        }
        
        // Alpine.js 3.x i√ßin searchHashtag d√ºzeltmesi
        window.searchHashtag = function(tag) {
            const appEl = document.querySelector('[x-data]');
            let app = null;
            
            if (appEl) {
                if (appEl._x_dataStack && appEl._x_dataStack[0]) {
                    app = appEl._x_dataStack[0];
                } else if (appEl.__x && appEl.__x.$data) {
                    app = appEl.__x.$data;
                }
            }
            
            if (app && app.searchByHashtag) {
                app.searchByHashtag(tag);
            }
        }
        
        // URL Routing - Post ve Profil Payla≈üƒ±m Sayfalarƒ±
        window.handleSharedURL = async function() {
            const path = window.location.pathname;
            const appEl = document.querySelector('[x-data]');
            let app = null;
            
            if (appEl && appEl._x_dataStack && appEl._x_dataStack[0]) {
                app = appEl._x_dataStack[0];
            }
            
            if (!app) return;
            
            // Post URL: /p/:postId
            const postMatch = path.match(/^\/p\/(.+)$/);
            if (postMatch) {
                const postId = postMatch[1];
                app.loadSharedPost(postId);
                return;
            }
            
            // Profil URL: /u/:userId
            const userMatch = path.match(/^\/u\/(.+)$/);
            if (userMatch) {
                const userId = userMatch[1];
                app.loadSharedProfile(userId);
                return;
            }
        };
        
        // Sayfa y√ºklendiƒüinde URL kontrol√º
        document.addEventListener('DOMContentLoaded', handleSharedURL);
    </script>
    
    <!-- ========== üìó FARMBOOK MODAL ========== -->
    
    <!-- ========== üõ∞Ô∏è UYDU TARLAM (NDVI) MODAL ========== -->
    
    <!-- ONBOARDING KALDIRILDI -->
    </div>

<script>
// =============================================================================
// üì© WEB PUSH NOTIFICATION SYSTEM
// =============================================================================

let pushSubscription = null;
let vapidPublicKey = null;

// Service Worker devre dƒ±≈üƒ±
async function registerServiceWorker() {
    return null;
}

// VAPID Public Key Al
async function getVapidPublicKey() {
    try {
        const response = await axios.get('/api/push/vapid-public-key');
        vapidPublicKey = response.data.publicKey;
        console.log('üîë VAPID Public Key alƒ±ndƒ±');
        return vapidPublicKey;
    } catch (error) {
        console.error('‚ùå VAPID key alma hatasƒ±:', error);
        return null;
    }
}

// URL-safe base64 to Uint8Array
function urlBase64ToUint8Array(base64String) {
    const padding = '='.repeat((4 - base64String.length % 4) % 4);
    const base64 = (base64String + padding)
        .replace(/\-/g, '+')
        .replace(/_/g, '/');
    const rawData = window.atob(base64);
    const outputArray = new Uint8Array(rawData.length);
    for (let i = 0; i < rawData.length; ++i) {
        outputArray[i] = rawData.charCodeAt(i);
    }
    return outputArray;
}

// Push Notification ƒ∞zni ƒ∞ste ve Subscribe Et
async function subscribeToPushNotifications() {
    try {
        // √ñnce Service Worker'ƒ± kontrol et
        const registration = await navigator.serviceWorker.ready;
        
        if (!registration) {
            console.error('‚ùå Service Worker hazƒ±r deƒüil');
            return false;
        }
        
        // Bildirim izni iste
        const permission = await Notification.requestPermission();
        
        if (permission !== 'granted') {
            console.log('‚ùå Bildirim izni verilmedi:', permission);
            return false;
        }
        
        console.log('‚úÖ Bildirim izni verildi!');
        
        // VAPID key al
        if (!vapidPublicKey) {
            await getVapidPublicKey();
        }
        
        if (!vapidPublicKey) {
            console.error('‚ùå VAPID key alƒ±namadƒ±');
            return false;
        }
        
        // Push Manager'dan subscription al
        pushSubscription = await registration.pushManager.subscribe({
            userVisibleOnly: true,
            applicationServerKey: urlBase64ToUint8Array(vapidPublicKey)
        });
        
        console.log('üì© Push subscription olu≈üturuldu:', pushSubscription);
        
        // Server'a kaydet
        const response = await axios.post('/api/push/subscribe', {
            endpoint: pushSubscription.endpoint,
            keys: {
                p256dh: btoa(String.fromCharCode.apply(null, new Uint8Array(pushSubscription.getKey('p256dh')))),
                auth: btoa(String.fromCharCode.apply(null, new Uint8Array(pushSubscription.getKey('auth'))))
            }
        });
        
        if (response.data.success) {
            console.log('‚úÖ Push subscription kaydedildi!');
            return true;
        } else {
            console.error('‚ùå Subscription kaydedilemedi');
            return false;
        }
        
    } catch (error) {
        console.error('‚ùå Push subscription hatasƒ±:', error);
        return false;
    }
}

// Push Notification Aboneliƒüini Kaldƒ±r
async function unsubscribeFromPushNotifications() {
    try {
        if (!pushSubscription) {
            const registration = await navigator.serviceWorker.ready;
            pushSubscription = await registration.pushManager.getSubscription();
        }
        
        if (!pushSubscription) {
            console.log('üì© Zaten abonelik yok');
            return true;
        }
        
        // Server'dan kaldƒ±r
        await axios.post('/api/push/unsubscribe', {
            endpoint: pushSubscription.endpoint
        });
        
        // Browser'dan kaldƒ±r
        await pushSubscription.unsubscribe();
        pushSubscription = null;
        
        console.log('‚úÖ Push subscription kaldƒ±rƒ±ldƒ±!');
        return true;
        
    } catch (error) {
        console.error('‚ùå Unsubscribe hatasƒ±:', error);
        return false;
    }
}

// Test Bildirimi G√∂nder
async function sendTestNotification() {
    try {
        const response = await axios.post('/api/push/test');
        
        if (response.data.success) {
            console.log('‚úÖ Test bildirimi g√∂nderildi!');
            return true;
        } else {
            console.error('‚ùå Test bildirimi g√∂nderilemedi');
            return false;
        }
        
    } catch (error) {
        console.error('‚ùå Test bildirimi hatasƒ±:', error);
        return false;
    }
}

// Push Notification Desteƒüini Kontrol Et
function checkPushNotificationSupport() {
    if (!('serviceWorker' in navigator)) {
        console.warn('‚ö†Ô∏è Service Worker desteklenmiyor');
        return false;
    }
    
    if (!('PushManager' in window)) {
        console.warn('‚ö†Ô∏è Push API desteklenmiyor');
        return false;
    }
    
    if (!('Notification' in window)) {
        console.warn('‚ö†Ô∏è Notification API desteklenmiyor');
        return false;
    }
    
    console.log('‚úÖ Push Notification tam destekleniyor!');
    return true;
}

// Sayfa Y√ºklendiƒüinde Otomatik Ba≈ülat
window.addEventListener('load', async function() {
    console.log('üì© Web Push devre dƒ±≈üƒ± (SW yok)');
    return; // SW devre dƒ±≈üƒ±
    console.log('üì© Web Push sistemi ba≈ülatƒ±lƒ±yor...');
    
    // Destek kontrol√º
    if (!checkPushNotificationSupport()) {
        console.warn('‚ö†Ô∏è Bu tarayƒ±cƒ± Web Push desteklemiyor');
        return;
    }
    
    // Service Worker kaydet
    const registration = await registerServiceWorker();
    
    if (!registration) {
        console.error('‚ùå Service Worker kaydedilemedi');
        return;
    }
    
    // VAPID key al
    await getVapidPublicKey();
    
    // Eƒüer kullanƒ±cƒ± giri≈ü yapmƒ±≈üsa ve daha √∂nce izin verdiyse otomatik subscribe
    // üîí G√úVENLƒ∞K NOTU: Token localStorage yerine HttpOnly cookie i√ßinde tutulmalƒ±dƒ±r.
    // localStorage XSS saldƒ±rƒ±sƒ±yla √ßalƒ±nabilir; HttpOnly cookie JavaScript'ten eri≈üilemez.
    // Sunucu tarafƒ±nda: res.cookie('token', jwt, { httpOnly: true, secure: true, sameSite: 'strict' })
    // ƒ∞deal √ß√∂z√ºm: Bu satƒ±r kaldƒ±rƒ±lƒ±p cookie tabanlƒ± auth'a ge√ßilmelidir.
    const token = localStorage.getItem('_agro_secure_token');
    if (token && Notification.permission === 'granted') {
        console.log('üîÑ Otomatik push subscription kontrol ediliyor...');
        
        try {
            const existingSub = await registration.pushManager.getSubscription();
            if (!existingSub) {
                console.log('üì© Yeni subscription olu≈üturuluyor...');
                await subscribeToPushNotifications();
            } else {
                console.log('‚úÖ Push subscription zaten aktif');
                pushSubscription = existingSub;
            }
        } catch (error) {
            console.error('‚ùå Auto-subscribe hatasƒ±:', error);
        }
    }
    
    console.log('‚úÖ Web Push sistemi hazƒ±r!');
});

// üîí G√úVENLƒ∞K: window.webPush global eri≈üim KALDIRILDI
// Console √ºzerinden yetkisiz test bildirimi g√∂nderilmesini √∂nler.
// Push fonksiyonlarƒ±nƒ± yalnƒ±zca i√ß Alpine.js state √ºzerinden √ßaƒüƒ±rƒ±n.
// console.log('üì© Web Push fonksiyonlarƒ± hazƒ±r! Test i√ßin: window.webPush.test()'); // Kaldƒ±rƒ±ldƒ±
</script>

</body>
</html>
